@DICTIONARY_FALLED_MAIN
#DIM PAGE
#DIM RACE
#DIM LINE
#DIM C_NO
#DIM L_COUNT, 3
#LOCALSIZE 320
LINE = LINECOUNT
RACE = -1
PAGE = 0
$START
VARSET LOCAL, -1
CLEARLINE LINECOUNT
DRAWLINE
L_COUNT:1 = 0
;リスト등록
FOR L_COUNT, 0, 5300
	;一応CSVの存在で弾く
	SIF !EXISTCSV(L_COUNT, 0)
		CONTINUE
	;조교したことがあるキャラのみ
	SIF !FLAG:(50000+L_COUNT)
		CONTINUE
	;종족が一致していない
	SIF RACE != CSVABL(L_COUNT, GETNUM(ABL, "종족"), 0)
		CONTINUE
	;마인の娘も除外
	SIF L_COUNT == 3502
		CONTINUE
	LOCAL:(L_COUNT:1) = L_COUNT
	L_COUNT:1++
NEXT

IF RACE != 999
	;리스트표시
	FOR L_COUNT, 0 , 40
		C_NO = LOCAL:(PAGE * 40 + L_COUNT)
		IF C_NO >= 0
			SIF FLAG:(50000+C_NO) == 255
				SETCOLOR COLOR("PINK")
			PRINTPLAINFORM [{C_NO,4}] %CSVCALLNAME(C_NO, 0), 20, LEFT%
			RESETCOLOR
			;処女履歴を後ろに表示させるため力技で解決
			FOR L_COUNT:1, 1, 10
				SIF L_COUNT:1 == 7
					CONTINUE
			SETCOLOR GETBIT(FLAG:(50000+C_NO), L_COUNT:1) ? COLOR("aqua") # COLOR("light-gray")
			PRINTFORM %AUTO_SPLIT("/연/친/음/창/복/예/○/신/동/처", "/", L_COUNT:1)%
;			PRINTFORM %AUTO_SPLIT("/ 1/ 2/ 3/ 4/ 5/ 6/○/ 8/ 9/ 7", "/", L_COUNT:1)%
			RESETCOLOR
		NEXT
		SETCOLOR GETBIT(FLAG:(50000+C_NO), 7) ? COLOR("aqua") # COLOR("light-gray")
				PRINTFORM  처녀
			RESETCOLOR
		PRINT 　　
	ELSE
		PRINTFORM %" "*53%
	ENDIF
	SIF L_COUNT % 2
		PRINTL 
NEXT
ELSEIF RACE == 999
	;함락数
	VARSET LOCAL
	FOR L_COUNT, 0, 10000
		SIF !EXISTCSV(L_COUNT, 0)
			CONTINUE
		SIF GETBIT(FLAG:(L_COUNT+50000) , 1) || GETBIT(FLAG:(L_COUNT+50000) , 2) || GETBIT(FLAG:(L_COUNT+50000) , 3) || GETBIT(FLAG:(L_COUNT+50000) , 4) || GETBIT(FLAG:(L_COUNT+50000) , 5) || GETBIT(FLAG:(L_COUNT+50000) , 6) || GETBIT(FLAG:(L_COUNT+50000) , 8) || GETBIT(FLAG:(L_COUNT+50000) , 9)
			LOCAL:CSVABL(L_COUNT, GETNUM(ABL, "종족"), 0)++
	NEXT

	FOR L_COUNT, 0 ,74
		;とりあず除外
		SIF GROUPMATCH(STR:L_COUNT, "어령", "보스전용", "링크전용", "페르소나전용", "페르소나２", "음마", "")
			CONTINUE
		;調教可能な種族だけ表示
		PRINTFORML  %STR:L_COUNT,6,LEFT% : {LOCAL:L_COUNT,3} 体함락
	NEXT
	VARSET LOCAL, -1
ENDIF

DRAWLINE
;とりあえず인간を含んだ一般종족のみ
L_COUNT:1 = 0
FOR L_COUNT, 0, 45
	SIF STR:L_COUNT == ""
		CONTINUE
	;とりあず除外
	SIF GROUPMATCH(STR:L_COUNT, "머신", "어령", "칠성", "광인", "보스전용", "페르소나전용", "페르소나２", "초인")
		CONTINUE
	PRINTFORM [{L_COUNT,2}] %STR:L_COUNT,8,LEFT%
	SIF L_COUNT:1 % 6 == 5
		PRINTL 
	L_COUNT:1++
NEXT
PRINTFORM [73] %STR:73,8,LEFT%

PRINTFORM [999] 함락수

SIF !LINEISEMPTY()
	PRINTL 
DRAWLINE
IF PAGE > 0
	PRINTFORM %"[ 99] 전 페이지",30,LEFT%
ELSE
	PRINTFORM %"",30,LEFT%
ENDIF
PRINTFORM %"[100] 돌아간다",30,LEFT%
SIF LOCAL:((PAGE+1) * 40) >= 0
	PRINTFORM %"[101] 다음 페이지",30,LEFT%
PRINTL 
INPUT
SIF RESULT == 99 && PAGE > 0
	PAGE--
SIF RESULT == 100
	RETURN 0
SIF RESULT == 101 && PAGE < 8 && LOCAL:((PAGE+1) * 40) >= 0
	PAGE++
IF RANGE(RESULT, 0, 45) && !GROUPMATCH(STR:L_COUNT, "머신", "어령", "칠성", "광인", "보스전용", "페르소나전용", "페르소나２", "초인") && STR:RESULT != ""
	RACE = RESULT
	PAGE = 0
ENDIF
IF RESULT == 999
	RACE = RESULT
	PAGE = 0
ENDIF
GOTO START
