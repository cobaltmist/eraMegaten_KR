;=======================================================================
;샘플던전
;던전のテン플레이트みたいなものです
;던전ナンバー0
;=======================================================================

;던전フラグ:83:0 = 1.クリアフラグ
;던전フラグ:83:1 = 1.初回
;던전フラグ:83:2 = 1.カードキー
;던전フラグ:83:3 = 1.扉の체크
;던전フラグ:83:10- = 1.宝箱



;=======================================================================
;攻略조건
;=======================================================================
@PREREQUISITE_DUNGEON_83
IF  의뢰플래그:5:0 == 3 & !던전フラグ:83:0
	RETURN 1
ENDIF

;=======================================================================
;던전名
;=======================================================================
@GET_DUNGEON_NAME_83
RESULTS = 히라사키경찰서

;=======================================================================
;フ로어名표시
;=======================================================================
@FLOORNAME_83
PRINT  히라사키경찰서
SELECTCASE FLAG:現M
	CASE 0
		PRINTL B1F
	CASE 1
		PRINTL 1F
	CASE 2
		PRINTL 2F
	CASE 3
		PRINTL 3F
	CASEELSE
		PRINTL
ENDSELECT
;=======================================================================
;スタート地点입력
;=======================================================================
@START_DUNGEON_83,ARG
FLAG:現M = 1
FLAG:現X = 7
FLAG:現Y = 11

;=======================================================================
;スタート時이벤트
;=======================================================================
@EVENT_DUNGEON_START_83
IF 던전フラグ:83:1 == 0
	CALL SHOW_PICTURE, "NONFLOORD"
	CALL MESSAGE_WINDOW_D, "", @"＞히라사키 경찰로부터 의뢰를 받은 %조사처리(CALLNAME:MASTER,"는")%/＞이계화된 서내에 발을 들였다"
	CALL MESSAGE_WINDOW_D, "", "＞이 경찰서는 숙청 의뢰를 받은 조직의 배신자가 관리하는 곳이다/＞아마 당신을 저쪽과 공멸시킬 계획인듯 하다"
	던전フラグ:83:1 = 1
ENDIF

;=======================================================================
;フ로어데이터
;=======================================================================
@MAKE_FLOOR_83
SELECTCASE FLAG:現M
	CASE 0
		FLAG:최대X = 13 
		FLAG:최대Y = 16 
		;                        0123456789012
		CALL MAKE_FLOOR_LINE, 0,"             "
		CALL MAKE_FLOOR_LINE, 1," D211 6 112D "
		CALL MAKE_FLOOR_LINE, 2," D    2    D "
 		CALL MAKE_FLOOR_LINE, 3," DDDDDDDDDDD "
		CALL MAKE_FLOOR_LINE, 4," D  2 D 2  D "
		CALL MAKE_FLOOR_LINE, 5," D  4 D 4  D "
		CALL MAKE_FLOOR_LINE, 6," D    D    D "
		CALL MAKE_FLOOR_LINE, 7," DDDDDD4DDDD "
		CALL MAKE_FLOOR_LINE, 8," D   D D   D "
		CALL MAKE_FLOOR_LINE, 9," D   D D   D "
		CALL MAKE_FLOOR_LINE,10," DD4DDDDDDD4 "
		CALL MAKE_FLOOR_LINE,11,"     D D   D "
		CALL MAKE_FLOOR_LINE,12," DDD D D   D "
		CALL MAKE_FLOOR_LINE,13," 2 D       D "
		CALL MAKE_FLOOR_LINE,14," E DDDDDDDDD "
		CALL MAKE_FLOOR_LINE,15,"             "
		;                        0123456789012
		
		
	CASE 1
		FLAG:최대X = 15 
		FLAG:최대Y = 13 
		;                        012345678901234
 		CALL MAKE_FLOOR_LINE, 0,"               "
		CALL MAKE_FLOOR_LINE, 1," 41 4 716 4 14 "
		CALL MAKE_FLOOR_LINE, 2,"  1 2  2  2 1  "
		CALL MAKE_FLOOR_LINE, 3,"  1 1111111 1  "
		CALL MAKE_FLOOR_LINE, 4," 11    1    11 "
		CALL MAKE_FLOOR_LINE, 5,"  1 4     4 1  "
		CALL MAKE_FLOOR_LINE, 6,"  1 1  4  1 1  "
		CALL MAKE_FLOOR_LINE, 7," 41 2  2  2 14 "
		CALL MAKE_FLOOR_LINE, 8,"    1114111    "
		CALL MAKE_FLOOR_LINE, 9," 13 1111111    "
		CALL MAKE_FLOOR_LINE,10," 2  11 2 11    "
		CALL MAKE_FLOOR_LINE,11," E     8       "
		CALL MAKE_FLOOR_LINE,12,"               "
		;                        012345678901234
		
		
		CASE 2
		FLAG:최대X = 15 
		FLAG:최대Y = 13 
		;                        012345678901234
 		CALL MAKE_FLOOR_LINE, 0,"               "
		CALL MAKE_FLOOR_LINE, 1," 1 421 7 121 1 "
		CALL MAKE_FLOOR_LINE, 2," 1   1 2 1   1 "
		CALL MAKE_FLOOR_LINE, 3," 1   11111   1 "
		CALL MAKE_FLOOR_LINE, 4," 1           1 "
		CALL MAKE_FLOOR_LINE, 5," 1111111111111 "
		CALL MAKE_FLOOR_LINE, 6," 1           1 "
		CALL MAKE_FLOOR_LINE, 7," 1   1 111   1 "
		CALL MAKE_FLOOR_LINE, 8," 1   1 2 1   1 "
		CALL MAKE_FLOOR_LINE, 9," 1 421 6 1   1 "
		CALL MAKE_FLOOR_LINE,10," 2   1   1   1 "
		CALL MAKE_FLOOR_LINE,11," E   11111 111 "
		CALL MAKE_FLOOR_LINE,12,"               "
		;                        012345678901234
		
		
		
		CASE 3
		FLAG:최대X = 15 
		FLAG:최대Y = 13 
		;                        012345678901234
 		CALL MAKE_FLOOR_LINE, 0,"               "
		CALL MAKE_FLOOR_LINE, 1," 5111 4 111513 "
		CALL MAKE_FLOOR_LINE, 2,"    1 2   1  2 "
		CALL MAKE_FLOOR_LINE, 3," 3  1 1   1  1 "
		CALL MAKE_FLOOR_LINE, 4," 1  1 1   1  1 "
		CALL MAKE_FLOOR_LINE, 5," 1111211111111 "
		CALL MAKE_FLOOR_LINE, 6," 1  1 1   1  1 "
		CALL MAKE_FLOOR_LINE, 7," 1  1 1   1  1 "
		CALL MAKE_FLOOR_LINE, 8," 1  1 2   1  1 "
		CALL MAKE_FLOOR_LINE, 9," 1  1 7   1  1 "
		CALL MAKE_FLOOR_LINE,10," 2 11     1  2 "
		CALL MAKE_FLOOR_LINE,11," E 111111515 3 "
		CALL MAKE_FLOOR_LINE,12,"               "
		;                        012345678901234
		
	
	CASEELSE
ENDSELECT


;=======================================================================
;タイル調整
;=======================================================================
@MAKE_FLOOR_LINE_COMMON_83, ARG, ARG:1, ARG:2
#LOCALSIZE 20
SIF ARG:1 == 0 && ARG:2 == 0
	VARSET LOCAL
SELECTCASE ARG
	CASE 3
		IF GETBIT(던전フラグ:(FLAG:現던전):(FLAG:現M+10), LOCAL:3)
			DA:(ARG:1):(ARG:2) = 1
			ELSE
			DA:(ARG:1):(ARG:2) = FLAG:現M *1000 + LOCAL:3 * 10 + 3
		ENDIF
		LOCAL:3++
	CASE 4 TO 9
		DA:(ARG:1):(ARG:2) = FLAG:現M *1000 + LOCAL:ARG * 10 + ARG
		LOCAL:ARG++
	
ENDSELECT

;=======================================================================
;指定したマスに進入可能か
;=======================================================================
@CAN_ENTER_83,ARG,ARG:1


IF FLAG:現M == 3 && ARG == 6 && ARG:1 == 2 
	CALL MESSAGE_WINDOW_D, "", "＞ここは署長室のようだ/＞문을 열겠습니까？"
			CALL INPUT_YN_D
			IF RESULT == 0
				IF 던전フラグ:83:2 == 0
				CALL MESSAGE_WINDOW_D, "", "＞락이 걸려있습니다/＞카드키가 없으면 열리지 않는 듯 하다"
				RESULT = 1
				던전フラグ:83:3 = 1
				ENDIF
			ELSE
			ENDIF
		SIF RESULT
			RETURN 0
ENDIF

CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT

;=======================================================================
;タイル定義
;=======================================================================
@TILE_MARK_COMMON_83_4, ARG , ARG:1 , ARG:2
SELECTCASE ARG / 10
	CASE 2,3,4
	IF FLAG:라이트마 || (EQUIP:MASTER:다크스캐너 && NUM_SUMMONER())
		RESULTS = \@GET_FLOOR_ANALYZE_T(ARG:1, ARG:2) == 2 ?Ｗ#□\@
	ELSE
		SETCOLOR 0x404040
		RESULTS = □
	ENDIF
	CASE 0,1,109,200,201
		SETCOLOR 0x00ff00
		RESULTS = ｍ
	CASE 300
		RESULTS = ！
	CASEELSE
		RESULTS = \@GET_FLOOR_ANALYZE_T(ARG:1, ARG:2) == 2 ?Ｗ#□\@
ENDSELECT

@TILE_MARK_COMMON_83_D, ARG, ARG:1, ARG:2
IF FLAG:라이트마 || (EQUIP:MASTER:다크스캐너 && NUM_SUMMONER())
	SELECTCASE ARG/10
		CASEELSE
			RESULTS = □
	ENDSELECT
ELSE
	SETCOLOR 0x404040
	SELECTCASE ARG/10
		CASEELSE
			RESULTS = □
	ENDSELECT
ENDIF

;=======================================================================
;[5]調べる　実行時の이벤트
;=======================================================================
@EVENT_CHECK_DUNGEON_83

;==========
;出입の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) % 10 == 8
		CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 3
	CALL TRESURING_CALLING_83
	RETURN RESULT

;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 6
	CALL UPSTAIRS_83
	RETURN RESULT

ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 7
	CALL DOWNSTAIRS_83
	RETURN RESULT

;==========
;이벤트の処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 4

SELECTCASE FLAG:現M
	CASE 0
		IF FLAG:現X == 4 && FLAG:現Y == 5
			CALL MESSAGE_WINDOW_D, "용의자", "경찰도 가장 파티같은 거、하는거냐？/갸ー갸ー소리지르면서、악마같은 것들이 돌아다니고 있다고。/나도 나쁜 짓은、꽤나 저질렀던 축이지만、놈들이 쓰고있는 가면정도로、/불길한 표정은 본 적이 없어。"
		ELSEIF  FLAG:現X == 8 && FLAG:現Y == 5
			IF 던전フラグ:83:2 == 0
				CALL MESSAGE_WINDOW_D, "모모치 경부", "설마、내가 돼지우리에 쳐넣어지다니、생각치 못했다。/이 곳의 일련의 괴물 소동 수사를 진행하려 했더니、/서장이 그만두라고 말해왔다。"
				CALL MESSAGE_WINDOW_D, "모모치 경부", "거절했더니、즉각、돼지우리 행으로 이 꼴이다。/아무래도、일련의 괴물 소동에는、서장도 얽혀있는 것 같다。/단숨에 서장을 처리하면、괴물들도、사라질지도 모르겠군。" 
				IF 던전フラグ:83:3 == 1
					CALL MESSAGE_WINDOW_D, "모모치 경부", "응？　카드키라고？ 좋다、너에게 빌려주지。/이대로는 여기서 순직해 버리겠군。/괴물들이 사라질 때까지 남아있겠네" 
					CALL MESSAGE_WINDOW_D, "", "＞카드키를 손에 넣었다"
					던전フラグ:83:2 = 1
				ENDIF
			ELSE
				CALL MESSAGE_WINDOW_D, "모모치 경부", "나는 괴물들이 사라질 때까지 남아있겠네" 
			ENDIF
		ENDIF
		
	CASE 1
		IF FLAG:現X == 7 && FLAG:現Y == 8
			CALL MESSAGE_WINDOW_D, "이소노 형사", "모모치 경부가、부당하게 감금당해 버려서 구출하러 가던 참이지만…/서내는 괴물이 어슬렁거리고、경부의 소재도 모르고、손을 쓸 수 없는 거다。/……괴、괴물이 무서운게 아니라고。"
			CALL MESSAGE_WINDOW_D, "이소노 형사", "그런데、괴물퇴치 전문가、데빌 서머너라는 자가 있다고 해서、/서내의 괴물퇴치를 의뢰한 것이다。/대리인에게는、￥1000000.이나 뜯겼지만、존경하는 모모치 경부를 구하기 위해서다。"
			CALL MESSAGE_WINDOW_D, "이소노 형사", "돈은、신경쓰지 않아。/……신경쓰지 않지만、비상금이 날아갔다……/모처럼、경마에서 이겼는데……。"
		ENDIF
	CASE 2
		IF FLAG:現X == 3 && FLAG:現Y == 1
			CALL MESSAGE_WINDOW_D, "경관", "보、본관、경찰의 생명이라고 할/권총의 신병을 확보하고 싶은 것입니다만……/복잡 괴기한 순간이동지대에 의해、진로를 저지받고 있는 것입니다！"
			CALL MESSAGE_WINDOW_D, "경관", "같은 장소인데 들어가는 방향에 따라/다른 장소에 가거나 하는 것입니다！/와、완전히 미궁에 빠진 것입니다！ "
		ELSEIF  FLAG:現X == 3 && FLAG:現Y == 9
			CALL MESSAGE_WINDOW_D, "경관", "히엑ー、악마가 나왔다아！ 악마다、놈들은 악마야。/나、나는 경관이라고오！ 그래、난 몰라。/놈들의 상대는 자위대가、하면 되는거야！"
		ENDIF
		ENDSELECT
	RETURN 1
	 
ELSE
	CALL MESSAGE_WINDOW_D, "", "＞아무것도 없는 것 같다"
	RETURN 0
ENDIF

;=======================================================================
;タイル進入時の이벤트
;=======================================================================
@EVENT_ENTER_DUNGEON_83,ARG
;ARG = 進入時の向き　0の場合ワープなど
;==========
;出입の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) % 10 == 8
	CALL DUNGEON_EXIT
	RETURN 1

;========
;宝の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 3
	CALL TRESURING_CALLING_83
	RETURN RESULT
	
;========
;罠の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 ==  5 
	CALL TRAP_83
	RETURN RESULT
	
;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 2
	CALL DUNGEON_DOOR,ARG
	RETURN 1

;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 6
	CALL UPSTAIRS_83
	RETURN RESULT

ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 7
	CALL DOWNSTAIRS_83
	RETURN RESULT
	
;==========
;이벤트の処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 4
	SELECTCASE FLAG:現M 
	CASE 0
			IF FLAG:現X == 3 && FLAG:現Y == 10
				FLAG:現X = 8
				FLAG:現Y = 1
			ELSEIF FLAG:現X == 11 && FLAG:現Y == 10
				FLAG:現X = 6
				FLAG:現Y = 5
			ELSEIF FLAG:現X == 7 && FLAG:現Y == 7
			IF FLAG:現Y > ARG
				FLAG:現X = 4
				FLAG:現Y = 1
			ELSE
				FLAG:現X = 11
				FLAG:現Y = 11
			ENDIF
		ENDIF
	CASE 1
			IF FLAG:現X == 7 && FLAG:現Y == 6
				FLAG:現X = 10
				FLAG:現Y = 1
			ELSEIF FLAG:現X == 10 && FLAG:現Y == 1
				FLAG:現X = 7
				FLAG:現Y = 9
			ELSEIF FLAG:現X == 4 && FLAG:現Y == 1
				FLAG:現X = 7
				FLAG:現Y = 6
			ELSEIF FLAG:現X == 4 && FLAG:現Y == 5
				FLAG:現X = 13
				FLAG:現Y = 4
			ELSEIF FLAG:現X == 10 && FLAG:現Y == 5
				FLAG:現X = 1
				FLAG:現Y = 4
			ELSEIF FLAG:現X == 13 && FLAG:現Y == 1
				FLAG:現X = 7
				FLAG:現Y = 4
			ELSEIF FLAG:現X == 13 && FLAG:現Y == 7
				FLAG:現X = 1
				FLAG:現Y = 1
			ELSEIF FLAG:現X == 1 && FLAG:現Y == 1
				FLAG:現X = 13
				FLAG:現Y = 7
			ELSEIF FLAG:現X == 1 && FLAG:現Y == 7
				FLAG:現X = 13
				FLAG:現Y = 1
			ENDIF
		CASE 3
		IF FLAG:現X == 6 && FLAG:現Y == 1
		CALL MESSAGE_WINDOW_D, "경찰서장", "서장실에 들어올땐 노크를 하게。"
		CALL MESSAGE_WINDOW_D, "경찰서장", @"자넨 아마……/우리들의 협력자들을 차례차례 꺾고있다는 쥐새끼……/%CALLNAME:MASTER%군……이었던가。"
		CALL MESSAGE_WINDOW_D, "경찰서장", "뭐、자네같은 쥐새끼 한마리가 뭘하든、상관 없지。/계획은、착착 진행되고 있다。"
		CALL MESSAGE_WINDOW_D, "경찰서장", "그래、대부분의 봉인은 파괴되고、/이제는 최후의 봉인을 파괴할 때……"
		CALL MESSAGE_WINDOW_D, "경찰서장", "이 이상은、자네가 알아도 소용없다。/왜냐하면、자네는 여기서 최후를 맞이 할테니。"
		CALL MESSAGE_WINDOW_D, "", "＞경찰서장의 모습이 순식간에 악마의 모습으로 변해간다"
		CALL MESSAGE_WINDOW_D, "쿠반다", "일개 병졸이 조직의 간부인 내손에 걸려 죽다니、/행복하다 생각해라。"
		CALL MESSAGE_WINDOW_D, "", "＞유귀 쿠반다가 １체 나왔다！"
		
		FLAG:도주불가플래그 = 1
		FLAG:회화불능플래그 = 1
		FLAG:선제기습취소 = 1
		
			;쿠반다
				CALL SET_ENEMY,9,[[キャラ:쿠반다]],53,0,1
				CFLAG:(CHARANUM-1):ＨＰ보정 = 3500
				CFLAG:(CHARANUM-1):ＭＰ보정 = 8000
				CFLAG:(CHARANUM-1):행동횟수 = 2
				CFLAG:(CHARANUM-1):속도보정 = 15
				BASE:(CHARANUM-1):힘 += 5
				BASE:(CHARANUM-1):지혜 += 5
				BASE:(CHARANUM-1):마력 += 5
				BASE:(CHARANUM-1):속도 += 10
				BASE:(CHARANUM-1):전격 = 75
				BASE:(CHARANUM-1):충격 = 75
				BASE:(CHARANUM-1):질풍 = 75
				ABL:(CHARANUM-1):최저공격횟수 = 2
				ABL:(CHARANUM-1):최대공격횟수 = 3
				ABL:(CHARANUM-1):스킬1 = [[스킬:어둠의심판]]
				ABL:(CHARANUM-1):스킬2 = [[스킬:절대영도]]
				ABL:(CHARANUM-1):스킬3 = [[스킬:마카라칸]]
				ABL:(CHARANUM-1):스킬4 = [[스킬:마계의조사]]
				ABL:(CHARANUM-1):스킬5 = [[스킬:메기도라]]
				ABL:(CHARANUM-1):스킬6 = [[스킬:대냉계]]
				ABL:(CHARANUM-1):아이템3 = GETNUM(ITEM, "인내력의향")
				ABL:(CHARANUM-1):입수확률3 = 100
				CSTR:(CHARANUM-1):사고패턴 = D83_쿠반다
				CALL SYNC_STATUS,(CHARANUM-1)
				CALL HEALTH_CHARA,(CHARANUM-1)
				CALL BATTLE_START
		FLAG:도주불가플래그 = 0
		FLAG:회화불능플래그 = 0
		FLAG:선제기습취소 = 0
		
		CALL MESSAGE_WINDOW_D, "쿠반다", "……내가 최후를 맞다니。/하지만、봉인의 힘이 없어질 때까지、조금이다/그 때는、너도 최후다……。"
		CALL MESSAGE_WINDOW_D, "", "＞유귀 쿠반다는 힘이 다했다…"
		CALL MESSAGE_WINDOW_D, "", "＞강경파의 배신자・유귀 쿠반다를 토벌함에 따라、/＞포상으로 ￥50000가 지급되고、명성 200이 올랐다"
		MONEY += 50000
		FLAG:명성 += 200
		던전フラグ:83:0 = 1
		FLAG:탈출 = 1
		ENDIF
	ENDSELECT
ENDIF

;쿠반다전투行動
@SET_ACTION_D83_쿠반다,ARG
;입력행동を-1と타겟を-1にしておく
CFLAG:ARG:입력행동 = -1
CFLAG:ARG:타겟 = -1

IF CFLAG:ARG:１more플래그 > 0
	IF RAND:2 == 0
CFLAG:ARG:입력행동 = [[스킬:대냉계]]
	ELSE
CFLAG:ARG:입력행동 = [[스킬:메기도라]]
	ENDIF
	
ELSEIF CFLAG:ARG:행동한횟수 == 0
	SELECTCASE RAND:100
		CASE 0 TO 20
			CFLAG:ARG:입력행동 = [[스킬:절대영도]]
		CASE 21 TO 50
			CFLAG:ARG:입력행동 = [[스킬:마카라칸]]
		CASE 51 TO 80
			CFLAG:ARG:입력행동 = [[스킬:마계의조사]]
		CASEELSE
			CFLAG:ARG:입력행동 = [[스킬:어둠의심판]]
		ENDSELECT
ELSE
		SELECTCASE RAND:100
		CASE 0 TO 24
			CFLAG:ARG:입력행동 = [[스킬:절대영도]]
		CASE 25 TO 49
			CFLAG:ARG:입력행동 = [[스킬:마계의조사]]
		CASE 50 TO 75
			CFLAG:ARG:입력행동 = [[스킬:메기도라]]
		CASE 76 TO 90
			CFLAG:ARG:입력행동 = [[스킬:ＡＴＴＡＣＫ]]
		CASEELSE
			CFLAG:ARG:입력행동 = [[스킬:대냉계]]
		ENDSELECT
	ENDIF
	
;アクション実行不能
CALL CHECK_ACTIONABLE, ARG, CFLAG:ARG:입력행동
SIF RESULT == 0
	CFLAG:ARG:입력행동 = 0
;ここまで타겟が決まってなかったら、랜덤타겟をよんで決定
SIF CFLAG:ARG:타겟 == -1
	CALL RANDOM_TARGET, ARG, CFLAG:ARG:입력행동
RETURN 1

;========
;階段移動
;========
@UPSTAIRS_83
SELECTCASE FLAG:現M
	CASE 0
		SIF FLAG:現X == 6 && FLAG:現Y == 1
			CALL DUNGEON_UPSTAIRS,1,6,1
	CASE 1
		SIF FLAG:現X == 8 && FLAG:現Y == 1
			CALL DUNGEON_UPSTAIRS,2,7,1
	CASE 2
		SIF FLAG:現X == 7 && FLAG:現Y == 9
			CALL DUNGEON_UPSTAIRS,3,6,9
		ENDSELECT
RETURN 1

@DOWNSTAIRS_83
SELECTCASE FLAG:現M
	CASE 1
		SIF FLAG:現X == 6 && FLAG:現Y == 1
			CALL DUNGEON_DOWNSTAIRS,0,6,1
	CASE 2
		SIF FLAG:現X == 7 && FLAG:現Y == 1
			CALL DUNGEON_DOWNSTAIRS,1,8,1
	CASE 3
		SIF FLAG:現X == 6 && FLAG:現Y == 9
			CALL DUNGEON_DOWNSTAIRS,2,7,9
		ENDSELECT
RETURN 1
;=======================================================================
;エレベーター
;=======================================================================
@DUNGEON_ELEVATOR_83, ARG
RESULT:1 = 0
RESULT:2 = 1
RESULT:3 = 2
RESULT:4 = 3
RESULTS:1 = Ｂ１Ｆ
RESULTS:2 = １Ｆ
RESULTS:3 = ２Ｆ
RESULTS:4 = ３Ｆ
RETURN -1

;=======================================================================
;宝箱の中身
;=======================================================================
@TRESURING_CALLING_83
#LOCALSIZE 3
LOCAL = FLAG:現M + 10

LOCAL:1 = (DA:(FLAG:現X):(FLAG:現Y) / 10) % 100
SELECTCASE DA:(FLAG:現X):(FLAG:現Y) / 10
		CASE 100
			CALL GET_TREASURE, [[아이템:네이팜탄]] , 1 , FLAG:現던전, LOCAL , LOCAL:1
		CASE 300
			CALL GET_TREASURE, [[아이템:방독마스크6형]] , 1 , FLAG:現던전, LOCAL , LOCAL:1
		CASE 301
			CALL GET_TREASURE, [[아이템:Ｍ249미니미]] , 1 , FLAG:現던전, LOCAL , LOCAL:1
		CASE 302
			CALL GET_TREASURE, [[아이템:그레네이드런쳐]] , 1 , FLAG:現던전, LOCAL , LOCAL:1
	ENDSELECT
RETURN 1


;========
;罠置き場
;========
@TRAP_83
SELECTCASE FLAG:現M
	CASE 3
		CALL MESSAGE_WINDOW_D, "", "＞함정이다！"
				CALL DUNGEON_WORP, FLAG:現M-1, FLAG:現X,  FLAG:現Y
	ENDSELECT

;=======================================================================
;인카운터율
;=======================================================================
@ENCOUNT_RATE_83

SELECTCASE FLAG:現M
	CASE 0
		FLAG:인카운터율 = 5 + FLAG:未遭遇歩数*5
	CASE 1,2
		FLAG:인카운터율 = 10 + FLAG:未遭遇歩数*5
	CASEELSE 
		FLAG:인카운터율 = 15 + FLAG:未遭遇歩数*5
ENDSELECT
SIF FLAG:未遭遇歩数 < 5
	FLAG:인카운터율 = 0
;=======================================================================
;필요레벨눈安
;권장LV 雑물고기최저LV 雑물고기最高LV ボスLV 
;=======================================================================
@GET_DUNGEON_LV_83
RETURN 44, 40, 45, 53 

;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_83
IF RAND:100 < FLAG:인카운터율
	CALL ENEMY_TABLE
	RETURN 1
ELSE
	FLAG:未遭遇歩数 += 1
	RETURN 0
ENDIF
;=======================================================================
;적の종족の종류数
;=======================================================================
@CLASS_NUM_83
RETURN CLASS_NUM_COMMON("上級")
;=======================================================================
;적の総数
;ARGは出現する적の종류です
;=======================================================================
@ENEMY_NUM_83, ARG
RETURN ENEMY_NUM_COMMON("上級", ARG)
;=======================================================================
;적の종류
;=======================================================================
@ENEMY_83, ARG
SELECTCASE FLAG:現M
	CASE 0,1,2,
		SELECTCASE RAND:100
			CASE IS < 30
				RETURN [[キャラ:짐]], 40
			CASE IS < 55
				RETURN [[キャラ:레기온]], 41
			CASE IS < 70
				RETURN [[キャラ:아마존]], 40
			CASE IS < 85
				RETURN [[キャラ:바질리스크]], 42
			CASE IS < 100
				RETURN [[キャラ:좀비캅]], 40
		ENDSELECT
CASEELSE
		SELECTCASE RAND:100
			CASE IS < 30
				RETURN [[キャラ:스프리건]], 43
			CASE IS < 55
				RETURN [[キャラ:서큐버스]], 44
			CASE IS < 70
				RETURN [[キャラ:베르세르크]], 45
			CASE IS < 85
				RETURN [[キャラ:파워]], 45
			CASE IS < 100
				RETURN [[キャラ:좀비캅]], 43
			ENDSELECT
ENDSELECT

;=======================================================================
;윤간참가악마
;=======================================================================
@DUNGEON_RAPE_DEVIL_83
;랜덤にどの악마が出るか決定
;RETURN CSV番号 , 人数 , 레벨
SELECTCASE RAND:3
	CASE 0
		RETURN [[キャラ:좀비캅]] , 3 + RAND:10 , CSVBASE([[キャラ:좀비캅]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 1
		RETURN [[キャラ:베르세르크]] , 3 + RAND:10 , CSVBASE([[キャラ:베르세르크]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 2
		RETURN [[キャラ:레기온]] , 3 + RAND:10 , CSVBASE([[キャラ:레기온]] , GETNUM(BASE , "LV") , 0) + RAND:3
ENDSELECT
