;=======================================================================
;아카사카
;=======================================================================
;変数 던전플래그:[[던전:아카사카]]:X
;0 아카사카地下の情報（侵入조건)
;1 ヒルコ
;2 ショート・ターミナル
;他던전・의뢰で関係する変数
;40- メッセンジャーのフラグ
;80- 宝箱
;=======================================================================
;真2旧ロッポンギを아카사카のさらに下層の던전として統合
;ICBM落ちてないのでガイア教が落ちぶれてないように＆長老の話を변경
;=======================================================================
;攻略조건
;=======================================================================
@PREREQUISITE_DUNGEON_29
;[IF_DEBUG]
;	RETURN 1
;[ENDIF]
;조건：아카사카の情報を得ている
IF 던전플래그:[[던전:아카사카]]:0
	RETURN 1
ENDIF

RETURN 0



;=======================================================================
;던전名
;=======================================================================
@GET_DUNGEON_NAME_29
RESULTS = 아카사카


;=======================================================================
;플로어名표시
;=======================================================================
@FLOORNAME_29
PRINT 아카사카
SELECTCASE FLAG:현M
	CASE 0
		PRINTL ・Ｂ７Ｆ
	CASE 1
		PRINTL ・Ｂ６Ｆ
	CASE 2
		PRINTL ・Ｂ５Ｆ
	CASE 3
		PRINTL ・Ｂ４Ｆ
	CASE 4
		PRINTL ・Ｂ３Ｆ
	CASE 5
		PRINTL ・Ｂ２Ｆ
	CASE 6
		PRINTL ・Ｂ１Ｆ
ENDSELECT



;=======================================================================
;スタート地点입력
;=======================================================================
@START_DUNGEON_29,ARG
#LOCALSSIZE 1
FLAG:현M = 6
FLAG:현X = 11
FLAG:현Y = 23
;CALL AUTOMAP


;=======================================================================
;スタート時이벤트
;=======================================================================
@EVENT_DUNGEON_START_29

;=======================================================================
;탈출時の이벤트
;=======================================================================
@EVENT_DUNGEON_END_29

;=======================================================================
;指定したマスに進入可能か
;=======================================================================
@CAN_ENTER_29,ARG,ARG:1
RESULT = 1
SELECTCASE DA:ARG:(ARG:1)
	CASE 12
		;上にしか進めない＝上からは無理
		;上である時＝現在のYがARG:1より小さいとき
		IF ARG:1 > FLAG:현Y
			CALL SET_FLOOR_ANALYZE(2, FLAG:현던전, FLAG:현M, ARG, ARG:1)
			RETURN 0
		ENDIF
	CASE 22
		IF ARG > FLAG:현X
			CALL SET_FLOOR_ANALYZE(2, FLAG:현던전, FLAG:현M, ARG, ARG:1)
			RETURN 0
		ENDIF
	CASE 32
		IF ARG:1 < FLAG:현Y
			CALL SET_FLOOR_ANALYZE(2, FLAG:현던전, FLAG:현M, ARG, ARG:1)
			RETURN 0
		ENDIF
	CASE 42
		IF ARG < FLAG:현X
			CALL SET_FLOOR_ANALYZE(2, FLAG:현던전, FLAG:현M, ARG, ARG:1)
			RETURN 0
		ENDIF
	CASEELSE
		CALL CAN_ENTER,ARG,ARG:1
ENDSELECT
RETURN RESULT

;=======================================================================
;플로어데이터
;=======================================================================
@MAKE_FLOOR_29
SELECTCASE FLAG:현M
	;Ｂ１Ｆ
	CASE 6
		FLAG:최대X = 33
		FLAG:최대Y = 25
		;						           1         2         3  
		;						 012345678901234567890123456789012
		CALL MAKE_FLOOR_LINE, 0,"                                 "
		CALL MAKE_FLOOR_LINE, 1,"     1111111 4 11111   3         "
		CALL MAKE_FLOOR_LINE, 2,"     1 2 1   2 1   1   2         "
		CALL MAKE_FLOOR_LINE, 3,"   111 1 1 1 1 1 1 11111         "
		CALL MAKE_FLOOR_LINE, 4,"   1     1 2 1 1 2   111         "
		CALL MAKE_FLOOR_LINE, 5,"   1 111 1 11121 111 111         "
		CALL MAKE_FLOOR_LINE, 6,"     111 2 1     111 1           "
		CALL MAKE_FLOOR_LINE, 7,"   1 11111 1 1112111 1           "
		CALL MAKE_FLOOR_LINE, 8,"   1   111 2 1   111 1           "
		CALL MAKE_FLOOR_LINE, 9," 4 111 1111111 1 111 11123   12e "
		CALL MAKE_FLOOR_LINE,10," 2 111 111     1 111 111     1   "
		CALL MAKE_FLOOR_LINE,11," 1 111 111 4 111 111 111 1111111 "
		CALL MAKE_FLOOR_LINE,12," 1 111   1 2 111 111         111 "
		CALL MAKE_FLOOR_LINE,13," 1 111 121111111 111111111112111 "
		CALL MAKE_FLOOR_LINE,14," 1 111         1   2         1   "
		CALL MAKE_FLOOR_LINE,15," 12111 1 4 4 4 1 111 124 11111   "
		CALL MAKE_FLOOR_LINE,16,"   111 1 2 2 2   1   1           "
		CALL MAKE_FLOOR_LINE,17,"   111 11111111111 111           "
		CALL MAKE_FLOOR_LINE,18,"   1   1 2 1 2 111 111           "
		CALL MAKE_FLOOR_LINE,19," 121 411 4 1 1 111 11111         "
		CALL MAKE_FLOOR_LINE,20,"   1       4       1   1         "
		CALL MAKE_FLOOR_LINE,21,"   11111111111 t 1 1 321         "
		CALL MAKE_FLOOR_LINE,22,"     11111 2 1 2 2 1             "
		CALL MAKE_FLOOR_LINE,23,"     11111 8 1111111             "
		CALL MAKE_FLOOR_LINE,24,"                                 "
		;						 012345678901234567890123456789012
		;						           1         2         3  
		
	;Ｂ２Ｆ
	CASE 5
		FLAG:최대X = 9
		FLAG:최대Y = 9
;								012345678
		CALL MAKE_FLOOR_LINE,0,"         "
		CALL MAKE_FLOOR_LINE,1," 52123 7 "
		CALL MAKE_FLOOR_LINE,2,"   1   2 "
		CALL MAKE_FLOOR_LINE,3," 511 111 "
		CALL MAKE_FLOOR_LINE,4," 1   1   "
		CALL MAKE_FLOOR_LINE,5," 125 1 5 "
		CALL MAKE_FLOOR_LINE,6,"   1 1 2 "
		CALL MAKE_FLOOR_LINE,7,"   12511 "
		CALL MAKE_FLOOR_LINE,8,"         "
	;Ｂ３Ｆ
	CASE 4
		FLAG:최대X = 9
		FLAG:최대Y = 9
;								012345678
		CALL MAKE_FLOOR_LINE, 0,"         "
		CALL MAKE_FLOOR_LINE, 1," 111   4 "
		CALL MAKE_FLOOR_LINE, 2," 2 1   2 "
		CALL MAKE_FLOOR_LINE, 3," 6 11111 "
		CALL MAKE_FLOOR_LINE, 4,"   11111 "
		CALL MAKE_FLOOR_LINE, 5,"   11111 "
		CALL MAKE_FLOOR_LINE, 6,"     2 2 "
		CALL MAKE_FLOOR_LINE, 7,"     3 7 "
		CALL MAKE_FLOOR_LINE, 8,"         "
	;Ｂ４Ｆ
	CASE 3
		FLAG:최대X = 33
		FLAG:최대Y = 9
		;						            1         2         3  
		;						 012345678901234567890123456789012
		CALL MAKE_FLOOR_LINE, 0,"                                 "
		CALL MAKE_FLOOR_LINE, 1," 6 1<111<11111 1111121 1111111   "
		CALL MAKE_FLOOR_LINE, 2," 2 1   ] 1 2 1 1 ]   1 1   2     "
		CALL MAKE_FLOOR_LINE, 3," 1 111 1 1 1 1 1 111 1 12e 1 t21 "
		CALL MAKE_FLOOR_LINE, 4," 1 1   1   1   1 1   1 1       1 "
		CALL MAKE_FLOOR_LINE, 5," 1 1>11111>12111 1 111 111 4 111 "
		CALL MAKE_FLOOR_LINE, 6," 1 1   [   1   ] ] 1   111 2 1 2 "
		CALL MAKE_FLOOR_LINE, 7," 12111 1112111 111>12111111111 7 "
		CALL MAKE_FLOOR_LINE, 8,"                                 "
		;						 012345678901234567890123456789012
		;						            1         2         3  

	;Ｂ５Ｆ
	CASE 2
		FLAG:최대X = 17
		FLAG:최대Y = 33
		;						           1     
		;						 01234567890123456
		CALL MAKE_FLOOR_LINE, 0,"                 "
		CALL MAKE_FLOOR_LINE, 1," 4 111 11111 1 1 "
		CALL MAKE_FLOOR_LINE, 2," 2 111   2 1 2 1 "
		CALL MAKE_FLOOR_LINE, 3," 1111111 1 11111 "
		CALL MAKE_FLOOR_LINE, 4," 2 111 2 1     1 "
		CALL MAKE_FLOOR_LINE, 5," t 111 111 111 1 "
		CALL MAKE_FLOOR_LINE, 6,"       1     1 2 "
		CALL MAKE_FLOOR_LINE, 7," 1211111<111>111 "
		CALL MAKE_FLOOR_LINE, 8,"         1     1 "
		CALL MAKE_FLOOR_LINE, 9," 111 a 1 1 321 1 "
		CALL MAKE_FLOOR_LINE,10," 2 1 2 1 1   1 1 "
		CALL MAKE_FLOOR_LINE,11," 1 1 111 11121 1 "
		CALL MAKE_FLOOR_LINE,12,"   1   2 1     1 "
		CALL MAKE_FLOOR_LINE,13," 1111111 4 321 1 "
		CALL MAKE_FLOOR_LINE,14," 2     ] 1   1 1 "
		CALL MAKE_FLOOR_LINE,15," 4 121 1 11121 1 "
		CALL MAKE_FLOOR_LINE,16," 1   1 ] 1     1 "
		CALL MAKE_FLOOR_LINE,17," 111 1 1 1 32111 "
		CALL MAKE_FLOOR_LINE,18," 1   1 1 2     1 "
		CALL MAKE_FLOOR_LINE,19," 121 1>1 11111 1 "
		CALL MAKE_FLOOR_LINE,20," 1   1 1 2   1 2 "
		CALL MAKE_FLOOR_LINE,21," 11111 1 111 111 "
		CALL MAKE_FLOOR_LINE,22," 1 2 1 ] 1 2 1   "
		CALL MAKE_FLOOR_LINE,23," 1 1 1 1 1 b 121 "
		CALL MAKE_FLOOR_LINE,24," 1 1   1         "
		CALL MAKE_FLOOR_LINE,25," 1 111 111>11111 "
		CALL MAKE_FLOOR_LINE,26," 2 1           ] "
		CALL MAKE_FLOOR_LINE,27," 1 11111 1 T 1 1 "
		CALL MAKE_FLOOR_LINE,28,"       1 1 2 2 1 "
		CALL MAKE_FLOOR_LINE,29," 11111 1 1111111 "
		CALL MAKE_FLOOR_LINE,30," 2     1   111 2 "
		CALL MAKE_FLOOR_LINE,31," 1111111112111 6 "
		CALL MAKE_FLOOR_LINE,32,"                 "
		;						 01234567890123456
		;						           1     
	;Ｂ６Ｆ
	CASE 1
		FLAG:최대X = 17
		FLAG:최대Y = 17
;								 0         1      
;								 01234567890123456
		CALL MAKE_FLOOR_LINE, 0,"                 "
		CALL MAKE_FLOOR_LINE, 1," 1112111 111 321 "
		CALL MAKE_FLOOR_LINE, 2," 1     1 1 2   1 "
		CALL MAKE_FLOOR_LINE, 3," 1 11121 1 1 3 1 "
		CALL MAKE_FLOOR_LINE, 4,"   2   1   2 2 2 "
		CALL MAKE_FLOOR_LINE, 5," a 1 111 12111 1 "
		CALL MAKE_FLOOR_LINE, 6," 2 1 2   2     1 "
		CALL MAKE_FLOOR_LINE, 7," 111 11111211121 "
		CALL MAKE_FLOOR_LINE, 8,"                 "
		CALL MAKE_FLOOR_LINE, 9," 3 1>1111111 111 "
		CALL MAKE_FLOOR_LINE,10," 2 1   [ 1 ] 1 2 "
		CALL MAKE_FLOOR_LINE,11," 11121 1 1 1 1 b "
		CALL MAKE_FLOOR_LINE,12," 1     1   2 2   "
		CALL MAKE_FLOOR_LINE,13," 123 11111 11111 "
		CALL MAKE_FLOOR_LINE,14," 1   1     1   2 "
		CALL MAKE_FLOOR_LINE,15," 1<11121111121 1 "
		CALL MAKE_FLOOR_LINE,16,"                 "
	;Ｂ７Ｆ
	CASE 0
		FLAG:최대X = 17
		FLAG:최대Y = 17
;								 0         1
;								 01234567890123456
		CALL MAKE_FLOOR_LINE, 0,"                 "
		CALL MAKE_FLOOR_LINE, 1," a 1 1111111 111 "
		CALL MAKE_FLOOR_LINE, 2," 2 1 1 2 2 1   1 "
		CALL MAKE_FLOOR_LINE, 3," 111 1 1 1 1 421 "
		CALL MAKE_FLOOR_LINE, 4,"   2 1     1   1 "
		CALL MAKE_FLOOR_LINE, 5," 11411 4 111 421 "
		CALL MAKE_FLOOR_LINE, 6," 1   1 2 2 1   1 "
		CALL MAKE_FLOOR_LINE, 7," 124 1 1 1 11111 "
		CALL MAKE_FLOOR_LINE, 8," 1   1 2 1 1   1 "
		CALL MAKE_FLOOR_LINE, 9," 11111 1 1 1 121 "
		CALL MAKE_FLOOR_LINE,10," 1   1 2 2 1   1 "
		CALL MAKE_FLOOR_LINE,11," 124 111 1 11111 "
		CALL MAKE_FLOOR_LINE,12," 1   1     1 2   "
		CALL MAKE_FLOOR_LINE,13," 124 1 4 1 1 111 "
		CALL MAKE_FLOOR_LINE,14," 1   1 2 2 1 1 2 "
		CALL MAKE_FLOOR_LINE,15," 111 1111111 1 b "
		CALL MAKE_FLOOR_LINE,16,"                 "


ENDSELECT

;=======================================================================
;特殊タイル표시
;=======================================================================
@TILE_MARK_COMMON_29_0, ARG , ARG:1 , ARG:2
SELECTCASE ARG / 10
	CASE 1
		RESULTS = 　
	CASEELSE
		RETURN 1
ENDSELECT

@TILE_MARK_COMMON_29_9, ARG , ARG:1 , ARG:2
SELECTCASE ARG / 10
	CASE 1
		RESULTS = ST
	CASE 2 , 3 , 4
		RESULTS = Ｅ
	CASEELSE
		RETURN 1
ENDSELECT

@TILE_MARK_COMMON_29_2, ARG , ARG:1 , ARG:2
SIF GET_FLOOR_ANALYZE_T(ARG:1, ARG:2) < 2
	RETURN 1
SELECTCASE ARG / 10
	CASE 1
		RESULTS = ↑
	CASE 2
		RESULTS = ←
	CASE 3
		RESULTS = ↓
	CASE 4
		RESULTS = →
	CASEELSE
		RETURN 1
ENDSELECT

@TILE_MARK_COMMON_29_4, ARG , ARG:1 , ARG:2
SELECTCASE ARG / 10
	;メッセンジャー
	CASE 600
		RESULTS = 鍛
	CASE 603 , 5
		RESULTS = 武
	CASE 604
		RESULTS = 酒
	CASE 605 , 6
		RESULTS = 防
	CASE 608 , 7
		SETCOLOR COLOR("RED")
		RESULTS = Ｇ
	CASE 400
		RESULTS = CB
	CASE 200 , 1 , 4
		RETURN 1
	CASEELSE
		SETCOLOR 0x00ff00
		RESULTS = ｍ
ENDSELECT

;=======================================================================
;タイル定義
;=======================================================================
@DEFINE_TILES_29, ARGS, ARG, ARG:1
SELECTCASE ARGS
	CASE "t"
		RETURN 19
	CASE "e"
		RETURN 29
	CASE "a"
		RETURN 39
	CASE "b"
		RETURN 49
	CASE "["
		RETURN 12
	CASE "<"
		RETURN 22
	CASE "]"
		RETURN 32
	CASE ">"
		RETURN 42
ENDSELECT

;=======================================================================
;タイル調整
;=======================================================================
@MAKE_FLOOR_LINE_COMMON_29, ARG, ARG:1, ARG:2
#LOCALSIZE 30
;LOCAL:3 宝箱 던전플래그:84~99
;LOCAL:4 이벤트
;(0/0)でLOCALを소거
SIF ARG:1 == 0 && ARG:2 == 0
	VARSET LOCAL
SELECTCASE ARG
	CASE 3
		IF GETBIT(던전플래그:(FLAG:현던전):(FLAG:현M+70), LOCAL:3)
			DA:(ARG:1):(ARG:2) = 1
		ELSE
			DA:(ARG:1):(ARG:2) = FLAG:현M *1000 + LOCAL:3 * 10 + 3
		ENDIF
		LOCAL:3++
	CASE 4
		DA:(ARG:1):(ARG:2) = FLAG:현M *1000 + LOCAL:4 * 10 + 4
		LOCAL:4++
	CASE 5
		;DA:(ARG:1):(ARG:2) = FLAG:현M *1000 + LOCAL:5 * 10 + 5
		;LOCAL:5++
	CASE 6
		DA:(ARG:1):(ARG:2) = FLAG:현M *1000 + LOCAL:6 * 10 + 6
		LOCAL:6++
	CASE 7
		DA:(ARG:1):(ARG:2) = FLAG:현M *1000 + LOCAL:7 * 10 + 7
		LOCAL:7++
	CASE 8
		DA:(ARG:1):(ARG:2) = FLAG:현M *1000 + LOCAL:8 * 10 + 8
		LOCAL:8++
	CASE 9
		DA:(ARG:1):(ARG:2) = FLAG:현M *1000 + LOCAL:9 * 10 + 9
		LOCAL:9++
	
ENDSELECT
SIF FLAG:현M == 0 && RANGE(ARG:1 , 17 , 23) && RANGE(ARG:2 , 2 , 10) && BASE:MASTER:지혜 < 10
	DA:(ARG:1):(ARG:2) = 0
	

;=======================================================================
;[5]調べる　実行時の이벤트
;=======================================================================
@EVENT_CHECK_DUNGEON_29
CALL EVENT_DUNGEON_29 , 0 , 1
RETURN RESULT


;=======================================================================
;タイル進入時の이벤트
;=======================================================================
@EVENT_ENTER_DUNGEON_29, ARG
;ARG = 進入時の向き　0の場合ワープなど
CALL EVENT_DUNGEON_29, ARG , 0
RETURN RESULT

@EVENT_DUNGEON_29, ARG, ARG:1
#DIM 交渉가능キャラ , 7
SELECTCASE DA:(FLAG:현X):(FLAG:현Y) % 10
;==========
;出口の処理
;==========
	CASE 8
		CALL DUNGEON_EXIT
		RETURN 1
;========
;宝の処理
;========
	CASE 3
		CALL TREASURE_29
		RETURN 1
	
;=======
;階段
;=======
	CASE 6
		CALL UPSTAIRS_29
		RETURN 1

	CASE 7
		CALL DOWNSTAIRS_29
		RETURN 1

;==========
;扉の処理
;==========
	CASE 2
		CALL DUNGEON_DOOR,ARG
		RETURN 1

;========================
;이벤트
;========================
	CASE 4
		LOCAL = DA:(FLAG:현X):(FLAG:현Y) / 10 % 10
		SIF GETBIT(던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL) && ARG:1 == 0
			RETURN 0
		SELECTCASE DA:(FLAG:현X):(FLAG:현Y) / 10
			;Ｂ１Ｆ　이벤트
			CASE 600
				;대장간
				CALL MESSAGE_WINDOW_D , "" , "＞2인조 드워프가 대장장이 일을 하고 있다……"
				  IF ITEM:진・드라우프니르 >= 1
				     CALL MESSAGE_WINDOW_D , "대장장이" , "여어、대장。살 만은 한가？"
				  ELSEIF ITEM:드라우프니르 >= 1
				     CALL MESSAGE_WINDOW_D , "" , "＞당신은 드워프들의 흥미를 끌 법한/낡은 보물을 가지고 있는 것을 떠올렸다"
				     CALL MESSAGE_WINDOW_D , "대장장이" , "무슨 용건이지？　웃기지도 않는 물건이면…/음… 잠깐 기다려 그건…！"
				     CALL MESSAGE_WINDOW_D , "" , "＞드워프들이 잡아먹을듯이 드라우프니르를 들여다보고 있다"
				     CALL MESSAGE_WINDOW_D , "대장장이" , "대단하군 드라우프니르인가…/설마 보는 날이 오게 될 줄이야…"
				     CALL MESSAGE_WINDOW_D , "대장장이" , "이것은 신들의 시대…　정신이 아득해질 정도로 아주 먼 옛날에/드워프 대장장이 형제가 만들었던 것일세"
				     CALL MESSAGE_WINDOW_D , "대장장이" , "그리고 우리는 그 형제의 자손일세/뭔가 기묘한 인연이구먼"
				     CALL MESSAGE_WINDOW_D , "" , "＞당신은 드라우프니르를 넘겨주고선、원하는 만큼 보라고 전했다"
				     CALL MESSAGE_WINDOW_D , "대장장이" , "오오、고맙우이。…그럼 잘 보겠네"
				     CALL MESSAGE_WINDOW_D , "" , "＞공손하고도 정중하게 신보를 받아들고서、환희에 가득찬 표정으로/혹은 고개를 끄덕이거나、혹은 감탄하며 눈을 빛내며 조사하기 시작했다"
				     CALL MESSAGE_WINDOW_D , "" , "＞정신을 차리자 다른 드워프들도 모여서、그야말로 대성황이 되어있었다/하지만 도를 넘게 소란피우는 자는 없고、모두 한결같이 얌전히 있었다"
				     CALL MESSAGE_WINDOW_D , "우두머리" , "지금의 우리들이 보기에는、소박하고 서투른 부분도 있고/다른 면에선、우리들로는 도저히 따라잡지 못할 부분도 있다"
				     CALL MESSAGE_WINDOW_D , "우두머리" , "하지만 단언해두지. 이것은 그야말로 드워프의 업…/우리들의 근원이자 목표이고、증거이자 자부심인것이다"
				     CALL MESSAGE_WINDOW_D , "" , "＞드워프들 중에는 감동한 나머지 우는 자도 있다/길은 다를지라도---너무 다르긴 하나---당신도 또한 일종의 장인이다/그들에게 공감하는 면도 있었다"
				     CALL MESSAGE_WINDOW_D , "대장장이" , "허나…　아무래도 이녀석은「죽어」있는건지/본래의 힘을 잃고 있다。비견할 데 없는 그 마력을"
				     CALL MESSAGE_WINDOW_D , "" , "＞당신은 드라우프니르를 입수한 경위를 설명했다"
				     CALL MESSAGE_WINDOW_D , "우두머리" , "벨・데르에게서 입수했다면、납득이 가는군/오딘이 아들의 죽음을 애도하며 같이 묻었다고 들었으니까 말이다"
				     CALL MESSAGE_WINDOW_D , "우두머리" , "부장품으로서 명부로 건너갔기때문에、드라우프닐도「죽어」있다는거군/되살아난 벨・데르는 다시 죽었지만、이녀석은 운 좋게 현세에 남았다、고"
				     CALL MESSAGE_WINDOW_D , "" , "＞대장장이 형제가 뭔가 말하고 있다。하지만 우두머리는 고개를 끄덕이면서도 제지했다/우두머리는 당신을 향해 서서 이렇게 말했다"
				     CALL MESSAGE_WINDOW_D , "우두머리" , "이보게 여행자여/특별히 귀하에게 부탁하고 싶은게 있네만"
				     CALL MESSAGE_WINDOW_D , "" , "＞우두머리는 심호흡을하고、말했다"
				     CALL MESSAGE_WINDOW_D , "우두머리" , "이 드라우프니르를、우리들이 고치게 해주지 않겠나/우리들이라면 그럴 수 있네。우리들이 하지 않으면 안돼/그것이야말로 우리들이 살았던 증거가 되는거다"
				     CALL MESSAGE_WINDOW_D , "" , "＞거절할 이유따위、있을리도 없다。당신은 쾌히 승락했다/드워프들로부터 환호성이 올랐다"
				     CALL MESSAGE_WINDOW_D , "우두머리" , "오오！　고맙구먼！　뭐、돈도 시간도 필요없어/바로 전원이 작업에 착수하도록 하지"
				     CALL MESSAGE_WINDOW_D , "" , "＞우두머리의 말에 네、하고 복창하고、드워프들은 무서운 속도로 공방내의 담당구역으로 흩어졌다/드래곤의 숨결을 불어넣듯 풀무를 불어넣어、순식간에 화로는 용암이 되었다"
				     CALL MESSAGE_WINDOW_D , "" , "＞옆에서는 각양각색의 광석을 금망치로 부숴、작은 냄비에 넣고선、화로를 지폈다/금은 몸통에 미스릴、오리하르콘、금속들이 차례차례 녹아간다"
				     CALL MESSAGE_WINDOW_D , "" , "＞한참동안 녹여넣은 작열의 작은 냄비는、무지개의 광채를 내기 시작했다/거기에 보물 장식을 떼어낸 드라우프니르를 가라앉힌다/그러자 기묘하게도、드라우프니르가 노래하기 시작했다"
				     CALL MESSAGE_WINDOW_D , "" , "＞완만하게、때로는 고상하게、라인강에 사는 로렐라이처럼/울림을 전하는 노랫소리에 맞춰서、드워프들도 노래하기 시작했다"
				     CALL MESSAGE_WINDOW_D , "" , "＞정신이 들자 당신도 노래하고 있었다。전열을 짠 동료마들도 똑같았다/놀랍게도 COMP에 있던 동료마까지、멋대로 튀어나와서 노래하고있다/하지만 이미 세세한 것들은 신경쓰이지도 않았다"
				     CALL MESSAGE_WINDOW_D , "" , "＞노래가 최고조에 달했을 때、준비된 거푸집에 작은 냄비의 목소리가 흘러들어갔다/한쪽팔 분만 있던 드라우프니르는、한쌍이 되어 진정한 모습을 보이려 하고 있다"
				     CALL MESSAGE_WINDOW_D , "" , "＞노래의 템포가 빨리진다。드라우프닐은 급속히 식어서 굳어지려 하고 있다/신속히、하지만 정확히 보석을 매워넣고、무늬를 세겨넣는다/화장이라도 하는듯이 아름답게 마무리되어 간다"
				     CALL MESSAGE_WINDOW_D , "" , "＞마무리의 작은 망치가 최후의 소리를 높게 울리자/노래는 멈추고、화로의 불도 돌아가고、방금까지와는 다른 정적이 찾아온다"
				     CALL MESSAGE_WINDOW_D , "" , "＞대장장이 형제는 고개를 끄덕이고、넓은 판에 팔찌를 올려 우두머리에게 건냈다/우두머리는 그걸 받아들고선 당신에게 다가가、공손하게 헌상했다"
				     CALL MESSAGE_WINDOW_D , "우두머리" , "새로운 신화의 탄생이구먼/받아주게나。이것은 귀하를 위해 만들어진 것이다"
				     CALL MESSAGE_WINDOW_D , "" , "＞공방은 환성에 둘러싸였다。식지 않는 열광 속에서、당신은 다시 여행길에 올랐다"
				     CALL MESSAGE_WINDOW_D , "" , "＞진・드라우프니르를 얻었다"
				          ITEM:드라우프니르 -= 1
				            ITEM:진・드라우프니르 += 1
				                FLAG:명성 += 1000
				  ELSE
				     CALL MESSAGE_WINDOW_D , "대장장이" , "봐서 알겠지만 바쁘다/놀러 왔다면 돌아가 줘"
				  ENDIF
				     SETBIT 던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL
			CASE 601
				;メッセンジャー
				CALL MESSAGE_WINDOW_D , "코볼트" , "옛날부터 도쿄를 지켜왔다던/마사카도 공은 잘게 잘려 산산이 흩어진 채 봉인되었다지"
				CALL MESSAGE_WINDOW_D , "코볼트" , "……그럼 지금은 누가 도쿄를 지키는 걸까？"
				SETBIT 던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL
			CASE 602
				;メッセンジャー
				CALL MESSAGE_WINDOW_D , "은거한 드워프" , "이 근처에서 묻혀있는 무기는 우리들의 보물이다"
				SETBIT 던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL
			;Ｂ１Ｆ　이벤트
			CASE 603
				;무기점
				CALL MESSAGE_WINDOW_D , "무기점" , "어서 오세요"
				$WEAPONS_603
				CALL INPUT_SELECT_D, "무슨 용무냐？//[1]산다/ [2]스테이터스를 본다///[0]밖으로 나간다" , , , 2
				IF RESULT == 1
					CALL MESSAGE_WINDOW_D , "무기점" , "무엇을 사시겠습니까？"
					;10-15레벨向け총と탄환を1割引きで販売
					LOCALS = 
					LOCALS += "IMI데저트이글," + TOSTR(ITEMPRICE:IMI데저트이글*9/10) + ","
					LOCALS += "곤즈피스톨," + TOSTR(ITEMPRICE:곤즈피스톨*9/10) + ","
					LOCALS += "호와카빈," + TOSTR(ITEMPRICE:호와카빈*9/10) + ","
					LOCALS += "도미네이터," + TOSTR(ITEMPRICE:도미네이터*9/10) + ","
					LOCALS += "독침탄," + TOSTR(ITEMPRICE:독침탄*8/10) + ","
					LOCALS += "신경탄," + TOSTR(ITEMPRICE:신경탄*8/10) + ","
					LOCALS += "저주의탄환," + TOSTR(ITEMPRICE:저주의탄환*8/10) + ","
					CALL DUNGEON_SHOPS, 0, LOCALS
				ELSEIF RESULT == 2
					CALL SHOP_COM_301
				ELSE
					CALL MESSAGE_WINDOW_D , "무기점" , "매번 감사합니다、또 부디"
					RETURN 1
				ENDIF
				GOTO WEAPONS_603
			CASE 604
				;酒場
				CALL MESSAGE_WINDOW_D, "바텐더", "어서 오세요"
				$BAR_LOOP
				CALL MESSAGE_WINDOW_D, "바텐더", "무슨 용무지？"
				CALL INPUT_SELECT_D, "[1]술을 마신다/[2]이야기를 듣는다/////[0]밖으로 나간다" , , , 2
				IF RESULT == 0
					CALL MESSAGE_WINDOW_D, "바텐더", "또 부디"
				ELSEIF RESULT == 1
					CALL MESSAGE_WINDOW_D, "바텐더", "가게에서의 음주는 미구현인 것 같군요"
				ELSEIF RESULT == 2
					$BAR_LOOP_2
					CALL INPUT_SELECT_D , "＞누구에게 말을 걸까？//[1]코볼트/[2]가이아교도/[3]코볼트/[4]코볼트/[0]그만둔다" , , , 2
					IF RESULT == 0
						GOTO BAR_LOOP
					ELSEIF RESULT == 1
						CALL MESSAGE_WINDOW_D, "코볼트", "당신 신주쿠라는 거리에 가본 적 있나？/거기 지하에 가보면、냐하、/여기처럼 요정이 중심이 되어 만들고 있는 거리가 있다네요"
						CALL MESSAGE_WINDOW_D, "코볼트", "바로 그 요정의 거리에 약국이 있는데、/거기서 일하고 있는 요정 아이가 대단한 미인인 것 같다더라"
					ELSEIF RESULT == 2
						CALL MESSAGE_WINDOW_D, "가이아교도", "지상에선 겁쟁이들을 속이고 있는 메시아 교도의 무리가 뻔뻔한 얼굴로 다니고 있지만/지하세계 에서는 우리들 가이아 교도 쪽이 더 받아들여 지고 있다/……진짜라고！"
					ELSEIF RESULT == 3
						CALL MESSAGE_WINDOW_D, "코볼트", "이 거리、특히 북쪽은 일그러져 있지？/그런 곳은 우리들이 보물을 파낸 김에 거리를 넓힌거야/……이건 비밀인데/우리들이 판 보물、지상에서도 구매하러 오고 있어"
					ELSEIF RESULT == 4
						CALL MESSAGE_WINDOW_D, "코볼트", "당신 싸움 같은 걸 하는 사람이겠지？/……아니、딱 보면 알아요"
						CALL MESSAGE_WINDOW_D, "코볼트", "그러면 드워프의 대장간을 알고 있나？/우리들이 파낸 무기를 다시 손보거나/새로운 무기를 만들어 내거나 하고 있는/팔자 좋은 녀석들이지"
						CALL MESSAGE_WINDOW_D, "코볼트", "뭐、만나봐도 손해는 없을 거야"
					ENDIF
					GOTO BAR_LOOP_2
				ENDIF
			CASE 605
				;방어구점
				CALL MESSAGE_WINDOW_D , "방어구점" , "어머、어서오세요"
				$ARMORS_605
				CALL INPUT_SELECT_D, "무슨 용무인가？//[1]산다/ [2]스테이터스를 본다///[0]밖으로 나간다" , , , 2
				IF RESULT == 1
					CALL MESSAGE_WINDOW_D , "방어구점" , "무엇을 사시겠습니까？"
					;10-15레벨向け防具を1割引きで販売
					LOCALS = 
					LOCALS += "아이언바니," + TOSTR(ITEMPRICE:아이언바니*9/10) + ","
					LOCALS += "프로그헬름," + TOSTR(ITEMPRICE:프로그헬름*9/10) + ","
					LOCALS += "하드텐갤런," + TOSTR(ITEMPRICE:하드텐갤런*9/10) + ","
					LOCALS += "체인베레," + TOSTR(ITEMPRICE:체인베레*9/10) + ","
					LOCALS += "카이저아머," + TOSTR(ITEMPRICE:카이저아머*9/10) + ","
					LOCALS += "일륜의갑옷," + TOSTR(ITEMPRICE:일륜의갑옷*9/10) + ","
					LOCALS += "재밍암," + TOSTR(ITEMPRICE:재밍암*9/10) + ","
					LOCALS += "암브릿지," + TOSTR(ITEMPRICE:암브릿지*9/10) + ","
					LOCALS += "다마스커스글러브," + TOSTR(ITEMPRICE:다마스커스글러브*9/10) + ","
					LOCALS += "티타늄부츠," + TOSTR(ITEMPRICE:티타늄부츠*9/10) + ","
					LOCALS += "세이프티부츠," + TOSTR(ITEMPRICE:세이프티부츠*9/10) + ","
					LOCALS += "에어로제트," + TOSTR(ITEMPRICE:에어로제트*9/10) + ","
					CALL DUNGEON_SHOPS, 0, LOCALS
				ELSEIF RESULT == 2
					CALL SHOP_COM_301
				ELSE
					CALL MESSAGE_WINDOW_D , "방어구점" , "대단히 감사합니다、또 오세요"
					RETURN 1
				ENDIF
				GOTO ARMORS_605
				
			CASE 606
				;メッセンジャー
				CALL MESSAGE_WINDOW_D , "감독 드워프" , "스다마나 코다마의 무리가 말하기를/이 도쿄 여기저기에 야마토의 신들이 봉인되어 있다고 하더군/어쩐지 천사나 타천사의 소행인 것 같구나"
				SETBIT 던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL
			CASE 607
				;メッセンジャー
				CALL MESSAGE_WINDOW_D , "팩토리 노동자" , "정말이지 지령놈들/사람 다루는 것이 난폭해서、이제 비실비실이야"
				SETBIT 던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL
			CASE 608
				;가이아神殿
				CALL GAIA_TEMPLE_29
			CASE 609
				;壁の落書き
				CALL MESSAGE_WINDOW_D , "문자" , "＞지령의 거리 /　기능자 환영"
				CALL MESSAGE_WINDOW_D , "" , "＞……라고 벽에 써 있다"
				SETBIT 던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL
			;Ｂ３Ｆ　이벤트
			CASE 400
				;난디 씨
				CALL MESSAGE_WINDOW_D, "난디 씨", "나마스테！/나 인도에서 온 난디 씨야/또 만난 사람 오랜만이네 기쁘네ー"
				CALL MESSAGE_WINDOW_D, "난디 씨", "코드브레이커 라네 꼭 하게 네"
				CALL MESSAGE_WINDOW_D, "", "＞난디 씨로부터 『XTH』라고 써진 게임 패키지를 받았다…"
				CALL MESSAGE_WINDOW_D, "난디 씨", "……미안하네、지금 코드브레이커 준비 중 이네/또 이번에 놀어줘야 네"
			;Ｂ４Ｆ　이벤트
			CASE 300
				;メッセンジャー
				CALL MESSAGE_WINDOW_D , "브라우니" , "그곳의 계단으로/인간들이 모여 있는 커뮤니티에 갈 수 있을 거야"
				CALL MESSAGE_WINDOW_D , "브라우니" , "녀석들 인간치고는 멋지다/뭐、이런 말하면 나쁘지만 당신과는 비교도 되지 않을 거야"
				CALL MESSAGE_WINDOW_D , "브라우니" , "하지만、그렇게나 멋있는데/지상에서 도망쳐 온 것 같다"
				
			;Ｂ５Ｆ　이벤트
			CASE 200
				;ヒルコ
				IF 던전플래그:[[던전:아카사카]]:1 == 0 && (의뢰플래그:13:0 != 4 || FINDCHARA_B([[キャラ:키쿠에]]) != 2 )
					CALL MESSAGE_WINDOW_D , "목소리" , "오지 마라！ 나에게 다가오지 말아라！！"
					CALL MESSAGE_WINDOW_D , "뮤턴트" , "돌아가라！/얌전히 돌아가지 않겠다면/다만 미안할 따름이구나！"
				ELSEIF 던전플래그:[[던전:아카사카]]:1 == 0
					LOCAL = RESULT:1
					CALL MESSAGE_WINDOW_D , "목소리" , "오지 마라！ 나에게 다가오지 말아라！！"
					CALL MESSAGE_WINDOW_D , "뮤턴트" , "돌아가라！/얌전히 돌아가지 않겠다면/다만 미안할 따름이구나！"
					CALL MESSAGE_WINDOW_D , "목소리" , "……기다려！/……그녀는……！"
					CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , "오래간만입니다、히루코 님"
					CALL MESSAGE_WINDOW_D , "히루코" , @"틀림없어！/쿠쿠리히메노카미(菊理媛神)시여、기다리고 있었습니다！"
					CALL MESSAGE_WINDOW_D , "히루코" , @"……그러면 자네가 %ANATANAME("의뢰를 한 소환사" , "")%인가？" , , "재이용한다"
					CALL INPUT_YN_D , "Yes" , "보수를 받는다"
					IF RESULT == 0
						CALL MESSAGE_WINDOW_D , "히루코" , @"그런가、의뢰대로 그녀를 무사히 구출해 준 것 같구나/잘 해주었다、감사의 말을 전하겠다"
					ELSE
						CALL MESSAGE_WINDOW_D , "히루코" , @"그렇다면、약속한 보수인가……"
					ENDIF
					CALL MESSAGE_WINDOW_D , "히루코" , @"이 큰 활약에 걸맞는 보수를 자네에게 주고 싶기는 한데……/미안한데、이 지하세계에서는 지상의 돈이 충분히 모이지 않는다" , , "재이용한다"
					CALL MESSAGE_WINDOW_D , "" , @"＞히루코에게서 너덜너덜한 지폐 ￥75000 정도와 파마화살을 2개 받았다"
					CALL MESSAGE_WINDOW_D , "" , @"＞%조사처리(CALLNAME:MASTER,"는")% 95의 명성을 얻었다" , , "재이용한다"
					MONEY += 75000
					FLAG:명성 += 95
					CALL GET_ITEMS , "파마화살" , 2
					IF CFLAG:MASTER:선악치 >= 128
						CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , "그러면 히루코 님、앞으로 어떻게 할까요？"
						CALL MESSAGE_WINDOW_D , "히루코" , @"봉인되고、붙잡힌 신들을 구원하지 않으면 안 되지만/그러나 나에겐 그런 힘은 없고、이 땅에 사는 사람들 중에도 그런 강자는 없다……"
						CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , @"신궁의 숲의 무녀들도 뿔뿔이 흩어졌고……/다시 그들을 불러 모을 수 있을지 여부도 모르겠습니다만/할 수 있다고 해도 시간이 매우 오래 걸리겠지요"
						CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , @"……히루코 님、제안이 있습니다/%ANATANAME("이 분" , "님")%에게 부탁해 보면 어떻겠습니까？"
						CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , @"팬텀 소사이어티에 속한 사람입니다만/지금의 우리들에게 있어 \@ TALENT:MASTER:남자 ? 그 # 그녀 \@는 가장 신용할 만한 편이라 생각합니다" , , "재이용한다"
						CALL MESSAGE_WINDOW_D , "히루코" , @"음……/%ANATANAME("소환사")%여、우리의 이야기를 들어 주겠는가？"
						CALL INPUT_YN_D
						IF RESULT == 0
							;地祇が騙されて천진신を封印して云々、というところは아마테라스を救出する손前になってから教えてくれる
							;それまでは都合悪いし濁す
							CALL MESSAGE_WINDOW_D , "히루코" , @"그런가、들어 주는 건가"
							$Q_200
							CALL MESSAGE_WINDOW_D , "히루코" , @"아마츠가미(천진신)、그리고 쿠니츠가미(국진신)이라는 이름은 알고 있겠지/본디부터 이 야마토의 땅은 우리 야마토 신족이 다스려왔다"
							CALL MESSAGE_WINDOW_D , "히루코" , @"그러나 세기말을 맞아 악마의 무리가 야마토의 땅에도 나타나자/그 혼란을 틈타 헤브루의 천사들의 손에 의해 야마토의 신들은 봉인되어버렸다" , , "재이용한다"
							CALL MESSAGE_WINDOW_D , "히루코" , @"그 결과가 지금의 야마토다/지켜주던 신들이 봉인되지만 않았다면/야마토는 여기까지 악마들이 날뛰는 땅이 되지 않았을 것이다"
							CALL MESSAGE_WINDOW_D , "히루코" , @"……이 땅이 다시 평온을 되찾으려면 그들의 힘이 필요하다/신들의 봉인을 풀고 부활시키지 않으면 안 되는데/……그것이 나의 책임이다……"
							CALL MESSAGE_WINDOW_D , "히루코" , @"……제발 신들의 봉인을 풀어주지 않겠는가？"
							CALL INPUT_SELECT_D, "[0]Yes/[1]No/[2]보수를 요구한다"
							SELECTCASE RESULT
								CASE 0
									CALL INCREASE_LD , 20
									CALL MESSAGE_WINDOW_D , "히루코" , @"오오、그런가 맡아 주는건가"
									CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , @"…당신의 기대에 어떻게든 보답하고 싶습니다만/알다시피 지금 나에게 있는 것은 이 몸 하나뿐입니다"
									CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , @"그러므로 %ANATANAME( , "님、")% 나는 당신께 저 자신을 바치겠습니다"
									CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , @"당신이 원하는 대로、생각하는 대로 나를 사용해 주세요/이 땅을 구하는데 도움이 되 줄거라 믿겠습니다" , , "재이용한다"
									던전플래그:[[던전:아카사카]]:1 = 2
									
									CFLAG:LOCAL:전투참가불가능 = 0
									CFLAG:LOCAL:이자리에없는플래그 = 0
									의뢰플래그:13:0 = 5
									
									CALL MESSAGE_WINDOW_D , "히루코" , @"신들이 봉인된 땅에 관한 정보는 자네의 사무소에 보내 두지/힘없는 나를 대신해 반드시 완수해 주게/부탁한다……"
									
								CASE 1
									CALL MESSAGE_WINDOW_D , "히루코" , @"그런가…… 들어줄 수 없다는 건가……"
									던전플래그:[[던전:아카사카]]:1 = 1
									IF CFLAG:LOCAL:인계횟수 == 0
										CFLAG:LOCAL:이자리에없는플래그 = 1
										CALL REMOVE_POSITION, CPOS(LOCAL)
									ENDIF
									
								CASE 2
									CALL INCREASE_LD , 20
									CALL MESSAGE_WINDOW_D , "히루코" , @"흠……/아니、그것도 당연한 것이 여하튼 그렇게 간단한 일이 아니다/하지만 지금의 우리에게는 도저히 자네가 만족할 만한 보수를 준비할 수 있을 리도 없다……"
									CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , @"나에게 있는 건 이 몸 하나 뿐、지불할 수 있는 것은 가지고 있지 않습니다/……그러나、만약 당신이 원한다면/나 자신을 보수로 하는 것으로 맡아 주실 수 없겠습니까？"
									CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , @"원래대로 말하자면 %ANATANAME("귀하" , "님")%께서 구해준 생명입니다"
									CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , @"그것이 신들의 봉인을 풀 수만 있다면、/%ANATANAME("귀하" , "님")%께 이 몸 모두를 바쳐도 상관없다고 생각하고 있습니다" , , "재이용한다"
									CALL INPUT_YN_D , "맡는다" , "그만둔다"
									IF RESULT == 0
										CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , @"……맡아주시겠는지요"
										CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , @"감사합니다。그리고、오늘부터 나는 %ANATANAME("귀하" , "님")%의 것입니다" , , "재이용한다"
										CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , @"여하튼 만족할 때까지 저를 사용하십시오/……그리고 반드시 그들을 구해 주세요" , , "재이용한다"
										던전플래그:[[던전:아카사카]]:1 = 2
										
										CFLAG:LOCAL:이자리에없는플래그 = 0
										CFLAG:LOCAL:전투참가불가능 = 0
										SIF CFLAG:LOCAL:인계횟수 == 0
											TALENT:LOCAL:약점 = 1
										의뢰플래그:13:0 = 5
										CALL MESSAGE_WINDOW_D , "히루코" , @"신들이 봉인된 땅에 관한 정보는 자네의 사무소에 보내 두지/힘없는 나를 대신해 반드시 완수해 주게/부탁한다……"
									ELSE
										CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , @"……그렇습니까……"
									
										던전플래그:[[던전:아카사카]]:1 = 1
										IF CFLAG:LOCAL:인계횟수 == 0
											CFLAG:LOCAL:이자리에없는플래그 = 1
											CALL REMOVE_POSITION, CPOS(LOCAL)
										ENDIF
									ENDIF
							ENDSELECT
						ELSE
							CALL MESSAGE_WINDOW_D , "히루코" , @"그런가……들어 줄 수 없다는 건가……"
							던전플래그:[[던전:아카사카]]:1 = 1
							
							IF CFLAG:LOCAL:인계횟수 == 0
								CFLAG:LOCAL:이자리에없는플래그 = 1
								CALL REMOVE_POSITION, CPOS(LOCAL)
							ENDIF
						ENDIF
						
					ELSE
						CALL MESSAGE_WINDOW_D , "히루코" , @"그럼 조심해서 돌아 가세요/여기는 지상의 사람이 오래 머물 곳이 아닙니다"
						CALL MESSAGE_WINDOW_D , @"%CALLNAME:LOCAL%" , @"%ANATANAME("귀하" , "님")%께서 도와주신 은혜는 결코 잊지 않겠습니다/그럼、조심하시길……"
						IF CFLAG:LOCAL:인계횟수 == 0
							CALL 캐릭터삭제 , LOCAL
						ENDIF
						던전플래그:[[던전:아카사카]]:1 = -1
					ENDIF
				ELSEIF 던전플래그:[[던전:아카사카]]:1 == 1
					
					CALLF FINDCHARA_B([[キャラ:키쿠에]])
					LOCAL = RESULT:1
					GOTO Q_200
				ELSEIF 던전플래그:[[던전:아카사카]]:1 == 2
					CALL MESSAGE_WINDOW_D , "히루코" , @"신들이 봉인되어 있는 지역에 대한 정보는/자네의 사무소에 전해 두지/힘없는 나를 대신해 반드시 완수해 주게/부탁한다……"
				
				ELSEIF 던전플래그:[[던전:아카사카]]:1 == -1
					CALL MESSAGE_WINDOW_D , "" , @"＞아무도 없다……"
				ENDIF
			CASE 201
				;メッセンジャー
				IF 던전플래그:[[던전:아카사카]]:1 == 0 && (의뢰플래그:13:0 != 4 || FINDCHARA_B([[キャラ:키쿠에]]) != 2 )
					CALL MESSAGE_WINDOW_D , "뮤턴트" , "뭐야、너？/너 따위가 왔다고 그분을 만날 수 있을까 보냐"
				ELSEIF 던전플래그:[[던전:아카사카]]:1 != 0
					CALL MESSAGE_WINDOW_D , "뮤턴트" , "히루코 님은/봉인된 신들의 비밀을 알고 있어서/쫓겨난 거다"
				ELSE
					CALL MESSAGE_WINDOW_D , "뮤턴트" , "뭐야、너……/앗、그녀는！"
					CALL MESSAGE_WINDOW_D , "뮤턴트" , "부디 들어와 주십시요/그 분은 안에 계십니다"
				ENDIF
				SETBIT 던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL
			CASE 202
				;メッセンジャー
				IF 던전플래그:[[던전:아카사카]]:1 == 0
					CALL MESSAGE_WINDOW_D , "뮤턴트" , "…너희들 뭐 하러 왔어？"
					CALL MESSAGE_WINDOW_D , "뮤턴트" , "여기는 너희들과 같은/평범한 인간이 있는 곳과는 달라/빨리 돌아가" , "/" , "로그를 남기지 않는다/버튼을 이용한다/재이용한다"
				ELSE
					CALL MESSAGE_WINDOW_D , "뮤턴트" , "……우리 뮤턴트는/지상에서 시달림 받은 끝에/지하로 추방되었다"
				ENDIF
				SETBIT 던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL
			;Ｂ７Ｆ　이벤트
			CASE 0
				CALL MESSAGE_WINDOW_D , "뮤턴트" , "정부나 메시아 교도들은 이형의 우리들을/지상에서 추방했다/살 곳을 잃은 우리들은/지하로 도망치는 것 외에 살아남을 길이 없었다……"
				CALL MESSAGE_WINDOW_D ,  "뮤턴트" , "이 원한……/지상이 멸망하는 날까지、녀석들이 멸망하는 그 때까지/결코 잊지 않는다……"
				SETBIT 던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL
				
			CASE 1
				;壁の落書き
				CALL MESSAGE_WINDOW_D , "문자" , "＞“뮤턴트・커뮤니티”/　지상의 인간은 들어오지 말 것"
				CALL MESSAGE_WINDOW_D , "" , "＞……라고 벽에 써 있다"
				SETBIT 던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL
			CASE 2
				;メッセンジャー
				CALL MESSAGE_WINDOW_D , "가이아교도" , "이 도쿄 땅에는 야마토 신족의 신들이 봉인되어 있다고 한다"
				CALL MESSAGE_WINDOW_D , "가이아교도" , "그들의 협력을 얻으면、/우리 가이아교의 원수 메시아 교도들을 토벌해 멸할 수 있을테니/이 신들의 부활을 기다리고 있다……"
				SETBIT 던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL
			CASE 3
				;メッセンジャー
				CALL MESSAGE_WINDOW_D , "뮤턴트" , "마사카도 공에게는 악마 세계에 갈 수 있는 힘이 있다고 한다"
				CALL MESSAGE_WINDOW_D ,  "뮤턴트" , "……이런 곳에서 사는 건 꿈도 희망도 없어/차라리 마계로 데려가 줬으면 해요" , "/" , "로그를 남기지 않는다/버튼을 이용한다/재이용한다"
				SETBIT 던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL
			CASE 4
				;長老
				IF !GETBIT(던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL)
					CALL MESSAGE_WINDOW_D , "뮤턴트 장로" , "……지상의 거리가 그렇듯、여기도 원래는 도쿄의 거리였다/하지만 여기가 악마의 소굴로 변해 봉쇄되고 방치되자/어느덧 지상의 인간들에게는 잊쳐져/지상에서 쫓겨난 사람만이 조용히 살게 되었다"
					CALL MESSAGE_WINDOW_D , "뮤턴트" , "평범한 인간이나 메시아 교도들은/우리들과 같은 추악한 뮤턴트가/지상에서 사는 것을 허락하지 않고 추방했다"
					CALL MESSAGE_WINDOW_D , "뮤턴트" , "우리는 고생한 끝에 여기로 도망쳐 왔고/그리고 빛에서 멀어진 채 살아왔던 것이다"
				ENDIF
				CALL MESSAGE_WINDOW_D , "뮤턴트" , "……우리들은 아무것도 필요하지 않아、우리들은 아무것도 원하지 않아/단지 한 번만 더 빛을 원한다……"
				SETBIT 던전플래그:(FLAG:현던전):(40+FLAG:현M) , LOCAL
			CASE 5
				;무기屋
				CALL MESSAGE_WINDOW_D , "무기점" , "어서 오세요"
				$WEAPONS_5
				CALL INPUT_SELECT_D, "무슨 용무냐？//[1]산다/ [2]스테이터스를 본다///[0]밖으로 나간다" , , , 2
				IF RESULT == 1
					CALL MESSAGE_WINDOW_D , "무기점" , "무엇를 사시겠습니까？"
					;20레벨向け총と탄환を1割引きで販売
					LOCALS = 
					LOCALS += "MBA자이로제트피스톨," + TOSTR(ITEMPRICE:MBA자이로제트피스톨*9/10) + ","
					LOCALS += "레밍턴Ｍ710," + TOSTR(ITEMPRICE:레밍턴Ｍ710*9/10) + ","
					LOCALS += "성스러운탄환," + TOSTR(ITEMPRICE:성스러운탄환*8/10) + ","
					LOCALS += "저주의탄환," + TOSTR(ITEMPRICE:저주의탄환*8/10) + ","
					LOCALS += "디스펠샷," + TOSTR(ITEMPRICE:디스펠샷*8/10) + ","
					CALL DUNGEON_SHOPS, 0, LOCALS
				ELSEIF RESULT == 2
					CALL SHOP_COM_301
				ELSE
					CALL MESSAGE_WINDOW_D , "무기점" , "매번 감사합니다、또 부디"
					RETURN 1
				ENDIF
				GOTO WEAPONS_5
			CASE 6
				;防具屋
				CALL MESSAGE_WINDOW_D , "방어구점" , "어머、어서오세요"
				$ARMORS_6
				CALL INPUT_SELECT_D, "무슨 용무인가？//[1]산다/ [2]스테이터스를 본다///[0]밖으로 나간다" , , , 2
				IF RESULT == 1
					CALL MESSAGE_WINDOW_D , "방어구점" , "무엇을 사시겠습니까？"
					;20레벨向け防具を1割引きで販売
					LOCALS = 
					LOCALS += "플레이트반다나," + TOSTR(ITEMPRICE:플레이트반다나*9/10) + ","
					LOCALS += "가라시지의법의," + TOSTR(ITEMPRICE:가라시지의법의*9/10) + ","
					LOCALS += "질풍의토시," + TOSTR(ITEMPRICE:질풍의토시*9/10) + ","
					LOCALS += "초승달의구족," + TOSTR(ITEMPRICE:초승달의구족*9/10) + ","
					CALL DUNGEON_SHOPS, 0, LOCALS
				ELSEIF RESULT == 2
					CALL SHOP_COM_301
				ELSE
					CALL MESSAGE_WINDOW_D , "방어구점" , "대단히 감사합니다、또 오세요"
					RETURN 1
				ENDIF
				GOTO ARMORS_6
			CASE 7
				;가이아神殿
				CALL GAIA_TEMPLE_29
		ENDSELECT
		RETURN 1
		
;========================
;그외
;========================
	CASE 9
		SELECTCASE DA:(FLAG:현X):(FLAG:현Y) / 10
			;ショート・ターミナル
			CASE 1
				CALLFORM S_TERMINAL_{FLAG:현던전}
			;エレベーター
			CASE 2
				CALL DUNGEON_ELEVATOR, 29
			CASE 3
				CALL DUNGEON_ELEVATOR, 39
			CASE 4
				CALL DUNGEON_ELEVATOR, 49
		ENDSELECT
		RETURN 1
ENDSELECT
RETURN 0

;=======================================================================
;宝箱の中身
;=======================================================================
@TREASURE_29
SELECTCASE DA:(FLAG:현X):(FLAG:현Y) / 10
	CASE 600
		LOCALS = 독화살
		LOCAL = 1
	CASE 601
		LOCALS = 魔法の箱
		LOCALS:1 = 가넷
		LOCALS:2 = 마석
		LOCAL = 8
		LOCAL:1 = 1
	CASE 602
		LOCALS = 운의향
		LOCAL = 1
	CASE 500
		LOCALS = 魔法の箱
		LOCALS:1 = 다이아몬드
		LOCALS:2 = 마석
		LOCAL = 8
		LOCAL:1 = 1
	CASE 400
		LOCALS = 요도니힐
		LOCAL = 1
	CASE 200
		LOCALS = 메기도스톤
		LOCAL = 1
	CASE 201
		LOCALS = 선행의돌
		LOCAL = 1
	CASE 202
		LOCALS = 디스톤
		LOCAL = 2
	CASE 100
		LOCALS = 무명의도
		LOCAL = 1
	CASE 101
		LOCALS = 魔法の箱
		LOCALS:1 = 진주
		LOCALS:2 = 마석
		LOCAL = 8
		LOCAL:1 = 1
	CASE 102
		LOCALS = 메탈카드
		LOCAL = 1
	CASE 103
		LOCALS = 魔法の箱
		LOCALS:1 = 루비
		LOCALS:2 = 마석
		LOCAL = 8
		LOCAL:1 = 1
	CASEELSE
ENDSELECT
IF LOCALS == "￥"
	CALL GET_TREASURE_MONEY, 0, LOCAL, FLAG:현던전, FLAG:현M + 70, (DA:(FLAG:현X):(FLAG:현Y) / 10) % 100
ELSEIF LOCALS == "마카"
	CALL GET_TREASURE_MONEY, 1, LOCAL, FLAG:현던전, FLAG:현M + 70, (DA:(FLAG:현X):(FLAG:현Y) / 10) % 100
ELSEIF LOCALS == "MAG" || LOCALS == "ＭＡＧ"
	CALL GET_TREASURE_MAG, 0, LOCAL, FLAG:현던전, FLAG:현M + 70, (DA:(FLAG:현X):(FLAG:현Y) / 10) % 100
ELSEIF LOCALS == "덫"
	;LOCALS:1 종류 LOCAL 데미지量or확률 LOCALS:2 相性
	CALL GET_TREASURE_TRAP, LOCALS:1, LOCAL, GET_TYPE_NUM(LOCALS:2), FLAG:현던전, FLAG:현M + 70, (DA:(FLAG:현X):(FLAG:현Y) / 10) % 100
ELSEIF LOCALS == "魔法の箱"
	IF GETNUM(ITEM, LOCALS:1) == -1 || GETNUM(ITEM, LOCALS:2) == -1
		PRINTL ＞아이템 이름의 지정이 잘못되었습니다
		PRINTW ＞아이템 취득처리를 중단합니다
	ELSE
		CALL MAGIC_BOX , LOCAL , GETNUM(ITEM, LOCALS:1) , GETNUM(ITEM, LOCALS:2) , LOCAL:1 , FLAG:현던전, FLAG:현M + 70, (DA:(FLAG:현X):(FLAG:현Y) / 10) % 100
	ENDIF
ELSE
	IF GETNUM(ITEM, LOCALS) == -1
		PRINTL ＞아이템 이름의 지정이 잘못되었습니다
		PRINTW ＞아이템 취득처리를 중단합니다
	ELSE
		CALL GET_TREASURE, GETNUM(ITEM, LOCALS), LOCAL , FLAG:현던전, FLAG:현M + 70, (DA:(FLAG:현X):(FLAG:현Y) / 10) % 100
	ENDIF
ENDIF
RETURN 1

;=======================================================================
;階段置き場
;=======================================================================
@UPSTAIRS_29
;位置とIDが対応しているはずなので、同IDの階段を探させれば良い
CALL DUNGEON_UPSTAIRS_ID, FLAG:현M+1 , DA:(FLAG:현X):(FLAG:현Y) + 1000 + 1
RETURN 1

@DOWNSTAIRS_29
CALL DUNGEON_DOWNSTAIRS_ID, FLAG:현M-1 , DA:(FLAG:현X):(FLAG:현Y) - 1000 - 1
RETURN 1
;=======================================================================
;エレベーター定義
;=======================================================================
@DUNGEON_ELEVATOR_29, ARG
VARSET RESULT, -1
VARSET RESULTS
SELECTCASE ARG
	CASE 29
		RESULT:1 = 6
		RESULT:2 = 3
		RETURN -1
	CASE 39
		RESULT:1 = 2
		RESULT:2 = 1
		RESULT:3 = 0
		RETURN -1
	CASE 49
		RESULT:1 = 2
		RESULT:2 = 1
		RESULT:3 = 0
		RETURN -1
ENDSELECT
;=======================================================================
;Ｓターミナル
;=======================================================================
@S_TERMINAL_29
#LOCALSSIZE 1
SELECTCASE FLAG:현M
	CASE 6
		SETBIT 던전플래그:(FLAG:현던전):2 , 0
	CASE 3
		SETBIT 던전플래그:(FLAG:현던전):2 , 1
	CASE 2
		SETBIT 던전플래그:(FLAG:현던전):2 , 2
ENDSELECT
LOCALS = 
SIF GETBIT(던전플래그:(FLAG:현던전):2 , 0) && FLAG:현M != 6
	LOCALS += "[1] Ｂ１Ｆへ/"
SIF GETBIT(던전플래그:(FLAG:현던전):2 , 1) && FLAG:현M != 3
	LOCALS += "[2] Ｂ４Ｆへ/"
SIF GETBIT(던전플래그:(FLAG:현던전):2 , 2) && FLAG:현M != 2
	LOCALS += "[3] Ｂ５Ｆ에/"
LOCALS += "[0] 이용하지 않는다/[100] 방으로 돌아간다"
CALL MESSAGE_WINDOW_D, "", "＞Ｓ터미널이 있다/＞어떻게 하겠습니까？"
CALL INPUT_SELECT_D, LOCALS
IF RESULT == 0
	RETURN 0
ELSEIF RESULT == 100
	FLAG:탈출 = 1
	RETURN 0
ELSEIF RESULT == 1
	CALL DUNGEON_WORP_ID,6,19,1
	RETURN 0
ELSEIF RESULT == 2
	CALL DUNGEON_WORP_ID,3,19,1
	RETURN 0
ELSE
	CALL DUNGEON_WORP_ID,2,19,1
	RETURN 0
ENDIF
RETURN 0

;=======================================================================
;인카운트율
;=======================================================================
@ENCOUNT_RATE_29
SELECTCASE FLAG:현M
	CASEELSE
		FLAG:인카운트율 = MAX(FLAG:미조우걸음수 * 5 - 25, 0)
		FLAG:MAG소비율 = 100
ENDSELECT
FLAG:인카운트율 = 0
;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_29
#LOCALSIZE 3
IF RAND:100 < FLAG:인카운트율
	CALL ENEMY_TABLE
	RETURN 1
ELSE
	FLAG:미조우걸음수 += 1
	RETURN 0
ENDIF

;=======================================================================
;적の종족の종류数
;=======================================================================
@CLASS_NUM_29
SELECTCASE FLAG:현M
	;지령街
	CASE 3 TO 6
		RETURN CLASS_NUM_COMMON("初級")
	;뮤턴트・コミュニティー
	CASEELSE
		RETURN CLASS_NUM_COMMON("中級")
ENDSELECT

;=======================================================================
;적の総数
;=======================================================================
@ENEMY_NUM_29, ARG
SELECTCASE FLAG:현M
	;지령街
	CASE 3 TO 6
		RETURN ENEMY_NUM_COMMON("中級", ARG)
	;뮤턴트・コミュニティー
	CASEELSE
		RETURN ENEMY_NUM_COMMON("上級", ARG)
ENDSELECT
;=======================================================================
;적の종류
;=======================================================================
@ENEMY_29, ARG
SELECTCASE FLAG:현M
	;아카사카
	;지령の街
	CASE 3 TO 6
		SELECTCASE RAND:100
			CASE IS < 15
				RETURN [[キャラ:노커]], 15
			CASE IS < 30
				RETURN [[キャラ:브라우니]], 17
			CASE IS < 50
				RETURN [[キャラ:화백]], 17
			CASE IS < 70
				RETURN [[キャラ:츠치구모]], 18
			CASE IS < 85
				RETURN [[キャラ:코파텐구]], 19
			CASE IS < 95
				RETURN [[キャラ:드베르가]], 23
			CASE IS < 100
				IF RAND:2 == 1
					RETURN [[キャラ:카라스텐구]], 28
				ELSEIF RAND:2 == 1
					RETURN [[キャラ:우벨루리]], 33
				ELSE
					RETURN [[キャラ:티탄]], 45
				ENDIF
		ENDSELECT
	;뮤턴트・コミュニティー
	CASE 0 TO 2
		SELECTCASE RAND:100
			CASE IS < 15
				RETURN [[キャラ:다크엘프]], 19
			CASE IS < 30
				RETURN [[キャラ:츠치구모]], 19
			CASE IS < 45
				RETURN [[キャラ:노즈치]], 19
			CASE IS < 60
				RETURN [[キャラ:특공대]], 20
			CASE IS < 75
				RETURN [[キャラ:네코마타]], 22
			CASE IS < 90
				RETURN [[キャラ:드베르가]], 25
			CASE IS < 100
				RETURN [[キャラ:밴시]], 27
		ENDSELECT
ENDSELECT
;=================================
;特殊調整
;=================================
@SET_ENEMY_STATUS_29, ARG
#LOCALSIZE 1
SELECTCASE NO:ARG
	CASE [[キャラ:노커]]
		ABL:ARG:스킬3 = [[스킬:디아라마]]
		ABL:ARG:스킬5 = [[스킬:소닉펀치]]
		ABL:ARG:스킬2 = [[스킬:마그나스]]
		ABL:ARG:스킬7 = [[스킬:마하・마그나]]
	CASE [[キャラ:브라우니]]
		ABL:ARG:스킬2 = [[스킬:그라이바]]
		ABL:ARG:스킬5 = [[스킬:마하・그라이]]
	CASE [[キャラ:화백]]
		ABL:ARG:스킬1 = [[스킬:아기라오]]
		ABL:ARG:스킬4 = [[스킬:펨파트라]]
	CASEELSE
ENDSELECT

@GAIA_TEMPLE_29
IF ABL:MASTER:속성LC == 1
	CALL MESSAGE_WINDOW_D , "가이아교 사제" , "로우 사이드의 사도들은 즉각 이 장소로부터 떠나라！"
	IF MONEY < 5000
		RETURN 1
	ELSE
		CALL MESSAGE_WINDOW_D , "가이아교 사제" , "……허나 ￥5000을 기부한다면 편의를 도모해 주겠다"
		CALL INPUT_YN, "지불한다" , "지불하지 않는다"
		SIF RESULT == 1
			RETURN 1
		MONEY -= 5000
	ENDIF
ENDIF
;ガイア神殿
CALL MESSAGE_WINDOW_D , "사제" , "여기는 가이아 신전"
$GAIA
CALL INPUT_SELECT_D, "무슨 용무냐？//[1]아이템을 산다/ [2]스테이터스를 본다///[0]밖으로 나간다" , , , 2
IF RESULT == 1
	CALL MESSAGE_WINDOW_D , "사제" , "어떻게 할 거지？"
	;カオス系아이템を1割引きで
	LOCALS = 
	LOCALS += "독화살," + TOSTR(ITEMPRICE:독화살*9/10) + ","
	LOCALS += "충독명," + TOSTR(ITEMPRICE:충독명*9/10) + ","
	LOCALS += "비공침," + TOSTR(ITEMPRICE:비공침*9/10) + ","
	LOCALS += "염주," + TOSTR(ITEMPRICE:염주*9/10) + ","
	CALL DUNGEON_SHOPS, 0, LOCALS
ELSEIF RESULT == 2
	CALL SHOP_COM_301
ELSE
	CALL MESSAGE_WINDOW_D , "사제" , "이 세상에 혼돈을 초래해라"
	RETURN 1
ENDIF
GOTO GAIA


;=======================================================================
;윤간참가악마
;=======================================================================
@DUNGEON_RAPE_DEVIL_29
;랜덤にどの악마が出るか決定
;RETURN CSV번호 , 人数 , 레벨
SELECTCASE RAND:4
	CASE 0
		RETURN [[キャラ:우벨루리]] , 3 + RAND:10 , CSVBASE([[キャラ:우벨루리]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 1
		RETURN [[キャラ:티탄]] , 3 + RAND:10 , CSVBASE([[キャラ:티탄]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 2
		RETURN [[キャラ:츠치구모]] , 3 + RAND:10 , CSVBASE([[キャラ:츠치구모]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 3
		RETURN [[キャラ:노즈치]] , 3 + RAND:10 , CSVBASE([[キャラ:노즈치]] , GETNUM(BASE , "LV") , 0) + RAND:3
ENDSELECT







;=======================================================================
;ゲームオーバー
;=======================================================================




