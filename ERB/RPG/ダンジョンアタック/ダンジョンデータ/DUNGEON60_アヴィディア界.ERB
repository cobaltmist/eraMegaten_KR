;=======================================================================
;아비디아계
;
;던전ナンバー60
;=======================================================================
;던전플래그:(FLAG:현던전):0 = クリアフラグ
;던전플래그:(FLAG:현던전):1 = ショートカットスイッチ？
;
;그외みているフラグ
;이벤트플래그:1:0 마요네ＧＥＴフラグ
;=======================================================================
;210305	NEO	パンドラのAIを修正
;=======================================================================
;攻略条件
;=======================================================================
@PREREQUISITE_DUNGEON_60
;岩戸クリア
IF 던전플래그:19:1 == 1 && 던전플래그:60:0 == 0
	RETURN 1
ELSE
	RETURN 0
ENDIF

;=======================================================================
;던전名
;=======================================================================
@GET_DUNGEON_NAME_60
RESULTS = 아비디아계


;=======================================================================
;플로어名표시
;=======================================================================
@FLOORNAME_60
PRINT 아비디아계

;=======================================================================
;特殊タイル표시
;=======================================================================
@TILE_MARK_60_0_18_8
RESULTS = →
@TILE_MARK_60_0_18_10
RESULTS = →
@TILE_MARK_60_0_18_14
RESULTS = →
@TILE_MARK_60_0_18_16
RESULTS = →
@TILE_MARK_60_1_18_8
RESULTS = →
@TILE_MARK_60_1_18_10
RESULTS = →
@TILE_MARK_60_4_18_5
RESULTS = →
@TILE_MARK_60_4_18_7
RESULTS = →
@TILE_MARK_60_4_18_13
RESULTS = →
@TILE_MARK_60_4_18_15
RESULTS = →
@TILE_MARK_60_5_18_2
RESULTS = →
@TILE_MARK_60_5_18_4
RESULTS = →
@TILE_MARK_60_5_18_14
RESULTS = →
@TILE_MARK_60_5_18_16
RESULTS = →

@TILE_MARK_60_1_0_8
RESULTS = ←
@TILE_MARK_60_1_0_10
RESULTS = ←
@TILE_MARK_60_1_0_14
RESULTS = ←
@TILE_MARK_60_1_0_16
RESULTS = ←
@TILE_MARK_60_2_0_8
RESULTS = ←
@TILE_MARK_60_2_0_10
RESULTS = ←
@TILE_MARK_60_3_0_5
RESULTS = ←
@TILE_MARK_60_3_0_7
RESULTS = ←
@TILE_MARK_60_3_0_13
RESULTS = ←
@TILE_MARK_60_3_0_15
RESULTS = ←
@TILE_MARK_60_4_0_2
RESULTS = ←
@TILE_MARK_60_4_0_4
RESULTS = ←
@TILE_MARK_60_4_0_14
RESULTS = ←
@TILE_MARK_60_4_0_16
RESULTS = ←

@TILE_MARK_60_0_4_0
RESULTS = ↑
@TILE_MARK_60_0_6_0
RESULTS = ↑

@TILE_MARK_60_6_4_18
RESULTS = ↓
@TILE_MARK_60_6_6_18
RESULTS = ↓

@TILE_MARK_60_2_2_5
RESULTS = Ｔ
@TILE_MARK_60_5_2_12
RESULTS = Ｔ


;=======================================================================
;スタート地点입력
;=======================================================================
@START_DUNGEON_60,ARG
FLAG:현M = 0
FLAG:현X = 3
FLAG:현Y = 18
;CALL AUTOMAP

;=======================================================================
;スタート時이벤트
;=======================================================================
@EVENT_DUNGEON_START_60
	CALL MESSAGE_WINDOW_D, "", @"＞소노무라 마키의 심상세계에서의 탐색도 드디어 가경에 들러갔다/＞동굴 가장 안쪽에서 만난 「소노무라 마키」의 컴팩트가 가야 할 길을 지시하고 있다/＞%CALLNAME:MASTER%이 방문한 곳은、성 엘민학원의 도서관이었다。"
	CALL MESSAGE_WINDOW_D, "", @"＞거기에는 거대한 문이 놓여 있었다/＞그 문은、파동치는 빛을 발하면서、섬뜩한 소리를 내고 있었다/＞마치 심장과도 같은 모습의 문에、%CALLNAME:MASTER%는 손을 대었다。"
	CALL MESSAGE_WINDOW_D, "", "………………/…………/……"

;=======================================================================
;指定したマスに進入가능か
;=======================================================================
@CAN_ENTER_60,ARG,ARG:1
CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT
;=======================================================================
;플로어데이터
;=======================================================================
@MAKE_FLOOR_60
SELECTCASE FLAG:현M
	CASE 0
		
		FLAG:최대X = 19
		FLAG:최대Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000909000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0061111000000000000"
		CALL MAKE_FLOOR_LINE, 2,"0000001100000000000"
		CALL MAKE_FLOOR_LINE, 3,"0000000100000000000"
		CALL MAKE_FLOOR_LINE, 4,"0011111100000000000"
		CALL MAKE_FLOOR_LINE, 5,"0000000010000000000"
		CALL MAKE_FLOOR_LINE, 6,"0000000010000000000"
		CALL MAKE_FLOOR_LINE, 7,"0011100111000000000"
		CALL MAKE_FLOOR_LINE, 8,"0011100101000000019"
		CALL MAKE_FLOOR_LINE, 9,"0001000101000000010"
		CALL MAKE_FLOOR_LINE,10,"0011111101111000019"
		CALL MAKE_FLOOR_LINE,11,"0010000100001011110"
		CALL MAKE_FLOOR_LINE,12,"0010110101111010000"
		CALL MAKE_FLOOR_LINE,13,"0011100101000010000"
		CALL MAKE_FLOOR_LINE,14,"0110111011100010019"
		CALL MAKE_FLOOR_LINE,15,"0011110010111110010"
		CALL MAKE_FLOOR_LINE,16,"0000100000100010019"
		CALL MAKE_FLOOR_LINE,17,"0111100000100011110"
		CALL MAKE_FLOOR_LINE,18,"0008000000000000000"
		;이벤트の設置
		CALL SET_TILE,8,4,던전플래그:(FLAG:현던전):1,1,1

	CASE 1
		FLAG:최대X = 19
		FLAG:최대Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 2,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 3,"0101111111111110100"
		CALL MAKE_FLOOR_LINE, 4,"0111000000010000100"
		CALL MAKE_FLOOR_LINE, 5,"0101000111111100100"
		CALL MAKE_FLOOR_LINE, 6,"0001000100000000100"
		CALL MAKE_FLOOR_LINE, 7,"0111000101000111110"
		CALL MAKE_FLOOR_LINE, 8,"9101010101111100019"
		CALL MAKE_FLOOR_LINE, 9,"0101010100000111010"
		CALL MAKE_FLOOR_LINE,10,"9101110101110001019"
		CALL MAKE_FLOOR_LINE,11,"0001000111111101010"
		CALL MAKE_FLOOR_LINE,12,"0001010101110101010"
		CALL MAKE_FLOOR_LINE,13,"0101010100000101010"
		CALL MAKE_FLOOR_LINE,14,"9111011100011101000"
		CALL MAKE_FLOOR_LINE,15,"0100010011110101010"
		CALL MAKE_FLOOR_LINE,16,"9100000010000001110"
		CALL MAKE_FLOOR_LINE,17,"0100111111111111010"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	
	CASE 2
		FLAG:최대X = 19
		FLAG:최대Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0111111111000000000"
		CALL MAKE_FLOOR_LINE, 2,"0100100001000000000"
		CALL MAKE_FLOOR_LINE, 3,"0110100101111101100"
		CALL MAKE_FLOOR_LINE, 4,"0000111100001001000"
		CALL MAKE_FLOOR_LINE, 5,"0090010000001111100"
		CALL MAKE_FLOOR_LINE, 6,"0020111100000000110"
		CALL MAKE_FLOOR_LINE, 7,"0111100000001100010"
		CALL MAKE_FLOOR_LINE, 8,"9100000000000111110"
		CALL MAKE_FLOOR_LINE, 9,"0100000000011111000"
		CALL MAKE_FLOOR_LINE,10,"9101100001001001100"
		CALL MAKE_FLOOR_LINE,11,"0111000001110001100"
		CALL MAKE_FLOOR_LINE,12,"0000011100011111110"
		CALL MAKE_FLOOR_LINE,13,"0111110111000000010"
		CALL MAKE_FLOOR_LINE,14,"0001000101000001010"
		CALL MAKE_FLOOR_LINE,15,"0011100101110001110"
		CALL MAKE_FLOOR_LINE,16,"0010100100011110010"
		CALL MAKE_FLOOR_LINE,17,"0060100101110011110"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	
	CASE 3
		FLAG:최대X = 19
		FLAG:최대Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0011110011110000000"
		CALL MAKE_FLOOR_LINE, 2,"0010010110010000000"
		CALL MAKE_FLOOR_LINE, 3,"0111010100010000100"
		CALL MAKE_FLOOR_LINE, 4,"0100011101111000100"
		CALL MAKE_FLOOR_LINE, 5,"9100000101101111110"
		CALL MAKE_FLOOR_LINE, 6,"0100000011111011100"
		CALL MAKE_FLOOR_LINE, 7,"9100011110001111100"
		CALL MAKE_FLOOR_LINE, 8,"0101110000000011110"
		CALL MAKE_FLOOR_LINE, 9,"0001010000000000000"
		CALL MAKE_FLOOR_LINE,10,"0001010001010011110"
		CALL MAKE_FLOOR_LINE,11,"0001000011011111100"
		CALL MAKE_FLOOR_LINE,12,"0001111111001011110"
		CALL MAKE_FLOOR_LINE,13,"9100100001101111100"
		CALL MAKE_FLOOR_LINE,14,"0100000000111110000"
		CALL MAKE_FLOOR_LINE,15,"9100000000001000000"
		CALL MAKE_FLOOR_LINE,16,"0111111111111100000"
		CALL MAKE_FLOOR_LINE,17,"0070000000000100000"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"

	CASE 4
		FLAG:최대X = 19
		FLAG:최대Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0111000000011111010"
		CALL MAKE_FLOOR_LINE, 2,"9101100001110001110"
		CALL MAKE_FLOOR_LINE, 3,"0100100111000011010"
		CALL MAKE_FLOOR_LINE, 4,"9100100101000010010"
		CALL MAKE_FLOOR_LINE, 5,"0001111101000010019"
		CALL MAKE_FLOOR_LINE, 6,"0001000001000110010"
		CALL MAKE_FLOOR_LINE, 7,"0011111001100100019"
		CALL MAKE_FLOOR_LINE, 8,"0110001100100110010"
		CALL MAKE_FLOOR_LINE, 9,"0100000100100010010"
		CALL MAKE_FLOOR_LINE,10,"0111001100100010010"
		CALL MAKE_FLOOR_LINE,11,"0001111000100010000"
		CALL MAKE_FLOOR_LINE,12,"0011001100101110010"
		CALL MAKE_FLOOR_LINE,13,"0010000110101000019"
		CALL MAKE_FLOOR_LINE,14,"9110000010111000010"
		CALL MAKE_FLOOR_LINE,15,"0100000010000000019"
		CALL MAKE_FLOOR_LINE,16,"9100000000000111010"
		CALL MAKE_FLOOR_LINE,17,"0000000000000101110"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	

	CASE 5
		FLAG:최대X = 19
		FLAG:최대Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0070001111100001110"
		CALL MAKE_FLOOR_LINE, 2,"0111111010000001019"
		CALL MAKE_FLOOR_LINE, 3,"0100001010000001010"
		CALL MAKE_FLOOR_LINE, 4,"0111000011100000019"
		CALL MAKE_FLOOR_LINE, 5,"0010000001100000000"
		CALL MAKE_FLOOR_LINE, 6,"0111000011100000000"
		CALL MAKE_FLOOR_LINE, 7,"0100000110000010000"
		CALL MAKE_FLOOR_LINE, 8,"0104000100010110000"
		CALL MAKE_FLOOR_LINE, 9,"0102000111111110000"
		CALL MAKE_FLOOR_LINE,10,"0111210001100000000"
		CALL MAKE_FLOOR_LINE,11,"0020000111000100000"
		CALL MAKE_FLOOR_LINE,12,"0090000010111100010"
		CALL MAKE_FLOOR_LINE,13,"0000000011110100110"
		CALL MAKE_FLOOR_LINE,14,"0000000010000101019"
		CALL MAKE_FLOOR_LINE,15,"0000000010111111010"
		CALL MAKE_FLOOR_LINE,16,"0000000010000001019"
		CALL MAKE_FLOOR_LINE,17,"0000000011001111110"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
		;이벤트の設置
		CALL SET_TILE,5,10,던전플래그:(FLAG:현던전):1,0,4

	CASE 6
		FLAG:최대X = 19
		FLAG:최대Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0101010101010101010"
		CALL MAKE_FLOOR_LINE, 2,"0101110101110111010"
		CALL MAKE_FLOOR_LINE, 3,"0111011101011101010"
		CALL MAKE_FLOOR_LINE, 4,"0101010111010101110"
		CALL MAKE_FLOOR_LINE, 5,"0100000101000101010"
		CALL MAKE_FLOOR_LINE, 6,"0101010100010100010"
		CALL MAKE_FLOOR_LINE, 7,"0101110101011101010"
		CALL MAKE_FLOOR_LINE, 8,"0111010111010101110"
		CALL MAKE_FLOOR_LINE, 9,"0101010101010001010"
		CALL MAKE_FLOOR_LINE,10,"0100010001011101000"
		CALL MAKE_FLOOR_LINE,11,"0001010111010101010"
		CALL MAKE_FLOOR_LINE,12,"0101010101000101110"
		CALL MAKE_FLOOR_LINE,13,"0111010000010001010"
		CALL MAKE_FLOOR_LINE,14,"0101110001010100010"
		CALL MAKE_FLOOR_LINE,15,"0101010001110111010"
		CALL MAKE_FLOOR_LINE,16,"0100000001011101110"
		CALL MAKE_FLOOR_LINE,17,"0111111001010100060"
		CALL MAKE_FLOOR_LINE,18,"0000909000000000000"
	
	CASE 7
		FLAG:최대X = 19
		FLAG:최대Y = 19
		CALL MAKE_FLOOR_LINE, 0,"0000000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"0111111111101111110"
		CALL MAKE_FLOOR_LINE, 2,"0100000001000010010"
		CALL MAKE_FLOOR_LINE, 3,"0101101111110111010"
		CALL MAKE_FLOOR_LINE, 4,"0111000100000001010"
		CALL MAKE_FLOOR_LINE, 5,"0101011111101100010"
		CALL MAKE_FLOOR_LINE, 6,"0101110000000101010"
		CALL MAKE_FLOOR_LINE, 7,"0001010111110111010"
		CALL MAKE_FLOOR_LINE, 8,"0101011100010101010"
		CALL MAKE_FLOOR_LINE, 9,"0111010101010101010"
		CALL MAKE_FLOOR_LINE,10,"0101000002010001010"
		CALL MAKE_FLOOR_LINE,11,"0100000001110101010"
		CALL MAKE_FLOOR_LINE,12,"0101000000000101110"
		CALL MAKE_FLOOR_LINE,13,"0111011111000111010"
		CALL MAKE_FLOOR_LINE,14,"0101001000000101010"
		CALL MAKE_FLOOR_LINE,15,"0001111110111100010"
		CALL MAKE_FLOOR_LINE,16,"0100001000001000110"
		CALL MAKE_FLOOR_LINE,17,"0111111111111110070"
		CALL MAKE_FLOOR_LINE,18,"0000000000000000000"
	
		;이벤트の設置
		CALL SET_TILE,9,9,던전플래그:(FLAG:현던전):0,0,4
	CASEELSE
ENDSELECT



;=======================================================================
;[5]조사　実行時の이벤트
;=======================================================================
@EVENT_CHECK_DUNGEON_60

;==========
;出口の処理
;==========
IF DA:(FLAG:현X):(FLAG:현Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 6
	SELECTCASE FLAG:현M
		CASE 0
			CALL DUNGEON_UPSTAIRS,5,(FLAG:현X),(FLAG:현Y)
		CASE 2
			CALL DUNGEON_UPSTAIRS,3,(FLAG:현X),(FLAG:현Y)
		CASE 6
			CALL DUNGEON_UPSTAIRS,7,(FLAG:현X),(FLAG:현Y)
		CASEELSE
	ENDSELECT
	RETURN 1

ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 7
	SELECTCASE FLAG:현M
		CASE 3
			CALL DUNGEON_DOWNSTAIRS,2,(FLAG:현X),(FLAG:현Y)
		CASE 5
			CALL DUNGEON_DOWNSTAIRS,0,(FLAG:현X),(FLAG:현Y)
		CASE 7
			CALL DUNGEON_DOWNSTAIRS,6,(FLAG:현X),(FLAG:현Y)
		CASEELSE
	ENDSELECT
RETURN 1

;========
;이벤트の処理
;========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 4
	IF FLAG:현M == 5
		IF FLAG:현X == 5
			PRINTW ＞스위치 같은 것이 있다。
			PRINTW ＞눌러 보겠습니까？
			CALL INPUT_YN
			IF RESULT == 0
				PRINTW ＞어디선가 무거운 물건이 움직이는 소리가 났다。
				던전플래그:(FLAG:현던전):1 = 1
			ENDIF
		ENDIF
	ENDIF
	CALL MAKE_FLOOR, FLAG:현던전
	CALL AUTOMAP
	
	RETURN 1
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 9
	SELECTCASE FLAG:현M
		CASE 2
			SIF FLAG:현X == 2 && FLAG:현Y == 5
				CALL DUNGEON_TERMINAL
	ENDSELECT
	RETURN 1
ELSE
	PRINTW 아무것도 없는 것 같다
	RETURN 0
ENDIF

;=======================================================================
;タイル進入時の이벤트
;=======================================================================
@EVENT_ENTER_DUNGEON_60,ARG
;ARG = 進入時の向き　0の場合ワープなど
;==========
;出口の処理
;==========
IF DA:(FLAG:현X):(FLAG:현Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;==========
;特殊タイルの処理
;==========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 9
	SELECTCASE FLAG:현M
		CASE 0
			IF FLAG:현X == 18
				FLAG:현X = 0
				FLAG:현M = 1
			ENDIF
			IF FLAG:현Y == 0
				FLAG:현Y = 18
				FLAG:현M = 6
			ENDIF
		CASE 1
			IF FLAG:현X == 0
				FLAG:현X = 18
				FLAG:현M = 0
			ELSEIF FLAG:현X == 18
				FLAG:현X = 0
				FLAG:현M = 2
			ENDIF
		CASE 2
			IF FLAG:현X == 0
				FLAG:현X = 18
				FLAG:현M = 1
			ELSEIF FLAG:현X == 2
				CALL DUNGEON_TERMINAL
			ENDIF
		CASE 3
			IF FLAG:현X == 0
				FLAG:현X = 18
				FLAG:현M = 4
			ENDIF
		CASE 4
			IF FLAG:현X == 18
				FLAG:현X = 0
				FLAG:현M = 3
			ELSEIF FLAG:현X == 0
				FLAG:현X = 18
				FLAG:현M = 5
			ENDIF
		CASE 5
			IF FLAG:현X == 18
				FLAG:현X = 0
				FLAG:현M = 4
			ELSEIF FLAG:현X == 2
				CALL DUNGEON_TERMINAL
			ENDIF
		CASE 6
			IF FLAG:현Y == 18
				FLAG:현Y = 0
				FLAG:현M = 0
			ENDIF
		CASEELSE
	ENDSELECT
	CALL MAKE_FLOOR, FLAG:현던전
	CALL AUTOMAP
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 6
	SELECTCASE FLAG:현M
		CASE 0
			CALL DUNGEON_UPSTAIRS,5,(FLAG:현X),(FLAG:현Y)
		CASE 2
			CALL DUNGEON_UPSTAIRS,3,(FLAG:현X),(FLAG:현Y)
		CASE 6
			CALL DUNGEON_UPSTAIRS,7,(FLAG:현X),(FLAG:현Y)
		CASEELSE
	ENDSELECT
	RETURN 1

ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 7
	SELECTCASE FLAG:현M
		CASE 3
			CALL DUNGEON_DOWNSTAIRS,2,(FLAG:현X),(FLAG:현Y)
		CASE 5
			CALL DUNGEON_DOWNSTAIRS,0,(FLAG:현X),(FLAG:현Y)
		CASE 7
			CALL DUNGEON_DOWNSTAIRS,6,(FLAG:현X),(FLAG:현Y)
		CASEELSE
	ENDSELECT
RETURN 1

;========
;이벤트の処理
;========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 4
	IF FLAG:현M == 5
		IF FLAG:현X == 3
			PRINTW 함정이다！
			FLAG:현M = 0
			CALL MAKE_FLOOR, FLAG:현던전
			CALL AUTOMAP
		ELSEIF FLAG:현X == 5
			PRINTW ＞스위치 같은 것이 있다。
			PRINTW ＞눌러보시겠습니까？
			CALL INPUT_YN
			IF RESULT == 0
				PRINTW ＞어디선가 무거운 것이 움직이는 소리가 났다。
				던전플래그:(FLAG:현던전):1 = 1
			ENDIF
		ENDIF
	ELSEIF FLAG:현M == 7
;판도라
		CALL MESSAGE_WINDOW_D, "", "＞거기는 열린 방이었다。/＞방의 안쪽에、대규모의 기계가 설치되어 있어、섬뜩한 빛을 발하고 있었다。/＞아마도、저것이 DEVA시스템일 것이다。"
		CALL MESSAGE_WINDOW_D, "", "＞그리고 그 앞에는、한 명의 여성이 서 있다。/＞그 여성은、소노무라 마키와 빼닮은 외모를 가지고 있었지만、/＞몸은 거인과도 같을 정도로 크고、등에는 나비와도 같은 아름다운 날개가 있었다。"
		CALL MESSAGE_WINDOW_D, "판도라", "이것은 내 「낙원의 문」//계속 꿈꾸던……겨우 손에 넣은거야"
		CALL MESSAGE_WINDOW_D, "판도라", "절대로 넘겨주지 않겠어……！/나는 이제 낙원을 만들었어/아무것도 없는、텅 빈 낙원을 말이지요"
		PRINTW 마왕 판도라가 １체 나타났다！
		CUSTOMDRAWLINE =
		WAIT
		FLAG:도주불가플래그 = 1
		FLAG:회화불능플래그 = 1
		FLAG:선제기습취소 = 1
		CALL SET_ENEMY,9,220,80,0,1
		CFLAG:(CHARANUM-1):ＨＰ보정 = 5000
		CALL SYNC_STATUS,(CHARANUM-1)
		CALL HEALTH_CHARA,(CHARANUM-1)
		CFLAG:(CHARANUM-1):행동횟수 = 2
		CSTR:(CHARANUM-1):사고패턴 = Dn60パンドラ
		CALL BATTLE_START
		FLAG:도주불가플래그 = 0
		FLAG:회화불능플래그 = 0
		FLAG:선제기습취소 = 0
		CALL MESSAGE_WINDOW_D, "", "＞쓰러진 판도라는 뭔가 말하고 싶어하는 표정으로 천천히 사라져 갔다。"
		CALL MESSAGE_WINDOW_D, "", "＞세계에 균열이 생겨난다…/＞판도라가 사라지자、세계를 지탱하는 힘을 잃어버린 것이다。/＞지금부터 탈출을 시도해도、늦지는 않을 것 같다"
;마키がいれば、外に出してくれる。いなければシステムをハックして탈출
		IF FINDCHARA_B([[キャラ:마키]])== 2
			CALL MESSAGE_WINDOW_D, "", "＞그렇게 생각하고 있는데 마키가 앞으로 나섰다。"
			CALL MESSAGE_WINDOW_D, "마키", "나에게 맡겨줘。/모두、무사히 밖으로 내보내주겠어"
			CALL MESSAGE_WINDOW_D, "", @"＞마키의 그 말과 함께、%CALLNAME:MASTER%의 시계가 하얗게 물들어 가기 시작했다。"
			CALL MESSAGE_WINDOW_D, "마키", "……나는、진짜 소노무라 마키의 인격 중 하나일 뿐이라、//이 이상 앞으로 가면 안 되니까……"
			CALL MESSAGE_WINDOW_D, "", @"＞희미해져 가는 %CALLNAME:MASTER%의 시계에 마지막으로 비친 것은、마키의 온화한 미소였다……"
			던전플래그:(FLAG:현던전):0 = 1
		ELSE
			CALL MESSAGE_WINDOW_D, "", "＞……DEVA시스템에 개입 할 수 밖에 없다。/＞도망칠 시간 정도는 벌어야……/＞발 밑은 흔들리는데다、천장에는 금이 가고 있고、눈에 보이는 속도로 모든 것이 붕괴해 가던 중、"
			CALL MESSAGE_WINDOW_D, "", @"＞%CALLNAME:MASTER%는、DEVA시템에 대한 조사보고를 떠올리며、/＞COMP를 통해 DEVA시스템의 해킹 작업을 시도했다……"
			IF FINDCHARA_B([[キャラ:유키노상]])== 2
				CALL MESSAGE_WINDOW_D, "유키노", "위험해！！"
				CALL MESSAGE_WINDOW_D, "", @"＞%CALLNAME:MASTER%의 머리 위로 떨어지는 천장의 파편을、유키노의 페르소나가 막아줬다。"
				CALL MESSAGE_WINDOW_D, "유키노", "주위는 신경쓰지 않아도 좋아！그쪽은 맡기겠어！"
			ENDIF
			CALL MESSAGE_WINDOW_D, "", "＞……매개하는 인간도 없이、/＞장시간 DEVA시스템을 작동시킬 수는 없지만/＞부서진 부분을 보충하고 어떻게든 시간을 벌고/＞다음에는 필사적으로 도망칠 뿐이었다"
			IF FINDCHARA_B([[キャラ:에리]])== 2
				CALL MESSAGE_WINDOW_D, "에리", "여기에요！"
				CALL MESSAGE_WINDOW_D, "", "＞에리는 선두에서 달리고 있다。/＞장대한 미로를、잘도 알고 있다。"
			ENDIF
			IF FINDCHARA_B([[キャラ:아야세]])== 2
				CALL MESSAGE_WINDOW_D, "아야세", "아얏 위험해 위험하니 어서 서둘러！"
				CALL MESSAGE_WINDOW_D, "", "＞아야세가 소리치며 달린다。/＞쏟아지는 파편으로부터 머리부분을 감싸며 필사적인 모습이다。"
			ENDIF
		ENDIF
		CALL MESSAGE_WINDOW_D, "", "…………/………/……/…"
		CALL MESSAGE_WINDOW_D, "", @"＞%CALLNAME:MASTER%의 사무소"
		;마요네ＧＥＴ済み
		IF 이벤트플래그:1:0 == 3
			CALL MESSAGE_WINDOW_D, "에이전트", "보고는 읽어보았다。/잘했다……라고 말하고 싶긴 하지만"
			CALL MESSAGE_WINDOW_D, "에이전트", "……시간이 너무 걸렸군、/데바・유가 소멸 직후에 보고를 올리는게 어떠했을지/그랬다면、가동중인 DEVA시스템도 이 손에 들어왔을텐데"
			CALL MESSAGE_WINDOW_D, "", @"＞%CALLNAME:MASTER%의 보고서를 읽은 팬텀・소사이어티의 에이전트는、/＞불평을 말하며 전화를 끊었다"
		ELSE
			CALL MESSAGE_WINDOW_D, "마요네", "보고는 잘 봤어요。/잘했다……라고 말해 주고 싶긴 하지만……"
			CALL MESSAGE_WINDOW_D, "마요네", "……시간이 너무 걸렸어요、/왜 데바・유가 소멸 직후에 보고를 올릴 수 없었나요?/그랬다면、가동중인 DEVA시스템도 이 손에 들어왔을텐데"
			CALL MESSAGE_WINDOW_D, "", @"＞%CALLNAME:MASTER%의 보고서를 읽은 마요네는、/＞불만스럽게 말한 후 전화를 끊었다"
		ENDIF
		CALL MESSAGE_WINDOW_D, "", "＞DEVA시스템은 기능을 정지해 버린 것 같다。/＞어쨌든 이로서、이 건은 끝났다고 말할 수 있겠다。/＞이 것의 보수로、￥50000이 지급되었다。"
		CALL MESSAGE_WINDOW_D, "", "＞……일에 걸맞는 보수라고 할 수는 없다。/＞조직의 역정을 사버리는 바람에、/＞앞으로는 싸움에 조심할 필요도 생겨버렸다。"
		CALL MESSAGE_WINDOW_D, "", @"＞……하지만、얻은 것이 있었다고 %CALLNAME:MASTER%는 생각한다"
		IF FINDCHARA_B([[キャラ:마키]])== 2
			CALL MESSAGE_WINDOW_D, "", @"＞떨어진 곳에서 잡담에 즐거워하는 「진짜」 소노무라 마키/＞그 때 사라진 「이상의 자신」이 얻은 기억이나 경험이 고스란히 남아 있는 듯、/＞여기에 남기를 원하는、%CALLNAME:MASTER%도 그것을 승낙했다"
			CALL MESSAGE_WINDOW_D, "", "＞처음에는 언행에 위화감을 느꼈지만、/＞점점 차이를 느끼지 않게 되었다。"
			CALL MESSAGE_WINDOW_D, "", "＞「이상의 자신」의 영향이 강한건가、/＞「진짜 자신」이 과거의 이상을 쫓고 있는 것이 아닐까、/＞분명 그것은 본인조차 모르는 일을 것이다……"
		ENDIF
		CALL MESSAGE_WINDOW_D, "", @"＞……어느샌가 손에 들어온 카드를 손가락으로 희롱하면서/＞잠시 생각에 둘러 쌓여 있던 %CALLNAME:MASTER%였지만、/＞이윽고 천천히 잠 속으로 빠져들었다……"
		CALL MESSAGE_WINDOW_D, "", "＞마테리얼 카드【아바타라】를 손에 넣었다"
		ITEM:아바타라 = 1
		MONEY += 50000
;미혹의숲侵入禁止
		던전플래그:12:0 = 10
;地下鉄侵入禁止
		던전플래그:11:7 = 1

		IF DAY < 51
;			CALL MESSAGE_WINDOW_D, "", "/―――여신이문록 페르소나 트루 엔드―――"
			CALL MESSAGE_WINDOW_D, "", "/Ending No.028 (여신이문록 페르소나　세벡편 엔드　be your true mind)"
			FLAG:5 = 9
			SETBIT FLAG:취소된ED,28
			SETBIT FLAG:발견ED,28
			FLAG:탈출 = 1
			PRINTFORML [0]끝낸다 [1]계속한다 [2]일부 데이터를 이어서 새로 시작
			CALL INPUTINT,0, 1, 2
			IF RESULT == 0
				QUIT
			ELSEIF RESULT == 1
				CALL REQUEST_50_DAY_END
			ELSEIF RESULT == 2
				CALL START_NEWGAME
				RETURN 1
			ENDIF
		ENDIF
		던전플래그:60:0 = 1
		FLAG:탈출 = 1
	ENDIF

;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 2
	CALL DUNGEON_DOOR,ARG
	RETURN 1
ENDIF

RETURN 0

;=======================================================================
;인카운트율
;=======================================================================
@ENCOUNT_RATE_60
	FLAG:인카운트율 = FLAG:미조우걸음수*5
;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_60
IF RAND:100 < FLAG:인카운트율
	CALL ENEMY_TABLE
	RETURN 1
ELSE
	FLAG:미조우걸음수 += 1
	RETURN 0
ENDIF
;=======================================================================
;적の종족の종류数
;=======================================================================
@CLASS_NUM_60
RETURN CLASS_NUM_COMMON("上級")
;=======================================================================
;적の総数
;ARGは出現する적の종류です
;=======================================================================
@ENEMY_NUM_60, ARG
RETURN ENEMY_NUM_COMMON("上級", ARG)
;=======================================================================
;적の종류
;=======================================================================
@ENEMY_60, ARG
SELECTCASE RAND:100
	CASE IS < 10
		RETURN [[キャラ:옵신]], 55
	CASE IS < 20
		RETURN [[キャラ:그리드]], 56
	CASE IS < 30
		RETURN [[キャラ:질러시]], 57
	CASE IS < 40
		RETURN [[キャラ:벨리커시티]], 58
	CASE IS < 50
		RETURN [[キャラ:레이지니스]], 59
	CASE IS < 60
		RETURN [[キャラ:앨러건스]], 60
	CASE IS < 70
		RETURN 356, 56
	CASE IS < 80
		RETURN 706, 55
	CASE IS < 90
		RETURN 656, 56
	CASEELSE
		RETURN 408, 56
ENDSELECT

;=======================================================================
;パンドラ思考パターン
;=======================================================================
@SET_ACTION_Dn60パンドラ,ARG

IF CFLAG:ARG:행동한횟수 == 0
	;1ターン目最初の行動決定時、行動パターンの初期化を行う
	IF FLAG:경과턴수 == 0
		LOCAL = 0
	ENDIF

	;奇数・偶数ターンで行動が変化する
	;1の時奇数ターン行動を行う
	IF LOCAL == 0
		LOCAL = 1
	ELSE
		LOCAL = 0
	ENDIF
ENDIF

IF LOCAL == 0 && CFLAG:ARG:행동한횟수 == 0
		PRINTFORML ┏>MESSAGE━━━━━━━━━━━━━━━━━━┓
		PRINTFORML ┃판도라의 머리카락이 붉게 물들어간다……　　　　　┃
		PRINTFORML ┃　　　　　　　　　　　　　　　　　　　　　　┃
		PRINTFORMW ┗━━━━━━━━━━━━━━━━━━━━━━┛
		PRINTL 
	MAXBASE:ARG:40 = 120
	MAXBASE:ARG:41 = 100
	MAXBASE:ARG:42 = 120
	MAXBASE:ARG:43 = 120
	MAXBASE:ARG:44 = -50
	MAXBASE:ARG:45 = -50
	MAXBASE:ARG:46 = -50
	MAXBASE:ARG:47 = -50
	MAXBASE:ARG:52 = -50
	MAXBASE:ARG:53 = -50
	MAXBASE:ARG:54 = -50
	MAXBASE:ARG:55 = -50
	MAXBASE:ARG:56 = -50
	CFLAG:ARG:입력행동 = [[스킬:우뢰의세례]]
	CALL RANDOM_TARGET, ARG, CFLAG:ARG:입력행동
ELSEIF LOCAL == 1 && CFLAG:ARG:행동한횟수 == 0
		PRINTFORML ┏>MESSAGE━━━━━━━━━━━━━━━━━━┓
		PRINTFORML ┃판도라의 머리카락이 푸르게 물들어 간다……　　　　　┃
		PRINTFORML ┃　　　　　　　　　　　　　　　　　　　　　　┃
		PRINTFORMW ┗━━━━━━━━━━━━━━━━━━━━━━┛
		PRINTL 
	MAXBASE:ARG:40 = 50
	MAXBASE:ARG:41 = 50
	MAXBASE:ARG:42 = 50
	MAXBASE:ARG:43 = 50
	MAXBASE:ARG:44 = 100
	MAXBASE:ARG:45 = 100
	MAXBASE:ARG:46 = 100
	MAXBASE:ARG:47 = 100
	MAXBASE:ARG:52 = 100
	MAXBASE:ARG:53 = 100
	MAXBASE:ARG:54 = 100
	MAXBASE:ARG:55 = 100
	MAXBASE:ARG:56 = 100
	CFLAG:ARG:입력행동 = [[스킬:절대영도]]
	CALL RANDOM_TARGET, ARG, CFLAG:ARG:입력행동
ELSEIF CFLAG:ARG:행동한횟수 == 1
	IF LOCAL == 0
		CFLAG:ARG:입력행동 = [[스킬:버터플라이스톰]]
		CALL RANDOM_TARGET, ARG, CFLAG:ARG:입력행동
	ELSE
		IF CFLAG:ARG:공격강화 < -8 || CFLAG:ARG:명중강화 < -8 || CFLAG:ARG:회피강화 < -8 || CFLAG:ARG:마법위력강화 < -8
			CFLAG:ARG:입력행동 = [[스킬:데・쿤다]]
			CALL RANDOM_TARGET, ARG, CFLAG:ARG:입력행동
		ELSEIF CFLAG:ARG:마법위력강화 < 16
			CFLAG:ARG:입력행동 = [[스킬:마카・카쟈]]
			CALL RANDOM_TARGET, ARG, CFLAG:ARG:입력행동
		ELSE
			CFLAG:ARG:입력행동 = [[스킬:우뢰의세례]]
			CALL RANDOM_TARGET, ARG, CFLAG:ARG:입력행동
		ENDIF
	ENDIF
ELSE
	;1more時など。念のため
	IF RAND:2 == 0
		CFLAG:ARG:입력행동 = [[스킬:절대영도]]
		CALL RANDOM_TARGET, ARG, CFLAG:ARG:입력행동
	ELSE
		CFLAG:ARG:입력행동 = [[스킬:우뢰의세례]]
		CALL RANDOM_TARGET, ARG, CFLAG:ARG:입력행동
	ENDIF
ENDIF


;アクション実行不能なら自動的に通常攻撃にする
CALL CHECK_ACTIONABLE, ARG, CFLAG:ARG:입력행동
IF RESULT == 0
	CFLAG:ARG:입력행동 = 0
	CALL RANDOM_TARGET, ARG, CFLAG:ARG:입력행동
ENDIF
;ここまで타겟が決まってなかったら、랜덤타겟をよんで決定
SIF CFLAG:ARG:타겟 == -1
	CALL RANDOM_TARGET, ARG, CFLAG:ARG:입력행동
RETURN 1


;=======================================================================
;윤간참가악마
;=======================================================================
@DUNGEON_RAPE_DEVIL_60
;랜덤にどの악마が出るか決定
;RETURN CSV번호 , 人数 , 레벨
SELECTCASE RAND:3
	CASE 0
		RETURN [[キャラ:인큐버스]] , 3 + RAND:10 , CSVBASE([[キャラ:인큐버스]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 1
		RETURN [[キャラ:도미니온]] , 3 + RAND:10 , CSVBASE([[キャラ:도미니온]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 2
		RETURN [[キャラ:베르세르크]] , 3 + RAND:10 , CSVBASE([[キャラ:베르세르크]] , GETNUM(BASE , "LV") , 0) + RAND:3
ENDSELECT
