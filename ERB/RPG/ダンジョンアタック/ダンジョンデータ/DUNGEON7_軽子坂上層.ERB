
;=======================================================================
;샘플던전
;던전のテンプレートみたいなものです
;던전ナンバー0
;=======================================================================




;=======================================================================
;攻略조건
;=======================================================================
@PREREQUISITE_DUNGEON_7
IF 이벤트플래그:2:0 == 1 && 던전플래그:7:1 == 0
	RETURN 1
ELSE
	RETURN 0
ENDIF

;=======================================================================
;던전名
;=======================================================================
@GET_DUNGEON_NAME_7
RESULTS = 카루코자카상층


;=======================================================================
;플로어名표시
;=======================================================================
@FLOORNAME_7
PRINT 카루코자카상층
SELECTCASE FLAG:현M
	CASE 0
		PRINTL   ６Ｆ
	CASE 1
		PRINTL   ７Ｆ
	CASE 2
		PRINTL   ８Ｆ
	CASE 3
		PRINTL   ９Ｆ
	CASE 4
		PRINTL   １０Ｆ
	CASE 5
		PRINTL   １１Ｆ
	CASEELSE
		PRINTL
ENDSELECT


;=======================================================================
;特殊タイル표시
;=======================================================================
@TILE_MARK_7_X_X
RESULTS = 特


;=======================================================================
;スタート地点입력
;=======================================================================
@START_DUNGEON_7,ARG
FLAG:현M = 0
FLAG:현X = 11
FLAG:현Y = 13
;CALL AUTOMAP
FLAG:MAG소비율 = 75
@EVENT_DUNGEON_START_7
IF 던전플래그:7:0 == 0
	CALL SHOW_FLOOR
	CALL SHOW_NOW_FORMATION_P,0,2,,2
	FLAG:커맨드표시행수 = LINECOUNT
	CALL MESSAGE_WINDOW_D, "", "＞마계로 떨어진 카루코자카 고교의 상층부/＞여기의 어딘가에, 이 사건의 원흉 마신황 하자마가 있을 것이다/＞……그런데, 왜 여기에 왔을까?/＞이 사건을 해결하면 약간의 보수야 나오겠지만, 노고에 알맞는 금액이 될거라고는 생각하기 어렵다"
	CALL MESSAGE_WINDOW_D, "", @"＞생명이 노려지고 있기 때문에?/＞하지만, 하자마에게 카루코자카 고등학교의 밖에서 사용할 수 있는 방법이 그렇게 많이 있을 것이라고는 생각하기 어렵다/＞돈을 벌기 위해서만이라면 갈 필요가 없을 길을、%조사처리(CALLNAME:MASTER,"는")% 한 걸음 내디뎠다"
	던전플래그:7:0 = 1
ENDIF
;=======================================================================
;指定したマスに進入가능か
;=======================================================================
@CAN_ENTER_7,ARG,ARG:1
CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT


;=======================================================================
;플로어데이터
;=======================================================================
@MAKE_FLOOR_7
SELECTCASE FLAG:현M
	CASE 0
	;１階
		FLAG:최대X = 17
		FLAG:최대Y = 17
		CALL MAKE_FLOOR_LINE, 0,"00000000000000000"
		CALL MAKE_FLOOR_LINE, 1,"01212121212121210"
		CALL MAKE_FLOOR_LINE, 2,"01000000020002020"
		CALL MAKE_FLOOR_LINE, 3,"01110121012101210"
		CALL MAKE_FLOOR_LINE, 4,"00020002000200020"
		CALL MAKE_FLOOR_LINE, 5,"01111101210101210"
		CALL MAKE_FLOOR_LINE, 6,"01111102020200020"
		CALL MAKE_FLOOR_LINE, 7,"01111101210101210"
		CALL MAKE_FLOOR_LINE, 8,"02020002000200000"
		CALL MAKE_FLOOR_LINE, 9,"01010601211111210"
		CALL MAKE_FLOOR_LINE,10,"01010201000000010"
		CALL MAKE_FLOOR_LINE,11,"01011101011111010"
		CALL MAKE_FLOOR_LINE,12,"00000001010201010"
		CALL MAKE_FLOOR_LINE,13,"01110001010801010"
		CALL MAKE_FLOOR_LINE,14,"00000000010001010"
		CALL MAKE_FLOOR_LINE,15,"01211111211111210"
		CALL MAKE_FLOOR_LINE,16,"00000000000000000"
		
	CASE 1
	;２階
		FLAG:최대X = 9
		FLAG:최대Y = 9
		CALL MAKE_FLOOR_LINE, 0,"000000000"
		CALL MAKE_FLOOR_LINE, 1,"011111110"
		CALL MAKE_FLOOR_LINE, 2,"010000010"
		CALL MAKE_FLOOR_LINE, 3,"010111010"
		CALL MAKE_FLOOR_LINE, 4,"010102010"
		CALL MAKE_FLOOR_LINE, 5,"010106010"
		CALL MAKE_FLOOR_LINE, 6,"020100010"
		CALL MAKE_FLOOR_LINE, 7,"070111110"
		CALL MAKE_FLOOR_LINE, 8,"000000000"

	CASE 2
	;３階
		FLAG:최대X = 9
		FLAG:최대Y = 9
		CALL MAKE_FLOOR_LINE, 0,"000000000"
		CALL MAKE_FLOOR_LINE, 1,"011111110"
		CALL MAKE_FLOOR_LINE, 2,"010000010"
		CALL MAKE_FLOOR_LINE, 3,"010111210"
		CALL MAKE_FLOOR_LINE, 4,"010200020"
		CALL MAKE_FLOOR_LINE, 5,"010607010"
		CALL MAKE_FLOOR_LINE, 6,"010002000"
		CALL MAKE_FLOOR_LINE, 7,"011111110"
		CALL MAKE_FLOOR_LINE, 8,"000000000"

	CASE 3
	;４階
		FLAG:최대X = 9
		FLAG:최대Y = 9
		CALL MAKE_FLOOR_LINE, 0,"000000000"
		CALL MAKE_FLOOR_LINE, 1,"011111110"
		CALL MAKE_FLOOR_LINE, 2,"010000010"
		CALL MAKE_FLOOR_LINE, 3,"010621010"
		CALL MAKE_FLOOR_LINE, 4,"010001010"
		CALL MAKE_FLOOR_LINE, 5,"010701010"
		CALL MAKE_FLOOR_LINE, 6,"010202010"
		CALL MAKE_FLOOR_LINE, 7,"011101110"
		CALL MAKE_FLOOR_LINE, 8,"000000000"

	CASE 4
	;５階
		FLAG:최대X = 7
		FLAG:최대Y = 9
		CALL MAKE_FLOOR_LINE, 0,"0000000"
		CALL MAKE_FLOOR_LINE, 1,"0111110"
		CALL MAKE_FLOOR_LINE, 2,"0100010"
		CALL MAKE_FLOOR_LINE, 3,"0127010"
		CALL MAKE_FLOOR_LINE, 4,"0000010"
		CALL MAKE_FLOOR_LINE, 5,"0106010"
		CALL MAKE_FLOOR_LINE, 6,"0102010"
		CALL MAKE_FLOOR_LINE, 7,"0111110"
		CALL MAKE_FLOOR_LINE, 8,"0000000"


	CASE 5
	;６階
		FLAG:최대X = 7
		FLAG:최대Y = 9
		CALL MAKE_FLOOR_LINE, 0,"0000000"
		CALL MAKE_FLOOR_LINE, 1,"0111110"
		CALL MAKE_FLOOR_LINE, 2,"0102010"
		CALL MAKE_FLOOR_LINE, 3,"0101010"
		CALL MAKE_FLOOR_LINE, 4,"0100010"
		CALL MAKE_FLOOR_LINE, 5,"0111110"
		CALL MAKE_FLOOR_LINE, 6,"0002000"
		CALL MAKE_FLOOR_LINE, 7,"0007000"
		CALL MAKE_FLOOR_LINE, 8,"0000000"
		;이벤트の設置
		CALL SET_TILE,3,3,던전플래그:7:1,0,4

	CASEELSE

ENDSELECT



;=======================================================================
;[5]조사　実行時の이벤트
;=======================================================================
@EVENT_CHECK_DUNGEON_7

;==========
;出口の処理
;==========
IF DA:(FLAG:현X):(FLAG:현Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 6
	SELECTCASE FLAG:현M
		CASE 0
			SIF FLAG:현X == 5 && FLAG:현Y == 9
				CALL DUNGEON_UPSTAIRS,1,1,7
		CASE 1
			SIF FLAG:현X == 5 && FLAG:현Y == 5
				CALL DUNGEON_UPSTAIRS,2,5,5
		CASE 2
			SIF FLAG:현X == 3 && FLAG:현Y == 5
				CALL DUNGEON_UPSTAIRS,3,3,5
		CASE 3
			SIF FLAG:현X == 3 && FLAG:현Y == 3
				CALL DUNGEON_UPSTAIRS,4,3,3
		CASE 4
			SIF FLAG:현X == 3 && FLAG:현Y == 5
				CALL DUNGEON_UPSTAIRS,5,3,7
		CASEELSE
	ENDSELECT

RETURN 1

ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 7
	SELECTCASE FLAG:현M
		CASE 1
			SIF FLAG:현X == 1 && FLAG:현Y == 7
				CALL DUNGEON_DOWNSTAIRS,0,5,9
		CASE 2
			SIF FLAG:현X == 5 && FLAG:현Y == 5
				CALL DUNGEON_DOWNSTAIRS,1,5,5
		CASE 3
			SIF FLAG:현X == 3 && FLAG:현Y == 5
				CALL DUNGEON_DOWNSTAIRS,2,3,5
		CASE 4
			SIF FLAG:현X == 3 && FLAG:현Y == 3
				CALL DUNGEON_DOWNSTAIRS,3,3,3
		CASE 5
			SIF FLAG:현X == 3 && FLAG:현Y == 7
				CALL DUNGEON_DOWNSTAIRS,4,3,5
		CASEELSE
ENDSELECT

RETURN 1

ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 9
	CALL DUNGEON_TERMINAL
	RETURN 1
ELSE
	CALL MESSAGE_WINDOW_D, "", "아무 것도 없는 것 같다"
	RETURN 0
ENDIF

;=======================================================================
;タイル進入時の이벤트
;=======================================================================
@EVENT_ENTER_DUNGEON_7,ARG
;ARG = 進入時の向き　0の場合ワープなど
;==========
;出口の処理
;==========
IF DA:(FLAG:현X):(FLAG:현Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1

;=======
;階段
;=======
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 6
	SELECTCASE FLAG:현M
		CASE 0
			SIF FLAG:현X == 5 && FLAG:현Y == 9
				CALL DUNGEON_UPSTAIRS,1,1,7
		CASE 1
			SIF FLAG:현X == 5 && FLAG:현Y == 5
				CALL DUNGEON_UPSTAIRS,2,5,5
		CASE 2
			SIF FLAG:현X == 3 && FLAG:현Y == 5
				CALL DUNGEON_UPSTAIRS,3,3,5
		CASE 3
			SIF FLAG:현X == 3 && FLAG:현Y == 3
				CALL DUNGEON_UPSTAIRS,4,3,3
		CASE 4
			SIF FLAG:현X == 3 && FLAG:현Y == 5
				CALL DUNGEON_UPSTAIRS,5,3,7
		CASEELSE
	ENDSELECT

RETURN 1

ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 7
	SELECTCASE FLAG:현M
		CASE 1
			SIF FLAG:현X == 1 && FLAG:현Y == 7
				CALL DUNGEON_DOWNSTAIRS,0,5,9
		CASE 2
			SIF FLAG:현X == 5 && FLAG:현Y == 5
				CALL DUNGEON_DOWNSTAIRS,1,5,5
		CASE 3
			SIF FLAG:현X == 3 && FLAG:현Y == 5
				CALL DUNGEON_DOWNSTAIRS,2,3,5
		CASE 4
			SIF FLAG:현X == 3 && FLAG:현Y == 3
				CALL DUNGEON_DOWNSTAIRS,3,3,3
		CASE 5
			SIF FLAG:현X == 3 && FLAG:현Y == 7
				CALL DUNGEON_DOWNSTAIRS,4,3,5
		CASEELSE
ENDSELECT
RETURN 1
;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 2
	CALL DUNGEON_DOOR,ARG
RETURN 1

ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 9
	CALL DUNGEON_TERMINAL
RETURN 1

;========================
;이벤트
;========================
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 4
	IF 던전플래그:7:1 == 0 && FLAG:현M == 5
		CALL SHOW_FLOOR
		CALL SHOW_NOW_FORMATION_P,0,2,,2
		FLAG:커맨드표시행수 = LINECOUNT
		CALL MESSAGE_WINDOW_D, "", "＞올라가자 그 앞에、그 소년이 혼자 서 있었다/＞그의 방에는 한기가 가득할 정도로 아무 것도 없었다"
		CALL MESSAGE_WINDOW_D, "하자마", "……어서 오시오、불청객씨/대접하고 싶은 마음은 굴뚝 같지만, 보시는 바와 같이 여기에는 아무것도 없어서 말이지/왜냐하면 여기에는 내가 인정한 것 밖에 두지 않기 때문이다"
		CALL MESSAGE_WINDOW_D, "하자마", "……즉 아무것도 필요하지 않아/모든 것은 쓰레기야, 쓰레기!/사라져 없어지는 것이 당연해！！"
		CALL MESSAGE_WINDOW_D, "", "＞초인 하자마가 １체 나타났다！"
		FLAG:도주불가플래그 = 1
		FLAG:회화불능플래그 = 1
		FLAG:선제기습취소 = 1
		CALL SET_ENEMY,9,4202,80,0,1
		CFLAG:(CHARANUM-1):ＨＰ보정 = 5000
		CALL SYNC_STATUS,(CHARANUM-1)
		CALL HEALTH_CHARA,(CHARANUM-1)
		CFLAG:(CHARANUM-1):행동횟수 = 2
		CALL BATTLE_START
		FLAG:도주불가플래그 = 0
		FLAG:회화불능플래그 = 0
		FLAG:선제기습취소 = 0
		CALL MESSAGE_WINDOW_D, "하자마", "바보 같은……"
		IF FINDCHARA_B(4508) == 2 && 던전플래그:43:0 == 1
			CALL MESSAGE_WINDOW_D, "", "＞하자마는 거대한 마신황에서、본래 고등학생의 모습으로 돌아와 쓰러져 엎어졌다/카루코자카고교의 마계화 사건은, 이것으로 해결을 한 것이다/＞살아남은 학생들의 가족으로부터、계좌에 ￥50000이 지불되었다"
			MONEY += 50000
			CALL MESSAGE_WINDOW_D, "", "＞“해탈의반지”를 손에 넣었다/＞해탈의 반지가 빛나고 있다/＞틈의 정신세계로 갈 수 있게 되었다！"
			FLAG:탈출 = 1
		ELSE
			CALL MESSAGE_WINDOW_D, "", "＞하자마는 거대한 마신황에서、본래 고등학생의 모습으로 돌아와 쓰러져 엎어졌다/카루코자카고교의 마계화 사건은, 이것으로 해결을 보았다/＞살아남은 학생들의 가족으로부터、계좌에 ￥50000이 지불되었다"
			MONEY += 50000
		ENDIF
		던전플래그:7:1 = 1
		DA:(FLAG:현X):(FLAG:현Y) = 1
		;FLAG:탈출 = 1
	ENDIF
ENDIF

RETURN 0



;=======================================================================
;인카운트율
;=======================================================================
@ENCOUNT_RATE_7
		FLAG:인카운트율 = FLAG:미조우걸음수*5
SIF FLAG:미조우걸음수 < 6
	FLAG:인카운트율 = 0
;=======================================================================
;필요레벨눈安
;권장LV 雑魚최저LV 雑魚最高LV ボスLV 
;=======================================================================
@GET_DUNGEON_LV_7
RETURN 41, 38, 56, 80
;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_7
IF RAND:100 < FLAG:인카운트율
	CALL ENEMY_TABLE
	RETURN 1
ELSE
	FLAG:미조우걸음수 += 1
	RETURN 0
ENDIF
;=======================================================================
;적の종족の종류数
;=======================================================================
@CLASS_NUM_7
RETURN CLASS_NUM_COMMON("最上級")
;=======================================================================
;적の総数
;ARGは出現する적の종류です
;RAND(X, Y)はX～Y-1のうち중 하나になるRANDです
;なお、ここで帰った数字は下限を종족数、上限を10として自動的に調整されます
;=======================================================================
@ENEMY_NUM_7, ARG
RETURN ENEMY_NUM_COMMON("最上級", ARG)
;=======================================================================
;적の종류
;=======================================================================
@ENEMY_7, ARG
SELECTCASE FLAG:현M
	CASE 0
		SELECTCASE RAND:100
			CASE IS < 20
				;20%で타마모
				RETURN 807, 38
			CASE IS < 40
				;20%で오토히메
				RETURN 706, 42
			CASE IS < 60
				;20%で비비안
				RETURN 509, 42
			CASE IS < 80
				;20%　사룡바질리스크LV25(41)
				RETURN [[キャラ:바질리스크]], 41
			CASE IS < 100
				;20%で마하
				RETURN 907, 42
		ENDSELECT

	CASE 1
		SELECTCASE RAND:100
			CASE IS < 20
				;25%で비비안
				RETURN 509, 45
			CASE IS < 40
				;25%で마하
				RETURN 907, 45
			CASE IS < 60
				;25%で스퀼라
				RETURN 808, 43
			CASE IS < 80
				;20%　사룡바질리스크LV25(44)
				RETURN [[キャラ:바질리스크]], 44
			CASE IS < 100
				;25%で서큐버스
				RETURN 407, 44
		ENDSELECT
	CASE 2
		SELECTCASE RAND:100
			CASE IS < 25
				;25%で스퀼라
				RETURN 808, 46
			CASE IS < 50
				;25%で서큐버스
				RETURN 407, 47
			CASE IS < 75
				;15%で달기
				RETURN 811, 47
			CASE IS < 100
				;15%で다키니
				RETURN 607, 46
		ENDSELECT
	CASE 3
		SELECTCASE RAND:100
			CASE IS < 25
				;25%で달기
				RETURN 811, 50
			CASE IS < 50
				;25%で다키니
				RETURN 607, 49
			CASE IS < 75
				;75%で알마티
				RETURN 306, 48
			CASE IS < 100
				;100%で모리안
				RETURN 908, 49
		ENDSELECT
	CASE 4
		SELECTCASE RAND:100
			CASE IS < 25
				;25%で알마티
				RETURN 306, 51
			CASE IS < 50
				;25%で모리안
				RETURN 908, 52
			CASE IS < 75
				;75%で바스테트
				RETURN 809, 51
			CASE IS < 100
				;100%で란다
				RETURN 206, 50
		ENDSELECT
	CASE 5
		SELECTCASE RAND:100
			CASE IS < 25
				;25%で바스테트
				RETURN 809, 54
			CASE IS < 50
				;25%で란다
				RETURN 206, 53
			CASE IS < 75
				;75%で티타니아
				RETURN 510, 51
			CASE IS < 100
				;100%で발키리
				RETURN 408, 56
		ENDSELECT
ENDSELECT
