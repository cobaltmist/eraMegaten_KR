
;=======================================================================
;皇居
;ボス・이자나미
;見るたびに陛下どんな所に住んでいらっしゃったんすかｗｗｗｗと突っ込みたくなる。
;던전ナンバー6　ＭＡＰ0~2
;던전플래그:(FLAG:현던전):0 イベント進行状況 1 イザナミ撃破

;東京駅追加
;使用フラグ
;투기장플래그:1:0							攻略条件			0:未発生	1:皇居			2:東京駅
;던전플래그:25:10	ダンジョン進行		0:初期状態	1:キョウジ戦後	2:サイガ撃破
;던전플래그:25:11	強行突破			0:初期状態	1:強行突破した
;던전플래그:25:12	タヱ確保イベント	0:初期状態	1:イベント終了
;던전플래그:25:13	キョウジ戦			0:初期状態	1:戦闘開始		2:戦闘終了
;던전플래그:25:14	サイガ戦			0:初期状態	1:戦闘開始		2:戦闘終了

;超力兵団関連フラグ
;이벤트플래그:86:1			超力兵団MOD進行フラグ
;								(0:消えた資産家令嬢開始、	 1:大道寺邸攻略開始		 2:						 3:
;								 4:ダークサマナー見参開始	 5:大道寺工業攻略開始	 6:港町連続失踪事件		 7:晴海町攻略開始	
;								 8:地底300mの戦い開始		 9:臨海公園攻略開始		10:五色不動の謎			11:旧皇居再攻略開始
;								12:呪われた探偵開始			13:深川攻略開始			14:鉄塔の悪魔			15:和電イ号機攻略開始
;								16:弐人の召喚師				17:						18:東京炎上				19:地下基地（西側）攻略開始
;								20:宇宙への挑戦				21:						22:近く、遠い存在		23:アカラナ回廊攻略開始
;

;								 99:イベント打ち切り

;던전플래그:25:20			大道寺邸進行フラグ
;								(0:開始前、1:中村との会話後、2地下への入り口発見、3:リンが連れ去られる、4:大タラスク撃破、5:ツチグモ撃破
;								 6:座敷牢で日記発見、7:ガシャドクロ撃破、8:居間の前で立ち聞き、9:イチモクレン戦開始
;던전플래그:25:21			大道寺邸 仏頂面の使用人フラグ
;								(0:初期状態	1:1,000円払った）
;던전플래그:25:22			大道寺邸 お気楽な使用人フラグ
;								(0:初期状態	1:눈で殺した）
;던전플래그:25:23			大道寺邸 大タクラス
;								(0:初期状態	1:酒を頼まれた）
;던전플래그:25:24			大道寺邸 オバリヨン戦
;								(0:初期状態	1:倒した）
;던전플래그:25:25 		TO 30	魔斗量子界の従業員発見(25:戸惑い気味、26:あきらめ気味、27:赤ずくめ化、28:暴走気味、29:泣き気味、30:怒り気味
;								(0:初期状態	1:発見済み
;던전플래그:25:31,		 32, 33	魔斗量子界の切片回収
;								(0:未回収	1:回収済み）
;던전플래그:25:34			大道寺工業　工場進行フラグ
;								(0:開始前	1:魔斗量子界発生）
;던전플래그:25:35			港町　進行フラグ
;								(0:開始前、1:襲撃開始	4:水夫を全員救出	5:トリグラフ撃破、6:ラスプーチン出現
;던전플래그:25:36～38		港町　水夫フラグ (36:粋	37:オドオド	38	いなせ）
;								(0:開始前、1:助けた）	
;던전플래그:25:39			港町　エルフマン
;								(0:開始前、1:話を聞いた。）	
;던전플래그:25:40			臨海公園　進行フラグ
;								(0:開始前、1:公園で定吉と会った、2:書類を回収した。3:ネビロスを倒した。4:좀비ーアーミーに発見された。5:좀비ーアーミーが逃げた。6:シキミの壁が破壊できなかった。
;								 7:イッポンダタラと交渉して壁を退かせた	8:宗像の話を聞いた。
;던전플래그:25:41～48		臨海公園　書類回収
;								(0:初期状態、1:回収済）
;던전플래그:25:49			臨海公園　書類回収枚数
;								(0:初期状態、1:回収済）
;던전플래그:25:50			深川（異界）　進行フラグ
;								(0:初期状態、1:우타ウドクロ１回目、2:우타ウドクロ2回目、3:우타ウドクロ3回目、4:ポストのお札破壊、５:オシチからお礼を受け取った。6:VSヒトコトヌシ開始）
;던전플래그:25:51			愛宕山　進行フラグ
;								(0:初期状態、1:電波塔侵入、2:中層に上がった、3:中層でヒルコの群れを撃破、4:上層でヒルコの群れを撃破、5:最上階でミシャグジさま戦開始）
;던전플래그:25:52			地下基地西側　進行フラグ
;								(0:初期状態、1:地下基地西側侵入、2:アラハバキ撃破、3:再生するシキミの壁を認識、4:再生するシキミの壁破壊、5:スクナヒコナ戦開始）
;던전플래그:25:53			アカラナ回廊　進行フラグ
;								(0:初期状態、1:アカラナ回廊侵入、2:イチモクレン戦開始、3:イチモクレン撃破、10:最終戦開始）
;던전플래그:25:54			伽耶の問いに対する回答
;								(0:운命に従う、1:운命は切り拓く）
;던전플래그:25:55			ループ判定


;던전플래그:25:78～89		シキミの壁、ヒルコ床
;던전플래그:25:90～99		宝箱用フラグ
;=======================================================================




;=======================================================================
;攻略조건
;=======================================================================
@PREREQUISITE_DUNGEON_25
;旧皇居(四天王の試練クリア済み)
IF 투기장플래그:1:0 == 1
	RETURN 1
;東京驛
ELSEIF 투기장플래그:1:0 == 2 && 던전플래그:25:10 != 2
	RETURN 1
;大道寺邸
ELSEIF 이벤트플래그:86:1 == 1
	RETURN 1
;大道寺工業　工場
ELSEIF 이벤트플래그:86:1 == 5
	RETURN 1
;晴海町
ELSEIF 이벤트플래그:86:1 == 7
	RETURN 1
;臨海公園
ELSEIF 이벤트플래그:86:1 == 9
	RETURN 1
;旧皇居with弾掌
ELSEIF 이벤트플래그:86:1 == 11
	RETURN 1
;深川（異界)
ELSEIF 이벤트플래그:86:1 == 13
	RETURN 1
;愛宕山
ELSEIF 이벤트플래그:86:1 == 15
	RETURN 1
;地下基地（西側）
ELSEIF 이벤트플래그:86:1 == 19
	RETURN 1
;アカラナ回廊
ELSEIF 이벤트플래그:86:1 == 23
	RETURN 1
ELSE
	RETURN 0
ENDIF



;=======================================================================
;던전名
;=======================================================================
@GET_DUNGEON_NAME_25
IF 투기장플래그:1:0 == 1
	RESULTS = 구황궁
ELSEIF 투기장플래그:1:0 == 2 && 던전플래그:25:10 < 2
	RESULTS = 도쿄역
ELSEIF 이벤트플래그:86:1 == 1
	RESULTS = 大道寺邸
ELSEIF 이벤트플래그:86:1 == 5
	RESULTS = 大道寺工業　工場
ELSEIF 이벤트플래그:86:1 == 7
	RESULTS = 港町
ELSEIF 이벤트플래그:86:1 == 9
	RESULTS = 臨海公園
ELSEIF 이벤트플래그:86:1 == 11
	RESULTS = 旧皇居
ELSEIF 이벤트플래그:86:1 == 13
	RESULTS = 深川町（異界）
ELSEIF 이벤트플래그:86:1 == 15
	RESULTS = 愛宕山
ELSEIF 이벤트플래그:86:1 == 19
	RESULTS = 地下基地（西側）
ELSEIF 이벤트플래그:86:1 == 23
	RESULTS = アカラナ回廊
ENDIF

;=======================================================================
;플로어名표시
;=======================================================================
@FLOORNAME_25
SELECTCASE FLAG:현M
	CASE 10 TO 14
		CALL FLOORNAME_TOKYO_STATION
	CASE 15, 16, 17
		CALL FLOORNAME_DAIDOUJI_MANSION
	CASE 18, 19
		CALL FLOORNAME_DAIDOUJI_FACTORY
	CASE 20, 21, 22
		CALL FLOORNAME_HARBOR_TOWN
	CASE 23 TO 27
		CALL FLOORNAME_SEASIDE_PARK
	CASE 28, 29
		CALL FLOORNAME_DUNGEOU
	CASE 30
		CALL FLOORNAME_FUKAGAWA
	CASE 31 TO 35
		CALL FLOORNAME_ATAGO
	CASE 36 TO 38
		CALL FLOORNAME_UG_BASE_WEST
	CASE 39 TO 52
		CALL FLOORNAME_AKARANA
	CASEELSE
		PRINT 구황궁　
		SELECTCASE FLAG:현M
			CASE 0
				PRINT Ｂ１Ｆ
			CASE 1
				PRINT Ｂ２Ｆ
			CASE 2
				PRINT Ｂ３Ｆ
			CASE 3
				PRINT Ｂ４Ｆ
			CASE 4
				PRINT Ｂ５Ｆ
		ENDSELECT
ENDSELECT

;=======================================================================
;スタート地点入力
;=======================================================================
@START_DUNGEON_25,ARG
;東京駅
IF 투기장플래그:1:0 == 2 && 던전플래그:25:10 < 2
	FLAG:현M = 10
	FLAG:현X = 1
	FLAG:현Y = 1
;大道寺邸
ELSEIF 이벤트플래그:86:1 == 1
	FLAG:현M = 16
	FLAG:현X = 14
	FLAG:현Y = 22
;大道寺工業　工場
ELSEIF 이벤트플래그:86:1 == 5
	FLAG:현M = 18
	FLAG:현X =  8
	FLAG:현Y = 13
;港町
ELSEIF 이벤트플래그:86:1 == 7
	FLAG:현M = 20
	FLAG:현X =  1
	FLAG:현Y = 22
;臨海公園
ELSEIF 이벤트플래그:86:1 == 9
	FLAG:현M = 23
	FLAG:현X = 13
	FLAG:현Y = 23
;旧皇居with弾掌
ELSEIF 이벤트플래그:86:1 == 11
	FLAG:현M = 0
	FLAG:현X = 7
	FLAG:현Y = 7
;深川
ELSEIF 이벤트플래그:86:1 == 13
	FLAG:현M = 30
	FLAG:현X = 1
	FLAG:현Y = 10
;愛宕山
ELSEIF 이벤트플래그:86:1 == 15
	FLAG:현M = 31
	FLAG:현X = 1
	FLAG:현Y = 10
;地下基地（西側）
ELSEIF 이벤트플래그:86:1 == 19
	FLAG:현M = 36
	FLAG:현X = 8
	FLAG:현Y = 1
;アカラナ回廊
ELSEIF 이벤트플래그:86:1 == 23
	FLAG:현M = 39
	FLAG:현X = 3
	FLAG:현Y = 9
;旧皇居
ELSE
	FLAG:현M = 0
	FLAG:현X = 7
	FLAG:현Y = 7
ENDIF
;CALL AUTOMAP


;=======================================================================
;スタート時イベント
;=======================================================================
@EVENT_DUNGEON_START_25
IF 투기장플래그:1:0 == 2 && 던전플래그:25:10 == 0
	CALL EVENT_TOKYO_STATION_START
ELSEIF 이벤트플래그:86:1 == 1 && 던전플래그:25:20 == 0
	CALL EVENT_DAIDOUJI_MANSION_START
ELSEIF 이벤트플래그:86:1 == 5 && 던전플래그:25:34 == 0
	CALL EVENT_DAIDOUJI_FACTORY_START
ELSEIF 이벤트플래그:86:1 == 7 && 던전플래그:25:35 == 0
	CALL EVENT_HARBOR_TOWN_START
ELSEIF 이벤트플래그:86:1 == 9 && 던전플래그:25:40 == 0
	CALL EVENT_SEASIDE_PARK_START
ELSEIF 이벤트플래그:86:1 == 13 && 던전플래그:25:50 == 0
	CALL EVENT_FUKAGAWA_START
ELSEIF 이벤트플래그:86:1 == 15 && 던전플래그:25:51 == 0
	CALL EVENT_ATAGO_START
ELSEIF 이벤트플래그:86:1 == 19 && 던전플래그:25:52 == 0
	CALL EVENT_UG_BASE_WEST_START
ELSEIF 이벤트플래그:86:1 == 23 && 던전플래그:25:53 == 0
	CALL EVENT_AKARANA_START
ELSE
ENDIF

;=======================================================================
;指定したマスに進入可能か
;=======================================================================
@CAN_ENTER_25,ARG,ARG:1
;ARG、ARG:1はそれぞれ対象のマスのX、Y座標を表しています。
;この던전ではエレベーターの扉が一度右側から開けておかないと左側からは開けられない、という処理に使用しています。
;どのマップでも座標(2,7)がエレベータの扉。던전플래그:(FLAG:현던전):13 ＝ エレベータフラグ管理用変数の{現在のマップ番号}番目のビットが立っていなければ開けられるかどうかの判定を行う
;偵察部隊(東京駅）
IF DA:ARG:(ARG:1) == 12
	CALL RECONAISSANCE_UNIT_DUNGERN_25
	RETURN RESULT
;龍のアギト
ELSEIF DA:ARG:(ARG:1) == 22
	CALL MESSAGE_WINDOW_D, "", "＞龍のアギトが行く手を塞いでいる/＞通過するのは難しそうだ。"
	RETURN 0
;封印された扉
ELSEIF DA:ARG:(ARG:1) == 32
	CALL SEALED_DOOR_DUNGERN_25
;シキミの壁
ELSEIF DA:ARG:(ARG:1) == 42
	CALL SHIKIMI_WALL_DUNGEON_25
	RETURN RESULT
;水場
ELSEIF DA:ARG:(ARG:1) == 10
	RETURN 0
;空中
ELSEIF DA:ARG:(ARG:1) == 20
	RETURN 0
ENDIF
CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT


;=======================================================================

;フロアデータ

;=======================================================================
@MAKE_FLOOR_25
SELECTCASE FLAG:현M
	CASE 0 TO 4
		CALL MAKE_FLOOR_OLD_IMPERIAL_PALACE
	CASE 10 TO 14
		CALL MAKE_FLOOR_TOKYO_STATION
	CASE 15, 16, 17
		CALL MAKE_FLOOR_DAIDOUJI_MANSION
	CASE 18, 19
		CALL MAKE_FLOOR_DAIDOUJI_FACTORY
	CASE 20, 21, 22
		CALL MAKE_FLOOR_HARBOR_TOWN
	CASE 23 TO 27
		CALL MAKE_FLOOR_SEASIDE_PARK
	CASE 28, 29
		CALL MAKE_FLOOR_DUNGEOU
	CASE 30
		CALL MAKE_FLOOR_FUKAGAWA
	CASE 31 TO 35
		CALL MAKE_FLOOR_ATAGO
	CASE 36 TO 38
		CALL MAKE_FLOOR_UG_BASE_WEST
	CASE 39 TO 52
		CALL MAKE_FLOOR_AKARANA
ENDSELECT

;=======================================================================
;タイル定義
;=======================================================================
@DEFINE_TILES_25, ARGS, ARG, ARG:1
SELECTCASE ARGS
	CASE "m";人物
		RETURN 14
	CASE "L";ループのためのワープ
		RETURN 24
	CASE "H";ヒルコ床
		RETURN 34
	CASE "U";↑
		RETURN 44
	CASE "d";↓	*D:はダークゾーン
		RETURN 54
	CASE "r";→
		RETURN 64
	CASE "W";←
		RETURN 74
	CASE "A";偵察部隊
		RETURN 12
	CASE "R";龍のアギト
		RETURN 22
	CASE "B";封印された扉
		RETURN 32
	CASE "C";シキミの壁
		RETURN 42
	CASE "w";水
		RETURN 10
	CASE "a";空中
		RETURN 20
ENDSELECT
;=======================================================================
;特殊タイル表示
;TILE_MARK_COMMON_{FLAG:현던전}_X
;=======================================================================
;ARG:1、ARG:2がX座標とY座標
;ARGはそこに代入されている値
;RESULTSに代入した文字がマップに表示されますが、必ず全角1文字分になるようにしてください。そうでないと表示が崩れます。
@TILE_MARK_COMMON_25_0, ARG, ARG:1, ARG:2
SELECTCASE ARG
	CASE 10
		SETCOLOR 0, 0, 255
		RESULTS = ミ
	CASE 20
		GETBGCOLOR
		SETCOLOR RESULT
		RESULTS = ■
	CASEELSE
		IF FLAG:현M >= 39 && FLAG:현M <= 52
			GETBGCOLOR
			SETCOLOR RESULT
		ENDIF
		RESULTS = ■
ENDSELECT

@TILE_MARK_COMMON_25_1, ARG, ARG:1, ARG:2
IF FLAG:현M >= 32 && FLAG:현M <= 35
	SETCOLOR 200, 50, 50
	RESULTS = ■
ELSEIF FLAG:현M >= 39 && FLAG:현M <= 52
	SETCOLOR 200, 200, 200
	RESULTS = ■
ELSE
	RESULTS = □
ENDIF

@TILE_MARK_COMMON_25_2, ARG, ARG:1, ARG:2
SELECTCASE ARG
	CASE 12
		SETCOLOR 255, 0, 0
		RESULTS = 偵
	CASE 22
		SETCOLOR 0, 255, 0
		RESULTS = 壁
	CASE 32
		SETCOLOR 255, 0, 0
		RESULTS = 封
	CASE 42
		CALL SHIKIMI_WALL_COLOR_DUNGEON_25
	CASEELSE
		RETURN 1
ENDSELECT

@TILE_MARK_COMMON_25_4, ARG, ARG:1, ARG:2
SELECTCASE ARG
	;メッセンジャーを緑色で"ｍ"と表示
	CASE 14
		SETCOLOR 0x00ff00
		RESULTS = ｍ
	;ループポイント
	CASE 24
		;アカラナ回廊の時空の歪み
		IF 이벤트플래그:86:1 == 23
			SETCOLOR 0, 0, 255
			RESULTS = ■
		ELSE
			RESULTS = □
		ENDIF
	;ヒルコ床
	CASE 34
		;アカラナ回廊の砂時計
		IF 이벤트플래그:86:1 == 23
			RESULTS = %UNICODE(0x231B)%
		ELSE
			SETCOLOR 255, 100, 100
			RESULTS = ◆ 
		ENDIF
	;↑
	CASE 44
		RESULTS = ↑
	;↓
	CASE 54
		RESULTS = ↓
	;↓
	CASE 64
		RESULTS = →
	CASE 74
		RESULTS = ←
	CASEELSE
		RETURN 1
ENDSELECT




;=======================================================================

;[5]調べる　実行時のイベント

;=======================================================================
@EVENT_CHECK_DUNGEON_25

;==========
;出口の処理
;==========
IF DA:(FLAG:현X):(FLAG:현Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1

;========
;宝の処理
;========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 3
	IF 이벤트플래그:86:1 == 1
		CALL TREASURE_DUNGEON_25_DAIDOUJI_MANSION
	ELSEIF 이벤트플래그:86:1 == 5
		CALL TREASURE_DUNGEON_25_DAIDOUJI_FACTORY
	ELSEIF 이벤트플래그:86:1 == 7
		CALL TREASURE_DUNGEON_25_HARBOR_TOWN
	ELSEIF 이벤트플래그:86:1 == 9
		CALL TREASURE_DUNGEON_25_SEASIDE_PARK
	ELSEIF 이벤트플래그:86:1 == 13
		CALL TREASURE_DUNGEON_25_FUKAGAWA
	ELSEIF 이벤트플래그:86:1 == 15
		CALL TREASURE_DUNGEON_25_ATAGO
	ELSEIF 이벤트플래그:86:1 == 19
		CALL TREASURE_DUNGEON_25_UG_BASE_WEST
	ELSEIF 이벤트플래그:86:1 == 23
		CALL TREASURE_DUNGEON_25_AKARANA
	ELSE
		CALL TREASURE_25
	ENDIF
	RETURN RESULT

;========
;イベント
;========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) % 10 == 4
	SELECTCASE FLAG:현M
		CASE 10 TO 14
			CALL EVENT_TOKYO_STATION
		CASE 15, 16, 17
			CALL EVENT_DAIDOUJI_MANSION
		CASE 18, 19
			CALL EVENT_DAIDOUJI_FACTORY
		CASE 20, 21, 22
			CALL EVENT_HARBOR_TOWN
		CASE 23 TO 27
			CALL EVENT_SEASIDE_PARK
		CASE 28, 29
			CALL EVENT_DUNGEOU
		CASE 30
			CALL EVENT_FUKAGAWA
		CASE 31 TO 35
			CALL EVENT_ATAGO
		CASE 36 TO 38
			CALL EVENT_UG_BASE_WEST
		CASE 39 TO 52
			CALL EVENT_AKARANA
	ENDSELECT
;=======
;階段
;=======
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 6
	SELECTCASE FLAG:현M
		CASE 10, 11, 12, 13, 14
			CALL UPSTAIRS_TOKYO_STATION
		CASE 15, 16, 17
			CALL UPSTAIRS_DAIDOUJI_MANSION
		CASE 23 TO 27
			CALL UPSTAIRS_SEASIDE_PARK
		CASE 28, 29
			CALL UPSTAIRS_DUNGEOU
		CASEELSE
			CALL UPSTAIRS_25
	ENDSELECT
	RETURN RESULT
		
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 7
	SELECTCASE FLAG:현M
		CASE 10, 11, 12, 13, 14
			CALL DOWNSTAIRS_TOKYO_STATION
		CASE 15, 16, 17
			CALL DOWNSTAIRS_DAIDOUJI_MANSION
		CASE 23 TO 27
			CALL DOWNSTAIRS_SEASIDE_PARK
		CASE 28, 29
			CALL DOWNSTAIRS_DUNGEOU
		CASE 36, 37, 38
			CALL DOWNSTAIRS_UG_BASE_WEST
		CASEELSE
			CALL DOWNSTAIRS_25
	ENDSELECT
	RETURN RESULT
	
;======
;特殊処理
;======
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 9
	CALL MESSAGE_WINDOW_D, "", "＞아무것도 없는 것 같다"
	RETURN 0
ENDIF

;=======================================================================

;タイル進入時のイベント

;=======================================================================
@EVENT_ENTER_DUNGEON_25,ARG
;ARG = 進入時の向き　0の場合ワープなど
;==========
;出口の処理
;==========
IF DA:(FLAG:현X):(FLAG:현Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 3
	IF 이벤트플래그:86:1 == 1
		CALL TREASURE_DUNGEON_25_DAIDOUJI_MANSION
	ELSEIF 이벤트플래그:86:1 == 5
		CALL TREASURE_DUNGEON_25_DAIDOUJI_FACTORY
	ELSEIF 이벤트플래그:86:1 == 7
		CALL TREASURE_DUNGEON_25_HARBOR_TOWN
	ELSEIF 이벤트플래그:86:1 == 9
		CALL TREASURE_DUNGEON_25_SEASIDE_PARK
	ELSEIF 이벤트플래그:86:1 == 13
		CALL TREASURE_DUNGEON_25_FUKAGAWA
	ELSEIF 이벤트플래그:86:1 == 15
		CALL TREASURE_DUNGEON_25_ATAGO
	ELSEIF 이벤트플래그:86:1 == 19
		CALL TREASURE_DUNGEON_25_UG_BASE_WEST
	ELSEIF 이벤트플래그:86:1 == 23
		CALL TREASURE_DUNGEON_25_AKARANA
	ELSE
		CALL TREASURE_25
	ENDIF
	RETURN RESULT
;========
;罠の処理
;========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 5
	CALL TRAP_25
	RETURN RESULT
;=======
;階段
;=======
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 6
	SELECTCASE FLAG:현M
		CASE 10, 11, 12, 13, 14
			CALL UPSTAIRS_TOKYO_STATION
		CASE 15, 16, 17
			CALL UPSTAIRS_DAIDOUJI_MANSION
		CASE 23 TO 27
			CALL UPSTAIRS_SEASIDE_PARK
		CASE 28, 29
			CALL UPSTAIRS_DUNGEOU
		CASE 36, 37, 38
			CALL UPSTAIRS_UG_BASE_WEST
		CASEELSE
			CALL UPSTAIRS_25
	ENDSELECT
	RETURN RESULT
	
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 7
	SELECTCASE FLAG:현M
		CASE 10, 11, 12, 13, 14
			CALL DOWNSTAIRS_TOKYO_STATION
		CASE 15, 16, 17
			CALL DOWNSTAIRS_DAIDOUJI_MANSION
		CASE 23 TO 27
			CALL DOWNSTAIRS_SEASIDE_PARK
		CASE 28, 29
			CALL DOWNSTAIRS_DUNGEOU
		CASE 36, 37, 38
			CALL DOWNSTAIRS_UG_BASE_WEST
		CASEELSE
			CALL DOWNSTAIRS_25
	ENDSELECT
	RETURN RESULT
	
;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 2
	CALL DUNGEON_DOOR,ARG
	RETURN 1


;========================
;이벤트
;========================
ELSEIF DA:(FLAG:현X):(FLAG:현Y) % 10 == 4
	SELECTCASE FLAG:현M
		CASE 4
			CALL EVENT_OLD_IMPERIAL_PALACE
		CASE 10, 11, 12, 13, 14
			CALL EVENT_TOKYO_STATION
		CASE 15, 16, 17
			CALL EVENT_DAIDOUJI_MANSION
		CASE 18, 19
			CALL EVENT_DAIDOUJI_FACTORY
		CASE 20, 21, 22
			CALL EVENT_HARBOR_TOWN
		CASE 23 TO 27
			CALL EVENT_SEASIDE_PARK
		CASE 28, 29
			CALL EVENT_DUNGEOU
		CASE 30
			CALL EVENT_FUKAGAWA
		CASE 31 TO 35
			CALL EVENT_ATAGO
		CASE 36 TO 38
			CALL EVENT_UG_BASE_WEST
		CASE 39 TO 52
			CALL EVENT_AKARANA
	ENDSELECT

;========================
;その他、特殊処理
;========================
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 9
ENDIF
RETURN 0


;===========
;宝箱の中身
;===========
@TREASURE_25
SELECTCASE FLAG:현M
	CASE 0
ENDSELECT
RETURN 1


;========
;罠置き場
;========
@TRAP_25
SELECTCASE FLAG:현M
	CASE 0
		IF FLAG:현X == 5 && FLAG:현Y == 1
			CALL DUNGEON_TRAP_MP,10
		ELSE
			CALL DUNGEON_TRAP_HP,10
		ENDIF
	CASE 1
		IF FLAG:현X == 7 && FLAG:현Y == 1
			CALL DUNGEON_TRAP_HP,10
		ELSE
			CALL DUNGEON_TRAP_MP,10
		ENDIF
	CASE 2
		IF FLAG:현X == 7 && FLAG:현Y == 7
			CALL DUNGEON_TRAP_MP,10
		ELSE
			CALL DUNGEON_TRAP_HP,10
		ENDIF
	CASE 3
		IF FLAG:현X == 1 && FLAG:현Y == 3
			CALL DUNGEON_TRAP_MP,10
		ELSEIF FLAG:현X == 1 && FLAG:현Y == 7
			CALL DUNGEON_TRAP_POISON,40
		ELSE
			CALL DUNGEON_TRAP_HP,10
		ENDIF
	CASE 29
		CALL DUNGEON_TRAP_HP,10
ENDSELECT
RETURN 0

;=======================================================================

;エンカウント率

;=======================================================================
@ENCOUNT_RATE_25
SELECTCASE FLAG:현M
	CASE 10 TO 14
		IF 던전플래그:25:11 == 0
			FLAG:인카운트율 = FLAG:미조우걸음수
		ELSE
			FLAG:인카운트율 = FLAG:미조우걸음수*10 + 10
		ENDIF
	CASE 15
		FLAG:인카운트율 = FLAG:미조우걸음수
	CASE 16, 17, 18, 20, 22, 29
		FLAG:인카운트율 = 0
	CASEELSE
		FLAG:인카운트율 = FLAG:미조우걸음수*5 + 5
ENDSELECT
SIF FLAG:미조우걸음수 < 5
	FLAG:인카운트율 = 0

;====================================
;必要レベル目安
;推奨LV 雑魚最低LV 雑魚最高LV ボスLV 
;=====================================
@GET_DUNGEON_LV_25
IF 투기장플래그:1:0 == 2
	RETURN 40, 35, 44, 55
ELSE
	RETURN 33, 30, 39, 50
ENDIF
;=================
;エンカウント処理
;=================
@CHECK_ENCOUNT_25
IF RAND:100 < FLAG:인카운트율
	CALL ENEMY_TABLE
	RETURN 1
ELSE
	FLAG:미조우걸음수 += 1
	RETURN 0
ENDIF
;================
;敵の種族の種類数
;================
@CLASS_NUM_25
SELECTCASE FLAG:현M
	CASE 10 TO 14
		IF 던전플래그:25:11 == 0
			RETURN 1
		ELSE
			RETURN 3
		ENDIF
	CASE 15 TO 40
		RETURN 1
	CASEELSE
		RETURN CLASS_NUM_COMMON("上級")
ENDSELECT
;=========================
;敵の総数
;ARGは出現する敵の種類です
;=========================
@ENEMY_NUM_25, ARG
SELECTCASE FLAG:현M
	CASE 10 TO 14
		IF 던전플래그:25:11 == 0
			RETURN ENEMY_NUM_COMMON("中級", ARG)
		ELSE
			RETURN 10
		ENDIF
	CASE 15 TO 50 
			RETURN ENEMY_NUM_COMMON("中級", ARG)
	CASEELSE
		RETURN ENEMY_NUM_COMMON("上級", ARG)
ENDSELECT
;=======================================================================
;적の종류
;=======================================================================
@ENEMY_25, ARG
SELECTCASE FLAG:현M
	CASE IS < 4
		SELECTCASE RAND:100
			CASE IS < 30
				;30%で사라시나히메
				RETURN 605, 30+RAND:(1+(FLAG:현M))
			CASE IS < 55
				;25%で후지무스메
				RETURN 507, 31+RAND:(1+(FLAG:현M))
			CASE IS < 70
				;15%で선리
				RETURN 806, 33+RAND:(1+(FLAG:현M))
			CASE IS < 85
				;15%で백낭자
				RETURN 705, 34+RAND:(1+(FLAG:현M))
			CASE IS < 100
				;10%で오시치
				RETURN 1008, 35+RAND:(1+(FLAG:현M))
		ENDSELECT
	CASE 4
		SELECTCASE RAND:100
			CASE IS < 30
				;30%で사라시나히메
				RETURN 605, 34
			CASE IS < 55
				;25%で후지무스메
				RETURN 507, 35
			CASE IS < 70
				;15%で선리
				RETURN 806, 37
			CASE IS < 85
				;15%で백낭자
				RETURN 705, 38
			CASE IS < 100
				;10%で오시치
				RETURN 1008, 39
		ENDSELECT
	;東京驛
	CASE 10 TO 14
		SELECTCASE RAND:100
			CASE IS < 40
				RETURN [[キャラ:카라스텐구]], 30 + RAND:5
			CASE IS < 70
				RETURN [[キャラ:가샤도쿠로]], 35 + RAND:5
			CASE IS < 100
				RETURN [[キャラ:네비로스]], 40 + RAND:5
		ENDSELECT
	;大道寺邸
	CASE 15, 16, 17
		SELECTCASE RAND:100
			CASE IS < 20
				RETURN [[キャラ:아즈미]], 26 + RAND:5
			CASE IS < 40
				RETURN [[キャラ:오바리욘]], 25 + RAND:5
			CASE IS < 60
				RETURN [[キャラ:잭랜턴]], 38 + RAND:5
			CASE IS < 75
				RETURN [[キャラ:좀비아미]], 22 + RAND:5
			CASE IS < 90
				RETURN [[キャラ:폴터가이스트]], 30 + RAND:5
			CASE IS < 100
				RETURN [[キャラ:오르트로스]], 34 + RAND:5
		ENDSELECT
	;大道寺工業　工場
	CASE 18, 19
		SELECTCASE RAND:100
			CASE IS < 10
				RETURN [[キャラ:아즈미]], 26 + RAND:5
			CASE IS < 20
				RETURN [[キャラ:알프]], 23 + RAND:5
			CASE IS < 30
				RETURN [[キャラ:오키쿠무시]], 44 + RAND:5
			CASE IS < 50
				RETURN [[キャラ:오시치]], 43 + RAND:5
			CASE IS < 60
				RETURN [[キャラ:오니]], 42 + RAND:5
			CASE IS < 70
				RETURN [[キャラ:잭프로스트]], 38 + RAND:5
			CASE IS < 80
				RETURN [[キャラ:좀비아미]], 22 + RAND:5
			CASE IS < 90
				RETURN [[キャラ:폴터가이스트]], 30 + RAND:5
			CASE IS < 100
				RETURN [[キャラ:모코이]], 33 + RAND:5
		ENDSELECT
	;港町（襲撃）
	CASE 21
		SELECTCASE RAND:100
			CASE IS < 40
				RETURN [[キャラ:안주]], 46 + RAND:5
			CASE IS < 50
				RETURN 1014, 47 + RAND:5
			CASE IS < 60
				RETURN [[キャラ:사티]], 49 + RAND:5
			CASE IS < 70
				RETURN [[キャラ:라미아]], 48 + RAND:5
			CASE IS < 80
				RETURN [[キャラ:랴난시]], 45 + RAND:5
			CASE IS < 90
				RETURN [[キャラ:잭프로스트]], 38 + RAND:5
			CASE IS < 100
				RETURN [[キャラ:모코이]], 33 + RAND:5
		ENDSELECT
	;臨海公園
	CASE 23
		SELECTCASE RAND:100
			CASE IS < 10
				RETURN [[キャラ:봉황]], 53 + RAND:5
			CASE IS < 20
				RETURN [[キャラ:알프]], 23 + RAND:5
			CASE IS < 30
				RETURN 1014, 47 + RAND:5
			CASE IS < 40
				RETURN [[キャラ:가샤도쿠로]], 55 + RAND:5
			CASE IS < 50
				RETURN [[キャラ:사티]], 49 + RAND:5
			CASE IS < 60
				RETURN [[キャラ:네코마타]], 49 + RAND:5
			CASE IS < 70
				RETURN [[キャラ:좀비아미]], 45 + RAND:5
			CASE IS < 80
				RETURN [[キャラ:모・쇼보]], 35 + RAND:5
			CASE IS < 90
				RETURN [[キャラ:라미아]], 48 + RAND:5
			CASE IS < 100
				RETURN [[キャラ:드라이어드]], 45 + RAND:5
		ENDSELECT
	;地下基地
	CASE 24 TO 27
		SELECTCASE RAND:100
			CASE IS < 10
				RETURN [[キャラ:봉황]], 48 + RAND:5
			CASE IS < 20
				RETURN [[キャラ:가샤도쿠로]], 55 + RAND:5
			CASE IS < 30
				RETURN [[キャラ:네코마타]], 49 + RAND:5
			CASE IS < 40
				RETURN [[キャラ:모・쇼보]], 35 + RAND:5
			CASE IS < 50
				RETURN [[キャラ:사티]], 49 + RAND:5
			CASE IS < 70
				RETURN [[キャラ:좀비아미]], 45 + RAND:5
			CASE IS < 100
				RETURN [[キャラ:요모츠시코메]], 58 + RAND:5
		ENDSELECT
	;深川（異界）
	CASE 30
		SELECTCASE RAND:100
			CASE IS < 10
				RETURN [[キャラ:좀비아미]], 50 + RAND:5
			CASE IS < 20
				RETURN [[キャラ:가샤도쿠로]], 55 + RAND:5
			CASE IS < 30
				RETURN [[キャラ:츠치구모]], 41 + RAND:5
			CASE IS < 40
				RETURN [[キャラ:트리글라프]], 41 + RAND:5
			CASE IS < 50
				RETURN [[キャラ:나가]], 59 + RAND:5
			CASE IS < 70
				RETURN [[キャラ:누에]], 60 + RAND:5
			CASE IS < 100
				RETURN [[キャラ:요모츠시코메]], 58 + RAND:5
		ENDSELECT
	;愛宕山
	CASE 31
		SELECTCASE RAND:100
			CASE IS < 10
				RETURN [[キャラ:오키쿠무시]], 44 + RAND:5
			CASE IS < 20
				RETURN [[キャラ:굴라]], 47 + RAND:5
			CASE IS < 30
				RETURN [[キャラ:카라스텐구]], 61 + RAND:5
			CASE IS < 40
				RETURN [[キャラ:드라이어드]], 48 + RAND:5
			CASE IS < 50
				RETURN [[キャラ:좀비헌병]], 50 + RAND:5
			CASE IS < 70
				RETURN [[キャラ:누에]], 60 + RAND:5
			CASE IS < 80
				RETURN [[キャラ:토트]], 58 + RAND:5
			CASE IS < 100
				RETURN [[キャラ:네비로스]], 62 + RAND:5
		ENDSELECT
	;和電イ号機
	CASE 32 TO 35
		SELECTCASE RAND:100
			CASE IS < 10
				RETURN [[キャラ:블랙맨]], 47 + RAND:5
			CASE IS < 30
				RETURN [[キャラ:카라스텐구]], 61 + RAND:5
			CASE IS < 40
				RETURN [[キャラ:좀비헌병]], 50 + RAND:5
			CASE IS < 50
				RETURN [[キャラ:네비로스]], 62 + RAND:5
			CASE IS < 60
				RETURN [[キャラ:슬라임]], 66 + RAND:5
			CASE IS < 80
				RETURN [[キャラ:요모츠시코메]], 58 + RAND:5
			CASE IS < 100
				RETURN [[キャラ:락샤사]], 64 + RAND:5
		ENDSELECT
	;地下基地（西側）
	CASE 36 TO 38
		SELECTCASE RAND:100
			CASE IS < 5
				RETURN [[キャラ:블랙맨]], 65 + RAND:5
			CASE IS < 10
				RETURN [[キャラ:안주]], 45 + RAND:5
			CASE IS < 20
				RETURN [[キャラ:인큐버스]], 71 + RAND:5
			CASE IS < 30
				RETURN [[キャラ:오오야마츠미]], 70 + RAND:5
			CASE IS < 40
				RETURN [[キャラ:케르베로스]], 69 + RAND:5
			CASE IS < 50
				RETURN [[キャラ:잭랜턴]], 30 + RAND:5
			CASE IS < 60
				RETURN [[キャラ:스카아하]], 67 + RAND:5
			CASE IS < 65
				RETURN [[キャラ:스사노오]], 90 + RAND:5
			CASE IS < 70
				RETURN [[キャラ:좀비아미]], 37 + RAND:5
			CASE IS < 80
				RETURN [[キャラ:트리글라프]], 61 + RAND:5
			CASE IS < 90
				RETURN [[キャラ:누에]], 60 + RAND:5
			CASE IS < 100
				RETURN [[キャラ:파르바티]], 66 + RAND:5
		ENDSELECT
	;アカラナ回廊
	CASE 39 TO 52
		SELECTCASE RAND:100
			CASE IS < 5
				RETURN [[キャラ:아라하바키]], 73 + RAND:5
			CASE IS < 10
				RETURN [[キャラ:인큐버스]], 71 + RAND:5
			CASE IS < 15
				RETURN [[キャラ:오오야마츠미]], 70 + RAND:5
			CASE IS < 20
				RETURN [[キャラ:가샤도쿠로]], 68 + RAND:5
			CASE IS < 25
				RETURN [[キャラ:산달폰]], 94 + RAND:5
			CASE IS < 30
				RETURN [[キャラ:지크프리트]], 81 + RAND:5
			CASE IS < 35
				RETURN [[キャラ:스카아하]], 67 + RAND:5
			CASE IS < 40
				RETURN [[キャラ:스사노오]], 90 + RAND:5
			CASE IS < 45
				RETURN [[キャラ:스로네]], 64 + RAND:5
			CASE IS < 50
				RETURN [[キャラ:타라스크]], 63 + RAND:5
			CASE IS < 55
				RETURN [[キャラ:토르]], 81 + RAND:5
			CASE IS < 60
				RETURN [[キャラ:트리글라프]], 61 + RAND:5
			CASE IS < 65
				RETURN [[キャラ:파르바티]], 66 + RAND:5
			CASE IS < 70
				RETURN [[キャラ:파워]], 71 + RAND:5
			CASE IS < 75
				RETURN [[キャラ:후츠누시]], 76 + RAND:5
			CASE IS < 80
				RETURN [[キャラ:야마타노오로치]], 83 + RAND:5
			CASE IS < 90
				RETURN [[キャラ:락샤사]], 64 + RAND:5
			CASE IS < 100
				RETURN [[キャラ:리리스]], 78 + RAND:5
		ENDSELECT
ENDSELECT

;=======================================================================
;特殊調整
;=======================================================================
@SET_ENEMY_STATUS_25, ARG
SIF NO:ARG == [[キャラ:후지무스메]]
	ABL:ARG:스킬4 = 106
IF NO:ARG == 1014
	NAME:ARG = オボログルマ
	CALLNAME:ARG = オボログルマ
ELSEIF NO:ARG == [[キャラ:좀비아미]]
	NAME:ARG = トゥルダク
	CALLNAME:ARG = トゥルダク
ELSEIF NO:ARG == [[キャラ:카라스텐구]]
	NAME:ARG = クラマテング
	CALLNAME:ARG = クラマテング
ELSEIF NO:ARG == [[キャラ:블랙맨]]
	NAME:ARG = 赤マント
	CALLNAME:ARG = 赤マント
ELSEIF NO:ARG == [[キャラ:슬라임]]
	NAME:ARG = ヒルコ
	CALLNAME:ARG = ヒルコ
ENDIF	


;========================================

;戦闘開始時の処理

;========================================
@EVENT_BATTLE_START_DUNGEON25
;超力兵団モード、02に居る仲魔とあなた以外は戦闘開始時にパーティーから外れる
IF 이벤트플래그:86:3 == 1
	FOR LOCAL:0,1,7
		IF LOCAL:0 != 2
			LOCALS = 포지션{LOCAL:0}
			IF FLAG:LOCALS != 0 && FLAG:LOCALS != -1
				CALL REMOVE_POSITION,LOCAL:0
			ENDIF
		ENDIF
	NEXT
ENDIF
IF 이벤트플래그:86:1 == 1
	CALL EVENT_BATTLE_START_DUNGEON25_DAIDOUJI_MANSION
ELSEIF 이벤트플래그:86:1 == 7
	CALL EVENT_BATTLE_START_DUNGEON25_HARBOR_TOWN
ELSEIF 이벤트플래그:86:1 == 9
	CALL EVENT_BATTLE_START_DUNGEON25_SEASIDE_PARK
ELSEIF 이벤트플래그:86:1 == 13
	CALL EVENT_BATTLE_START_DUNGEON25_FUKAGAWA
ELSEIF 이벤트플래그:86:1 == 15
	CALL EVENT_BATTLE_START_DUNGEON25_ATAGO
ELSEIF 이벤트플래그:86:1 == 19
	CALL EVENT_BATTLE_START_DUNGEON25_UG_BASE_WEST
ELSEIF 이벤트플래그:86:1 == 23
	CALL EVENT_BATTLE_START_DUNGEON25_AKARANA
ENDIF

;========================================

;行動終了時の処理

;========================================
@EVENT_BATTLE_ACTEND_DUNGEON25
IF 이벤트플래그:86:1 == 7
	CALL EVENT_BATTLE_ACTEND_DUNGEON25_HARBOR_TOWN
ELSEIF 이벤트플래그:86:1 == 9
	CALL EVENT_BATTLE_ACTEND_DUNGEON25_SEASIDE_PARK
ELSEIF 이벤트플래그:86:1 == 13
	CALL EVENT_BATTLE_ACTEND_DUNGEON25_FUKAGAWA
ELSEIF 이벤트플래그:86:1 == 15
	CALL EVENT_BATTLE_ACTEND_DUNGEON25_ATAGO
ELSEIF 이벤트플래그:86:1 == 23
	CALL EVENT_BATTLE_ACTEND_DUNGEON25_AKARANA
ENDIF

;========================================

;ターン終了時の処理

;========================================
@EVENT_BATTLE_TURNEND_DUNGEON25
IF 이벤트플래그:86:1 == 1
	CALL EVENT_BATTLE_TURNEND_DUNGEON25_DAIDOUJI_MANSION
ELSEIF 이벤트플래그:86:1 == 7
	CALL EVENT_BATTLE_TURNEND_DUNGEON25_HARBOR_TOWN
ELSEIF 이벤트플래그:86:1 == 9
	CALL EVENT_BATTLE_TURNEND_DUNGEON25_SEASIDE_PARK
ELSEIF 이벤트플래그:86:1 == 13
	CALL EVENT_BATTLE_TURNEND_DUNGEON25_FUKAGAWA
ELSEIF 이벤트플래그:86:1 == 23
	CALL EVENT_BATTLE_TURNEND_DUNGEON25_AKARANA
ENDIF


;=================================
;사고패턴
;=================================
;좀비사무라이の사고패턴
@SET_ACTION_1091,ARG
;後衛に居るなら前衛に出る
IF CPOS(ARG) > 11
	CFLAG:ARG:입력행동 = 2301
	CFLAG:ARG:입력행동 = CPOS(ARG)-5
;それ以外は通常
ELSE
		$DECIDE_ACTION
		CALL SEARCH_ACT,ARG
		IF RESULT == 0
			CFLAG:ARG:입력행동 = -1
			CFLAG:ARG:방어플래그 = 1
			RETURN 0
		ENDIF
;		PRINTFORML [{CFLAG:ARG:5}]の스킬数 {RESULT}
		LOCAL = RAND:RESULT
		;스킬番号決定
		LOCAL:1 = S:(10+LOCAL)
;		PRINTFORML [{CFLAG:ARG:5}]の스킬 {LOCAL:1}
		$TARGET_LOOP
		
		CALL RANDOM_TARGET,ARG,LOCAL:1
		CALLFORM SKILL_TARGET_{LOCAL:1}
		;ここで스킬番号を行動内容に代入
		SIF CFLAG:ARG:타겟 == -1
			GOTO DECIDE_ACTION
		CFLAG:ARG:입력행동 = LOCAL:1
ENDIF

;좀비헌병の사고패턴
@SET_ACTION_1092,ARG
;前衛に居るなら자폭
IF CPOS(ARG) < 12
	CFLAG:ARG:입력행동 = 2005
	CALL CHECK_ACTIONABLE_AND_SET , ARG , CFLAG:ARG:입력행동
;それ以外は通常
ELSE
		$DECIDE_ACTION
		CALL SEARCH_ACT,ARG
		IF RESULT == 0
			CFLAG:ARG:입력행동 = -1
			CFLAG:ARG:방어플래그 = 1
			RETURN 0
		ENDIF
;		PRINTFORML [{CFLAG:ARG:5}]の스킬数 {RESULT}
		LOCAL = RAND:RESULT
		;스킬番号決定
		LOCAL:1 = S:(10+LOCAL)
;		PRINTFORML [{CFLAG:ARG:5}]の스킬 {LOCAL:1}
		$TARGET_LOOP
		
		CALL RANDOM_TARGET,ARG,LOCAL:1
		CALLFORM SKILL_TARGET_{LOCAL:1}
		;ここで스킬番号を行動内容に代入
		SIF CFLAG:ARG:타겟 == -1
			GOTO DECIDE_ACTION
		CFLAG:ARG:입력행동 = LOCAL:1
ENDIF

;이자나미の사고패턴
@SET_ACTION_7,ARG
IF CFLAG:ARG:행동한횟수 == 4
	;５回눈の行動は어둠의심판
	CALL CHECK_ACTIONABLE,ARG,1406
	SIF RESULT == 0
		GOTO DECIDE_ACTION
	CFLAG:ARG:입력행동 = 1406
	CALL RANDOM_TARGET,ARG,1406
ELSEIF CFLAG:ARG:행동한횟수 < 4
	;포지션9の좀비か포지션14の좀비が死んでたら優先사마리캄
	;それ以外に死んでるキャラが居たら사마리캄
	;居なかったら컨센트레이트(既に貯まってたら메기도)or자장가（一人でも眠ってたら誘い）
	IF CFLAG:POS(9):상태이상 == GET_STATE_NUM("DYING")
		CALL CHECK_ACTIONABLE,ARG,418
		SIF RESULT == 0
			GOTO DECIDE_ACTION
		CFLAG:ARG:입력행동 = 418
		CFLAG:ARG:타겟 = POS(9)
		RETURN 1
	ELSEIF CFLAG:POS(14):상태이상 == GET_STATE_NUM("DYING")
		CALL CHECK_ACTIONABLE,ARG,418
		SIF RESULT == 0
			GOTO DECIDE_ACTION
		CFLAG:ARG:입력행동 = 418
		CFLAG:ARG:타겟 = POS(14)
		RETURN 1
	ENDIF
	;前衛に居るならスウェイバック
	IF CPOS(ARG) == 9
		CFLAG:ARG:입력행동 = 2301
		CFLAG:ARG:타겟 = 14
		RETURN 1
	ENDIF
	
	LOCAL:10 = 0

	FOR LOCAL,16,6,-1
		IF POS(LOCAL) > -1 && CFLAG:(POS(LOCAL)):상태이상 == GET_STATE_NUM("DYING")
			CALL CHECK_ACTIONABLE,ARG,418
			SIF RESULT == 0
			GOTO DECIDE_ACTION
			CFLAG:ARG:입력행동 = 418
			CFLAG:ARG:타겟 = POS(LOCAL)
			RETURN 1
		ENDIF
	NEXT
	
	IF RAND:2 == 0
	
		IF CFLAG:ARG:집중플래그
			CALL CHECK_ACTIONABLE,ARG,2001
			SIF RESULT == 0
				GOTO DECIDE_ACTION
			CFLAG:ARG:입력행동 = 2001
			CALL RANDOM_TARGET,ARG,2001
			RETURN 1
		ELSE
			CALL CHECK_ACTIONABLE,ARG,512
			SIF RESULT == 0
				GOTO DECIDE_ACTION
			CFLAG:ARG:입력행동 = 512
			CALL RANDOM_TARGET,ARG,512
			RETURN 1
		ENDIF
	ELSE
		FOR LOCAL,1,7
			IF POS(LOCAL) > -1 && CFLAG:(POS(LOCAL)):상태이상 == GET_STATE_NUM("SLEEP")
				CALL CHECK_ACTIONABLE,ARG,1225
				SIF RESULT == 0
					GOTO DECIDE_ACTION
				CFLAG:ARG:입력행동 = 1225
				CALL RANDOM_TARGET,ARG,1225
				RETURN 1
			ENDIF
		NEXT
		CALL CHECK_ACTIONABLE,ARG,1223
		SIF RESULT == 0
			GOTO DECIDE_ACTION
		CFLAG:ARG:입력행동 = 1223
		CALL RANDOM_TARGET,ARG,1223
		RETURN 1
	ENDIF
	
ELSE
		$DECIDE_ACTION
		CALL SEARCH_ACT,ARG
		IF RESULT == 0
			CFLAG:ARG:입력행동 = -1
			CFLAG:ARG:방어플래그 = 1
			RETURN 0
		ENDIF
;		PRINTFORML [{CFLAG:ARG:5}]の스킬数 {RESULT}
		LOCAL = RAND:RESULT
		;스킬番号決定
		LOCAL:1 = S:(10+LOCAL)
;		PRINTFORML [{CFLAG:ARG:5}]の스킬 {LOCAL:1}
		$TARGET_LOOP
		
		CALL RANDOM_TARGET,ARG,LOCAL:1
		CALLFORM SKILL_TARGET_{LOCAL:1}
		;ここで스킬番号を行動内容に代入
		SIF CFLAG:ARG:타겟 == -1
			GOTO DECIDE_ACTION
		CFLAG:ARG:입력행동 = LOCAL:1
ENDIF

;=======================================================================
;マップ(皇居）
;=======================================================================
@MAKE_FLOOR_OLD_IMPERIAL_PALACE
SELECTCASE FLAG:현M
		CASE 0
			FLAG:최대X = 9
			FLAG:최대Y = 9
			CALL MAKE_FLOOR_LINE, 0,"000000000"
			CALL MAKE_FLOOR_LINE, 1,"011115110"
			CALL MAKE_FLOOR_LINE, 2,"01     10"
			CALL MAKE_FLOOR_LINE, 3,"0521 1250"
			CALL MAKE_FLOOR_LINE, 4,"01     10"
			CALL MAKE_FLOOR_LINE, 5,"0121 1210"
			CALL MAKE_FLOOR_LINE, 6,"01     20"
			CALL MAKE_FLOOR_LINE, 7,"0127   80"
			CALL MAKE_FLOOR_LINE, 8,"000000000"

		CASE 1
			FLAG:최대X = 9
			FLAG:최대Y = 9
			CALL MAKE_FLOOR_LINE, 0,"000000000"
			CALL MAKE_FLOOR_LINE, 1,"011511150"
			CALL MAKE_FLOOR_LINE, 2,"02  2  10"
			CALL MAKE_FLOOR_LINE, 3,"07  1  10"
			CALL MAKE_FLOOR_LINE, 4,"0 1121210"
			CALL MAKE_FLOOR_LINE, 5,"0 1 1  50"
			CALL MAKE_FLOOR_LINE, 6,"0      10"
			CALL MAKE_FLOOR_LINE, 7,"0  621110"
			CALL MAKE_FLOOR_LINE, 8,"000000000"
		
		CASE 2
			FLAG:최대X = 9
			FLAG:최대Y = 9
			CALL MAKE_FLOOR_LINE, 0,"000000000"
			CALL MAKE_FLOOR_LINE, 1,"0    7210"
			CALL MAKE_FLOOR_LINE, 2,"0   1  10"
			CALL MAKE_FLOOR_LINE, 3,"06 111250"
			CALL MAKE_FLOOR_LINE, 4,"01  1  10"
			CALL MAKE_FLOOR_LINE, 5,"01  7  10"
			CALL MAKE_FLOOR_LINE, 6,"01     10"
			CALL MAKE_FLOOR_LINE, 7,"011511150"
			CALL MAKE_FLOOR_LINE, 8,"000000000"
		
		CASE 3
			FLAG:최대X = 9
			FLAG:최대Y = 9
			CALL MAKE_FLOOR_LINE, 0,"000000000"
			CALL MAKE_FLOOR_LINE, 1,"011126  0"
			CALL MAKE_FLOOR_LINE, 2,"01      0"
			CALL MAKE_FLOOR_LINE, 3,"05 111  0"
			CALL MAKE_FLOOR_LINE, 4,"01 111  0"
			CALL MAKE_FLOOR_LINE, 5,"01 161 70"
			CALL MAKE_FLOOR_LINE, 6,"01     20"
			CALL MAKE_FLOOR_LINE, 7,"051115110"
			CALL MAKE_FLOOR_LINE, 8,"000000000"
		
		
		CASE 4
			FLAG:최대X = 17
			FLAG:최대Y = 20
			CALL MAKE_FLOOR_LINE, 0,"00000000000000000"
			CALL MAKE_FLOOR_LINE, 1,"0        11111110"
			CALL MAKE_FLOOR_LINE, 2,"0        1     20"
			CALL MAKE_FLOOR_LINE, 3,"0        111   60"
			CALL MAKE_FLOOR_LINE, 4,"0          2    0"
			CALL MAKE_FLOOR_LINE, 5,"01111111111111110"
			CALL MAKE_FLOOR_LINE, 6,"01             10"
			CALL MAKE_FLOOR_LINE, 7,"01 11111 11111 10"
			CALL MAKE_FLOOR_LINE, 8,"01 1 2       1 10"
			CALL MAKE_FLOOR_LINE, 9,"01 1 11111 1 1 10"
			CALL MAKE_FLOOR_LINE,10,"01 1 1   2 1 2 10"
			CALL MAKE_FLOOR_LINE,11,"01 1 1 1 1 1 1 10"
			CALL MAKE_FLOOR_LINE,12,"02 1 1 1 1 1 1 20"
			CALL MAKE_FLOOR_LINE,13,"01 1 1 2 2 1 1 10"
			CALL MAKE_FLOOR_LINE,14,"01 1 111 111 1 10"
			CALL MAKE_FLOOR_LINE,15,"01 1         1 10"
			CALL MAKE_FLOOR_LINE,16,"01 11111111111 10"
			CALL MAKE_FLOOR_LINE,17,"01       2     10"
			CALL MAKE_FLOOR_LINE,18,"01111121 11111110"
			CALL MAKE_FLOOR_LINE,19,"00000000000000000"
			
			
			;イベントの設置
			CALL SET_TILE,7,11,던전플래그:(FLAG:현던전):0,0,4
			;階段の設置
			CALL SET_TILE,7,11,이벤트플래그:86:1,11,7
			
		CASEELSE
	ENDSELECT

;=======================================================================
;階段置き場(旧皇居)
;=======================================================================
@UPSTAIRS_25
SELECTCASE FLAG:현M
	CASE IS < 4
			CALL DUNGEON_DOWNSTAIRS,FLAG:현M - 1,FLAG:현X,FLAG:현Y
	CASE 4
		CALL DUNGEON_UPSTAIRS,3,7,5
	CASEELSE
ENDSELECT
RETURN 1

@DOWNSTAIRS_25
SELECTCASE FLAG:현M
	CASE IS < 3
			CALL DUNGEON_DOWNSTAIRS,FLAG:현M + 1,FLAG:현X,FLAG:현Y
	CASE 3
			CALL DUNGEON_DOWNSTAIRS,4,15,3
	CASE 4
			CALL DUNGEON_DOWNSTAIRS,28, 1,29
	CASEELSE
ENDSELECT
RETURN 1


;=======================================================================
;イベント（旧皇居)
;=======================================================================
@EVENT_OLD_IMPERIAL_PALACE
IF FLAG:현X == 7 && FLAG:현Y == 11
	FLAG:도주불가플래그 = 1
	FLAG:회화불능플래그 = 1
	FLAG:선제기습취소 = 1
	CALL SHOW_PICTURE, "D"
	CALL MESSAGE_WINDOW_D, "", "＞침실 같다/＞발(御簾)을 넘어 여성의 모습이 보인다……"
	CALL MESSAGE_WINDOW_D, "지모신 이자나미", "여러분、여길 떠나십시오/이곳은 우리들의 피를 이은 자만이 들어올 수 있는 장소/당신들도 내가 낳은 자식들이라고는 하지만、/함부로 들어와서는 안 됩니다"
	CALL MESSAGE_WINDOW_D, "지모신 이자나미", "……비사문천들의 허가를 받았다고？/그럼、당신은……/이곳을 지키라고 명한 지상의 아이들은/우리들의 말보다 저 신입들의 말을 우선시했다고！？"
	CALL MESSAGE_WINDOW_D, "지모신 이자나미", "……불쾌하구나/정말로 불쾌하구나！/첩의 노여움을 사려는 눈치다！"
	CALL MESSAGE_WINDOW_D, "지모신 이자나미", "좋을 것이다、네가 원하는 대로 해 주지 않겠는가/부디 이 어머니의 팔에 안겨 재워주마、이 후레자식들아！"
	CALL MESSAGE_WINDOW_D, "", "＞지모신 이자나미가 1체 나타났다！"
	CALL SET_ENEMY,14,7,50,1,1
	CFLAG:(CHARANUM-1):ＨＰ보정 = 2000
	CFLAG:(CHARANUM-1):ＭＰ보정 = 4000
	CFLAG:(CHARANUM-1):속도보정 = 15
	CSTR:(CHARANUM-1):사고패턴 = 7
	CFLAG:(CHARANUM-1):행동횟수 = 5
	ABL:(CHARANUM-1):스킬3 = 2001
	ABL:(CHARANUM-1):스킬4 = 1223
	ABL:(CHARANUM-1):스킬5 = 1225
	CALL SYNC_STATUS,(CHARANUM-1)
	CALL HEALTH_CHARA,(CHARANUM-1)

	FLAG:21091 += 1
	FLAG:21092 += 1

	;ゾンビーサムライを前衛
	CALL SET_ENEMY,8,1091,40,1
	CSTR:(CHARANUM-1):사고패턴 = 1091
	CFLAG:(CHARANUM-1):ＨＰ보정 = 200
	CALL SYNC_STATUS,(CHARANUM-1)
	CALL HEALTH_CHARA,(CHARANUM-1)

	CALL SET_ENEMY,9,1091,40,1
	CSTR:(CHARANUM-1):사고패턴 = 1091
	CFLAG:(CHARANUM-1):ＨＰ보정 = 200
	CALL SYNC_STATUS,(CHARANUM-1)
	CALL HEALTH_CHARA,(CHARANUM-1)
	CALL SET_ENEMY,10,1091,40,1
	CSTR:(CHARANUM-1):사고패턴 = 1091
	CFLAG:(CHARANUM-1):ＨＰ보정 = 200
	CALL SYNC_STATUS,(CHARANUM-1)
	CALL HEALTH_CHARA,(CHARANUM-1)

	;ゾンビーケンペイ自爆なし
	CALL SET_ENEMY,13,1092,40,1
	CSTR:(CHARANUM-1):사고패턴 = 1092
	CFLAG:(CHARANUM-1):ＨＰ보정 = 100
	CALL SYNC_STATUS,(CHARANUM-1)
	CALL HEALTH_CHARA,(CHARANUM-1)
	ABL:(CHARANUM-1):스킬3 = 0
	CALL SET_ENEMY,15,1092,40,1
	ABL:(CHARANUM-1):스킬3 = 0
	CSTR:(CHARANUM-1):사고패턴 = 1092
	CFLAG:(CHARANUM-1):ＨＰ보정 = 100
	CALL SYNC_STATUS,(CHARANUM-1)
	CALL HEALTH_CHARA,(CHARANUM-1)

	CALL BATTLE_START

	CALL MESSAGE_WINDOW_D, "지모신 이자나미", "아아아……"
	CALL MESSAGE_WINDOW_D, "", @"＞이자나미는 그 자리에서 쓰러졌다/＞살갗이 찬 옷에서 들여다보이는 피부는 %CALLNAME:MASTER%의 정욕을 돋우기에는 충분했다/＞전설의 국모도 이렇게 되면 한낱 여자에 지나지 않는다"
	CALL MESSAGE_WINDOW_D, "", "＞지모신 이자나미을 손에 넣었다"
	;FLAG:10007 = 1
	CALL LIFTING_A_BAN([[キャラ:이자나미]])
	CALL ADD_NEW_COMPANION,7,0,1
	SIF FLAG:20007 < 100
		FLAG:20007 = 100
	IF RESULT == 1
		CFLAG:(CHARANUM-1):전투참가불가능 = 1
		BASE:(CHARANUM-1):LV -= 28
		BASE:(CHARANUM-1):힘 -= 7
		BASE:(CHARANUM-1):지혜 -= 7
		BASE:(CHARANUM-1):마력 -= 7
		BASE:(CHARANUM-1):인내력 -= 7
		BASE:(CHARANUM-1):속도 -= 7
		BASE:(CHARANUM-1):운 -= 7
		BASE:(CHARANUM-1):ＥＸＰ = 5*(31)*(32)*(33)/3
		CALL SYNC_STATUS,(RESULT:1)
		CALL HEALTH_CHARA,(RESULT:1)
	ENDIF
	FLAG:도주불가플래그 = 0
	FLAG:회화불능플래그 = 0
	FLAG:선제기습취소 = 0
	던전플래그:(FLAG:현던전):0 = 1
	DA:7:11 = 1
	RETURN 1
ENDIF

;=======================================================================
;エレベーター定義
;=======================================================================
;ARGはそのエレベーターのタイル
;RESULT:1～5にエレベータが存在するマップの番号を代入し、RESULTS:1～5には表示したい名称を代入、RETURNでは-1を返しておく
@DUNGEON_ELEVATOR_25, ARG
;臨海公園
IF 이벤트플래그:86:1 == 9
	RESULT:1 = 26
	RESULT:2 = 27
	RESULTS:1 = Ｂ３Ｆ
	RESULTS:2 = 最下層
ENDIF
RETURN -1


