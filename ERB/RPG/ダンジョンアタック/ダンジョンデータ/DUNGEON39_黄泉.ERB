;=======================================================================
;황천
;突入には아야토君必須、これ以降の偽典던전も同조건とする
;下の이벤트やモチーフから女性の子宮をイメージした던전구조
;사용フラグ
;39:0 오세・발드르撃破フラグ
;39:1 데카라비아撃破フラグ
;=======================================================================

;=======================================================================
;攻略조건
;=======================================================================

@PREREQUISITE_DUNGEON_39
SIF (이벤트플래그:70:0 < 7 || 이벤트플래그:70:0 == 99) || !(FINDCHARA_B(4761,0) == 2)
	RETURN 0
RETURN 1

;=======================================================================
;던전名
;=======================================================================
@GET_DUNGEON_NAME_39
RESULTS = 황천

;=======================================================================
;フ로어名표시
;=======================================================================
@FLOORNAME_39
PRINT 황천

;=======================================================================
;特殊タイル표시
;=======================================================================

@TILE_MARK_39_0_7_0
RESULTS = ↑

@TILE_MARK_39_1_7_13
RESULTS = ↓

@TILE_MARK_39_1_0_1
RESULTS = ←

@TILE_MARK_39_1_13_1
RESULTS = →

@TILE_MARK_39_1_13_3
RESULTS = →

@TILE_MARK_39_1_0_3
RESULTS = ←

@TILE_MARK_39_2_13_1
RESULTS = →

@TILE_MARK_39_2_13_3
RESULTS = →

@TILE_MARK_39_3_0_1
RESULTS = ←

@TILE_MARK_39_3_0_3
RESULTS = ←

;=======================================================================
;스타ト地点입력
;=======================================================================
@START_DUNGEON_39,ARG
FLAG:現M = 0
FLAG:現X = 7
FLAG:現Y = 12
;CALL AUTOMAP

;=======================================================================
;攻略開始時の이벤트
;=======================================================================
@EVENT_DUNGEON_START_39
CALL MESSAGE_WINDOW_D, "", "＞" + CALLNAME:MASTER + "는 카츠라기와 함께/＞오세가 있다는 황천의 바닥으로 갔다"
CALL MESSAGE_WINDOW_D, "", "＞과연、실제로 와보니 있는 건 악령뿐이다/＞본래 온갖 영이 있어도 이상하지 않겠지만"
CALL MESSAGE_WINDOW_D, "", "＞아무래도 오세는 예상 이상으로 영혼을 먹고 힘을 키운 것 같다/＞경계해야만 할 것이다"
CALL MESSAGE_WINDOW_D, "", "＞하물며 벨・데르까지 있다고 들은、대단히 위험한 의뢰지만、/＞저 신검 쿠사나기의 검이 손에 들어온다면 그만한 가치는 있으리라…"

;=======================================================================
;탈출時の이벤트
;=======================================================================
@EVENT_DUNGEON_END_39
IF 던전フラグ:39:0 == 1 && 던전フラグ:39:1 == 0
CALL MESSAGE_WINDOW_D, "", "＞오세를 처단한 " + CALLNAME:MASTER + " 일행 앞에 한 신이 모습을 드러냈다…"
CALL MESSAGE_WINDOW_D, "오오쿠니누시", "미안하구려 손님、본래라면 우리가 해결해야 할 일을…"
CALL MESSAGE_WINDOW_D, "", "＞" + CALLNAME:MASTER + "는 문제는 없다、일하다 남은 걸 정리했을 뿐이라고 말했다…"
CALL MESSAGE_WINDOW_D, "오오쿠니누시", "최소한의 답례일세、이 신검 쿠사나기의 검을 드리…"
CALL MESSAGE_WINDOW_D, "목소리", "이크、송구합니다만 그 신검、이리로 넘겨주시지요"
CALL MESSAGE_WINDOW_D, "", "＞" + CALLNAME:MASTER + "가 갑작스런 목소리에 돌아보니、오망성 형상의 악마가 거기 있었다"
CALL MESSAGE_WINDOW_D, "오오쿠니누시", "넌 웬 놈이냐！/아니、삿된 존재가 왜 여기에 있어！？/이 황천은 결계로 사악한 생자는 숨어들지 못할 터…"
CALL MESSAGE_WINDOW_D, "데카라비아", "제 이름은 데카라비아、법진을 관장하는 몸이온지라/모든 법진들은 제게는 무효하답니다"
CALL MESSAGE_WINDOW_D, "데카라비아", "자 그럼、신검 쿠사나기의 검、그리고 벨의 힘의 한 조각을 받아갈까요！"
CALL MESSAGE_WINDOW_D, "", "타천사　데카라비아　가 1체　나왔다！"
FLAG:도주불가플래그 = 1
FLAG:회화불능플래그 = 1
FLAG:선제기습취소 = 1
CALL SET_ENEMY,9,1705,65,0,5;데카라비아
MAXBASE:(CHARANUM-1):파마 = 0
MAXBASE:(CHARANUM-1):주살 = 0
CALL BATTLE_START
FLAG:도주불가플래그 = 0
FLAG:회화불능플래그 = 0
FLAG:선제기습취소 = 0	
CALL MESSAGE_WINDOW_D, "데카라비아", "저마저 해치우다니、과연 바알의 분령、이라고 해야 할까요…"
CALL MESSAGE_WINDOW_D, "", "＞데카라비아는 사라졌다…"
CALL MESSAGE_WINDOW_D, "", "그러자 그 안에서 환히 빛나는 왼발이 나왔다！ 이것도 타치바나 유우카의、아니 이슈타르의 것이겠지…/＞나중에 조직에 넘겨주기로 하자"
CALL MESSAGE_WINDOW_D, "오오쿠니누시", "면목없구려、수고하시게 만들었어/그럼 다시、여기 쿠사나기의 검이외다/얼마든지 마음껏 쓰시오"
CALL MESSAGE_WINDOW_D, "오오쿠니누시", "그럼、여러분을 돌려 보내드리겠소이다"
CALL MESSAGE_WINDOW_D, "", "＞문득 정신이 들자、" + CALLNAME:MASTER + " 일행은 현세에 있었다…"
CALL MESSAGE_WINDOW_D, "", "황천의 오세를 처단한 보수로 쿠사나기의 검을 입수했다"
ITEM:쿠사나기의검 = 1
던전フラグ:39:1 = 1
이벤트플래그:70:0 = 8
ENDIF
;=======================================================================
;指定したマスに進入가능か
;=======================================================================
@CAN_ENTER_39,ARG,ARG:1

CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT

;=======================================================================
;フ로어데이터
;=======================================================================
@MAKE_FLOOR_39
SELECTCASE FLAG:現M
	CASE 0
	;１階
		FLAG:최대X = 14
		FLAG:최대Y = 14
					;01234567890123
		CALL MAKE_FLOOR_LINE, 0,"       9      "
		CALL MAKE_FLOOR_LINE, 1,"       1      "
		CALL MAKE_FLOOR_LINE, 2,"       1      "
		CALL MAKE_FLOOR_LINE, 3,"       1      "
		CALL MAKE_FLOOR_LINE, 4,"       1      "
		CALL MAKE_FLOOR_LINE, 5,"       1      "
		CALL MAKE_FLOOR_LINE, 6,"       1      "
		CALL MAKE_FLOOR_LINE, 7,"       1      "
		CALL MAKE_FLOOR_LINE, 8,"       1      "
		CALL MAKE_FLOOR_LINE, 9,"       1      "
		CALL MAKE_FLOOR_LINE,10,"       1      "
		CALL MAKE_FLOOR_LINE,11,"       1      "
		CALL MAKE_FLOOR_LINE,12,"       1      "
		CALL MAKE_FLOOR_LINE,13,"       8      "
							    ;012345678


	CASE 1
	;２階
		FLAG:최대X = 14
		FLAG:최대Y = 15
					;012345678901234
		CALL MAKE_FLOOR_LINE, 0,"              "
		CALL MAKE_FLOOR_LINE, 1,"91111111111119"
		CALL MAKE_FLOOR_LINE, 2,"       1      "
		CALL MAKE_FLOOR_LINE, 3,"911    1   119"
		CALL MAKE_FLOOR_LINE, 4,"  1    1   1  "
		CALL MAKE_FLOOR_LINE, 5,"  1  11111 1  "
		CALL MAKE_FLOOR_LINE, 6,"  1  11111 1  "
		CALL MAKE_FLOOR_LINE, 7,"  1  11411 1  "
		CALL MAKE_FLOOR_LINE, 8,"  1        1  "
		CALL MAKE_FLOOR_LINE, 9,"  1111111111  "
		CALL MAKE_FLOOR_LINE,10,"       1      "
		CALL MAKE_FLOOR_LINE,11,"       1      "
		CALL MAKE_FLOOR_LINE,12,"       1      "
		CALL MAKE_FLOOR_LINE,13,"       9      "
		CALL MAKE_FLOOR_LINE,14,"              "

	CASE 2
	;３階
		FLAG:최대X = 14
		FLAG:최대Y = 14
					;01234567890123
		CALL MAKE_FLOOR_LINE, 0,"              "
		CALL MAKE_FLOOR_LINE, 1,"  111111111119"
		CALL MAKE_FLOOR_LINE, 2,"  1           "
		CALL MAKE_FLOOR_LINE, 3,"  1         19"
		CALL MAKE_FLOOR_LINE, 4,"  1         1 "
		CALL MAKE_FLOOR_LINE, 5,"  1         1 "
		CALL MAKE_FLOOR_LINE, 6,"  1         1 "
		CALL MAKE_FLOOR_LINE, 7,"  1         1 "
		CALL MAKE_FLOOR_LINE, 8,"  1         1 "
		CALL MAKE_FLOOR_LINE, 9,"  1         1 "
		CALL MAKE_FLOOR_LINE,10,"  1         1 "
		CALL MAKE_FLOOR_LINE,11,"  1         1 "
		CALL MAKE_FLOOR_LINE,12,"  11111111111 "
		CALL MAKE_FLOOR_LINE,13,"              "

	CASE 3
	;４階
		FLAG:최대X = 14
		FLAG:최대Y = 14
					;01234567890123
		CALL MAKE_FLOOR_LINE, 0,"              "
		CALL MAKE_FLOOR_LINE, 1,"9111111111111 "
		CALL MAKE_FLOOR_LINE, 2,"            1 "
		CALL MAKE_FLOOR_LINE, 3,"91          1 "
		CALL MAKE_FLOOR_LINE, 4," 1          1 "
		CALL MAKE_FLOOR_LINE, 5," 1          1 "
		CALL MAKE_FLOOR_LINE, 6," 1          1 "
		CALL MAKE_FLOOR_LINE, 7," 1          1 "
		CALL MAKE_FLOOR_LINE, 8," 1          1 "
		CALL MAKE_FLOOR_LINE, 9," 1          1 "
		CALL MAKE_FLOOR_LINE,10," 1          1 "
		CALL MAKE_FLOOR_LINE,11," 1          1 "
		CALL MAKE_FLOOR_LINE,12," 111111111111 "
		CALL MAKE_FLOOR_LINE,13,"              "

	CASEELSE

ENDSELECT

;=======================================================================
;[5]조사　実行時の이벤트
;=======================================================================
@EVENT_CHECK_DUNGEON_39

;==========
;出입の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
;% 10は10で割ったあまり、つまり下一桁がでてきます
;그리고、下一桁はタイルの종류を表す
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 3
;	CALL TREASURE_39
;	RETURN RESULT
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 6
SELECTCASE FLAG:現M
	CASE 0
		CALL DUNGEON_UPSTAIRS,1,2,12
	CASE 1
		CALL DUNGEON_UPSTAIRS,2,9,9
	CASE 2
		CALL DUNGEON_UPSTAIRS,3,2,1
	CASE 3
		CALL DUNGEON_UPSTAIRS,4,2,12
	CASE 4
		CALL DUNGEON_UPSTAIRS,5,2,1
	CASE 5
		CALL DUNGEON_UPSTAIRS,6,2,12
	CASE 6
		CALL DUNGEON_UPSTAIRS,7,11,9
	CASE 7
		CALL DUNGEON_UPSTAIRS,8,2,1
	CASE 8
		CALL DUNGEON_UPSTAIRS,9,11,9
	CASE 9
		CALL DUNGEON_UPSTAIRS,9,4,3
	CASE 10

	CASEELSE
ENDSELECT

RETURN 1

ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 7
SELECTCASE FLAG:現M
	CASE 0

	CASE 1
		CALL DUNGEON_DOWNSTAIRS,0,2,12
	CASE 2
		CALL DUNGEON_DOWNSTAIRS,1,9,9
	CASE 3
		CALL DUNGEON_DOWNSTAIRS,2,2,1
	CASE 4
		CALL DUNGEON_DOWNSTAIRS,3,2,12
	CASE 5
		CALL DUNGEON_DOWNSTAIRS,4,2,1
	CASE 6
		CALL DUNGEON_DOWNSTAIRS,5,2,12
	CASE 7
		CALL DUNGEON_DOWNSTAIRS,6,11,9
	CASE 8
		CALL DUNGEON_DOWNSTAIRS,7,2,1
	CASE 9
		CALL DUNGEON_DOWNSTAIRS,8,11,9
	CASE 10
		CALL DUNGEON_DOWNSTAIRS,10,6,5
	CASEELSE
ENDSELECT
RETURN 1
;========
;이벤트
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 4

ELSE
	CALL MESSAGE_WINDOW_D, "", "＞아무것도 없는 것 같다"
	RETURN 0
ENDIF

;=======================================================================
;タイル進入時の이벤트
;=======================================================================
@EVENT_ENTER_DUNGEON_39,ARG
;ARG = 進入時の向き　0の場合ワープなど
;==========
;出입の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) % 10 == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 3
	SELECTCASE FLAG:現M
	CASE 0
	CASE 1
	CASE 2
	CASE 3
	CASE 4
	CASE 5
	CASE 6
		
	CASE 7
		
	CASE 8
		
	CASE 9
		
	CASE 10
		
	CASEELSE
ENDSELECT
	RETURN RESULT
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 6
SELECTCASE FLAG:現M
	CASE 0
		CALL DUNGEON_UPSTAIRS,1,2,12
	CASE 1
		CALL DUNGEON_UPSTAIRS,2,9,9
	CASE 2
		CALL DUNGEON_UPSTAIRS,3,2,1
	CASE 3
		CALL DUNGEON_UPSTAIRS,4,2,12
	CASE 4
		CALL DUNGEON_UPSTAIRS,5,2,1
	CASE 5
		CALL DUNGEON_UPSTAIRS,6,2,12
	CASE 6
		CALL DUNGEON_UPSTAIRS,7,11,9
	CASE 7
		CALL DUNGEON_UPSTAIRS,8,2,1
	CASE 8
		CALL DUNGEON_UPSTAIRS,9,11,9
	CASE 9
		CALL DUNGEON_UPSTAIRS,9,4,3
	CASE 10

	CASEELSE
ENDSELECT

RETURN 1

ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 7
SELECTCASE FLAG:現M
	CASE 0

	CASE 1
		CALL DUNGEON_DOWNSTAIRS,0,2,12
	CASE 2
		CALL DUNGEON_DOWNSTAIRS,1,9,9
	CASE 3
		CALL DUNGEON_DOWNSTAIRS,2,2,1
	CASE 4
		CALL DUNGEON_DOWNSTAIRS,3,2,12
	CASE 5
		CALL DUNGEON_DOWNSTAIRS,4,2,1
	CASE 6
		CALL DUNGEON_DOWNSTAIRS,5,2,12
	CASE 7
		CALL DUNGEON_DOWNSTAIRS,6,11,9
	CASE 8
		CALL DUNGEON_DOWNSTAIRS,7,2,1
	CASE 9
		CALL DUNGEON_DOWNSTAIRS,8,11,9
	CASE 10
		CALL DUNGEON_DOWNSTAIRS,10,6,5
	CASEELSE
ENDSELECT
RETURN 1
;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 2
	CALL DUNGEON_DOOR,ARG
	RETURN 1
;========================
;이벤트
;========================
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 4
IF 던전フラグ:39:0 == 0
	CALL MESSAGE_WINDOW_D, "", "＞어딘가 온기가 느껴지는 동굴、그 심처에는 두 체의 악마가 있었다/＞하나는 본 적이 있는 표범 머리의 타천사 오세、/＞다른 하나는 쇠사슬에 묶인 은빛 남자"
	CALL MESSAGE_WINDOW_D, "오세", "으음、네 이놈！ 설마 황천에서까지 나를 훼방 놓느냐！"
	CALL MESSAGE_WINDOW_D, "벨・데르", "호오… 그 남자、상당한 벨의 힘을 가진 걸로 봤다/그만한 힘이 있다면 지상에 이 몸이 되살아날 수도 있으리"
	CALL MESSAGE_WINDOW_D, "오세", "오호라 벨・데르、그렇다면 네놈의 힘 보도록 할까！/이놈들을 해치우겠다！/신검의 힘、네놈들로 시험해주마！"
	CALL MESSAGE_WINDOW_D, "벨・데르", "말할 필요도 없는 일이로다！/그 힘、네놈에게는 과분한 장난감이다！/성왕의 힘、이 몸이 받겠노라！"
	CALL MESSAGE_WINDOW_D, "", "＞타천사　오세　와　마왕　벨・데르　가 나왔다！"
	IF TALENT:MASTER:도구지식 == 3
	     TALENT:MASTER:아이템숙련 = 1
	ELSE
	     TALENT:MASTER:도구지식 = 3
	ENDIF
	CALL SYNC_STATUS, MASTER
	FLAG:도주불가플래그 = 1
	FLAG:회화불능플래그 = 1
	FLAG:선제기습취소 = 1
	CALL SET_ENEMY,8,1704,65,0,1;오세
	MAXBASE:(CHARANUM-1):파마 = 0
	MAXBASE:(CHARANUM-1):주살 = 0
	CALL SET_ENEMY,10,290,65,0,1;벨・데르
	MAXBASE:(CHARANUM-1):검격 = 10
	MAXBASE:(CHARANUM-1):타격 = 10
	MAXBASE:(CHARANUM-1):비구 = 10
	MAXBASE:(CHARANUM-1):전술 = 10
	MAXBASE:(CHARANUM-1):화염 = 110
	MAXBASE:(CHARANUM-1):빙결 = 10
	MAXBASE:(CHARANUM-1):전격 = 10
	MAXBASE:(CHARANUM-1):충격 = 110
	MAXBASE:(CHARANUM-1):파마 = 0
	MAXBASE:(CHARANUM-1):주살 = 0
	MAXBASE:(CHARANUM-1):지변 = 100
	MAXBASE:(CHARANUM-1):질풍 = 10
	MAXBASE:(CHARANUM-1):수격 = 110
	MAXBASE:(CHARANUM-1):중력 = 10
	MAXBASE:(CHARANUM-1):만능 = 100
	MAXBASE:(CHARANUM-1):사이코 = 100
	CALL BATTLE_START
	FLAG:도주불가플래그 = 0
	FLAG:회화불능플래그 = 0
	FLAG:선제기습취소 = 0	
	CALL MESSAGE_WINDOW_D, "오세", "설마… 신검의 힘…으로도… 당해내지 못할 줄…이야……"
	CALL MESSAGE_WINDOW_D, "벨・데르", "이 몸의… 벨의 힘…이… 빼앗기고… 있어…"
	CALL MESSAGE_WINDOW_D, "", "＞오세와 벨・데르는 사라졌다…"	
	던전フラグ:39:0 = 1
ELSE
	CALL MESSAGE_WINDOW_D, "", "＞아무도 없다…"
ENDIF


ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 9
SELECTCASE FLAG:現M
	CASE 0
		CALL DUNGEON_WORP,1,7,12
	CASE 1
		IF FLAG:現X == 7
			CALL DUNGEON_WORP,0,7,1
		ELSEIF FLAG:現X == 0
			IF FLAG:現Y == 1
				CALL DUNGEON_WORP,2,12,1
			ELSE
				CALL DUNGEON_WORP,2,12,3
			ENDIF
		ELSE
			IF FLAG:現Y == 1
				CALL DUNGEON_WORP,3,1,1
			ELSE
				CALL DUNGEON_WORP,3,1,3
			ENDIF
		ENDIF
	CASE 2
		IF FLAG:現Y == 1
			CALL DUNGEON_WORP,1,1,1
		ELSE
			CALL DUNGEON_WORP,1,1,3
		ENDIF
	CASE 3
		IF FLAG:現Y == 1
			CALL DUNGEON_WORP,1,12,1
		ELSE
			CALL DUNGEON_WORP,1,12,3
		ENDIF
		
ENDSELECT
ENDIF


;=======================================================================
;인카운터율
;=======================================================================
@ENCOUNT_RATE_39
FLAG:인카운터율 = FLAG:未遭遇歩数*5

;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_39
IF RAND:100 < FLAG:인카운터율
	CALL ENEMY_TABLE
	RETURN 1
ELSE
	FLAG:未遭遇歩数 += 1
	RETURN 0
ENDIF

;=======================================================================
;적の종족の종류数
;=======================================================================
@CLASS_NUM_39
RETURN CLASS_NUM_COMMON("上級")
;=======================================================================
;적の総数
;ARGは出現する적の종류です
;=======================================================================
@ENEMY_NUM_39, ARG
RETURN ENEMY_NUM_COMMON("上級", ARG)

;=======================================================================
;적の종류
;=======================================================================
@ENEMY_39, ARG
	IF RAND:4 == 0
		RETURN 602, 50;요모츠시코메
	ELSEIF RAND:3 == 0
		RETURN 610, 52;奪衣아줌마
	ELSEIF RAND:2 == 0
		RETURN 1010, 48;섀도우
	ELSE
		RETURN 1013, 45;색정인연령
	ENDIF

