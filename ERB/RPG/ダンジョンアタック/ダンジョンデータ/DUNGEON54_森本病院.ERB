
;=======================================================================
;모리모토병원
;=======================================================================
;=======================================================================
;攻略조건
;=======================================================================
@PREREQUISITE_DUNGEON_54
SIF STRFLAG_NUM_EV("罰ルート進行", , , , [[이벤트:페르소나２]]) == 3
	RETURN 1
RETURN 0



;=======================================================================
;던전名
;=======================================================================
@GET_DUNGEON_NAME_54
RESULTS = 모리모토병원

;=======================================================================
;指定したマスに進入가능か
;=======================================================================
@CAN_ENTER_54, ARG, ARG:1
RESULT = 1
SELECTCASE DA:ARG:(ARG:1)
	CASE 12
	PRINTW ＞벌써 스도 타츠조의 부하가 와 있다
	PRINTW ＞다시 할 시간은 없다
	RETURN 0
;트리슈の泉
	CASE 22
	CALL FOUNTAIN_OF_TRISH
	RETURN 0
	CASEELSE
		CALL CAN_ENTER,ARG,ARG:1
	ENDSELECT
RETURN RESULT
;=======================================================================
;泉の세이브の가격
;=======================================================================
@PRICE_OF_SAVE_54
RETURN 100, 400

;=======================================================================
;フ로어名표시
;=======================================================================
@FLOORNAME_54
SELECTCASE FLAG:현M
	CASE 0
		PRINTL １Ｆ
	CASE 1
		PRINTL ２Ｆ
	CASE 2
		PRINTL ３Ｆ
	CASE 3
		PRINTL ４Ｆ
ENDSELECT

;=======================================================================
;特殊タイル표시
;=======================================================================
;時計台
@TILE_MARK_ID_54_3_3004
SETCOLOR 0x990000
RESULTS = ！
;=======================================================================
;フ로어데이터
;=======================================================================
@MAKE_FLOOR_54
SELECTCASE FLAG:현M
	CASE 0
		FLAG:최대X = 30
		FLAG:최대Y = 16
		;						 000000000011111111112222222222
		;						 012345678901234567890123456789
		CALL MAKE_FLOOR_LINE, 0,"                              "
		CALL MAKE_FLOOR_LINE, 1,"     111                126   "
		CALL MAKE_FLOOR_LINE, 2,"     111                1     "
		CALL MAKE_FLOOR_LINE, 3,"     111                1     "
		CALL MAKE_FLOOR_LINE, 4,"      G                 1     "
		CALL MAKE_FLOOR_LINE, 5,"  111 1                 1 111 "
		CALL MAKE_FLOOR_LINE, 6,"  11121                 12111 "
		CALL MAKE_FLOOR_LINE, 7,"  331 1                 1 111 "
		CALL MAKE_FLOOR_LINE, 8,"      1                 1     "
		CALL MAKE_FLOOR_LINE, 9,"  111 1                 1 111 "
		CALL MAKE_FLOOR_LINE,10,"  111t1                 12111 "
		CALL MAKE_FLOOR_LINE,11,"  111 1111111111111111111 113 "
		CALL MAKE_FLOOR_LINE,12,"        2  2  111  2  2       "
		CALL MAKE_FLOOR_LINE,13,"        8  1  111  1  1       "
		CALL MAKE_FLOOR_LINE,14,"               G              "
		CALL MAKE_FLOOR_LINE,15,"               1              "
		;						 000000000011111111112222222222
		;						 012345678901234567890123456789
		;1個눈の特殊扉は번호ずらすよう
	CASE 1
		FLAG:최대X = 30
		FLAG:최대Y = 16
		;						 000000000011111111112222222222
		;						 012345678901234567890123456789
		CALL MAKE_FLOOR_LINE, 0,"                              "
		CALL MAKE_FLOOR_LINE, 1,"    621                 126   "
		CALL MAKE_FLOOR_LINE, 2,"      1                 1     "
		CALL MAKE_FLOOR_LINE, 3,"      1                 127   "
		CALL MAKE_FLOOR_LINE, 4,"      1                 1     "
		CALL MAKE_FLOOR_LINE, 5,"    821                 121   "
		CALL MAKE_FLOOR_LINE, 6,"      1                 1     "
		CALL MAKE_FLOOR_LINE, 7,"      1                 1     "
		CALL MAKE_FLOOR_LINE, 8,"    121                 121   "
		CALL MAKE_FLOOR_LINE, 9,"      1                 1     "
		CALL MAKE_FLOOR_LINE,10,"      1                 1     "
		CALL MAKE_FLOOR_LINE,11,"      1111111111111111111     "
		CALL MAKE_FLOOR_LINE,12,"        2  2  111  2  2       "
		CALL MAKE_FLOOR_LINE,13,"        1  1  113  1  1       "
		CALL MAKE_FLOOR_LINE,14,"                              "
		CALL MAKE_FLOOR_LINE,15,"                              "
		;						 000000000011111111112222222222
		;						 012345678901234567890123456789
	CASE 2
		FLAG:최대X = 30
		FLAG:최대Y = 16
		;						 000000000011111111112222222222
		;						 012345678901234567890123456789
		CALL MAKE_FLOOR_LINE, 0,"                              "
		CALL MAKE_FLOOR_LINE, 1,"    621                 126   "
		CALL MAKE_FLOOR_LINE, 2,"      1                 1     "
		CALL MAKE_FLOOR_LINE, 3,"    721                 127   "
		CALL MAKE_FLOOR_LINE, 4,"      1                 1     "
		CALL MAKE_FLOOR_LINE, 5,"    121                 121   "
		CALL MAKE_FLOOR_LINE, 6,"      1                 1     "
		CALL MAKE_FLOOR_LINE, 7,"      1 1  1       1  1 1     "
		CALL MAKE_FLOOR_LINE, 8,"    121 2  2       2  2 121   "
		CALL MAKE_FLOOR_LINE, 9,"      1111111111111111111     "
		CALL MAKE_FLOOR_LINE,10,"      1                 1     "
		CALL MAKE_FLOOR_LINE,11,"      1111111111111111111     "
		CALL MAKE_FLOOR_LINE,12,"        2  2  111  2  2       "
		CALL MAKE_FLOOR_LINE,13,"        1  1  111  4  1       "
		CALL MAKE_FLOOR_LINE,14,"                              "
		CALL MAKE_FLOOR_LINE,15,"                              "
		;						 000000000011111111112222222222
		;						 012345678901234567890123456789
	CASE 3
		FLAG:최대X = 30
		FLAG:최대Y = 16
		;						 000000000011111111112222222222
		;						 012345678901234567890123456789
		CALL MAKE_FLOOR_LINE, 0,"                              "
		CALL MAKE_FLOOR_LINE, 1,"                              "
		CALL MAKE_FLOOR_LINE, 2,"      11               11     "
		CALL MAKE_FLOOR_LINE, 3,"    7211               1127   "
		CALL MAKE_FLOOR_LINE, 4,"      1                1      "
		CALL MAKE_FLOOR_LINE, 5,"    121                1      "
		CALL MAKE_FLOOR_LINE, 6,"      1                1      "
		CALL MAKE_FLOOR_LINE, 7,"      1                1124   "
		CALL MAKE_FLOOR_LINE, 8,"    121                       "
		CALL MAKE_FLOOR_LINE, 9,"      1                       "
		CALL MAKE_FLOOR_LINE,10,"      1                       "
		CALL MAKE_FLOOR_LINE,11,"      111111111111111111      "
		CALL MAKE_FLOOR_LINE,12,"        2  2  111  2  2       "
		CALL MAKE_FLOOR_LINE,13,"        1  4  133  1  1       "
		CALL MAKE_FLOOR_LINE,14,"                              "
		CALL MAKE_FLOOR_LINE,15,"                              "
		;						 000000000011111111112222222222
		;						 012345678901234567890123456789
ENDSELECT
;=======================================================================
;タイル調整
;=======================================================================
@MAKE_FLOOR_LINE_COMMON_54, ARG, ARG:1, ARG:2
#LOCALSIZE 30
;LOCAL:3 宝箱 던전플래그:75~99
;LOCAL:4 이벤트
;LOCAL:8 メッセンジャー
;(0/0)でLOCALを소거
SIF ARG:1 == 0 && ARG:2 == 0
	VARSET LOCAL
IF ARG == 3
	IF GETBIT(던전플래그:(FLAG:현던전):(FLAG:현M+75), LOCAL:3)
		DA:(ARG:1):(ARG:2) = 1
	ELSE
		DA:(ARG:1):(ARG:2) = FLAG:현M *1000 + LOCAL:3 * 10 + 3
	ENDIF
	LOCAL:3++
ENDIF
;이벤트扉
IF ARG == 12
	DA:(ARG:1):(ARG:2) = FLAG:현M *1000 + LOCAL:2 * 10 + 2
	LOCAL:2++
ENDIF
IF ARG == 4
	DA:(ARG:1):(ARG:2) = FLAG:현M *1000 + LOCAL:4 * 10 + 4
	LOCAL:4++
	SELECTCASE DA:(ARG:1):(ARG:2) / 10
		CASE 301
			SIF STRFLAG_D("노리코") || STRFLAG_NUM_EV("세븐스의 어둠 소문", , , , [[이벤트:소문]]) < 2
				DA:(ARG:1):(ARG:2) = 1
	ENDSELECT
ENDIF
IF ARG == 6
	DA:(ARG:1):(ARG:2) = FLAG:현M *1000 + LOCAL:6 * 100 + 6
	LOCAL:6++
ENDIF
IF ARG == 7
	DA:(ARG:1):(ARG:2) = FLAG:현M *1000 + LOCAL:7 * 100 + 7
	LOCAL:7++
ENDIF
IF ARG == 8
	DA:(ARG:1):(ARG:2) = FLAG:현M *1000 + LOCAL:8 * 10 + 8
	LOCAL:8++
	SELECTCASE DA:(ARG:1):(ARG:2) / 10
	ENDSELECT
ENDIF
;=======================================================================
;タイル定義
;=======================================================================
@DEFINE_TILES_54, ARGS, ARG, ARG:1
;G 이벤트扉
SIF ARGS == "G"
	RETURN 12
SIF ARGS == "t"
	RETURN 22
;=======================================================================
;던전突入時の이벤트
;=======================================================================
@START_DUNGEON_54, ARG
FLAG:현M = 0
FLAG:현X = 15
FLAG:현Y = 13
FLAG:탈출스킬금지 = 1
PRINTFORMW ＞병원에 들어서자、진한 피냄새가 코를 자극했다…
PRINTFORML ＞주위에는 피투성이의 시체가 몇 개인가 널려있다
PRINTFORMW ＞시체는 갱단 같았고 병원 직원이나 환자는 보이지 않았다
PRINTFORML ＞%플레이어가()% 시체를 조사하고 있을 때 안쪽에서 남자들이 나타났다
PRINTFORMW ＞복장을 보니 죽은 남자들의 동료인 것 갔다
PRINTL 
PRINTL 남자:
PRINTL 「네 놈、서머너인가？」
PRINTW 　네놈이 악마같은 걸 부른 거냐?？」
PRINTW 「용서하지 않겠다！」
PRINTL 
PRINTFORML ＞%플레이어가()% 입을 열기도 전에 남자들이 덤벼들었다！
CUSTOMDRAWLINE =
WAIT
FLAG:도주불가플래그 = 1
FLAG:회화불능플래그 = 1
FLAG:선제기습취소 = 1
CALL SET_ENEMY,8,[[キャラ:판렌]], 13
CALL SET_ENEMY,9,[[キャラ:판렌]], 13
CALL SET_ENEMY,10,[[キャラ:판렌]], 13
CALL SET_ENEMY,14,[[キャラ:류우만]], 15
CALL BATTLE_START
FLAG:도주불가플래그 = 0
FLAG:회화불능플래그 = 0
FLAG:선제기습취소 = 0
;=======================================================================
;タイル進入時の이벤트
;=======================================================================
@EVENT_ENTER_DUNGEON_54,ARG
;ARG = 進入時の向き　0の場合ワープなど
SELECTCASE DA:(FLAG:현X):(FLAG:현Y) % 10
CASE 1
	SELECTCASE DA:(FLAG:현X):(FLAG:현Y) / 10
	ENDSELECT
;==========
;出입の処理　出입はない
;==========
;==========
;扉の処理
;==========
CASE 2
	CALL DUNGEON_DOOR,ARG
;宝の処理
;========
	CASE 3
		CALL TREASURE_54, DA:(FLAG:현X):(FLAG:현Y) / 10
		RETURN 1
;=======
;이벤트
;=======
	CASE 4
		CALL EVENT_54
		RETURN 1
;=======
;階段
;=======
	CASE 6
		CALL STAIR_54, 6
		RETURN 1
	CASE 7
		CALL STAIR_54, 7
		RETURN 1
;=======
;メッセンジャー
;=======
	CASE 8
		CALL MESSAGE_54
		RETURN 1
;=======
;特殊タイル
;=======
	CASE 9
ENDSELECT
@EVENT_CHECK_DUNGEON_54
SELECTCASE DA:(FLAG:현X):(FLAG:현Y) % 10
;==========
;出입の処理　出입はない
;==========
;========
;宝の処理
;========
	CASE 3
		CALL TREASURE_54, DA:(FLAG:현X):(FLAG:현Y) / 10
		RETURN 1
;=======
;이벤트
;=======
	CASE 4
		CALL EVENT_54
		RETURN 1
;=======
;階段
;=======
	CASE 6
		CALL STAIR_54, 6
		RETURN 1
	CASE 7
		CALL STAIR_54, 7
		RETURN 1
;=======
;メッセンジャー
;=======
	CASE 8
		CALL MESSAGE_54
		RETURN 1
	CASEELSE
		PRINTW 아무 것도 없는 것같다
		RETURN 0
ENDSELECT
@TREASURE_54, ARG
#LOCALSIZE 1
#LOCALSSIZE 1
;個数,-1のとき、마카・0の時、\となる
LOCAL = 1
;IDは현M*100＋X個눈の宝箱の法則でふられている
SELECTCASE DA:(FLAG:현X):(FLAG:현Y) / 10
	CASE 0
		LOCALS = 외상약
		LOCAL = 3
	CASE 1
		LOCALS = 메디컬파우더
		LOCAL = 3
	CASE 2
		LOCALS = 디스포이즌
		LOCAL = 2
	CASE 100
		LOCALS = ￥
		LOCAL = 13700
	CASE 300
		LOCALS = 우황단
		LOCAL = 2
	CASE 301
		LOCALS = ￥
		LOCAL = 12600
ENDSELECT
IF LOCALS == "￥"
	CALL GET_TREASURE_MONEY, 0, LOCAL, FLAG:현던전, FLAG:현M + 75, (DA:(FLAG:현X):(FLAG:현Y) / 10) % 100
ELSEIF LOCALS == "마카"
	CALL GET_TREASURE_MONEY, 1, LOCAL, FLAG:현던전, FLAG:현M + 75, (DA:(FLAG:현X):(FLAG:현Y) / 10) % 100
ELSEIF LOCALS == "MAG" || LOCALS == "ＭＡＧ"
	CALL GET_TREASURE_MAG, 0, LOCAL, FLAG:현던전, FLAG:현M + 75, (DA:(FLAG:현X):(FLAG:현Y) / 10) % 100
ELSEIF LOCALS == "덫"
	;LOCALS:1 종류 LOCAL 데미지量or확률 LOCALS:2 相性
	;CALL GET_TREASURE_TRAP, LOCALS:1, LOCAL, GET_TYPE_NUM(LOCALS:2), FLAG:현던전, FLAG:현M + 75, (DA:(FLAG:현X):(FLAG:현Y) / 10) % 100
ELSE
	IF GETNUM(ITEM, LOCALS) == -1
		PRINTL ＞아이템 이름이 잘못 되었습니다
		PRINTW ＞아이템 취득처리를 중단합니다
	ELSE
		CALL GET_TREASURE, GETNUM(ITEM, LOCALS), LOCAL , FLAG:현던전, FLAG:현M + 75, (DA:(FLAG:현X):(FLAG:현Y) / 10) % 100
	ENDIF
ENDIF


;=======================================================================
;階段
;=======================================================================
@STAIR_54, ARG
IF ARG == 6
	CALL DUNGEON_UPSTAIRS_ID, FLAG:현M+1, DA:(FLAG:현X):(FLAG:현Y)+1001
ELSE
	CALL DUNGEON_DOWNSTAIRS_ID, FLAG:현M-1, DA:(FLAG:현X):(FLAG:현Y)-1001
ENDIF

;=======================================================================
;이벤트
;=======================================================================
@EVENT_54
#LOCALSIZE 2
SELECTCASE DA:(FLAG:현X):(FLAG:현Y) /10
	CASE 200
		PRINTL ＞병실에는 아무도 없다
		PRINTL ＞그러나 벽에는 수상한 도면이나 숫자가 적혀 있었다
		PRINTW ＞벽에 있는 문자를 읽습니까？
		CALL INPUT_YN
		PRINTW 『마이아의 신탁』
		PRINTL 『하늘에서 반짝이는 묘성이 멈추고 시간이 움직이기 시작한다
		PRINTL 　향락의 춤 그림자들의 연회 이국의 노래
		PRINTW 　 속죄를 맞이할 불길은 하늘을 비추니…』
		PRINTL 『사자의 포효는 널리 울려 퍼지고
		PRINTL 　저승에 빛나는 다섯의 해골
		PRINTW 　천상에 빛나는 거룩한 십자가…』
		PRINTL 『하늘에 올라 별이 움직임을 멈출 때 
		PRINTL 　마이야 처녀의 고동도 멈춘다
		PRINTW 　뒤에 남은 것은 지상의 낙원 그리고 시간은 끊임없이 반복된다』
	CASE 300
		PRINTW ＞몇 구의 시체가 구르고 있는 방 안에 검을 든 백의의 남자가 있다
		PRINTL 
		PRINTL 백의의 남자:
		PRINTL 「야아、보고 있었어
		PRINTL 　나를 대신해서、빌어먹을 아버지의 부하들을 쓰러뜨리고 있었구나
		PRINTW 　일단、감사한다고 말해두지」
		PRINTL 「전파가 말해줬다
		PRINTW 　내가 사명을 완수하는 것을 도와줄 녀석이 나타난다고 말이지」
		PRINTW 「나는 스도 타츠야……ＪＯＫＥＲ다」
		PRINTL 「전파의 주문도 시끄러워서 난처하다니까？
		PRINTW 　헤에、너도 알고 있구나？」
		PRINTL 「그래… 제물같은게 있어서말이야
		PRINTL 　이렇게 산 채로 가슴을 가르는거야…
		PRINTW 　그 전에 움직일 수 없게 손발을 잘라두는 거다」
		PRINTL 「전파는 말이야、뭐든지 가르쳐 주지
		PRINTW 　그 빌어먹을 아버지가 날 이 꼴로 만들었네」
		PRINTL 「그러니 부하들은 얼마든지 양보하지만 
		PRINTL 　빌어먹을 아버지는 내 손으로 죽이지 않으면 안된다는 거다」
		PRINTW 　그렇게 될 때까지 잘 부탁한다」
		PRINTL 
		PRINTW ＞돌연、음악이 울리기 시작한다
		PRINTW ＞타츠야는 휴대전화를 꺼냈다
		PRINTL 
		PRINTL 타츠야：
		PRINTW 「쉿。전화다」
		PRINTL 「아아、알았다… 곧 죽여버려줄게
		PRINTW 　맡겨둬」
		PRINTL 
		PRINTW ＞타츠야는 전화를 던지면서 웃음을 터뜨렸다
		PRINTL 
		PRINTL 타츠야：
		PRINTL 「햐하！ 죽이는 거라니、옛날에는 좋아라 했지만、
		PRINTW 　지금은 거리의 인간이 전화를 걸어올 정도로 잘 지내고 있었는데…」
		PRINTL 「또 그렇게 바빠지려나
		PRINTL 　친아버지를 죽이러 갈 틈도、마녀를 죽이고 갈 틈도 없을 정도라니까
		PRINTW 　모두 죽이고 싶은 녀석이 있다면、스스로 죽이면 좋을텐데」
		IF STRFLAG_D("노리코保護")
			PRINTL 
			PRINTW ＞그렇게 말하고 타츠야는 노리코를 본다
			PRINTFORMW ＞노리코는 고개를 푹 숙이며 %CALLNAME:MASTER%의 팔을 꼭 붙잡았다.
			PRINTL 
			PRINTL 타츠야：
		ENDIF
		PRINTL 「내 진짜 역할은 말이지… 잘못을 바로 잡는 것이야
		PRINTW 　『이쪽 편』은 잘못이고、『저쪽 편』은 올바른거지」
		PRINTL 「빌어먹을 친아버지는 매사가 그런 식이라니까…
		PRINTW 　당신이라도 알겠지？」
		PRINTL 「그래、이제 곧 잘못은 바로잡을 수 있다
		PRINTL 　벌써 초대장을 보냈거든
		PRINTW 　빌어 처먹을 빈 과학관에서 그 녀석들과 마녀가 올 거야」
		PRINTL 「거기서 우리들은 숙적을 타도하고、지도자를 얻는다
		PRINTL 　햐하！ 이제 우리들은 무적이다！
		PRINTW 　이제 누구도 멈출 수 없다네！ 햐하하하하하！」
		PRINTL 
		PRINTW ＞돌연 문이 열리며 남자들이 우르르 몰려온다
		PRINTL 
		PRINTL 타츠야：
		PRINTL 「칫、빌어먹을 친아버지의 부하들이
		PRINTL 　사람이 친구와 즐거운 이야기 좀 하겠다는데 
		PRINTW 　훼방을 놓고 있잖아」
		PRINTL 「내장을 꺼내 엉망진창으로 해 주겠어
		PRINTL 　……라고 말하고 싶은 부분이기도 하지만、할일이 좀 있어서 
		PRINTW 　이제 가지 않으면 안되겠군」
		PRINTL 「그런 뜻에서、여기는 당신에게 맡기겠네」
		PRINTL 
		PRINTL ＞스도 타츠야는 자취를 감추었다
		PRINTW ＞그리고 남자들이 덤벼들었다…！
		PRINTL 
		FLAG:도주불가플래그 = 1
		FLAG:회화불능플래그 = 1
		FLAG:선제기습취소 = 1
		CALL SET_ENEMY,7,[[キャラ:판렌]], 16
		CALL SET_ENEMY,8,[[キャラ:판렌]], 16
		CALL SET_ENEMY,9,[[キャラ:판렌]], 16
		CALL SET_ENEMY,10,[[キャラ:판렌]], 16
		CALL SET_ENEMY,11,[[キャラ:판렌]], 16
		CALL SET_ENEMY,12,[[キャラ:류우만]], 18
		CALL SET_ENEMY,13,[[キャラ:류우만]], 18
		CALL SET_ENEMY,14,[[キャラ:류우만]], 20
		CALL SET_ENEMY,15,[[キャラ:류우만]], 18
		CALL SET_ENEMY,16,[[キャラ:류우만]], 18
		FOR LOCAL, 7, 17
			LOCAL:1 = FLAG:전투난이도 - 3 > 0 ? 300 + (FLAG:전투난이도 - 3) * 50 # 250
			CALL SET_BATTLE_STATUS(POS(LOCAL), MAXBASE:POS(LOCAL):ＨＰ * LOCAL:1 / 100, "ＨＰ")
			CALL SET_BATTLE_STATUS(POS(LOCAL), MAXBASE:POS(LOCAL):공격*3/2, "총공격")
			CALL HEALTH_CHARA, POS(LOCAL)
			SELECTCASE LOCAL
				CASE 7, 8, 9, 10, 11
					ABL:POS(LOCAL):스킬4 = [[스킬:스파이럴밤]]
					ABL:POS(LOCAL):스킬5 = [[스킬:메디컬파우더]]
				CASE 12, 13
					ABL:POS(LOCAL):스킬4 = [[스킬:코로나샷]]
					ABL:POS(LOCAL):스킬5 = [[스킬:코로나샷]]
				CASE 14
					ABL:POS(LOCAL):스킬4 = [[스킬:랜턴샷]]
					ABL:POS(LOCAL):스킬5 = [[스킬:랜턴샷]]
				CASE 15, 16
					ABL:POS(LOCAL):스킬4 = [[스킬:프로스트샷]]
					ABL:POS(LOCAL):스킬5 = [[스킬:프로스트샷]]
			ENDSELECT
		NEXT
		CALL BATTLE_START
		FLAG:도주불가플래그 = 0
		FLAG:회화불능플래그 = 0
		FLAG:선제기습취소 = 0
		FLAG:탈출 = 1
		CUSTOMDRAWLINE =
		WAIT
		PRINTFORMW >남자들을 쓰러뜨렸다
		PRINTFORMW >타겟도 없어져 버렸으므로 증원이 와서 귀찮게 되버리기 전에 
		PRINTFORMW >%조사처리(CALLNAME:MASTER,"는")% 병원을 탈출하기로 했다……
		CALLF STRFLAG_NUM_EV("罰ルート進行", "=", , 4, [[이벤트:페르소나２]])
		IF STRFLAG_D("노리코保護")
			CUSTOMDRAWLINE =
			WAIT
			PRINTW ＞무사히 카타무츠리산(蝸牛山)을 내려가 스마루시의 시가지까지 왔다
			PRINTL 
			PRINTL 노리코:
			PRINTL 「여기까지 왔으니 괜찮겠네요
			PRINTW 　감사합니다。덕분에 살았습니다…」
			PRINTL 「하지만 어째서 나같은 걸 도와주셨나요…
			PRINTW 　병원의 사람들은 구조받지 못했는데、ＪＯＫＥＲ저주를 받은 내가 구조받은 것은 이상합니다」
			PRINTL 「……역시 정말로 ＪＯＫＥＲ저주를 받은 건 저로군요
			PRINTL 　그 병원에 넣어지고、ＪＯＫＥＲ저주를 받았던 것도、사람을 죽였던 것도、
			PRINTW 　ＪＯＫＥＲ가 되어 버렸던 것도 전부 망상이나 병 때문이 아닐까 생각했지만…」
			PRINTL 「조금 전에 깨닫게 되었습니다
			PRINTW 　역시、현실이었다 라고…」
			PRINTL 「그 날 정말로 교장 선생님이 죽었는지 보러 갔더니…
			PRINTW 　그랬더니、교장 선생님이 죽어가며 아까 ＪＯＫＥＲ가 있었다며……」
			PRINTL 「그래서 말한 거에요
			PRINTL 　ＪＯＫＥＲ는 내 안에 있다라고
			PRINTW 　이번에는 내가 ＪＯＫＥＲ의 일을 도울차례니」
			PRINTW 「그리고 ＪＯＫＥＲ가 손을 뻗어와……눈치 채이면……」
			PRINTL 「나、무섭습니다。또 ＪＯＫＥＲ가 되어、이번에는 정말로 살인을 하지 않을까 라고
			PRINTW 　언제 ＪＯＫＥＲ가 될지도 모르는데、모두의 옆에서 살고 싶다고 할 수 없습니다」
			PRINTL 
			PRINTW ＞노리코는 그러면서 울기 시작해 버렸다……
			PRINTL 
			CALL INPUT_YN("격려한다", "노예가 되는 것을 추천한다")
			IF RESULT == 0
				PRINTFORML ＞%조사처리(CALLNAME:MASTER,"는")% 필레몬에게 들었던대로 、
				PRINTFORML ＞이제부터 다시 ＪＯＫＥＲ가 될지 어떨지는 
				PRINTFORMW ＞이제부터는 노리코 하기 나름이라고 격려했다
				PRINTL 
				PRINTL 노리코:
				PRINTL 「앞으로 내가 하기 나름이라……
				PRINTW 　하지만、나는 왠지……」
				PRINTL 「아니 이런 말은 안되겠네요
				PRINTL 　모처럼 서머너씨가 도와준 것이니까 
				PRINTW 　그만큼 확실히 노력하지 않으면 ……」
				PRINTL 「저기、서머너씨。나 동경하는 사람이 있습니다
				PRINTL 　그 사람은 대단히 아름답게 달릴 줄 아는 사람이었지만 교통사고로 달릴 수 없게 되어 
				PRINTW 　자포자기해、나쁜 사람들의 동료가 되고…… 모두에게 버림받으며」
				PRINTL 「그래도 나는 그 사람에게 단념하지 말고 또 노력했으면 좋겠다고 해버렸습니다…
				PRINTW 　그런니까 내가、무리라든가 단념하면 안 되요
				PRINTL 「나、노력해 보겠습니다
				PRINTL 　ＪＯＫＥＲ같은 것에 지지 않도록 
				PRINTW 　그리고 서머너씨처럼 사람을 도울 수 있는 사람이 되고 싶습니다」
				PRINTW 「나、절대 오늘 일을、서머너씨를 잊지 않겠습니다！」
				PRINTL 
				PRINTFORMW ＞노리코의 표정에 강한 결의가 보인다
				PRINTFORMW ＞%조사처리(CALLNAME:MASTER,"는")% 그런 노리코에게 이별을 고하고 사무소로 돌아갔다
				SIF STRFLAG_NUM_EV("필레몬進行", , , , [[이벤트:페르소나２]]) == 2
					CALLF STRFLAG_NUM_EV("필레몬進行", "=", , 3, [[이벤트:페르소나２]])
			ELSE
				PRINTL 노리코:
				PRINTW 「……에、노예상인이라니 정말로？」
				PRINTW 「그런… 겁니까…」
				PRINTL 「……알겠습니다。이런 나라도 좋으면 노예로 삼아주세요
				PRINTL 　서머너씨의 옆에 있을 수 있다면、언제ＪＯＫＥＲ가 되어도 안심입니다
				PRINTW 　이런 식으로 언제 ＪＯＫＥＲ가 될지 무서워하며 살 바에야 ……」
				PRINTL 
				PRINTW ＞카타야마 노리코를 손에 넣었다
				CALL ADD_NEW_COMPANION,[[キャラ:노리코]],1000
				SIF RESULT
					TALENT:(RESULT:1):약점 = 1
			ENDIF
		ENDIF
	CASE 301
		IF !STRFLAG_D("노리코")
			PRINTW ＞병실에는 소녀가 있었다……
			PRINTL 소녀:
			PRINTW 「히익…… 먹지 마세요……」
			PRINTW 「아아、미안해요。틀림없이 악마일까하고」
			PRINTW 「……아앗、당신은 칠자매학원에 왔던 서머너씨군요！？」
			PRINTL 
			PRINTL ＞그렇게 말하며 놀라는 소녀를 자세히 보자 、
			PRINTW ＞칠자매학원에서 ＪＯＫＥＲ로서 싸운 소녀였다…
			PRINTL 
			PRINTL 소녀:
			PRINTW 「희미하지만 기억합니다……」
			PRINTL 「그 때는 죄송했습니다
			PRINTW 　그리고、감사합니다」
			PRINTL 「하아 잘됐다… 적어도 감사 정도는 전하고 싶다고 생각했어요
			PRINTL 　그게 갑자기 병원에…… 하지만 어쩔 수 없다면 어쩔 수 없달까
			PRINTW 　그런 짓을 저지르고도 이런 식으로 치료받는게 고마워서…」
			PRINTL 
			PRINTW ＞소녀는 현재 자신이 처한 상황을 잊어버리고 있는 것 같지만……
			CALL INPUT_YN("소녀를 보호한다", "소녀를 납치한다")
			IF RESULT == 0
				PRINTL 소녀:
				PRINTL 「보호？ 아니、그런 폐를 끼칠 수는……
				PRINTW 　하지만 이런 상황이니까요…… 그럼 잘 부탁드립니다」
				PRINTW 「아、그래。저는 카타야마 노리코입니다。노리코라고 불러주세요い」
				PRINTW 「그럼 정말 죄송하지만 잘 부탁드립니다」
				CALLF STRFLAG_D("노리코保護", 1)
			ELSE
				PRINTL 소녀:
				PRINTW 「저기、잠깐…꺄악……!?」
				PRINTL 
				PRINTW ＞카타야마 노리코를 손에 넣었다
				CALL ADD_NEW_COMPANION,[[キャラ:노리코]],200,1
			ENDIF
			CALLF STRFLAG_D("노리코", 1)
		ELSE
				PRINTW ＞誰も居ない……
		ENDIF
ENDSELECT

;=====================
;メッセンジャー
;=====================
@TILE_MARK_COMMON_54_8, ARG, ARG:1, ARG:2
SETCOLOR 0x00ff00
RESULTS = ｍ
@MESSAGE_54
SELECTCASE DA:(FLAG:현X):(FLAG:현Y) / 10
	CASE 0
		PRINTL 숨어 있던 직원:
		PRINTL 「아… 당신들은…인…간……이군요？
		PRINTL 　도도도…도와주세요！
		PRINTW 　악마… 악마가 나타났어요！！」
		PRINTL 「…그 사람이야… 그 사람이 악마를……
		PRINTL 　３０３호실의 환자가…
		PRINTW 　스도 타츠야가 악마를 불러왔어요！」
		PRINTL 「악마가 환자나 동료들을 습격해서…
		PRINTW 　그 이후 무장한 남자들이 와서 싸움을 시작했지만…」
	CASE 100
		PRINTL 숨어 있던 직원:
		PRINTL 「……아、당신은？ 서머너인가？
		PRINTW 　타츠조님이 도와주러 보낸 건가？
		PRINTL 「에？ 틀려？ 그런……
		PRINTW 　무장한 놈들도 타츠조님의 부하가 아닌가…？」
		PRINTL 「그런 엿같은！ 우리들은 그 놈의 일을 도와왔다！
		PRINTW 　돈이 아니라、이런 때 우리를 도울 의무가 있다고！？」
ENDSELECT
;=======================================================================
;인카운트율
;=======================================================================
@ENCOUNT_RATE_54
IF FLAG:미조우걸음수 <= 5
	FLAG:인카운트율 = 0
ELSE
	FLAG:인카운트율 = 10 + (FLAG:미조우걸음수-5) * 5
ENDIF
;=======================================================================
;필요레벨눈安
;권장LV 雑魚최저LV 雑魚最高LV ボスLV 
;=======================================================================
@GET_DUNGEON_LV_54
RETURN 11, 8, 12, 12
;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_54
IF RAND:100 < FLAG:인카운트율
	CALL ENEMY_TABLE
	RETURN 1
ELSE
	FLAG:미조우걸음수 += 1
	RETURN 0
ENDIF
;=======================================================================
;적の종족の종류数
;=======================================================================
@CLASS_NUM_54
;天道連がどうかの判別
던전플래그:(FLAG:현던전):1 = RAND:2
IF 던전플래그:(FLAG:현던전):1
	RETURN CLASS_NUM_COMMON("初級")
ELSE
	RETURN RAND(1, 3)
ENDIF
;=======================================================================
;적の総数
;ARGは出現する적の종류です
;=======================================================================
@ENEMY_NUM_54, ARG
IF 던전플래그:(FLAG:현던전):1
	RETURN ENEMY_NUM_COMMON("初級", ARG)
ELSE
	RETURN RAND(2 + ARG*2, 3 + ARG * 4)
ENDIF
;=======================================================================
;적の종류
;=======================================================================
@ENEMY_54, ARG
IF 던전플래그:(FLAG:현던전):1
	SELECTCASE RAND:100
		CASE IS < 20
			RETURN [[キャラ:파리카]], 14
		CASE IS < 40
			RETURN [[キャラ:요모츠시코메]], 14
		CASE IS < 60
			;20%で픽시
			RETURN [[キャラ:네코마타]], 12
		CASE IS < 75
			;15%で좀비쨩
			RETURN [[キャラ:잭프로스트]], 15
		CASE IS < 90
			;15%で좀비군
			RETURN [[キャラ:츠치구모]], 15
		CASEELSE
			RETURN [[キャラ:가기손]], 12
	ENDSELECT
ELSE
	IF RAND:2
		RETURN [[キャラ:판렌]], 13
	ELSE
		RETURN [[キャラ:류우만]], 15
	ENDIF
ENDIF
;=================================
;特殊調整
;=================================
@SET_ENEMY_STATUS_54, ARG
SIF GROUPMATCH(NO:ARG, [[キャラ:류우만]], [[キャラ:판렌]])
	CALL SET_BATTLE_STATUS(ARG, MAXBASE:ARG:공격*3/2, "총공격")


;=======================================================================
;윤간참가악마
;=======================================================================
@DUNGEON_RAPE_DEVIL_54
;랜덤にどの악마が出るか決定
;RETURN CSV번호 , 人数 , 레벨
IF 던전플래그:(FLAG:현던전):1
	IF RAND:2
		RETURN [[キャラ:류우만]] , 3 + RAND:10 , CSVBASE([[キャラ:류우만]] , GETNUM(BASE , "LV") , 0) + RAND:3
	ELSE
		RETURN [[キャラ:판렌]] , 3 + RAND:10 , CSVBASE([[キャラ:판렌]] , GETNUM(BASE , "LV") , 0) + RAND:3
	ENDIF
ELSE
	SELECTCASE RAND:2
		CASE 0
			RETURN [[キャラ:츠치구모]] , 3 + RAND:10 , CSVBASE([[キャラ:츠치구모]] , GETNUM(BASE , "LV") , 0) + RAND:3
		CASE 1
			RETURN [[キャラ:가기손]] , 3 + RAND:10 , CSVBASE([[キャラ:가기손]] , GETNUM(BASE , "LV") , 0) + RAND:3
	ENDSELECT
ENDIF
