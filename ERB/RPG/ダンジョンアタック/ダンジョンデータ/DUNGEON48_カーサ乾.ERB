
;=======================================================================
;카사이누이
;
;던전플래그:48:0 = 1.ボス
;던전플래그:48:1 = 1.初回
;던전플래그:48:10-13 = 1.宝箱

;던전ナンバー48
;=======================================================================

;=======================================================================
;攻略조건
;=======================================================================
@PREREQUISITE_DUNGEON_48
SIF 의뢰플래그:5:0 >= 1 && !던전플래그:48:0
	RETURN 1
RETURN 0

;=======================================================================
;던전名
;=======================================================================
@GET_DUNGEON_NAME_48
RESULTS = 카사이누이


;=======================================================================
;플로어名표시
;=======================================================================
@FLOORNAME_48
PRINT 카사이누이
SELECTCASE FLAG:현M
	CASE 0
		PRINTL   １Ｆ
	CASE 1
		PRINTL   ２Ｆ
	CASE 2
		PRINTL   ３Ｆ
	CASE 3
		PRINTL   ４Ｆ
	CASEELSE
		PRINTL
ENDSELECT


;=======================================================================
;特殊タイル표시
;=======================================================================
@TILE_MARK_48_0_8_5
RESULTS = Ｅ
@TILE_MARK_48_1_8_5
RESULTS = Ｅ
@TILE_MARK_48_2_8_7
RESULTS = Ｅ
@TILE_MARK_48_2_8_9
RESULTS = Ｅ
@TILE_MARK_48_3_8_7
RESULTS = Ｅ
@TILE_MARK_48_3_8_9
RESULTS = Ｅ
@TILE_MARK_48_4_1_8
RESULTS = Ｅ

;=======================================================================
;스타ト地点입력
;=======================================================================
@START_DUNGEON_48,ARG
FLAG:현M = 0
FLAG:현X = 2
FLAG:현Y = 4
;CALL AUTOMAP

;=======================================================================
;스타ト時이벤트
;=======================================================================
@EVENT_DUNGEON_START_48
IF 던전플래그:48:1 == 0
	CUSTOMDRAWLINE =
	PRINTFORMW 당신은 이계화한 맨션, 카사 이누이의 조사 의뢰를 받았다
	PRINTFORMW 주민의 피해가 나오기 전에 원인을 시급하게 규명해 맨션을 되돌려놔야 한다
	던전플래그:48:1 = 1
ENDIF

;=======================================================================
;指定したマスに進入가능か
;=======================================================================
@CAN_ENTER_48,ARG,ARG:1
CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT
;=======================================================================
;플로어데이터
;=======================================================================
@MAKE_FLOOR_48
SELECTCASE FLAG:현M
	CASE 0
	;１階
		FLAG:최대X = 12
		FLAG:최대Y = 12 
							    ;012345678901
		CALL MAKE_FLOOR_LINE, 0,"            "
		CALL MAKE_FLOOR_LINE, 1," 6211111111 "
		CALL MAKE_FLOOR_LINE, 2,"          1 "
		CALL MAKE_FLOOR_LINE, 3,"          1 "
		CALL MAKE_FLOOR_LINE, 4,"8211211   1 "
		CALL MAKE_FLOOR_LINE, 5,"     1129 1 "
		CALL MAKE_FLOOR_LINE, 6,"          1 "
		CALL MAKE_FLOOR_LINE, 7,"     11   1 "
		CALL MAKE_FLOOR_LINE, 8," 111  2   1 "
		CALL MAKE_FLOOR_LINE, 9," 2 11111111 "
		CALL MAKE_FLOOR_LINE,10," 6          "
		CALL MAKE_FLOOR_LINE,11,"            "
							    ;012348678901

		;宝箱の設置
		CALL SET_TILE,5,7,던전플래그:48:10,0,3
		;
		CALL SET_TILE,6,4,던전플래그:48:0,0,4

	CASE 1
	;２階
		FLAG:최대X = 12
		FLAG:최대Y = 12 
							    ;012348678901
		CALL MAKE_FLOOR_LINE, 0,"            "
		CALL MAKE_FLOOR_LINE, 1," 721111 621 "
		CALL MAKE_FLOOR_LINE, 2,"   1  1   1 "
		CALL MAKE_FLOOR_LINE, 3," 111  11111 "
		CALL MAKE_FLOOR_LINE, 4,"  11 1      "
		CALL MAKE_FLOOR_LINE, 5,"   1 1129 1 "
		CALL MAKE_FLOOR_LINE, 6,"          1 "
		CALL MAKE_FLOOR_LINE, 7," 111   11 1 "
		CALL MAKE_FLOOR_LINE, 8," 1 111 2  1 "
		CALL MAKE_FLOOR_LINE, 9," 2 2 111111 "
		CALL MAKE_FLOOR_LINE,10," 7 6        "
		CALL MAKE_FLOOR_LINE,11,"            "
							    ;012348678901

		;宝箱の設置
		CALL SET_TILE,5,4,던전플래그:48:11,0,3
		CALL SET_TILE,8,7,던전플래그:48:12,0,3

	CASE 2
	;３階
		FLAG:최대X = 12
		FLAG:최대Y = 13 
							    ;012348678901
		CALL MAKE_FLOOR_LINE, 0,"            "
		CALL MAKE_FLOOR_LINE, 1," 1 1211 721 "
		CALL MAKE_FLOOR_LINE, 2," 1 1  1   1 "
		CALL MAKE_FLOOR_LINE, 3," 1 1  1 621 "
		CALL MAKE_FLOOR_LINE, 4," 121  1   1 "
		CALL MAKE_FLOOR_LINE, 5,"   15 11111 "
		CALL MAKE_FLOOR_LINE, 6,"   11     1 "
		CALL MAKE_FLOOR_LINE, 7," 1 511129 1 "
		CALL MAKE_FLOOR_LINE, 8," 2        1 "
		CALL MAKE_FLOOR_LINE, 9," 11111129 1 "
		CALL MAKE_FLOOR_LINE,10,"   2      1 "
		CALL MAKE_FLOOR_LINE,11,"   7 111111 "
		CALL MAKE_FLOOR_LINE,12,"            "
							    ;012348678901

	CASE 3
	;４階
		FLAG:최대X = 12
		FLAG:최대Y = 15 
							    ;012348678901
		CALL MAKE_FLOOR_LINE, 0,"            "
		CALL MAKE_FLOOR_LINE, 1," 515 111111 "
		CALL MAKE_FLOOR_LINE, 2," 1 1 11   1 "
		CALL MAKE_FLOOR_LINE, 3," 5 5 11 7 1 "
		CALL MAKE_FLOOR_LINE, 4," 1 1 1  2 1 "
		CALL MAKE_FLOOR_LINE, 5," 5   2  1 1 "
		CALL MAKE_FLOOR_LINE, 6," 121 11   1 "
		CALL MAKE_FLOOR_LINE, 7,"   1 1129 1 "
		CALL MAKE_FLOOR_LINE, 8," 121      1 "
		CALL MAKE_FLOOR_LINE, 9," 1 111129 1 "
		CALL MAKE_FLOOR_LINE,10," 1          "
		CALL MAKE_FLOOR_LINE,11," 11       1 "
		CALL MAKE_FLOOR_LINE,12," 111      2 "
		CALL MAKE_FLOOR_LINE,13," 1111111111 "
		CALL MAKE_FLOOR_LINE,14,"            "
							    ;012348678901

		;宝箱の設置
		CALL SET_TILE,3,4,던전플래그:48:13,0,3
		;
		CALL SET_TILE,10,11,던전플래그:48:0,0,4

	CASEELSE

ENDSELECT



;=======================================================================
;[5]조사　実行時の이벤트
;=======================================================================
@EVENT_CHECK_DUNGEON_48

;==========
;出口の処理
;==========
IF DA:(FLAG:현X):(FLAG:현Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 3
	CALL TRESURING_CALLING_48
	RETURN 1
;==========
;이벤트の処理
;==========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 4
	CALL EVENTING_CALLING_48
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 6
SELECTCASE FLAG:현M
	CASE 0
		SIF FLAG:현X == 1 && FLAG:현Y == 1
			CALL DUNGEON_UPSTAIRS,1,3,1
		SIF FLAG:현X == 1 && FLAG:현Y == 10
			CALL DUNGEON_UPSTAIRS,1,1,8
	CASE 1
		SIF FLAG:현X == 8 && FLAG:현Y == 1
			CALL DUNGEON_UPSTAIRS,2,10,1
		SIF FLAG:현X == 3 && FLAG:현Y == 10
			CALL DUNGEON_UPSTAIRS,2,3,9
	CASE 2
		SIF FLAG:현X == 8 && FLAG:현Y == 3
			CALL DUNGEON_UPSTAIRS,3,8,5
	CASEELSE
ENDSELECT

RETURN 1

ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 7
	SELECTCASE FLAG:현M
		CASE 1
			SIF FLAG:현X == 1 && FLAG:현Y == 1
				CALL DUNGEON_DOWNSTAIRS,0,3,1
			SIF FLAG:현X == 1 && FLAG:현Y == 10
				CALL DUNGEON_DOWNSTAIRS,0,1,8
		CASE 2
			SIF FLAG:현X == 8 && FLAG:현Y == 1
				CALL DUNGEON_DOWNSTAIRS,1,10,1
			SIF FLAG:현X == 3 && FLAG:현Y == 11
				CALL DUNGEON_DOWNSTAIRS,1,3,8
		CASE 3
			SIF FLAG:현X == 8 && FLAG:현Y == 3
				CALL DUNGEON_DOWNSTAIRS,2,10,3
		CASEELSE
	ENDSELECT
	RETURN 1


;==========
;ターミナル
;==========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 9
	SELECTCASE FLAG:현M
		CASE 0
			SIF FLAG:현X == 8 && FLAG:현Y == 5
				CALL E_INUI_01
		CASE 1
			SIF FLAG:현X == 8 && FLAG:현Y == 5
				CALL E_INUI_01
		CASE 2
			SIF FLAG:현X == 8 && FLAG:현Y == 7
				CALL E_INUI_01
			SIF FLAG:현X == 8 && FLAG:현Y == 9
				CALL E_INUI_02
		CASE 3
			SIF FLAG:현X == 8 && FLAG:현Y == 7
				CALL E_INUI_01
			SIF FLAG:현X == 8 && FLAG:현Y == 9
				CALL E_INUI_02
		CASEELSE
	ENDSELECT
	RETURN 1
ELSE
	PRINTW 아무것도 없는 것 같다
	RETURN 0
ENDIF

;=======================================================================
;タイル進入時の이벤트
;=======================================================================
@EVENT_ENTER_DUNGEON_48,ARG
;ARG = 進入時の向き　0の場合ワープなど
;==========
;出口の処理
;==========
IF DA:(FLAG:현X):(FLAG:현Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 3
	CALL TRESURING_CALLING_48
	RETURN 1
;========
;罠の処理
;========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 5
	CALL TRAP_48
	RETURN RESULT
;==========
;이벤트の処理
;==========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 4
	CALL EVENTING_CALLING_48
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 6
SELECTCASE FLAG:현M
	CASE 0
		SIF FLAG:현X == 1 && FLAG:현Y == 1
			CALL DUNGEON_UPSTAIRS,1,3,1
		SIF FLAG:현X == 1 && FLAG:현Y == 10
			CALL DUNGEON_UPSTAIRS,1,1,8
	CASE 1
		SIF FLAG:현X == 8 && FLAG:현Y == 1
			CALL DUNGEON_UPSTAIRS,2,10,1
		SIF FLAG:현X == 3 && FLAG:현Y == 10
			CALL DUNGEON_UPSTAIRS,2,3,9
	CASE 2
		SIF FLAG:현X == 8 && FLAG:현Y == 3
			CALL DUNGEON_UPSTAIRS,3,8,5
	CASEELSE
ENDSELECT

RETURN 1

ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 7
	SELECTCASE FLAG:현M
		CASE 1
			SIF FLAG:현X == 1 && FLAG:현Y == 1
				CALL DUNGEON_DOWNSTAIRS,0,3,1
			SIF FLAG:현X == 1 && FLAG:현Y == 10
				CALL DUNGEON_DOWNSTAIRS,0,1,8
		CASE 2
			SIF FLAG:현X == 8 && FLAG:현Y == 1
				CALL DUNGEON_DOWNSTAIRS,1,10,1
			SIF FLAG:현X == 3 && FLAG:현Y == 11
				CALL DUNGEON_DOWNSTAIRS,1,3,8
		CASE 3
			SIF FLAG:현X == 8 && FLAG:현Y == 3
				CALL DUNGEON_DOWNSTAIRS,2,10,3
		CASEELSE
	ENDSELECT
	RETURN 1

;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 2
	IF FLAG:현M == 3 && FLAG:현X == 10 && FLAG:현Y == 12 && 던전플래그:48:0 == 0
		PRINTW 문 너머에서 사기(邪気)가 느껴진다
		PRINTL 문을 열겠는가?
		PRINTL 
		CALL INPUT_YN
		IF RESULT == 0
			CALL DUNGEON_DOOR,ARG
		ELSEIF RESULT == 1
			FLAG:현Y = 13
		ENDIF
	ELSE
		CALL DUNGEON_DOOR,ARG
	ENDIF
	RETURN 1
	
;==========
;ターミナル
;==========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 9
	SELECTCASE FLAG:현M
		CASE 0
			SIF FLAG:현X == 8 && FLAG:현Y == 5
				CALL E_INUI_01
		CASE 1
			SIF FLAG:현X == 8 && FLAG:현Y == 5
				CALL E_INUI_01
		CASE 2
			SIF FLAG:현X == 8 && FLAG:현Y == 7
				CALL E_INUI_01
			SIF FLAG:현X == 8 && FLAG:현Y == 9
				CALL E_INUI_02
		CASE 3
			SIF FLAG:현X == 8 && FLAG:현Y == 7
				CALL E_INUI_01
			SIF FLAG:현X == 8 && FLAG:현Y == 9
				CALL E_INUI_02
		CASEELSE
	ENDSELECT
	RETURN 1
ENDIF
RETURN 0
;=======================================================================
;필요레벨눈安
;권장LV 雑魚최저LV 雑魚最高LV ボスLV 
;=======================================================================
@GET_DUNGEON_LV_48
RETURN 25, 22, 27, 25

;=======================================================================
;인카운트율
;=======================================================================
@ENCOUNT_RATE_48
;FLAG:인카운트율 = 0
IF FLAG:현M < 3
	FLAG:인카운트율 = FLAG:미조우걸음수*5 + 5
ELSEIF FLAG:현M == 3
	FLAG:인카운트율 = FLAG:미조우걸음수*5 + 10
ENDIF

;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_48
IF RAND:100 < FLAG:인카운트율
	CALL ENEMY_TABLE
	RETURN 1
ELSE
	FLAG:미조우걸음수 += 1
	RETURN 0
ENDIF
;=======================================================================
;적の종족の종류数
;=======================================================================
@CLASS_NUM_48
RETURN CLASS_NUM_COMMON("中級")
;=======================================================================
;적の総数
;ARGは出現する적の종류です
;=======================================================================
@ENEMY_NUM_48, ARG
RETURN ENEMY_NUM_COMMON("中級", ARG)
;=======================================================================
;적の종류
;=======================================================================
@ENEMY_48, ARG
SELECTCASE FLAG:현M
	CASE 0
	;一階
		SELECTCASE RAND:100
			CASE IS < 20
				;20％　요마코파텐구Lv19（22）
				RETURN [[キャラ:코파텐구]], 22
			CASE IS < 35
				;15%　요귀오니　Lv20（23）
				RETURN [[キャラ:오니]], 23
			CASE IS < 50
				;15%　용왕노즈치　Lv19（22）
				RETURN [[キャラ:노즈치]], 22
			CASE IS < 65
				;15%　요귀유키죠로　Lv21（24）
				RETURN [[キャラ:유키죠로]], 24
			CASE IS < 80
				;15%　마수블랙위도우　Lv23
				RETURN [[キャラ:블랙위도우]], 23
			CASE IS < 90
				;10%　외도굴라　Lv22
				RETURN [[キャラ:굴라]], 22
			CASE IS < 100
				;10%　요정엘프　Lv23
				RETURN [[キャラ:엘프]], 23
		ENDSELECT
	CASE 1
	;二階
		SELECTCASE RAND:100
			CASE IS < 20
				;20％　요마코파텐구Lv19（22）
				RETURN [[キャラ:코파텐구]], 22
			CASE IS < 35
				;15%　요귀오니　Lv20（23）
				RETURN [[キャラ:오니]], 23
			CASE IS < 50
				;15%　용왕노즈치　Lv19（22）
				RETURN [[キャラ:노즈치]], 22
			CASE IS < 65
				;15%　요귀유키죠로　Lv21（24）
				RETURN [[キャラ:유키죠로]], 24
			CASE IS < 80
				;15%　마수블랙위도우　Lv23
				RETURN [[キャラ:블랙위도우]], 23
			CASE IS < 90
				;10%　외도굴라　Lv22
				RETURN [[キャラ:굴라]], 22
			CASE IS < 100
				;10%　요정엘프　Lv23
				RETURN [[キャラ:엘프]], 23
		ENDSELECT
	CASE 2
	;三階
		SELECTCASE RAND:100
			CASE IS < 15
				;15％　요마이소라Lv23
				RETURN [[キャラ:이소라]], 23
			CASE IS < 35
				;20%　요귀모무노후　Lv25
				RETURN [[キャラ:모무노후]], 25
			CASE IS < 50
				;15%　마수오르트로스　Lv23
				RETURN [[キャラ:오르트로스]], 23
			CASE IS < 70
				;20%　요귀한냐　Lv25
				RETURN [[キャラ:한냐]], 25
			CASE IS < 85
				;15%　요조켈라이노　Lv25
				RETURN [[キャラ:켈라이노]], 25
			CASE IS < 100
				;15%　요정엘프　Lv23
				RETURN [[キャラ:엘프]], 23
		ENDSELECT
	CASE 3
	;四階
		SELECTCASE RAND:100
			CASE IS < 15
				;15％　요마이소라Lv23（26）
				RETURN [[キャラ:이소라]], 26
			CASE IS < 35
				;20%　요귀모무노후　Lv25
				RETURN [[キャラ:모무노후]], 25
			CASE IS < 50
				;15%　마수오르트로스　Lv23
				RETURN [[キャラ:오르트로스]], 23
			CASE IS < 70
				;20%　요귀한냐　Lv25
				RETURN [[キャラ:한냐]], 25
			CASE IS < 85
				;15%　요조켈라이노　Lv25
				RETURN [[キャラ:켈라이노]], 25
			CASE IS < 100
				;15%　요정밴시　Lv27
				RETURN [[キャラ:밴시]], 27
		ENDSELECT
ENDSELECT

;=======================================================================
;이벤트まとめ
;=======================================================================
@EVENTING_CALLING_48
SELECTCASE FLAG:현M
	CASE 0
		IF FLAG:현X == 6 && FLAG:현Y == 4 && 던전플래그:48:0 == 0
			PRINTFORML ＞맨션 거주자의 유령이 있다
			PRINTFORMW 「여기는 옛날, 군인들이 많이 자살한 장소였다고 들었어요」
			PRINTFORMW 「유령이라도 나올까봐 무섭네요」
		ENDIF
	CASE 3
		IF FLAG:현X == 10 && FLAG:현Y == 11 && 던전플래그:48:0 == 0
			CUSTOMDRAWLINE =
			PRINTW 이계화한 맨션, 카사 이누이의 한 방
			PRINTW 문 너머에는 구 일본군의 교복을 입은 망령들이 정렬해 있었다
			PRINTW 
			PRINTW 「……우리 영역에 진입하는 것은 누구냐?」
			PRINTW 「우리의 잠을 방해하는 괘씸한 인간 용서하지 않겠다」
			PRINTW 「……이누이 소대, 돌격!」
			PRINTL 
			PRINTL 원령 부대병이 ４체 나타났다！
			PRINTL 원령 이누이가 １체 나타났다！
			PRINTW 
			CUSTOMDRAWLINE =
			WAIT
			FLAG:도주불가플래그 = 1
			FLAG:회화불능플래그 = 1
			FLAG:선제기습취소 = 1
			IF FLAG:전투난이도 >= 3 || FLAG:주회횟수 >= 1 || BASE:MASTER:LV >= 30
				;부대병Lv21
				CALL SET_ENEMY,8,1088,30,0,1
				CSTR:(CHARANUM-1):사고패턴 = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)
				;부대병
				CALL SET_ENEMY,9,1088,30,0,1
				CSTR:(CHARANUM-1):사고패턴 = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)
				;부대병
				CALL SET_ENEMY,10,1088,30,0,1
				CSTR:(CHARANUM-1):사고패턴 = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)
				;부대병
				CALL SET_ENEMY,13,1088,30,0,1
				CSTR:(CHARANUM-1):사고패턴 = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)
				;이누이Lv25
				CALL SET_ENEMY,14,1089,34,0,1
				CFLAG:(CHARANUM-1):ＨＰ보정 += 500
				CFLAG:(CHARANUM-1):ＭＰ보정 += 5000
				CFLAG:(CHARANUM-1):속도보정 += 10
				CALL SYNC_STATUS,(CHARANUM-1)
				CALL HEALTH_CHARA,(CHARANUM-1)
			ELSE
				;부대병
				CALL SET_ENEMY,8,1088,21,0,1
				CSTR:(CHARANUM-1):사고패턴 = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)
				;부대병
				CALL SET_ENEMY,9,1088,21,0,1
				CSTR:(CHARANUM-1):사고패턴 = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)
				;부대병
				CALL SET_ENEMY,10,1088,21,0,1
				CSTR:(CHARANUM-1):사고패턴 = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)
				;부대병
				CALL SET_ENEMY,13,1088,21,0,1
				CSTR:(CHARANUM-1):사고패턴 = 1088
				CALL SYNC_STATUS, (CHARANUM-1)
				CALL HEALTH_CHARA, (CHARANUM-1)

				;이누이
				CALL SET_ENEMY,14,1089,25,0,1
				CFLAG:(CHARANUM-1):ＭＰ보정 += 500
				CFLAG:(CHARANUM-1):ＭＰ보정 += 5000
				CFLAG:(CHARANUM-1):속도보정 += 10
				CALL SYNC_STATUS,(CHARANUM-1)
				CALL HEALTH_CHARA,(CHARANUM-1)
			ENDIF
			CALL BATTLE_START
			FLAG:도주불가플래그 = 0
			FLAG:회화불능플래그 = 0
			FLAG:선제기습취소 = 0
			CUSTOMDRAWLINE =
			PRINTL
			PRINTW 「……원통한 마음을 품고 자결한 우리는 그저 조용히 잠들고 싶었을 뿐……」
			PRINTW 「그런데 불과 반세기 뒤에 이런 돈벌이를 위한 건물이 이곳에 지어질 줄이야……」
			PRINTW 「그 분노와 함께, 이 땅에 넘쳐나온 힘이 우리를 원령이나 다름없게 만들었던 것이다……」 
			PRINTW
			PRINTW 원령 이누이들은 사라져갔다…
			PRINTL 
			PRINTL 이계화된 카사 이누이는 원래대로 돌아갔다
			PRINTW 보수로 계좌에 ￥50000이 지불되었다
			CUSTOMDRAWLINE =
			MONEY += 50000
			던전플래그:48:0 = 1
			DA:(FLAG:현X):(FLAG:현Y) = 1
			CALL LIFTING_A_BAN([[キャラ:부대병]])
			CALL LIFTING_A_BAN([[キャラ:이누이]])
			;FLAG:(10000+[[キャラ:부대병]]) = 1
			;FLAG:(10000+[[キャラ:이누이]]) = 1
			FLAG:탈출 = 1
			RETURN 1
		ENDIF
	CASEELSE
	ENDSELECT
	RETURN 1
RETURN 0
;=======================================================================
;宝箱まとめ
;=======================================================================
@TRESURING_CALLING_48
	SELECTCASE FLAG:현M
		CASE 0
			;마석
			CALL GET_TREASURE,1002,2,48,10
		CASE 1
			SIF FLAG:현X == 5 && FLAG:현Y == 4
				;네이팜탄
				CALL GET_TREASURE,1102,2,48,11
			SIF FLAG:현X == 8 && FLAG:현Y == 7
				;법승
				CALL GET_TREASURE,2090,1,48,12
		CASE 3
			;복수의토시
			CALL GET_TREASURE,4008,1,48,13
	ENDSELECT
RETURN 0

;========
;罠置き場
;========
@TRAP_48
SELECTCASE FLAG:현M
	CASE 2
		IF RAND:3 == 0
			CALL DUNGEON_TRAP_POISON,40
		ELSEIF RAND:2 == 0
			CALL DUNGEON_TRAP_HP,10
		ELSE
			CALL DUNGEON_TRAP_MP,10
		ENDIF
	CASE 3
		IF RAND:3 == 0
			CALL DUNGEON_TRAP_POISON,40
		ELSEIF RAND:2 == 0
			CALL DUNGEON_TRAP_HP,10
		ELSE
			CALL DUNGEON_TRAP_MP,10
		ENDIF
ENDSELECT
RETURN 0


@E_INUI_01
PRINTL 이곳은 엘리베이터다.
PRINTW -가고 싶은 층의 버튼을 눌러 주세요-
PRINTL [1]１Ｆ
PRINTL [2]２Ｆ
PRINTL [3]３Ｆ
PRINTL [4]４Ｆ
PRINTL [99] 취소
$INPUT_LOOP_INUI_01
INPUT
IF RESULT == 99
	RETURN 1
ELSEIF RESULT == 1
	IF FLAG:현M == 0
		RETURN 1
	ELSE
		FLAG:현M = 0
		FLAG:현X = 6
		FLAG:현Y = 5
	ENDIF
ELSEIF RESULT == 2
	IF FLAG:현M == 1
		RETURN 1
	ELSE
		FLAG:현M = 1
		FLAG:현X = 6
		FLAG:현Y = 5
	ENDIF
ELSEIF RESULT == 3
	IF FLAG:현M == 2
		RETURN 1
	ELSE
		FLAG:현M = 2
		FLAG:현X = 6
		FLAG:현Y = 7
	ENDIF
ELSEIF RESULT == 4
	IF FLAG:현M == 3
		RETURN 1
	ELSE
		FLAG:현M = 3
		FLAG:현X = 6
		FLAG:현Y = 7
	ENDIF
ELSE
	GOTO INPUT_LOOP_INUI_01
ENDIF

CALL MAKE_FLOOR, FLAG:현던전
CALL AUTOMAP

@E_INUI_02
PRINTL 이곳은 엘리베이터다.
PRINTW -가고 싶은 층의 버튼을 눌러 주세요-
PRINTL [3]３Ｆ
PRINTL [4]４Ｆ
PRINTL [99] 취소
$INPUT_LOOP_INUI_02
INPUT
IF RESULT == 99
	RETURN 1
ELSEIF RESULT == 3
	IF FLAG:현M == 2
		RETURN 1
	ELSE
		FLAG:현M = 2
		FLAG:현X = 6
		FLAG:현Y = 9
	ENDIF
ELSEIF RESULT == 4
	IF FLAG:현M == 3
		RETURN 1
	ELSE
		FLAG:현M = 3
		FLAG:현X = 6
		FLAG:현Y = 9
	ENDIF
ELSE
	GOTO INPUT_LOOP_INUI_02
ENDIF

CALL MAKE_FLOOR, FLAG:현던전
CALL AUTOMAP



@SET_ACTION_1088,ARG
IF CFLAG:MASTER:공격강화 >= 8 || CFLAG:MASTER:명중강화 >= 8 || CFLAG:MASTER:방어강화 >= 8 || CFLAG:MASTER:명중강화 >= 8
	IF RAND:2 == 0
		;자폭
		CALL CHECK_ACTIONABLE,ARG,2005
			SIF RESULT == 0
				GOTO DECIDE_ACTION
		CFLAG:ARG:입력행동 = 2005
		CALL RANDOM_TARGET,ARG,2005
		RETURN 1
	ELSE
		CALL CHECK_ACTIONABLE,ARG,113
		SIF RESULT == 0
			GOTO DECIDE_ACTION
		CFLAG:ARG:입력행동 = 113
		CALL RANDOM_TARGET,ARG,113
		RETURN 1
	ENDIF
	
ELSEIF 현HP비율(ARG) < 50
	SELECTCASE RAND:100
		CASE IS < 10
			;자폭
			CALL CHECK_ACTIONABLE,ARG,2005
				SIF RESULT == 0
					GOTO DECIDE_ACTION
			CFLAG:ARG:입력행동 = 2005
			CALL RANDOM_TARGET,ARG,2005
			RETURN 1
		CASE IS < 30
			CALL CHECK_ACTIONABLE,ARG,111
			SIF RESULT == 0
				GOTO DECIDE_ACTION
			CFLAG:ARG:입력행동 = 111
			CALL RANDOM_TARGET,ARG,111
			RETURN 1
		CASE IS < 65
			CALL CHECK_ACTIONABLE,ARG,112
			SIF RESULT == 0
				GOTO DECIDE_ACTION
			CFLAG:ARG:입력행동 = 112
			CALL RANDOM_TARGET,ARG,112
			RETURN 1
		CASE IS < 100
			CALL CHECK_ACTIONABLE,ARG,113
			SIF RESULT == 0
				GOTO DECIDE_ACTION
			CFLAG:ARG:입력행동 = 113
			CALL RANDOM_TARGET,ARG,113
			RETURN 1
	ENDSELECT

ELSEIF 현HP비율(ARG) >= 50
	SELECTCASE RAND:100
		;
		CASE IS < 35
			CALL CHECK_ACTIONABLE,ARG,111
			SIF RESULT == 0
				GOTO DECIDE_ACTION
			CFLAG:ARG:입력행동 = 111
			CALL RANDOM_TARGET,ARG,111
			RETURN 1
		;
		CASE IS < 70
			CALL CHECK_ACTIONABLE,ARG,112
			SIF RESULT == 0
				GOTO DECIDE_ACTION
			CFLAG:ARG:입력행동 = 112
			CALL RANDOM_TARGET,ARG,112
			RETURN 1
		CASE IS < 100
			CALL CHECK_ACTIONABLE,ARG,113
			SIF RESULT == 0
				GOTO DECIDE_ACTION
			CFLAG:ARG:입력행동 = 113
			CALL RANDOM_TARGET,ARG,113
			RETURN 1
	ENDSELECT
ELSE
	$DECIDE_ACTION
	CALL SEARCH_ACT,ARG
	IF RESULT == 0
		CFLAG:ARG:입력행동 = -1
		CFLAG:ARG:방어플래그 = 1
		RETURN 0
	ENDIF
	LOCAL = RAND:RESULT
	;스킬번호決定
	LOCAL:1 = S:(10+LOCAL)
	$TARGET_LOOP
	
	CALL RANDOM_TARGET,ARG,LOCAL:1
	CALLFORM SKILL_TARGET_{LOCAL:1}
	;ここで스킬번호を行動内容に代入
	SIF CFLAG:ARG:타겟 == -1
		GOTO DECIDE_ACTION
	CFLAG:ARG:입력행동 = LOCAL:1
ENDIF


;=======================================================================
;윤간참가악마
;=======================================================================
@DUNGEON_RAPE_DEVIL_48
;랜덤にどの악마が出るか決定
;RETURN CSV번호 , 人数 , 레벨
SELECTCASE RAND:4
	CASE 0
		RETURN [[キャラ:모무노후]] , 3 + RAND:10 , CSVBASE([[キャラ:모무노후]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 1
		RETURN [[キャラ:오니]] , 3 + RAND:10 , CSVBASE([[キャラ:오니]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 2
		RETURN [[キャラ:오르트로스]] , 3 + RAND:10 , CSVBASE([[キャラ:오르트로스]] , GETNUM(BASE , "LV") , 0) + RAND:3
	CASE 3
		RETURN [[キャラ:이소라]] , 3 + RAND:10 , CSVBASE([[キャラ:이소라]] , GETNUM(BASE , "LV") , 0) + RAND:3
ENDSELECT
