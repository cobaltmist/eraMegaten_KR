
;=======================================================================
;샘플던전(전투테스트用)
;던전のテンプレートみたいなものです
;던전ナンバー0
;情報が古いので参考にするのは에코빌딩のほうがいいでしょう
;
;ちょっと전투테스트用に변경
;指定した레벨の적と戦ってみる感じの던전に
;=======================================================================




;=======================================================================
;攻略조건
;=======================================================================
@PREREQUISITE_DUNGEON_0
;DEBUG조건を外したいならこの次の行を削る
SIF FLAG:DEBUG
	RETURN 1
RETURN 0


;=======================================================================
;던전名
;=======================================================================
@GET_DUNGEON_NAME_0
RESULTS = 샘플던전


;=======================================================================
;플로어名표시
;=======================================================================
@FLOORNAME_0
PRINT 샘플던전
PRINTFORML   {FLAG:현M + 1}F (1枠あたりの적出現率{(FLAG:현M + 1) * 5}％)



;=======================================================================
;特殊タイル표시
;=======================================================================
@TILE_MARK_0_X_X
RESULTS = 特


;=======================================================================
;スタート地点입력
;=======================================================================
@START_DUNGEON_0,ARG
FLAG:현M = 0
FLAG:현X = 1
FLAG:현Y = 18
FOR LOCAL, 0, 100
	던전플래그:0:LOCAL = 0
NEXT
PRINTL 출현하는 적의 최저레벨을 지정해주세요
CALL INPUT_MANY(1, 99)
LOCAL:1 = RESULT
PRINTL 출현하는 적의 최대레벨이 최저레벨보다 얼마나 높은지를 지정해주세요
CALL INPUT_MANY(0, 10)
LOCAL:2 = RESULT + LOCAL:1
FOR LOCAL, 1, 2000
	SIF !EXISTCSV(LOCAL,0)
		CONTINUE
	SIF CSVCFLAG(LOCAL,GETNUM(CFLAG,"특수합체만"),0)
		CONTINUE
	SIF CSVCFLAG(LOCAL,GETNUM(CFLAG,"합체조건있음"),0)
		CONTINUE
	SIF CSVCFLAG(LOCAL,GETNUM(CFLAG,"전서소환불가"),0)
		CONTINUE
	SIF CSVBASE(LOCAL,GETNUM(BASE,"LV"),0) < LOCAL:1
		CONTINUE
	SIF CSVBASE(LOCAL,GETNUM(BASE,"LV"),0) > LOCAL:2
		CONTINUE
	CALL INCREASE_ANALYZE, LOCAL, 10
	던전플래그:0:0 += 1
	던전플래그:0:(던전플래그:0:0) = LOCAL
NEXT
IF 던전플래그:0:0 == 0
	PRINTL 출현가능한 악마가 없습니다！
	RESTART
ELSE
	PRINTL 출현악마는 아래와 같습니다.
	FOR LOCAL, 1, 던전플래그:0:0 + 2
		SIF 던전플래그:0:LOCAL == 0
			BREAK
		PRINTFORM \@ CSVCSTR(던전플래그:0:LOCAL,GETNUM(CSTR,"종족명"),0) != "" ? %CSVCSTR(던전플래그:0:LOCAL,GETNUM(CSTR,"종족명"),0),10,LEFT% # %STR:(CSVABL(던전플래그:0:LOCAL,GETNUM(ABL,"종족"),0)),10,LEFT%\@　
		PRINTFORM %CSVCALLNAME(던전플래그:0:LOCAL,0),20,LEFT%　
		PRINTFORML LV{CSVBASE(던전플래그:0:LOCAL,GETNUM(BASE,"LV"),0),6}
	NEXT
	WAIT
ENDIF


;=======================================================================
;指定したマスに進入가능か
;=======================================================================
@CAN_ENTER_0,ARG,ARG:1
CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT

;=======================================================================
;플로어데이터
;=======================================================================
@MAKE_FLOOR_0
SELECTCASE FLAG:현M
	CASE 0
	;１階
		FLAG:최대X = 20
		FLAG:최대Y = 20
		CALL MAKE_FLOOR_LINE,0,"00000000000000000000"
		CALL MAKE_FLOOR_LINE,1,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,2,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,3,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,4,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,5,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,6,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,7,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,8,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,9,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,10,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,11,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,12,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,13,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,14,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,15,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,16,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,17,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,18,"01611111111111111110"
		CALL MAKE_FLOOR_LINE,19,"08000000000000000000"
	CASE 18
		FLAG:최대X = 20
		FLAG:최대Y = 20
		CALL MAKE_FLOOR_LINE,0,"00000000000000000000"
		CALL MAKE_FLOOR_LINE,1,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,2,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,3,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,4,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,5,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,6,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,7,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,8,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,9,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,10,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,11,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,12,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,13,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,14,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,15,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,16,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,17,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,18,"01171111111111111110"
		CALL MAKE_FLOOR_LINE,19,"08000000000000000000"
	CASEELSE
		FLAG:최대X = 20
		FLAG:최대Y = 20
		CALL MAKE_FLOOR_LINE,0,"00000000000000000000"
		CALL MAKE_FLOOR_LINE,1,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,2,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,3,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,4,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,5,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,6,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,7,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,8,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,9,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,10,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,11,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,12,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,13,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,14,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,15,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,16,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,17,"01111111111111111110"
		CALL MAKE_FLOOR_LINE,18,"01671111111111111110"
		CALL MAKE_FLOOR_LINE,19,"08000000000000000000"
ENDSELECT



;=======================================================================
;[5]조사　実行時の이벤트
;=======================================================================
@EVENT_CHECK_DUNGEON_0

;==========
;出口の処理
;==========
IF DA:(FLAG:현X):(FLAG:현Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 3
	SELECTCASE FLAG:현M
		CASE 0
			IF FLAG:현X == 7 && FLAG:현Y == 6
				CALL GET_TREASURE,1001,1,0,0
			ENDIF
		CASE 1
			IF FLAG:현X == 1 && FLAG:현Y == 1
				CALL GET_TREASURE,2001,1,0,1
			ENDIF
	ENDSELECT
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 6
	CALL DUNGEON_UPSTAIRS_ID, FLAG:현M+1, 7
RETURN 1
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 7
	CALL DUNGEON_DOWNSTAIRS_ID, FLAG:현M-1, 6
RETURN 1

ELSE
	PRINTW 아무것도 없는 것 같다
	RETURN 0
ENDIF

;=======================================================================
;タイル進入時の이벤트
;=======================================================================
@EVENT_ENTER_DUNGEON_0,ARG
;ARG = 進入時の向き　0の場合ワープなど
;==========
;出口の処理
;==========
IF DA:(FLAG:현X):(FLAG:현Y) == 8
	CALL DUNGEON_EXIT
	RETURN 1
;========
;宝の処理
;========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 3
	SELECTCASE FLAG:현M
		CASE 0
			IF FLAG:현X == 7 && FLAG:현Y == 6
				CALL GET_TREASURE,1001,1,0,0
			ENDIF
		CASE 1
			IF FLAG:현X == 1 && FLAG:현Y == 1
				CALL GET_TREASURE,2001,1,0,1
			ENDIF
	ENDSELECT
	RETURN 1
;=======
;階段
;=======
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 6
	CALL DUNGEON_UPSTAIRS_ID, FLAG:현M+1, 7
RETURN 1
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 7
	CALL DUNGEON_DOWNSTAIRS_ID, FLAG:현M-1, 6
RETURN 1
;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:현X):(FLAG:현Y) == 2
	CALL DUNGEON_DOOR,ARG
	RETURN 1
ENDIF
RETURN 0


;=======================================================================
;인카운트율
;=======================================================================
@ENCOUNT_RATE_0
SELECTCASE FLAG:현M
	CASE 0
		FLAG:인카운트율 = FLAG:미조우걸음수*5
	CASE 1
		FLAG:인카운트율 = FLAG:미조우걸음수*5
ENDSELECT



;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_0
IF RAND:100 < FLAG:인카운트율
	$LOOP_ENCOUNT
	LOCAL:2 = 0
	FOR LOCAL,7,17,1
		;1Fは１枠あたり10％の확률로出現
		;2Fは１枠あたり20％の확률로出現
		IF RAND:100 < (FLAG:현M+1) * 5
			LOCAL:3 = 던전플래그:0:(RAND:(던전플래그:0:0) + 1)
			CALL SET_ENEMY,LOCAL, LOCAL:3 , CSVBASE(LOCAL:3, GETNUM(BASE,"LV"),0),0
			LOCAL:2 += 1
		ENDIF
	NEXT
	SIF LOCAL:2 == 0
		GOTO LOOP_ENCOUNT
	RETURN 1
ELSE
	FLAG:미조우걸음수 += 1
	RETURN 0
ENDIF










