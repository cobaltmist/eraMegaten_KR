;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;
;	Module		:REQUEST_108_ランダム依頼.ERB
;	Facility	:
;
;	Licence		:ライセンスフリー。
;
;	Modification Data:
;
;	Edit	Date			Author					Reason
;	001		20XX/XX/XX		----					新規作成
;	002		2021/12/31		軽木					REQUEST_108_軽子坂高校体育館1.ERBから処理を分離、連続で受けられないように変更
;	003		2022/05/08		ロッド＠カヤノソト		ランダム依頼で使用するダンジョンを「DUNGEON_2_軽子坂高校」→「DUNGEON108_ランダム依頼」に変更　※既存のダンジョンに相乗りするとソースがごちゃごちゃになってしまうことを懸念
;	004		2022/05/14		ロッド＠カヤノソト		イベントの発生条件に『EXTRAフィルターがOFFの場合は発生しない』を追加。　※当初はヤマタイカ(EXイベントの一種)フラグONが必須であったが、上記「003」の変更で撤廃。その後、最初の作者さんがEXイベントにしていた意向を重視してEXTRAフィルターを付けるべきと考え直しました。
;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#

;
;ランダム依頼modで使用するフラグ
;의뢰플래그:108:2		依頼の受諾判定に使用
;의뢰플래그:108:3		ダンジョン依頼の場所判定に使用
;						（1、ビル　２、下水道　３.工場　４.森　５.山　６.ランダムダンジョン）
;의뢰플래그:108:4		依頼中の状況判定に使用
;의뢰플래그:108:5		依頼の難易度判定に使用
;의뢰플래그:108:7		依頼主（1:メシア教、2:ガイア教、0:그외）の判定に使用

;의뢰플래그:108:8		前回依頼を受けた日
;의뢰플래그:108:9		前回依頼を受けた時間帯

;의뢰플래그:108:11		メシア教の戦力値
;의뢰플래그:108:12		ガイア教の戦力値
;의뢰플래그:108:13		依頼の達成状況によるボーナス値
;의뢰플래그:108:14		固定報酬フラグ（0:変動報酬、1：固定報酬）の判定に使用　※固定報酬の場合、「의뢰플래그:108:13」の依頼達成状況によるボーナス値のみで報酬を算出する
;
;의뢰플래그:108:19		依頼60の非表示化

;====================
;条件
;====================
@PLAYABLE_REQUEST_108
;ランダム依頼を受注できる条件、および受注できる場合はどの種類の依頼が表示されるかを設定する

;EXTRAイベントがOFFの場合は発生しない　※以前はヤマタイカフィルターでしたが、EXTRA全般に変更
IF GETBIT(FLAG:EXTRA이벤트설정, 0) == 0
	RETURN 0

;既にランダム依頼を実行中の場合、受注不可
ELSEIF DAY == 의뢰플래그:108:8 && TIME == 의뢰플래그:108:9
	의뢰플래그:108:2 = 1
	RETURN 0

;この日のこの時間に既に依頼を受けていれば表示しない
ELSEIF DAY == 의뢰플래그:108:8 && TIME == 의뢰플래그:108:9
	RETURN 0

;その他の場合
ELSE
	;最初に、フラグなどをリセットする　※個別依頼でのフラグリセットし忘れによる報酬計算ミスの対応
	CALL REQUEST_108_FLAG_CLEAR

	;ランダムな依頼を表示する
	SELECTCASE RAND(0,72)
		CASE 0
			RESULTS = 얼음천지 공장（난이도 ☆☆）
			의뢰플래그:108:1 = 0
		CASE 1
			RESULTS = 교회 시설을 방위（난이도 ☆☆☆）
			의뢰플래그:108:1 = 1
		CASE 2
			RESULTS = 수송 부대를 습격（난이도 ★★★★）
			의뢰플래그:108:1 = 2
		CASE 3
			RESULTS = 하수도의 이상한 소리（난이도 ★）
			의뢰플래그:108:1 = 3
		CASE 4
			RESULTS = 폭격 부대의 요격（난이도 ☆☆）
			의뢰플래그:108:1 = 4
		CASE 5
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 무장집단 제거（난이도 ★★★）
			의뢰플래그:108:1 = 5
		CASE 6
			SIF 던전플래그:108:11 == 0
				RETURN 0
			RESULTS = 신형TK 파괴（난이도 ☆☆☆）
			의뢰플래그:108:1 = 6
		CASE 7
			SIF 던전플래그:108:11 == 0 || TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 강탈부대 추격（난이도 ★★★★）
			의뢰플래그:108:1 = 7
		CASE 8
			RESULTS = 파괴공작 저지（난이도 ☆☆☆☆☆）
			의뢰플래그:108:1 = 8
		CASE 9
			RESULTS = 보안시스템 파괴（난이도 ★★★★）
			의뢰플래그:108:1 = 9
		CASE 10
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 폐기물 처리장 점거자 배제（난이도 ☆☆☆）
			의뢰플래그:108:1 = 10
		CASE 11
			RESULTS = 서머너 평가 시험（난이도 ☆☆☆☆）
			의뢰플래그:108:1 = 11
		CASE 12
			RESULTS = 거점 빌딩 습격（난이도 ★★★）
			의뢰플래그:108:1 = 12
		CASE 13
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 기밀 물자 방위（난이도 ☆☆☆☆）
			의뢰플래그:108:1 = 13
		CASE 14
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 강습 부대 요격（난이도 ☆☆☆）
			의뢰플래그:108:1 = 14
		CASE 15
			RESULTS = 조사부대 배제（난이도 ★）
			의뢰플래그:108:1 = 15
		CASE 16
			RESULTS = 물자창고 탈환（난이도 ☆☆）
			의뢰플래그:108:1 = 16
		CASE 17
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 물자창고 점거（난이도 ☆☆）
			의뢰플래그:108:1 = 17
		CASE 18
			RESULTS = 전속 서머너 제거（난이도 ★★★★★）
			의뢰플래그:108:1 = 18
		CASE 19
			RESULTS = 도둑을 쫓아버려줘（난이도 ☆）
			의뢰플래그:108:1 = 19
		CASE 20
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 대(対)서머너 연습（난이도 ☆☆☆☆）
			의뢰플래그:108:1 = 20
		CASE 21
			RESULTS = 침입자 전부 배제（난이도 ☆☆☆）
			의뢰플래그:108:1 = 21
		CASE 22
			RESULTS = 경호원 의뢰（난이도 ☆☆☆）
			의뢰플래그:108:1 = 22
		CASE 23
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 산악기지 강습（난이도 ★★★）
			의뢰플래그:108:1 = 23
		CASE 24
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 항공기지 방위（난이도 ☆☆☆）
			의뢰플래그:108:1 = 24
		CASE 25
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 강도집단 소탕（난이도 ☆☆☆☆）
			의뢰플래그:108:1 = 25
		CASE 26
			RESULTS = 기밀연구 물자회수（난이도 ☆☆☆☆）
			의뢰플래그:108:1 = 26
		CASE 27
			RESULTS = 비밀창고 침입（난이도 ☆☆☆）
			의뢰플래그:108:1 = 27
		CASE 28
			RESULTS = 요정부대 격멸（난이도 ☆☆）
			의뢰플래그:108:1 = 28
		CASE 29
			RESULTS = 우군 탈출지원（난이도 ★★）
			의뢰플래그:108:1 = 29
		CASE 30
			RESULTS = 폐공장 침입（난이도 ☆☆☆）
			의뢰플래그:108:1 = 30
		CASE 31
			RESULTS = 소속불명 악마배제 지원（난이도 ☆☆）
			의뢰플래그:108:1 = 31
		CASE 32
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 특수부대 강습（난이도 ☆☆☆☆☆）
			의뢰플래그:108:1 = 32
		CASE 33
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 점거부대 구조（난이도 ☆☆）
			의뢰플래그:108:1 = 33
		CASE 34
			RESULTS = 연구팀 구출（난이도 ☆☆）
			의뢰플래그:108:1 = 34
		CASE 35
			RESULTS = 침입부대 배제（난이도 ☆☆☆）
			의뢰플래그:108:1 = 35
		CASE 36
			RESULTS = 침투부대 리더 격파（난이도 ☆☆）
			의뢰플래그:108:1 = 36
		CASE 37
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 수송로 호위（난이도 ☆☆☆）
			의뢰플래그:108:1 = 37
		CASE 38
			RESULTS = 방위전력 조사（난이도 ★★★）
			의뢰플래그:108:1 = 38
		CASE 39
			RESULTS = 산악 방위망 격파（난이도 ★★）
			의뢰플래그:108:1 = 39
		CASE 40
			RESULTS = 이계화된 빌딩의 개방（난이도 ☆☆）
			의뢰플래그:108:1 = 40
		CASE 41
			RESULTS = 선박 도크 습격（난이도 ☆☆☆）
			의뢰플래그:108:1 = 41
		CASE 42
			RESULTS = 선박 도크 경비（난이도 ☆☆☆☆）
			의뢰플래그:108:1 = 42
		CASE 43
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 열차 요격（난이도 ☆☆）
			의뢰플래그:108:1 = 43
		CASE 44
			RESULTS = 요새 방위（난이도 ★★★）
			의뢰플래그:108:1 = 44
		CASE 45
			RESULTS = 대공포 격파（난이도 ☆☆☆）
			의뢰플래그:108:1 = 45
		CASE 46
			RESULTS = 기온 시스템 제어（난이도 ☆☆）
			의뢰플래그:108:1 = 46
		CASE 47
			RESULTS = 방위 기능 시험（난이도 ☆☆☆）
			의뢰플래그:108:1 = 47
		CASE 48
			RESULTS = 세균 무기 제거（난이도 ☆）
			의뢰플래그:108:1 = 48
		CASE 49
			RESULTS = 지원무기 강탈자 격파（난이도 ☆☆）
			의뢰플래그:108:1 = 49
		CASE 50
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 신형무기 시험（난이도 ☆☆☆☆）
			의뢰플래그:108:1 = 50
		CASE 51
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 신형무기 탈취부대 격멸（난이도 ☆☆☆☆）
			의뢰플래그:108:1 = 51
		CASE 52
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 수송선 구조（난이도 ★★★）
			의뢰플래그:108:1 = 52
		CASE 53
			RESULTS = 무장 수송선 습격（난이도 ☆☆☆）
			의뢰플래그:108:1 = 53
		CASE 54
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 민폐악마 처리（난이도 ☆☆）
			의뢰플래그:108:1 = 54
		CASE 55
			RESULTS = 변이된 뱀장어의 처리（난이도 ★）
			의뢰플래그:108:1 = 55
		CASE 56
			SIF TALENT:MASTER:서머너 != 5
				RETURN 0
			RESULTS = 서큐버스 퇴치（난이도 ☆☆☆☆☆）
			의뢰플래그:108:1 = 56
		CASE 57
			RESULTS = 드라이어드를 솎아주게（난이도 ★★）
			의뢰플래그:108:1 = 57
		CASE 58
			RESULTS = 貸軒先取於母屋（난이도 ☆☆☆☆）
			의뢰플래그:108:1 = 58
		CASE 59
			RESULTS = 地下洞窟調査（난이도 ★★★★）
			의뢰플래그:108:1 = 59
		CASE 60
			SIF 의뢰플래그:108:19 == 1
				RETURN 0
			RESULTS = 素材調達（難易度 ★★★）
			의뢰플래그:108:1 = 60
		CASE 61
			RESULTS = 潜入調査（難易度 ★★★★★）
			의뢰플래그:108:1 = 61
		CASE 62
			RESULTS = セキュリティー解除（難易度 ★★★★）
			의뢰플래그:108:1 = 62
		CASE 63
			RESULTS = 魔法少女討伐（難易度 ☆☆☆）
			의뢰플래그:108:1 = 63
		CASE 64
			RESULTS = 魔石収集（難易度 ☆）
			의뢰플래그:108:1 = 64
		CASE 65
			RESULTS = 武者修行（難易度 ☆☆☆）
			의뢰플래그:108:1 = 65
		CASE 66
			RESULTS = 暴れ者をつかまえてくれ（難易度 ★★★）
			의뢰플래그:108:1 = 66
		CASE 67
			RESULTS = 鬼攫いの夕べ（難易度 ★★★）
			의뢰플래그:108:1 = 67
		CASE 68
			RESULTS = 東京湾攪拌（難易度 ★★★★）
			의뢰플래그:108:1 = 68
		CASE 69
			RESULTS = 暴風神討伐（難易度 ☆☆☆☆）
			의뢰플래그:108:1 = 69
		CASE 70
			RESULTS = 博愛からの逃亡（難易度 ★★★）
			의뢰플래그:108:1 = 70
		CASE 71
			RESULTS = 支援物資輸送（難易度 ★★★）
			의뢰플래그:108:1 = 71
	ENDSELECT
	RETURN 1
ENDIF
RETURN 0

;====================
;説明
;====================
@EXPLAIN_REQUEST_108
;-------------------
;変数定義
;-------------------
#DIM REWARD_PERCENTAGE_L		;メシア教側の報酬変動率(%)
#DIM REWARD_PERCENTAGE_C		;가이아教側の報酬変動率(%)

;-------------------
;変数の初期化
;-------------------
REWARD_PERCENTAGE_L = 100		;メシア教側の報酬変動率(%)
REWARD_PERCENTAGE_C = 100		;가이아教側の報酬変動率(%)

;-------------------
;ここから本処理
;-------------------
;メシア・ガイアの報酬変動率の算出　※劣勢なほど報酬は良くなる
REWARD_PERCENTAGE_L = (100 * MAX(의뢰플래그:108:12, 1) + 20) / (MAX(의뢰플래그:108:11, 1) + 20)
REWARD_PERCENTAGE_C = (100 * MAX(의뢰플래그:108:11, 1) + 20) / (MAX(의뢰플래그:108:12, 1) + 20)

;倍率は50%～200%とする
REWARD_PERCENTAGE_L = MAX(REWARD_PERCENTAGE_L, 50)		;倍率の最小値を50%に設定
REWARD_PERCENTAGE_L = MIN(REWARD_PERCENTAGE_L, 200)		;倍率の最大値を200%に設定
REWARD_PERCENTAGE_C = MAX(REWARD_PERCENTAGE_C, 50)		;倍率の最小値を50%に設定
REWARD_PERCENTAGE_C = MIN(REWARD_PERCENTAGE_C, 200)		;倍率の最大値を200%に設定

;メシア・ガイアの勢力状況および報酬への影響を表示する
PRINTFORML メシア教　報酬：{REWARD_PERCENTAGE_L}\%
IF REWARD_PERCENTAGE_L >= 120
	PRINTL (劣勢のようです。いつもより高額の報酬が期待できます。）
ELSEIF REWARD_PERCENTAGE_L <= 80
	PRINTL (優勢のようです。報酬に期待は持てません。）
ELSE
	PRINTL 
ENDIF
PRINTFORML ガイア教　報酬：{REWARD_PERCENTAGE_C}\%
IF REWARD_PERCENTAGE_C >= 120
	PRINTL (劣勢のようです。いつもより高額の報酬が期待できます。）
ELSEIF REWARD_PERCENTAGE_C <= 80
	PRINTL (優勢のようです。報酬に期待は持てません。）
ELSE
	PRINTL 
ENDIF

;個別の依頼の説明を表示する(「氷漬けの工場」「教会施設を防衛」など各依頼の説明はここから)
CALLFORM REQUEST_EXPLAIN_108_{의뢰플래그:108:1}

;====================
;内容
;====================
@REQUEST_108
;ランダム依頼を受けるのが初回である場合、メシア・ガイアの勢力を互角にする(両方50ずつ)
IF 의뢰플래그:108:8 == 0 && 의뢰플래그:108:9 == 0
	의뢰플래그:108:11 = 50
	의뢰플래그:108:12 = 50
ENDIF

;個別の依頼を開始する(「氷漬けの工場」「教会施設を防衛」など各依頼の処理はここから)
CALLFORM REQUEST_108_{의뢰플래그:108:1}

;ランダム依頼実行時の日時を記録
의뢰플래그:108:8 = DAY
의뢰플래그:108:9 = TIME

;====================
;その他
;====================
;各種フラグの初期化を行う。(個別の依頼における初期化忘れによって報酬計算が変になるケースがあるため、共通処理でリセットをかける)
@REQUEST_108_FLAG_CLEAR
의뢰플래그:108:2 = 0			;ダンジョンの有無(デフォルトは「0：なし」とする。)
의뢰플래그:108:5 = 1			;依頼の難易度(デフォルトは「1」とする)
의뢰플래그:108:7 = 0			;依頼主(デフォルトは「0：その他」とする)
의뢰플래그:108:13 = 0			;依頼の達成状況によるボーナス値(デフォルトは「0」とする)
의뢰플래그:108:14 = 0			;固定報酬フラグ（デフォルトは「0:変動報酬」とする）
던전플래그:108:20 = 0		;ダンジョン系依頼の進行状況フラグ。(デフォルトは0とする)
