;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;
;	Module		:FATE_鯖共通_ノウブル・ファンタズム.ERB
;	Facility	:
;
;	Licence		:ライセンスフリー
;
;	Modification Data:
;
;	Edit	Date			Author		Reason
;	000		20XX/XX/XX		----		テンプレ
;	001		2021/04/21		SUIHOU		作成
;	002		2021/05/05		SUIHOU		Fゲージが多段攻撃でも溜まるように調整
;	003		2021/05/05		しゃけ		無銘勝利剣、黒龍双剋勝利剣の使用時にHゲージ増加量を抑える様に調整
;	004		2021/08/10		SUIHOU		ゲージカンスト後、魔力放出前の説明文がなかったので追記
;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#

;スキル名
@SKILL_NAME_ノウブル・ファンタズム,ARG
RESULTS = 노블・판티즘

;　명중
@SKILL_HITRATE_ノウブル・ファンタズム, ARG
RETURN 0

;　위력
@SKILL_POWER_ノウブル・ファンタズム, ARG
RETURN 0

;;クリティカル率
;@SKILL_CRITICAL_RATE_ノウブル・ファンタズム, ARG
;RETURN 0

;;　吸収率
;@SKILL_HP_ABSORBER_ノウブル・ファンタズム, ARG
;RETURN 0

;　최저공격횟수
@SKILL_MINATTACKNUMBER_ノウブル・ファンタズム,ARG
RETURN 0

;　최대공격횟수
@SKILL_MAXATTACKNUMBER_ノウブル・ファンタズム,ARG
RETURN 0

;;一体辺りの最大ＨＩＴ数
;;※ランダム攻撃系に使う
;@SKILL_MAXATK_PER_ノウブル・ファンタズム,ARG
;RETURN 0

;;一体辺りの最低ＨＩＴ数
;;※ランダム攻撃系に使う
;@SKILL_MINATK_PER_ノウブル・ファンタズム,ARG
;RETURN 0

;　2 ＨＰ지불　3 ＭＰ지불
@SKILL_COSTTYPE_ノウブル・ファンタズム, ARG
RETURN 1
;消費なし＝1

;　코스트량
@SKILL_COST_ノウブル・ファンタズム,ARG
RETURN 0

;　상성
@SKILL_TYPE_ノウブル・ファンタズム,ARG
RETURN 0

;　1 EXTRA　2 MAGIC
@SKILL_DECIDE_TYPE_ノウブル・ファンタズム,ARG
RETURN 0

;　1 물리데미지로 계산　2 마법데미지로 계산
@SKILL_DAMAGETYPE_ノウブル・ファンタズム,ARG
RETURN 0


;　対象が1敵か2味方か3場全体か4特殊か
@SKILL_TARGET_ノウブル・ファンタズム,ARG
RETURN 4

;　사거리
@SKILL_RANGE_ノウブル・ファンタズム,ARG
RETURN 0

;　범위　1 1체　2 1열　3 전체　4 적아군전체
@SKILL_SPHERE_ノウブル・ファンタズム,ARG
RETURN 1

;　 효과타입　1 공격、2 회복、3 상태변화、4 특수、5 상태회복
@SKILL_EFECT_ノウブル・ファンタズム,ARG
RETURN 6

;　 특수처리 여부 및 처리내용
;@SKILL_SPECIALEFECT_ノウブル・ファンタズム,ARG
;ARG = 1인 경우는 처리 여부를 반환합니다
;SIF ARG == 1
;	RETURN 0
;아래쪽에 특수처리를 기술합니다

;계승타입
;@SKILL_SUCCESSION_TYPE_ノウブル・ファンタズム,ARG
;RETURN 23
;검격

;속도보정
@SKILL_SPEED_ノウブル・ファンタズム, ARG = -1
RETURN 0

;;　口上の表示とそのタイプ
;@SKILL_MESSAGE_ノウブル・ファンタズム,ARG


;전투시 이외에 사용 가능한가
@SKILL_ACTIONABLE_FIELD_ノウブル・ファンタズム, ARG = -1
RETURN 0

;没
;@SKILL_RANK_ノウブル・ファンタズム
;@SKILL_RANKUP_ノウブル・ファンタズム
;@계승불능_ノウブル・ファンタズム

;템플릿용、추가효과 시리즈
;추가효과ステータス
@SKILL_ADDTIONAL_STATE_ノウブル・ファンタズム,ARG
RETURN 0

;추가효과 상성
@SKILL_ADDTIONAL_TYPE_ノウブル・ファンタズム,ARG
RETURN 0

;추가효과基本付与確率
@SKILL_ADDTIONAL_BASE_RATE_ノウブル・ファンタズム,ARG
RETURN 0

;추가효과付与確率上限
@SKILL_ADDTIONAL_MAX_RATE_ノウブル・ファンタズム,ARG
RETURN 0

;;拡散攻撃用追加処理
;;ブレスなどの拡散攻撃に使う
;@SKILL_SPREAD_ノウブル・ファンタズム,ARG
;RETURN 0

;====================================================
;トリガー発動条件
;====================================================
;@SKILL_TRIGGER_ACTIONABLE_ノウブル・ファンタズム,ARG,ARG:1
;RETURN 0

;====================================================
;カウンター発動条件
;====================================================
;@SKILL_COUNTER_ACTIONABLE_ノウブル・ファンタズム,ARG,ARG:1
;RETURN RESULT

;====================================================
;ヒット時ダメージ前処理
;====================================================
;@SKILL_HIT_EFFECT_ノウブル・ファンタズム,ARG,ARG:1

;====================================================
;ダメージ発動時
;====================================================
;@SKILL_DAMAGE_EFFECT_ノウブル・ファンタズム,ARG,ARG:1

;====================================================
;行動によるスキルゲージ操作
;====================================================
@SKILLGAGE_CHARGE_ノウブル・ファンタズム,ARG,ARG:1
#LOCALSIZE 1
#DIM SKILL_NUM

SKILL_NUM = PU_SKILLNUM_GET(ARG,"ノウブル・ファンタズム")

;自分の行動の場合
IF ARG == ARG:1
	;ダメージを受けた敵の数に応じてスキルゲージアップ
	FOR LOCAL,0,CHARANUM
		SIF CFLAG:LOCAL:PT플래그 == CFLAG:ARG:PT플래그
			CONTINUE
		IF CFLAG:LOCAL:현데미지 > 0
			CALL SKILLGAGE_F_ADD,ARG,SKILL_NUM,5
			;PRINTFORMW  被弾回数チェック{CFLAG:LOCAL:피탄횟수}
			;PRINTFORMW  LOCAL確認:{LOCAL}
			;---- EDIT 002 ADD START ---------------------------
			IF CFLAG:LOCAL:피탄횟수 > 1
				;PRINTFORMW  被弾回数：{CFLAG:LOCAL:피탄횟수}
				;---- EDIT 003 ADD START ---------------------------
				IF CFLAG:ARG:입력행동 == PU_SKILLNUM_GET(ARG,"黒龍双剋勝利剣")
					IF CFLAG:LOCAL:현데미지 >= BASE:LOCAL:ＨＰ
						CALL SKILLGAGE_F_ADD,ARG,SKILL_NUM,(5*CFLAG:LOCAL:피탄횟수)
					ELSE
						CALL SKILLGAGE_F_ADD,ARG,SKILL_NUM,(3*CFLAG:LOCAL:피탄횟수)
					ENDIF
				ELSEIF CFLAG:ARG:입력행동 == PU_SKILLNUM_GET(ARG,"無銘勝利剣")
					IF CFLAG:LOCAL:현데미지 >= BASE:LOCAL:ＨＰ
						CALL SKILLGAGE_F_ADD,ARG,SKILL_NUM,(5*CFLAG:LOCAL:피탄횟수)
					ELSE
						CALL SKILLGAGE_F_ADD,ARG,SKILL_NUM,(2*CFLAG:LOCAL:피탄횟수)
					ENDIF
				;---- EDIT 003 ADD END ---------------------------
				ELSE
					CALL SKILLGAGE_F_ADD,ARG,SKILL_NUM,(5*CFLAG:LOCAL:피탄횟수)
				ENDIF
			ENDIF
			;---- EDIT 002 ADD END -----------------------------
		ELSE
			CONTINUE
		ENDIF
		;会心、弱点を出すとさらにアップ
		SIF GETBIT(CFLAG:LOCAL:받음플래그,21)
			CALL SKILLGAGE_F_ADD,ARG,SKILL_NUM,10
		SIF GETBIT(CFLAG:LOCAL:받음플래그,22)
			CALL SKILLGAGE_F_ADD,ARG,SKILL_NUM,10
	NEXT
	;挑発をしても上がる
	SIF CFLAG:ARG:입력행동 == 515
		CALL SKILLGAGE_F_ADD,ARG,SKILL_NUM,25
ENDIF
;ダメージを受けた又はカウンター、トリガー以外の攻撃を受けたら
;怒りゲージが増える
IF CFLAG:ARG:현데미지 > 0 || GETBIT(CFLAG:ARG:받음플래그,18) || GETBIT(CFLAG:ARG:받음플래그,19)
	LOCAL = 60 * CFLAG:ARG:현데미지 / MAXBASE:ARG:ＨＰ
	LOCAL = LOCAL < 2 ? 2 # LOCAL
	CALL SKILLGAGE_F_ADD,ARG,SKILL_NUM,LOCAL
ENDIF
;スキルゲージが100以上だと100にする
SIF SKILLGAGE_F_GET(ARG,SKILL_NUM) > 100
	CALL SKILLGAGE_F_SET,ARG,SKILL_NUM,100
RETURN 0


;====================================================
;스킬 및 행동의 실행
;====================================================
@ACTION_ノウブル・ファンタズム,ARG,ARG:1,SKILL_NUM
#DIM SKILL_NUM

SKILL_NUM = PU_SKILLNUM_GET(ARG,"ノウブル・ファンタズム")

CALL SKILLGAGE_F_SET,ARG,SKILL_NUM,0
CALL SKILLGAGE_D_SET,ARG,SKILL_NUM,5
PRINTFORMW %ARG는% 마력을 개방했다！

;====================================================
;실행내용 여기까지
;====================================================


;====================================================
;追加コマンド(一番下)
;====================================================
@SKILL_SPECIAL_COMMAND_ノウブル・ファンタズム,ARG,LOCAL,SKILL_NUM
#LOCALSIZE 1
#DIM SKILL_NUM

SKILL_NUM = PU_SKILLNUM_GET(ARG,"ノウブル・ファンタズム")

IF SKILLGAGE_F_GET(ARG,SKILL_NUM) > 99
	SETCOLOR 0xdc143c
	PRINTFORML [{LOCAL}] 마력방출
	C:LOCAL = 10000 + SKILL_NUM
	LOCAL += 1
	RESETCOLOR
ENDIF
RETURN LOCAL

;====================================================
;コマンド実行
;====================================================
@INPUT_COM_ノウブル・ファンタズム,ARG
#LOCALSIZE 1
#DIM SKILL_NUM

SKILL_NUM = PU_SKILLNUM_GET(ARG,"ノウブル・ファンタズム")

LOCAL = CFLAG:ARG:입력행동
CFLAG:ARG:입력행동 = PU_SKILLNUM_GET(ARG,"ノウブル・ファンタズム")
SETCOLOR 0x33ffcc
PRINTFORML ┏>CHARA━━━━━━━━━━┓　┏>ACT━━━━━━━━━━━━━━━━━━┓
PRINTFORM ┃[{CPOS(ARG),2}] %CALLNAME:ARG,21,LEFT%┃　┃
CALLFORM SKILL_NAME_ノウブル・ファンタズム,ARG
PRINTFORML %RESULTS,40,LEFT%┃
PRINTFORMW ┗━━━━━━━━━━━━━┛　┗━━━━━━━━━━━━━━━━━━━━┛
SWAP TARGET,ARG
CALL ACTION_ノウブル・ファンタズム,TARGET
CALL 구상호출 , "BATTLE_MESSAGE" , TARGET , TARGET
RESETCOLOR
WAIT
SWAP TARGET,ARG
CFLAG:ARG:입력행동 = LOCAL
RETURN -1

;====================================================
;戦闘中スキルゲージの可視化
;====================================================
@SKILLGAGE_DISPLAY_ノウブル・ファンタズム,ARG
#DIM SKILL_NUM

SKILL_NUM = PU_SKILLNUM_GET(ARG,"ノウブル・ファンタズム")
SETCOLOR 0xff4500
SIF SKILLGAGE_D_GET(ARG,SKILL_NUM) > 0
	SETCOLOR 0xdc143c
IF SKILLGAGE_D_GET(ARG,SKILL_NUM) > 0
	PRINTFORML 마력방출　나머지 {SKILLGAGE_D_GET(ARG,SKILL_NUM)}턴
ELSEIF SKILLGAGE_F_GET(ARG,SKILL_NUM) < 100
	PRINTFORML NP게이지　{SKILLGAGE_F_GET(ARG,SKILL_NUM),3}％
ENDIF
RESETCOLOR

;　説明文の表示
@SKILL_EXPLAIN_ノウブル・ファンタズム,ARG
#DIM SKILL_NUM

SKILL_NUM = PU_SKILLNUM_GET(ARG,"ノウブル・ファンタズム")
IF SKILLGAGE_D_GET(ARG,SKILL_NUM) > 0
	PRINTL 축적되어 있던 마력을 개방한 상태
	PRINTL 영웅의 상징은 여기에 형태를 이루어、다시 전설이 재현될 것이다
	PRINTL 
	PRINTL 마력해방 중：보구 사용 가능、피데미지 20％ 경감
ELSEIF SKILLGAGE_F_GET(ARG,SKILL_NUM) == 100
	PRINTL 서번트가 가진 비장의 카드이자、인간의 환상을 골자로 만들어낸 무장
	PRINTL 그들이 생전에 구축해낸 전설의 상징이자、물질화된 기적이다
	PRINTL 
	PRINTL 필요한 마력의 축적이 끝나 있다
	PRINTL 개방하면 영웅담의 재현이 가능한 상태
ELSEIF SKILLGAGE_F_GET(ARG,SKILL_NUM) < 100
	PRINTL 서번트가 가진 비장의 카드이자、인간의 환상을 골자로 만들어낸 무장
	PRINTL 그들이 생전에 구축해낸 전설의 상징이자、물질화된 기적이다
	PRINTL 
	IF U > 0 && U < CHARANUM && NO:U == ([[キャラ:앙리마유]])
		PRINTL  NP게이지가 부착、100％로 마력해방을 행할 수 있고、마력방출 상태로 이행。
		PRINTFORML %CALLNAME:ARG%는 항상 100％이며、임의의 타이밍에 보구를 사용 가능。
	ELSE
		PRINTL NP게이지가 부착、여데미지、피데미지、도발로 게이지가 쌓인다
		PRINTL 100에서 마력해방을 행할 수 있고、마력방출 상태로 이행。보구를 사용할 수 있게 된다
	ENDIF
ENDIF

;没
;@계승부위_ノウブル・ファンタズム,ARG

;사용조건
@SKILL_SPECIAL_ACTIONABLE_ノウブル・ファンタズム,ARG
RETURN 0




;スキル重複で役に立つ関数
;HAVE_SKILL_OVERLAP(ARG,PU_SKILLNUM_GET(ARG,"ノウブル・ファンタズム"))

;スキルゲージで役に立つ関数
;SKILLGAGE_H_GET(ARG,PU_SKILLNUM_GET(ARG,"ノウブル・ファンタズム"))
;CALL SKILLGAGE_H_SET,ARG,PU_SKILLNUM_GET(ARG,"ノウブル・ファンタズム"),0

