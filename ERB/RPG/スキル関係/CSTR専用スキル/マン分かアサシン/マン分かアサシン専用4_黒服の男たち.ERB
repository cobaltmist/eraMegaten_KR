;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;
;	Module		:黒服の男たち.ERB
;	Facility	:
;
;	Licence		:ライセンスフリー
;
;	Modification Data:
;
;	Edit	Date			Author					Reason
;	000		20XX/XX/XX		----					テンプレ
;	001		2021/12/30		軽木					作成
;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;スキル名
@SKILL_NAME_黒服の男たち,ARG
RESULTS = 黒服の男たち

;　命中
@SKILL_HITRATE_黒服の男たち, ARG
RETURN 200


;　威力
@SKILL_POWER_黒服の男たち, ARG
RETURN 0

;クリティカル率
@SKILL_CRITICAL_RATE_黒服の男たち, ARG
RETURN 0


;　最低攻撃回数
@SKILL_MINATTACKNUMBER_黒服の男たち,ARG
RETURN 1

;　最大攻撃回数
@SKILL_MAXATTACKNUMBER_黒服の男たち,ARG
RETURN 1


;　ＨＰ2を支払うかＭＰ3を支払うか
@SKILL_COSTTYPE_黒服の男たち, ARG
RETURN 3
;消費なし＝1

;　コストの量
@SKILL_COST_黒服の男たち,ARG
RETURN 100

;　相性
@SKILL_TYPE_黒服の男たち,ARG
RETURN GET_TYPE_NUM("万能")


;　1EXTRAか2MAGICか
@SKILL_DECIDE_TYPE_黒服の男たち,ARG
RETURN 0

;　1物理ダメージで計算するか2魔法ダメージで計算するか
@SKILL_DAMAGETYPE_黒服の男たち,ARG
RETURN 2


;　対象が1敵か2味方か3場全体か4特殊か
@SKILL_TARGET_黒服の男たち,ARG
RETURN 1

;　射程
@SKILL_RANGE_黒服の男たち,ARG
RETURN 3

;　範囲　1単体　21列　3全体　4　敵味方全体
@SKILL_SPHERE_黒服の男たち,ARG
RETURN 3

;　 効果のタイプ　1攻撃、2回復、3状態変化、4特殊、5状態回復
@SKILL_EFECT_黒服の男たち,ARG
RETURN 3

;速度補正
@SKILL_SPEED_黒服の男たち, ARG = -1
RETURN 999

;;　口上の表示とそのタイプ
;@SKILL_MESSAGE_黒服の男たち,ARG

;戦闘時以外に使用できるか
@SKILL_ACTIONABLE_FIELD_黒服の男たち, ARG = -1
RETURN 0


;テンプレート用、追加効果シリーズ
;追加効果ステータス
@SKILL_ADDTIONAL_STATE_黒服の男たち,ARG
RETURN 0

;追加効果相性
@SKILL_ADDTIONAL_TYPE_黒服の男たち,ARG
RETURN 0

;追加効果基本付与確率
@SKILL_ADDTIONAL_BASE_RATE_黒服の男たち,ARG
RETURN 0

;追加効果付与確率上限
@SKILL_ADDTIONAL_MAX_RATE_黒服の男たち,ARG
RETURN 0


;====================================================
;トリガー発動条件
;====================================================
@SKILL_TRIGGER_ACTIONABLE_黒服の男たち,ARG,ARG:1
IF ARG:1 != ARG
	;起動してないなら死
	SIF SKILLGAGE_D_GET(ARG,PU_SKILLNUM_GET(ARG,"ノウブル・ファンタズム")) < 1
		RETURN 0
	;ダメージ与えてないなら死
	SIF !GETBIT(CFLAG:POS(CFLAG:(ARG:1):ターゲット):受けフラグ,20)
		RETURN 0
	;死んでるなら死
	SIF GET_STATE(CFLAG:POS(CFLAG:(ARG:1):ターゲット):ステート) == "DYING"
		RETURN 0
	;ここまで来たら攻撃準備
	RESULT:1 = POS(CFLAG:(ARG:1):ターゲット)
	;スキル起動中、対象が味方の攻撃でダメージ受けてるならCOOP
	RETURN 1
ELSEIF ARG == ARG:1
	;起動してたら死
	SIF SKILLGAGE_D_GET(ARG,PU_SKILLNUM_GET(ARG,"ノウブル・ファンタズム"))
		RETURN 0
	;通常モード転落直後は死
	SIF CFLAG:ARG:入力行動 == PU_SKILLNUM_GET(ARG,"公式かつ機密")
		RETURN 0
	;NP中でなく、O&C以外の自分の行動直後ならば発動
	RETURN 1
ENDIF

;====================================================
;スキル及び行動の実行
;====================================================
@ACTION_黒服の男たち,ARG,ARG:1,SKILL_NUM
#DIM SKILL_NUM
IF SKILLGAGE_D_GET(ARG,PU_SKILLNUM_GET(ARG,"ノウブル・ファンタズム"))
	CFLAG:(ARG:1):ＣＯＯＰフラグ = FLAG:(20000+NO:(ARG:1)) * FLAG:(20000+NO:(ARG:1)) / 2000
	CALL BTL_CALC_DAMAGE_COOP(ARG, ARG:1, 1, 18, 1, 1, FLAG:(20000+NO:(ARG:1)) * FLAG:(20000+NO:(ARG:1)) / 2000)
ELSE
	;味方の解析度上げるの敵にとってなんか意味あるのか…？
	IF CFLAG:(ARG):PTフラグ == 0
		LOCAL:1 = 1
		LOCAL:2 = 7
	ELSE
		LOCAL:1 = 7
		LOCAL:2 = 17
	ENDIF
	FOR LOCAL,LOCAL:1,LOCAL:2
		SIF POS(LOCAL) < 0
			CONTINUE
		SIF FLAG:(20000+NO:POS(LOCAL)) > 999
			CALL SKILLGAGE_F_ADD,ARG,PU_SKILLNUM_GET(ARG,"ノウブル・ファンタズム"),10
		FLAG:(20000+NO:POS(LOCAL)) = MIN(1000 , FLAG:(20000+NO:POS(LOCAL))+(1+(HAVE_SKILL(ARG,[[スキル:民俗学]])))*10)
	NEXT
	PRINTFORML 敵全体の解析度が上昇した！
ENDIF
;====================================================
;実行内容ここまで
;====================================================

;　説明文の表示
@SKILL_EXPLAIN_黒服の男たち,ARG
PRINTL 常時効果：ターン終了時、解析度を10%上昇させる。対象が解析済の場合、NPを増加させる。
PRINTL NP起動中：味方の行動によりダメージを与えた対象に対し、弱点を突いたものとしてCOOPを行う。
PRINTL 
PRINTL 黒いスーツを着た男性のみで構成されたエージェントたち。監視や弾圧を役目としている。
PRINTL あらゆる情報を収集しアサシンのもとに届ける。

;使用条件
@SKILL_SPECIAL_ACTIONABLE_黒服の男たち,ARG
RETURN 0
