
;스킬명
@SKILL_NAME_3520,ARG
RESULTS = 영봉
IF ARG > -1
	IF TFLAG:전투중 == 0 && HAVE_SKILL(U, [[스킬:분노폭발]])
		RESULTS = 분노오의
	;수라
	ELSEIF SKILLGAGE_F_GET(ARG,[[스킬:분노폭발]]) == 0
		RESULTS = 영봉
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RESULTS = 영봉・주
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RESULTS = 영봉・심담
	;羅刹
	ELSE
		RESULTS = 우인
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RESULTS = 영봉・몽탄
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RESULTS = 영봉
	ENDIF
ENDIF


;　명중
@SKILL_HITRATE_3520, ARG
IF ARG > -1
	;수라
	IF SKILLGAGE_F_GET(ARG,[[스킬:분노폭발]]) == 0
		SIF SKILLGAGE_H_GET(ARG,3520) == 0
			RETURN 100
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 150
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN 150
	;羅刹
	ELSE
		SIF SKILLGAGE_H_GET(ARG,3520) == 0
			RETURN 100
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 150
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN 150
	ENDIF
ENDIF
RETURN 100

;　위력
@SKILL_POWER_3520, ARG
IF ARG > -1
	;수라
	IF SKILLGAGE_F_GET(ARG,[[스킬:분노폭발]]) == 0
		SIF SKILLGAGE_H_GET(ARG,3520) == 0
			RETURN 300
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 120
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN 520
	;羅刹
	ELSE
		SIF SKILLGAGE_H_GET(ARG,3520) == 0
			RETURN 370
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 120
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN 80
	ENDIF
ENDIF
RETURN 300

;クリティカル率
@SKILL_CRITICAL_RATE_3520, ARG
SIF FLAG:확산플래그 == 1
	RETURN 30
RETURN 5

;　최저공격횟수
@SKILL_MINATTACKNUMBER_3520,ARG
IF ARG > -1
	;수라
	IF SKILLGAGE_F_GET(ARG,[[스킬:분노폭발]]) == 0
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 4
	;羅刹
	ELSE
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 6
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN 10
	ENDIF
ENDIF
RETURN 1

;　최대공격횟수
@SKILL_MAXATTACKNUMBER_3520,ARG
IF ARG > -1
	;수라
	IF SKILLGAGE_F_GET(ARG,[[스킬:분노폭발]]) == 0
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 4
	;羅刹
	ELSE
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 6
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN 10
	ENDIF
ENDIF
RETURN 1

;　2 ＨＰ지불　3 ＭＰ지불
@SKILL_COSTTYPE_3520, ARG
RETURN 3
;소비없음＝1

;　코스트량
@SKILL_COST_3520,ARG
IF ARG > -1
	;수라
	IF SKILLGAGE_F_GET(ARG,[[스킬:분노폭발]]) == 0
		SIF SKILLGAGE_H_GET(ARG,3520) == 0
			RETURN 20
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 25
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN 28
	;羅刹
	ELSE
		SIF SKILLGAGE_H_GET(ARG,3520) == 0
			RETURN 25
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 25
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN 28
	ENDIF
ENDIF
RETURN 20

;　상성
@SKILL_TYPE_3520,ARG
#LOCALSSIZE 4
#LOCALSIZE 5
VARSET LOCALS
IF ARG > -1
	;수라
	IF SKILLGAGE_F_GET(ARG,[[스킬:분노폭발]]) == 0
		IF SKILLGAGE_H_GET(ARG,3520) == 0
			LOCALS:0 = 비구
			LOCALS:1 = 주살
			LOCALS:2 = 비구
			LOCAL:4 = 3
		ELSEIF SKILLGAGE_H_GET(ARG,3520) == 1
			LOCALS:0 = 비구
			LOCALS:1 = 정신
			LOCALS:2 = 주살
			LOCALS:3 = 비구
			LOCAL:4 = 4
		ELSEIF SKILLGAGE_H_GET(ARG,3520) == 2
			LOCALS:0 = 주살
			LOCALS:1 = 신경
			LOCALS:2 = 만능
			LOCALS:3 = 주살
			LOCAL:4 = 4
		ENDIF
	;羅刹
	ELSE
		IF SKILLGAGE_H_GET(ARG,3520) == 0
			LOCALS:0 = 검격
			LOCALS:1 = 만능
			LOCALS:2 = 검격
			LOCAL:4 = 3
		ELSEIF SKILLGAGE_H_GET(ARG,3520) == 1
			LOCALS:0 = 검격
			LOCALS:1 = 주살
			LOCALS:2 = 검격
			LOCAL:4 = 3
		ELSEIF SKILLGAGE_H_GET(ARG,3520) == 2
			LOCALS:0 = 검격
			LOCALS:1 = 주살
			LOCALS:2 = 만능
			LOCALS:3 = 검격
			LOCAL:4 = 4
		ENDIF
	ENDIF
ENDIF
SIF LOCALS == ""
	RETURN 0
SIF ARG < 0 || 스킬속성표시중 || CFLAG:ARG:타겟 > 16 || CFLAG:ARG:타겟 < 1
	RETURN GET_TYPE_NUM(LOCALS)
LOCAL = POS(CFLAG:ARG:타겟)
SIF LOCAL < 0
	RETURN GET_TYPE_NUM(LOCALS)
LOCAL:2 = -300
;FOR LOCAL:4, 0, 20
;	IF LOCALS:(LOCAL:4) == ""
;		LOCALS:(LOCAL:4) = %LOCALS%
;		BREAK
;	ENDIF
;NEXT

FOR LOCAL:1, 1, LOCAL:4
	;判定用に数値を仕舞う。反射は-200扱い
	LOCAL:3 = MAXBASE:LOCAL:(LOCALS:(LOCAL:1)) == 999 ? -200 # MAXBASE:LOCAL:(LOCALS:(LOCAL:1))
	LOCAL:3 = BTL_CHK_SKILL_관통(ARG) && INRANGE(MAXBASE:LOCAL:(LOCALS:(LOCAL:1)), 0, 100) ? 100 # LOCAL:3
	LOCAL:3 = CFLAG:LOCAL:(LOCALS:(LOCAL:1)+"가드킬") && LOCAL:3 < 100 ? 100 # LOCAL:3
	LOCAL:3 = CFLAG:LOCAL:(LOCALS:(LOCAL:1)+"무효화횟수") ? 0 # LOCAL:3
	LOCAL:3 = GET_TYPE_NUM(LOCALS:(LOCAL:1)) < 17 && CFLAG:LOCAL:무효플래그 ? 0 # LOCAL:3
	IF GET_TYPE_NUM(LOCALS:(LOCAL:1)) < 4
		LOCAL:3 = CFLAG:LOCAL:물리반사플래그 ? -200 # LOCAL:3
	ELSEIF GET_TYPE_NUM(LOCALS:(LOCAL:1)) < 17
		LOCAL:3 = CFLAG:LOCAL:마법반사플래그 ? -200 # LOCAL:3
	ENDIF
	IF LOCAL:3 > LOCAL:2
		LOCAL:2 = LOCAL:3
		LOCALS = %LOCALS:(LOCAL:1)%
	ENDIF
NEXT
RETURN GET_TYPE_NUM(LOCALS)
;검격

;　1 EXTRA　2 MAGIC
@SKILL_DECIDE_TYPE_3520, ARG
RETURN 1
;どちらでもない

;　1 물리데미지로 계산　2 마법데미지로 계산
@SKILL_DAMAGETYPE_3520, ARG
RETURN 1


;　대상　1 적　2 아군　3 양쪽전체　4 특수
@SKILL_TARGET_3520
RETURN 1

;　사거리
@SKILL_RANGE_3520,ARG
IF ARG > -1
	;수라
	IF SKILLGAGE_F_GET(ARG,[[스킬:분노폭발]]) == 0
		RETURN 3
	;羅刹
	ELSE
		RETURN 1
	ENDIF
ENDIF
RETURN 3

;　범위　1 1체　2 1열　3 전체　4 적아군전체
@SKILL_SPHERE_3520,ARG
IF ARG > -1
	;수라
	IF SKILLGAGE_F_GET(ARG,[[스킬:분노폭발]]) == 0
		SIF SKILLGAGE_H_GET(ARG,3520) == 0
			RETURN 2
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 3
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN 3
	;羅刹
	ELSE
		SIF SKILLGAGE_H_GET(ARG,3520) == 0
			RETURN 1
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 1
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN 1
	ENDIF
ENDIF
RETURN 2

;　 효과타입　1 공격、2 회복、3 상태변화、4 특수、5 상태회복
@SKILL_EFECT_3520
RETURN 1

;　 특수처리 여부 및 처리내용
@SKILL_SPECIALEFECT_3520,ARG
;ARG = 1인 경우는 처리 여부를 반환합니다
SIF ARG == 1
	RETURN 0
;아래쪽에 특수처리를 기술합니다

;계승타입
@SKILL_SUCCESSION_TYPE_3520
RETURN 0

@계승불능_3520
RETURN 1
;継承不能

;속도보정
@SKILL_SPEED_3520, ARG = -1
RETURN 0

;　구상의 표시와 그 타입
@SKILL_MESSAGE_3520,ARG


;전투시 이외에 사용 가능한가
@SKILL_ACTIONABLE_FIELD_3520
RETURN 0

;스킬변화？용 랭크
@SKILL_RANK_3520
RETURN 22

@SKILL_RANKUP_3520
RETURN 0

;템플릿용、추가효과 시리즈
;추가효과 스테이터스
@SKILL_ADDTIONAL_STATE_3520,ARG
IF ARG > -1
	;수라
	IF SKILLGAGE_F_GET(ARG,[[스킬:분노폭발]]) == 0
		SIF SKILLGAGE_H_GET(ARG,3520) == 0
			RETURN GET_STATE_NUM("BIND")
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN GET_STATE_NUM("CHARM")
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN GET_STATE_NUM("PALYZE")
	;羅刹
	ELSE
		SIF SKILLGAGE_H_GET(ARG,3520) == 0
			RETURN GET_STATE_NUM("DYING")
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN GET_STATE_NUM("CURSE")
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN GET_STATE_NUM("DYING")
	ENDIF
ENDIF
RETURN GET_STATE_NUM("BIND")

;추가효과 상성
@SKILL_ADDTIONAL_TYPE_3520,ARG
IF ARG > -1
	;수라
	IF SKILLGAGE_F_GET(ARG,[[스킬:분노폭발]]) == 0
		SIF SKILLGAGE_H_GET(ARG,3520) == 0
			RETURN 8
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 9
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN 8
	;羅刹
	ELSE
		SIF SKILLGAGE_H_GET(ARG,3520) == 0
			RETURN 11
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 11
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN 17
	ENDIF
ENDIF
RETURN 8

;추가효과 기본부여확률
@SKILL_ADDTIONAL_BASE_RATE_3520,ARG
IF ARG > -1
	;수라
	IF SKILLGAGE_F_GET(ARG,[[스킬:분노폭발]]) == 0
		SIF SKILLGAGE_H_GET(ARG,3520) == 0
			RETURN 50
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 50
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN 80
	;羅刹
	ELSE
		SIF SKILLGAGE_H_GET(ARG,3520) == 0
			RETURN 40
		SIF SKILLGAGE_H_GET(ARG,3520) == 1
			RETURN 70
		SIF SKILLGAGE_H_GET(ARG,3520) == 2
			RETURN 50
	ENDIF
ENDIF
RETURN 50

;추가효과 부여확률상한
@SKILL_ADDTIONAL_MAX_RATE_3520,ARG
RETURN 100

;====================================================
;ダメージ発動時
;====================================================
@SKILL_DAMAGE_EFFECT_3520,ARG,ARG:1
IF ARG > -1
	;수라
	IF SKILLGAGE_F_GET(ARG,[[스킬:분노폭발]]) == 0
		IF SKILLGAGE_H_GET(ARG,3520) == 1
			CFLAG:(ARG:1):크리티컬강화 = MAX(-4, CFLAG:(ARG:1):크리티컬강화 - 1)
			PRINT  & 여크리티컬률 다운
		ELSEIF SKILLGAGE_H_GET(ARG,3520) == 2
			CFLAG:(ARG:1):방어강화 = MAX(-16, CFLAG:(ARG:1):방어강화 - 4)
			CFLAG:(ARG:1):마법효과강화 = MAX(-16, CFLAG:(ARG:1):마법효과강화 - 4)
			CFLAG:(ARG:1):BS부착률강화 = MIN(4, CFLAG:(ARG:1):BS부착률강화 + 4)
			PRINT  & 방어 저하 & 마법효과 저하 & BS부착률 UP
		ENDIF
	;羅刹
	ELSE
	ENDIF
ENDIF


;====================================================
;行動によるスキルゲージ操作
;====================================================
@SKILLGAGE_CHARGE_3520,ARG,ARG:1
SIF FLAG:행동순2 < 0
	CALL SKILLGAGE_H_SET,ARG,3520,0

;====================================================
;스킬 및 행동의 실행
;====================================================
@ACTION_3520,ARG,ARG:1
;수라
IF SKILLGAGE_F_GET(ARG,[[스킬:분노폭발]]) == 0
	CALL ATTACK_FIELD,ARG,ARG:1,3520
	SIF SKILLGAGE_H_GET(ARG,3520) > 0
		CALL SKILLGAGE_D_SET,ARG,[[스킬:분노폭발]],0
;羅刹
ELSE
	LOCAL = POS(ARG:1)
	SIF SKILLGAGE_H_GET(ARG,3520) > 0
		FLAG:확산플래그 = 1
	CALL ATTACK_SINGLE,ARG,LOCAL,3520
	SIF SKILLGAGE_H_GET(ARG,3520) > 0 && CFLAG:LOCAL:현데미지 > 0
		CALL SKILLGAGE_D_SET,ARG,[[스킬:분노폭발]],0
	FLAG:확산플래그 = 0
ENDIF
;IF POS(ARG:1) >= 0 && LOCAL:1 > BASE:POS(ARG:1):ＨＰ && GET_STATE(CFLAG:POS(ARG:1):상태이상) != "DYING"
;	FLAG:확산플래그 = 1
;;	CFLAG:ARG:베어내기플래그 = 1
;	CFLAG:POS(ARG:1):방어플래그 = 0
;	CALL ATTACK_SINGLE,ARG,LOCAL,3520,1
;	FLAG:확산플래그 = 0
;ENDIF

;====================================================
;실행내용 여기까지
;====================================================

;====================================================
;追加コマンド(EXTRAの下)
;====================================================
@SKILL_SPECIAL_COMMAND_EXTRA_3520,ARG,LOCAL
#LOCALSIZE 1
CALL TRUE_SKILL_COST,ARG,3520
IF SKILLGAGE_D_GET(ARG,[[스킬:분노폭발]])
	PRINTFORML [{LOCAL}] 오의
	C:LOCAL = 13520
	LOCAL += 1
ENDIF
RETURN LOCAL

;====================================================
;コマンド実行
;====================================================
@INPUT_COM_13520,ARG
#LOCALSSIZE 1
#LOCALSIZE 3
#DIM STOCK
#DIM LCOUNT
#DIM LINE
LINE = LINECOUNT
VARSET LOCAL
STOCK = SKILLGAGE_H_GET(ARG,3520)
FOR LCOUNT,0,3
	CALL SKILLGAGE_H_SET,ARG,3520,LCOUNT
	CALL CHECK_ACTIONABLE,ARG,3520
	IF RESULT && (LCOUNT < 2 || (LCOUNT == 2 && (SKILLGAGE_H_GET(ARG,[[스킬:분노폭발]]) == 200 || 현HP비율(ARG) < 26)))
		LOCAL:LCOUNT = 1
		CALL SKILL_NAME_3520,ARG
		LOCALS = %RESULTS%
		CALL TRUE_SKILL_COST,ARG,3520
		PRINTFORML [{LCOUNT+1}] %LOCALS, 38, LEFT%{RESULT, 3}ＭＰ
	ENDIF
NEXT
DRAWLINE
PRINTL [0] ＣＡＮＣＥＬ
CALL INPUTINT(0,1,2,3)
IF RESULT > 0 && LOCAL:(RESULT - 1) > 0
	CALL SKILLGAGE_H_SET,ARG,3520,RESULT - 1
	CALL SELECT_SKILL_INPUT,ARG,3520
	SIF RESULT > -1
		RETURN 1
ELSEIF RESULT == 0
	CALL SKILLGAGE_H_SET,ARG,3520,STOCK
	RETURN -1
ENDIF
CLEARLINE LINECOUNT - LINE
RESTART

;　 설명문 표시
@SKILL_EXPLAIN_3520
IF U > -1
	IF CFLAG:(CHARANUM-1):PT플래그 && HAVE_SKILL(U, [[스킬:분노폭발]])
		;戦闘中じゃない時のスキル説明
		PRINTL 분노상태가 되면 오의가 생긴다。커맨드의 오의에서 사용할 수 있다。
		PRINTL 또한 분노폭발 또는 HP 25% 이하면 비오의(秘奥義)를 사용할 수 있게 된다。오의、비오의를 사용하면 분노상태가 사라진다
		PRINTL 수라　　통상　비구・주살 １열 공격 + BIND
		PRINTL 　　　　오의　비구・정신・주살 전체 4회 공격 + CHARM + 여크리티컬률 다운
		PRINTL 　　　비오의　신경・주살・만능 전체 공격 + PALYZE +방어・마법효과 저하+BS내성 저하
		PRINTL 나찰　　통상　검격・만능 １체 공격 + DYING
		PRINTL 　　　　오의　검격・주살 １체 6회 공격 + CURSE + 높은 크리티컬률
		PRINTL 　　　비오의　검격・주살・만능 １체 10회 공격 + DYING + 높은 크리티컬률
	;수라
	ELSEIF SKILLGAGE_F_GET(U,[[스킬:분노폭발]]) == 0
		IF SKILLGAGE_H_GET(U,3520) == 0
			PRINTL 자신의 그림자에 무기를 박아넣고、그 무기가 공간을 넘어 공중에서 기습을 가한다。
			PRINTL 적 1열에 비구+주살의 복합속성의 대 데미지를 주고 BIND 상태로 만든다
		ELSEIF SKILLGAGE_H_GET(U,3520) == 1
			PRINTL 연인의 화톳불(篝火)의 환영을 반복해 내비치면서 연속 공격한다。카게마이・무쿠이
			PRINTL 적 전체에 비구+정신+주살의 4회 데미지를 주고 CHARM 상태로 만들어、여크리티컬률을 낮춘다
		ELSEIF SKILLGAGE_H_GET(U,3520) == 2
			PRINTL 간헐천처럼 그림자를 뿜어올리는 기술。접촉한 적을 어둠에 휩싼다
			PRINTL 적 전체에 신경+주살+만능의 초특대 데미지를 주고 PALYZE 상태로 만들어、방어・마법효과・BS내성을 낮춘다
		ENDIF
	;羅刹
	ELSE
		IF SKILLGAGE_H_GET(U,3520) == 0
			PRINTL 잡은 상대를 자신의 그림자로 끌어들여 공격한다。
			PRINTL 1체에 검격+만능의 대 데미지를 준다。즉사시키는 경우가 있다
		ELSEIF SKILLGAGE_H_GET(U,3520) == 1
			PRINTL 카게마이・유메비키
			PRINTL 1체에 검격+주살의 6회 데미지를 주고 CURSE 상태로 만든다。크리티컬률이 높다
		ELSEIF SKILLGAGE_H_GET(U,3520) == 2
			PRINTL 상대를 자신의 그림자 속으로 끌어들여、그 속에서 상대를 무참히 벤다
			PRINTL 1체에 검격+주살+만능의 10회 데미지를 준다。크리티컬률이 높고、만능 속성으로 즉사시킨다
		ENDIF
	ENDIF
ELSE
	PRINTL 자신의 그림자에 무기를 박아넣고、그 무기가 공간을 넘어 공중에서 기습을 가한다。
	PRINTL 적 1열에 비구+주살의 복합속성의 대 데미지를 주고 BIND 상태로 만든다
ENDIF
;PRINTL 상대를 자신의 그림자 속으로 끌어들여、그 속에서 상대를 무참히 벤다
;PRINTL 첫 번째 공격에 성공하면、필중에 즉사 효과가 있는 10연격을 한다

;계승에 필요한 부위
@계승부위_3520,ARG
RETURN 1


;사용조건
@SKILL_SPECIAL_ACTIONABLE_3520,ARG
RETURN 1
;とくにない

