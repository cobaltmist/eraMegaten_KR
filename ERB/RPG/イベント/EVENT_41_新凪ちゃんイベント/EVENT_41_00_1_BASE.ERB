;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;
;	Module		:EVENT_41_00_1_BASE.ERB
;	Facility	:コドクノマレビトMOD/凪ちゃんイベント群/イベント管理部分
;
;	Licence		:ライセンスフリー。
;
;	Modification Data:
;
;	Edit	Date			Author					Reason
;	001		20XX/XX/XX		？？？					新規作成
;	002		2022/03/19？	NEO						エクストラルートの誤字脱字修正……
;	003		2022/03/21？	NEO						……だけのつもりが、エクストラルートが『ニンジャスレイヤー』の文章丸パクだってことが発覚したのでせめてもの抵抗としてメガテンナイズ……
;	004		2022/03/22？	NEO						……だけのつもりが、エクストラルートのボスのバランスが大変なことになってたのでその修正……
;	005		2022/05/03		NEO						……だけのつもりが、全編テキストを直したくなったのでその修正……
;	006		2022/05/05		NEO						……だけのつもりが、全編ボスのバランスが大変なことになってたのでその修正……
;	007		2022/05/06		NEO						……だけのつもりが、ダンジョンもバグ出てて直すのが面倒なことになってたのでダンジョンを切り分け……
;	008		2022/05/07		NEO						……だけのつもりが、「これもうイチから作った方が早いな」ってなったので、関連ファイルの全変更開始、『ちょっと手直し』じゃ済まなくなったので『コドクノマレビト』履修開始
;	009		2022/06/01		NEO						Ver0.1。まだまだ未完成。
;													　ほぼ新造パッチになったため、フォルダ分け。
;													　雰囲気としてこんな感じになるよ……というのを見せるため公開。
;													　エクストラルートは丸パクを直すのが大変なのでひとまずカットしますわよ。
;
;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#

;================================================================================================================
;●なんか参考になるの欲しいな～と思ってるあなたへ
;================================================================================================================
;　Read Meは***必ず***散逸するので、重要なことは全部ここに書いておこうね。
;　3か月も経ったら人間別人になるので、必要なことはきちんとメモしておこうね。
;================================================================================================================

;================================================================================================================
;●フォルダ構成について
;================================================================================================================
;　なんかもう色々と組み替えた結果、既存のファイルは一回全部空ファイルにします。しました。
;　空ファイルにはしたけど、既存ファイルと階層が同じだと面倒なことになるので、
;　「新凪ちゃんイベント」というフォルダを作成し、その下部に作成しています。
;　（バニラにはないイベントなので、カーチャンパッチで対応してほしいトコロではありますが、ちょっと望み薄かな）
;　それはそれとして、BASEファイルは一番上に来てほしいので、ちょっとお名前を工夫してます……
;================================================================================================================

;================================================================================================================
;●イベント変数群
;================================================================================================================
;・이벤트플래그:41:0
;　――ルート分岐変数
;　　0：開始前
;　　1：仲魔にした/凪仲魔ルート
;　　2：拒否した/凪敵対ルート/コドクノマレビト参加ルート
;　　3：奴隷にした/即時終了
;　　4：悪魔人間殺すべし/Extra：アクマニンゲンスレイヤールート
;　　5：供倶璃の媛/串蛇ルート（予定）
;・이벤트플래그:41:1
;　――進行変数
;　이벤트플래그:41:0と絡めてルート分岐・進行を行う
;　　EVFLAG:41:0 == 0/ルート開始前
;　　　0-0：イベント「セルフ修行のプロセスを希望です」発生
;　　EVFLAG:41:0 == 1/凪仲間ルート
;　　　ヤタガラスの協力者として凪ちゃんと一緒にコドクノマレビトを壊滅させるルート
;　　　01：イベント「ダークサマナーを退治するプロセスです」発生
;　　　　　凪のレベルが足りない場合は「セルフ修行中のプロセスです」が発生しイベント進行が一時停止
;　　EVFLAG:41:0 == 2/凪敵対ルート
;　　　コドクノマレビトの協力者として凪ちゃんをイジメ倒すルート
;　　　01：イベント「ダークサマナーの護衛」発生
;　　EVFLAG:41:0 == 3/凪奴隷ルート
;　　　99：イベント終了
;　　EVFLAG:41:0 == 4/アクマニンゲンスレイヤールート
;　　　（カット）
;　　EVFLAG:41:0 == 5/串蛇ルート
;　　　（凪仲間ルート途中から分岐）（※予定）
;　　　『コドクノマレビト』原作にもう少し近いストーリーで進行
;　　　（もちろんあなたはライドウではないし、セイメイとの友情もないので、色々変更アリ）

;・이벤트플래그:41:2
;　――メッセージイベント表示用フラグ
;　　凪を入れてから来いよ！　とかそういうのを表示するだけのイベント
;・이벤트플래그:41:3
;　――凪凌辱変数
;　　凪敵対ルートにて、凪を凌辱した回数をカウントする
;・이벤트플래그:41:4
;　――凪スキル習得変数
;　　凪仲間ルートにて、凪がスキルを習得する

;=======================================================================================================================================================

;=======================================================================
;●ルート分岐
;=======================================================================
;ルート分岐が発生する
;　├凪仲間ルート┬凪仲間ルート
;　｜｜　　　　　└串蛇媛ルート（中盤から分岐予定）
;　｜└悪魔人間殺すべしルート（EXTRAイベント。凪が既に仲間になっている場合のみ選択可能）（テキスト書き直すまで封印）
;　├凪敵対ルート┬犯した回数が３回以下の最終戦
;　｜　　　　　　└犯した回数が４回の最終戦
;　└凪奴隷（イベント終了）
;=======================================================================================================================================================

;=======================================================================
;●報酬
;=======================================================================
;・凪仲間ルート
;　1.凪の早期加入
;　　まあ条件が「あなたのLv35」なので、早期とも言い切れないが……
;　2.凪の忠誠度＋
;　　元パッチでは＋4000が雑に入ってたのでもう少し少なくはする
;　　最終的に未調教陥落が狙える程度には多くするが
;　3.凪がスキルを習得する
;　　低周回向け。
;　　凪が様々なスキルを、イベントクリアで習得する。
;　4.エンディングの発生
;　5.凪に受胎アイテム：スキルカード「ヨシツネ見参」の設定
;・凪敵対ルート
;　1.仲間ルートでは仲間にならないキャラの加入
;　　『コドクノマレビト』原作のキャラがこちらのルートで限定加入
;　2.名声・金銭的報酬が美味しい
;　　ガッツリ裏社会側にかかわるため。
;　3.強化凪の参加
;　　カッ飛んだ性能した凪ちゃんが仲魔になる、かも。
;　　犯した回数に応じて、初期能力などが変化、陥落状態で参加などがありえる。
;　4.凪に受胎アイテム：スキルカード「ヨシツネ見参」の設定
;・凪奴隷
;　特にメリットはない。イベントが終了する。
;・忍殺EX
;　今のところカットするので考えてないです。実装するとしたら「ナギ」に名前が変化してスキルなどがニンジャっぽくなる感じだろうか。
;・串蛇ルート
;　1.凪仲間ルートでは仲間にならないキャラの加入
;　　串蛇《くしなだ》が仲魔になる。
;　　霊媒体質の非戦闘員。
;　2.エンディングの発生
;　3.クリア報酬武器の追加
;　　串蛇のレベルに応じた性能になる武器の予定。
;　　つまり「周回したら串蛇を便器に突っ込む」のが最適解になるわけだが、まあeraらしくていいよね。最悪だよ。
;
;=======================================================================================================================================================

;================================================================================================================
;●レベル設計
;================================================================================================================
;나기仲間ルート
;　01.イベント「ダークサマナーを退治するプロセスです」
;　　凪Lv25、あなた35程度
;　　弱め設定
;　　（凪を育てる過程であなたのLvが40程度になってるだろうと思われるので）
;나기敵対ルート
;　01.イベント「ダークサマナーを退治するプロセスです」
;　　vs凪その１
;　　あなた35程度
;　　ヨシツネLv57のクソゲーに耐えられるのがどのくらいのレベルになるか確認のこと
;
;
;XX.最終戦
;　凪仲間ルート
;　　想定Lv80程度
;　　Lv比例型ボス（最高レベル＋20）の予定
;　　イベント戦の風味で、みんなで一緒にデカ目玉をぶっ殺そうぜ！！！という感じ
;　凪敵対ルート
;　　想定Lv80/99+程度
;　　シナリオ進行中、凪を何度犯したかによって分岐
;　　３回以下：凪ちゃんはあなたを追って必死に頑張りました。
;　　４回以下：凪ちゃんは　発狂した
;
;================================================================================================================


;=======================================================================================================================================================
;●条件
;===========================================================================================================================================================================
@PLAYABLE_EVENT_41

	;나기ちゃんの番号とかを取得
	CALLF FINDCHARA_B([[キャラ:나기]])
	LOCAL = RESULT:1

	;いきなり奴隷にしたとかエンディングを迎えたとかでイベントが強制終了
	SIF 이벤트플래그:41:0 == 99 || 이벤트플래그:41:1 == 99 
		RETURN 0

	;나기を入れてから来いよ！　とかそういうのを表示するだけのイベント用変数の初期化
	이벤트플래그:41:2 = 0

	;一定以上進行したあと、闘技場で星命と戦っていると不可
	;※進行が進むと星命とは戦えなくなるようにするが、念のため。
	IF 이벤트플래그:41:1 >= 2 && 투기장플래그:14:0 == 1
		;終了フラグを念のため立てる
		이벤트플래그:41:1 = 99
		RETURN 0

	;================================================================================================================================================================
	;初回イベント：セルフ修行のプロセスを希望です
	;================================================================================================================================================================
	ELSEIF 이벤트플래그:41:0 == 0
		;名声1000以上、Lv35以上で開始
		IF FLAG:명성 >= 1000 && BASE:MASTER:LV >= 35
			RESULTS = セルフ修行のプロセスを希望です
			RETURN 1
		ENDIF


	;今はまだ途中でごわす！
	ELSEIF 이벤트플래그:41:1 >= 2 && 이벤트플래그:41:1 != 99 && (이벤트플래그:41:0 == 1 || 이벤트플래그:41:0 == 2)
		RESULTS = 凪ちゃんイベントは制作中のプロセスです。
		이벤트플래그:41:2 = 2
		RETURN 1


	;================================================================================================================================================================
	;나기を仲魔にしたルート/凪仲間ルート
	;================================================================================================================================================================
	ELSEIF 이벤트플래그:41:0 == 1
		;イベント発生不可チェック
		;나기ちゃんが出撃不可ならイベントが出てこない
		SIF (GETCHARA(4768) > 0 && CFLAG:GETCHARA(4768):전투참가불가능 < 1) == 0
			RETURN 0

		;나기ちゃんがPTに入ってないと「入れてね！」ってだけのイベントになる
		IF FINDCHARA_B([[キャラ:나기]]) != 2
			RESULTS = （凪をPTに入れてください）
			이벤트플래그:41:2 = 1
			RETURN 1
		ENDIF

		IF 0
		;イベント「ダークサマナーを退治するプロセスです」＆「セルフ修行中のプロセスです」
		ELSEIF 이벤트플래그:41:1 == 1
			IF BASE:LOCAL:LV > 24
				RESULTS = ダークサマナーを退治するプロセスです
			ELSE
				RESULTS = セルフ修行中のプロセスです
			ENDIF
			RETURN 1
		ENDIF

		;「本来のルート」という記載で下記の条件があったが、こちらは作られていない模様。
		;（「ダークサマナーを退治するプロセスです」の次から分岐のようだ）
		;もしやるなら、「이벤트플래그:41:0 == 5」の場合で分岐させるとかになると思う
		;=======================================================================================================
		;本来のルート
		;ELSEIF BASE:LOCAL:LV > 44 && 이벤트플래그:41:2 == 0
		;	RESULTS = ヤタガラス試験のセオリーです
		;	RETURN 1
		;ELSEIF FINDCHARA_B(4762,0) == 2 && BASE:GETCHARA(4768):LV > 74
		;	RESULTS = ゲイリン襲名試験のセオリーです
		;	RETURN 1
		;======================================================================================================

	;================================================================================================================================================================
	;나기を拒否したルート/凪敵対ルート/コドクノマレビト協力ルート
	;================================================================================================================================================================
	ELSEIF 이벤트플래그:41:0 == 2
		;イベント発生不可チェック
		;こっちでは凪が最後まで仲魔にならないので、凪ちゃんのチェックは要らない

		;마요네が存在しているチェックも必要そうな気はする
		;もうマヨーネ、どこからでもわかりやすいようにフラグ立てたほうがいいんじゃねーかな、いやもしかしてある？
		;eraMegatenのメインヒロインだし……
		;ともあれ、いるものとして、カット。


		IF 0
		;イベント「ダークサマナーの護衛」
		ELSEIF 이벤트플래그:41:1 == 1
			RESULTS = ダークサマナーの護衛
			RETURN 1
		ENDIF

	;================================================================================================================================================================
	;初手凪を奴隷にしたルート
	;================================================================================================================================================================
	ELSEIF 이벤트플래그:41:1 == 3
		;なにも発生しない

	;================================================================================================================================================================
	;악마인間殺すべしルート
	;================================================================================================================================================================
	ELSEIF 이벤트플래그:41:1 == 4
		;書き直すまで封印
		RETURN 0

;		IF 0
;		;イベント「豆腐への怒りのプロセスです。」
;		ELSEIF 이벤트플래그:41:0 == 1
;			RESULTS = 豆腐への怒りのプロセスです。
;			RETURN 1
;		;イベント「死の蝶のプロセスです。」
;		ELSEIF 이벤트플래그:41:0 == 2
;			RESULTS = 死の蝶のプロセスです。
;			RETURN 1
;		;イベント「墓場の上で踊る幽霊のプロセスです。」
;		ELSEIF 이벤트플래그:41:0 == 3
;			RESULTS = 墓場の上で踊る幽霊のプロセスです。
;			RETURN 1
;		;イベント「汚水からの人魚のプロセスです。」
;		ELSEIF 이벤트플래그:41:0 == 4
;			RESULTS = 汚水からの人魚のプロセスです。
;			RETURN 1
;		;イベント「とても合理的なプロセスです。」
;		ELSEIF 이벤트플래그:41:0 == 5
;			RESULTS = とても合理的なプロセスです。
;			RETURN 1
;		ENDIF

	;================================================================================================================================================================
	;쿠시나다を仲魔にしたルート/串蛇ルート/原作に近いルート
	;================================================================================================================================================================
;	ELSEIF 이벤트플래그:41:0 == 5
;		;イベント発生不可チェック
;		;나기ちゃんが出撃不可ならイベントが出てこない
;		SIF (GETCHARA(4768) > 0 && CFLAG:GETCHARA(4768):전투참가불가능 < 1) == 0
;			RETURN 0
;		;クシナダちゃんが存在してないと不可（保護していることが前提のシナリオのため）
;		SIF クシナダちゃんが存在していない
;			RETURN 0
;		★串蛇を調教しており、陥落していないなら進めない
;		★（調教していないか、調教して陥落させたならOK）
;		SIF クシナダちゃんを調教した && クシナダちゃんが陥落してない
;			RETURN 0
;
;		IF 0
;		;나기仲間ルートの途中から分岐するため、イベント進行フラグはXから
;		;イベント「～～～～」
;		ELSEIF 이벤트플래그:41:1 == X
;			RESULTS = イベントタイトルやで
;			RETURN 1


	ENDIF
	RETURN 0






;================================================================================================================================================================
;●内容
;================================================================================================================================================================
@SHOPCOM_EVENT_41


	;================================================================================================================================================================
	;初回イベント：セルフ修行のプロセスを希望です
	;================================================================================================================================================================
	IF 이벤트플래그:41:0 == 0
		CALL EVENT_41_0_0


	;イベント「凪ちゃんイベントは制作中のプロセスです」
	;今はまだ途中でごわす！
	ELSEIF 이벤트플래그:41:2 == 2
		CALL EVENT_41_0_X

	;================================================================================================================================================================
	;나기を仲魔にしたルート/凪仲間ルート
	;================================================================================================================================================================
	ELSEIF 이벤트플래그:41:0 == 1

		IF 0

		;イベント「（凪をPTに入れてください）」。
		;나기入れてから来いよ！
		ELSEIF 이벤트플래그:41:2 == 1
			CALL EVENT_41_1_X

		;イベント「ダークサマナーを退治するプロセスです」
		ELSEIF 이벤트플래그:41:1 == 1
			CALL EVENT_41_1_1
;		;イベント「～～～」
;		;DUN「～～～」に行けるようになるイベント
;		ELSEIF 이벤트플래그:41:1 == 2
;			CALL EVENT_41_1_2
		ENDIF

	;================================================================================================================================================================
	;나기を拒否したルート/凪敵対ルート/コドクノマレビト協力ルート
	;================================================================================================================================================================
	ELSEIF 이벤트플래그:41:0 == 2

		IF 0
		;イベント「ダークサマナーの護衛」
		ELSEIF 이벤트플래그:41:1 == 1
			CALL EVENT_41_2_1
		ENDIF

	;================================================================================================================================================================
	;初手凪を奴隷にしたルート
	;================================================================================================================================================================
	ELSEIF 이벤트플래그:41:0 == 3
		;なにも発生しない

	;================================================================================================================================================================
	;악마인間殺すべしルート
	;================================================================================================================================================================
	ELSEIF 이벤트플래그:41:0 == 4
		;書き直すまで封印
;		IF 0
;		;イベント「豆腐への怒りのプロセスです。」
;		ELSEIF 이벤트플래그:41:0 == 1
;			CALL EVENT_41_4_1
;		;イベント「死の蝶のプロセスです。」
;		ELSEIF 이벤트플래그:41:0 == 2
;			CALL EVENT_41_4_2
;		;イベント「墓場の上で踊る幽霊のプロセスです。」
;		ELSEIF 이벤트플래그:41:0 == 3
;			CALL EVENT_41_4_3
;		;イベント「汚水からの人魚のプロセスです。」
;		ELSEIF 이벤트플래그:41:0 == 4
;			CALL EVENT_41_4_4
;		;イベント「とても合理的なプロセスです。」
;		ELSEIF 이벤트플래그:41:0 == 5
;			CALL EVENT_41_4_5
;		ENDIF
	;================================================================================================================================================================
	;쿠시나다を仲魔にしたルート/串蛇ルート/原作に近いルート
	;================================================================================================================================================================
	ELSEIF 이벤트플래그:41:0 == 5

;		IF 0
;		;나기仲間ルートの途中から分岐するため、イベント進行フラグはXから
;		;イベント「～～～～」
;		ELSEIF 이벤트플래그:41:1 == X
;			CALL EVENT_41_5_X


	ENDIF


;メモ：「連続イベントが再出現した場合に再表示するためのやつ」
;;ARG＝番号、ARG:1＝0：ダンジョン、1：闘技場、2：イベント、3：依頼

@EVENT_41_FLAG_RESET

CALL FLAG_RESET,41,2


