;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;
;	Modification Data:
;
;	Edit	Date			Author					Reason
;	001		20xx/xx/xx		----					新規作成
;	002		2011/01/15		旅人					PARTY情報の味方表示部に色を付ける
;	003		2011/01/25		旅人					PARTY情報の表示部に色を付ける
;	004		2011/02/05		風花救済計画			特定スキルの条件チェック追加
;	005		2011/02/15		黒天					仲魔にいる悪魔が敵にいる場合名前の色が変わるように
;	006		2011/02/16		Ｎ鳥					悪魔ストレージ機能に対応
;	007		2011/03/18		P						ストレージ機能に合わせて、若干処理を追加
;	008		2011/03/23		UNP						セットアップ画面での誤爆クリックを予防・ポジションチェンジのキャンセルを実装
;	009		2012/12/02		ネトリス				ムフフ展開のＧＯＯＤの色の変化を『CFLAG:ダンジョン内発情用欲情値』を参照にするように変更
;	010		2012/12/02								招来の舞踏用に死者だけリスト化するのを追加(サバトマの逆)
;	011		2013/03/05		銃Ｐ					召喚/編入のリストでＣＯＭＰにいるか表示、最初のページと最後のページを行き来できるように加筆
;	012		2013/11/24		ひみつ					リスト表示数設定
;	013		2017/06/23		kuni					キャラ表示でINPUT_CHARA_LISTを使用するように変更
;	014		2018/10/20		JK好き					INSERT_POSITIONを悪魔人に対応
;	015		2019/02/05		(ﾟдﾟ)					画像表示について、伽耶ちゃんズに対応（力技）
;	016		2019/03/17		名無					マインドシーカー(常時アンノウン状態アプリ)追加
;	016		2019/04/20		TR(SAYA)				解析度最大のキャラは色を変えて表示する様に
;	017		2019/08/03		ypa     				画像表示処理修正
;	018		2019/08/24		空気					サマナーLv1から相手の耐性を表示できるように(ANALYZEはできるのに表示されないので面倒なだけだった)
;	019		2019/08/29		空気					MAXHP、MAXMP5桁以上で表示がずれる問題修正
;	020		2020/02/02		木綿豆腐 				デビルシフター/喰奴/悪魔憑きは悪魔変身時の画面の顔グラを設定できるように
;	021		2020/02/28		Jガン					Cflag:アナライズ不可　追加　このフラグがONだと耐性？に
;	022		2020/06/12		なんとなくの人			画像エディットの画像を表示できるように
;	023		2020/08/20		JK好き					戦闘中に表示切替ボタンでキャラの防御壁を確認できるように追加 @SHOW_NOW_FORMATION_P @SHOW_NOW_FORMATION_E
;	024		2021/02/07		Rsp暇人					文字数が多くてレイアウトが崩れる場合に短縮形を使うように。EDIT002,003,004のコメントアウト部分を削除（もう10年間問題なく動いているから残す必要はないと思う）
;	025		2021/02/21		Rsp暇人					名前部分の文字色変更戻し用RESETCOLORを削除してたので修正
;	026		2021/05/17		しゃけ					ラグナロク（ＡＮ）起動中にポジションから外された場合、ゲージをリセットする処理を追加
;	023		2021/08/31		JK好き					@SHOW_NOW_FORMATION_P　名前が長いキャラがいると画像表示が崩れる問題を修正
;	023		2022/05/22		Collared				外見固定処理を追加
;	024		2022/06/10		Collared				UI整理プロジェクトによりショップコマンドフラグを参照するよう変更
;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#


;==================================
;召喚
;==================================
@SETUP_SUMON
PRINTL
CALL SHOW_NOW_FORMATION_P,0,2, 3
PRINTC [1000] - 돌아간다
PRINTL
DRAWLINE
PRINTL 어디에 소환합니까？

$INPUT_LOOP
INPUT
IF RESULT == 1000
	RETURN 0
ELSEIF RESULT < 7 && 0 < RESULT
	LOCAL = RESULT
	$INPUT_LOOP2
	CALL CHOOSE_COMPANION,2
	LOCAL:1 = RESULT
	IF RESULT == 1000
		RESTART
	ELSE
		;---- EDIT 007 ADD START -------------------------
		IF POS(LOCAL) > 0 && CFLAG:POS(LOCAL):소속ＣＯＭＰ == -1 && FLAG:SHOP커맨드 == [[SHOP:탐색]] && !(LOCAL < 4 && POS(LOCAL+3) == -1)
			PRINTFORML %조사처리(CALLNAME:POS(LOCAL),"는")% 자택 서버에 등록된 악마입니다다.
			PRINTL 던전에서는 자택 서버에 등록된 악마를 파티에서 제외할 수 없습니다
			PRINTW 다른 포지션을 선택해서 소환하십시오
			CLEARLINE 3
			GOTO INPUT_LOOP2
		ENDIF
		;---- EDIT 007 ADD END   -------------------------
		;LOCAL:2 = FLAG:SHOP커맨드
		;FLAG:SHOP커맨드 = 106
		CALL INSERT_POSITION,LOCAL,LOCAL:1
		;FLAG:SHOP커맨드 = LOCAL:2
		IF RESULT > -1
			SELECTCASE FLAG:SHOP커맨드
				CASE [[SHOP:탐색]],[[SHOP:콜로세움참가]],[[SHOP:이벤트]],[[SHOP:의뢰청부]]
					IF CFLAG:(LOCAL:1):PT플래그 > 0 && ABL:(LOCAL:1):종족 != 0
						BASE:MASTER:ＭＡＧ -= MAXBASE:(LOCAL:1):￥
					ENDIF
			ENDSELECT
		ENDIF
	ENDIF

	RESTART
ELSE
	GOTO INPUT_LOOP
ENDIF

CALL REFRESH_FORMATION

;==================================
;포지션변경
;==================================
@SETUP_FORMATION
#LOCALSIZE 2
PRINTL
DRAWLINE
DRAWLINE
LOCAL:1 = LINECOUNT
PRINTL 포지션변경
$START
CLEARLINE LOCAL:1 - LINECOUNT
CALL SHOW_NOW_FORMATION_P,0,2, 3
DRAWLINE
PRINT 바꿔넣을 포지션을 선택하십시오(
PRINTBUTTON "[  0] - 돌아간다",0
PRINT 　
PRINTBUTTON "[  9] - 전부변경",9
PRINTL )
CALL INPUTINT(0, 1, 2, 3, 4, 5 ,6, 9)
SIF RESULT == 0
	RETURN 0
IF RESULT == 9
	CALL SETUP_FORMATIONS
	SIF RESULT
		RETURN 0
	GOTO START
ENDIF
LOCAL = RESULT
CLEARLINE LOCAL:1 - LINECOUNT
CALL SHOW_NOW_FORMATION_P,0,2, 3
DRAWLINE
PRINTFORM [ {LOCAL}]와(과) 바꿀 포지션을 선택하십시오 (
PRINTBUTTON "[  0] - 취소",0
PRINTL )
CALL INPUTINT(0, 1, 2, 3, 4, 5 ,6)
SIF RANGE(RESULT, 1, 6)
	CALL CHANGE_POS,LOCAL ,RESULT
GOTO START
@SETUP_FORMATIONS
#DIM LCOUNT
#LOCALSIZE 3
VARSET Q,-1
;PRINTL
;DRAWLINE
;DRAWLINE
CALL SHOW_NOW_FORMATION_P,0,2, 3
DRAWLINE
;PRINTL 포지션を변경します
VARSET Q,-1
LOCAL = 0
FOR LCOUNT, 0, CHARANUM
	SIF CFLAG:LCOUNT:PT플래그 != 2
		CONTINUE
	Q:LOCAL = LCOUNT
	;元の포지션を保存
	Q:(10+LOCAL) = CFLAG:LCOUNT:포지션
	LOCAL += 1
NEXT

FOR LCOUNT, 0, 6
	LOCALS = 포지션{LCOUNT+1}
	IF FLAG:LOCALS > -1
		;各포지션の数値を保存
		Q:(20+LCOUNT) = FLAG:LOCALS
		
		CFLAG:(FLAG:LOCALS):포지션 = 0
		FLAG:(LOCALS) = -1
	ENDIF
NEXT
FOR LOCAL:2,0,LOCAL
	CALL SHOW_NOW_FORMATION_P,0,2, 3
	DRAWLINE
	PRINTFORM %CALLNAME:(Q:(LOCAL:2))%의 포지션은？ (
	PRINTBUTTON "[  0] - 취소",0
	PRINT 　
	PRINTBUTTON "[  9] - 이전으로 돌림",9
	PRINTL )
	$INPUT_LOOP
	INPUT
	LOCALS = 포지션{RESULT}
	;戻る
	IF RESULT == 9 && LOCAL:2 > 0
		LOCAL:2--
		CALL REMOVE_POSITION, Q:(LOCAL:2+30)
		FLAG:(LOCALS) = Q:(LOCAL:2 + 20)
		CFLAG:(Q:(LOCAL:2)):포지션 = 0
		LOCAL:2--
	ELSEIF RESULT == 0
		;キャンセル
		FOR LCOUNT, 0, 6
			IF Q:LCOUNT > -1
				CFLAG:(Q:LCOUNT):포지션 = Q:(10+LCOUNT)
			ENDIF
			
			LOCALS = 포지션{LCOUNT+1}
			FLAG:(LOCALS) = Q:(20+LCOUNT)
		NEXT
		RETURN 0
	ELSEIF RESULT < 1 || RESULT > 6 || FLAG:LOCALS > -1
		GOTO INPUT_LOOP
	ELSE
		Q:(LOCAL:2+30) = RESULT
		CALL INSERT_POSITION,RESULT,Q:(LOCAL:2)
	ENDIF
NEXT
CALL REFRESH_FORMATION
RETURN 1
;$INPUT_LOOP
;INPUT
;IF RESULT == 1000
;	RETURN 0
;ELSEIF RESULT < 7 && 0 < RESULT
;	LOCAL = RESULT
;	CALL CHOOSE_COMPANION,(FLAG:(70+LOCAL))
;	LOCAL:1 = RESULT
;	IF RESULT == 1000
;		RESTART
;	ELSEIF RESULT == 1002
;		CALL REMOVE_POSITION,LOCAL
;		RESTART
;	ELSEIF FLAG:(70+LOCAL) > -1 && CFLAG:(LOCAL:1):0 == 2
;		FLAG:2 = 110
;		CALL CHANGE_POSITION,FLAG:(70+LOCAL),LOCAL:1
;		FLAG:2 = 0
;	ELSE
;		FLAG:2 = 110
;		CALL INSERT_POSITION,LOCAL,LOCAL:1
;		FLAG:2 = 0
;	ENDIF
;
;	RESTART
;ELSE
;	GOTO INPUT_LOOP
;ENDIF

;==================================
;メンバーを外す：選択
;==================================
@SETUP_REMOVE
PRINTL
DRAWLINE
DRAWLINE
CALL SHOW_NOW_FORMATION_P,0,2, 3
DRAWLINE
PRINTC [0]그만둔다

PRINTL
DRAWLINE
PRINTL 누구를 제외합니까？
$INPUT_LOOP
INPUT
LOCALS = 포지션{RESULT}
IF RESULT == 0
	RETURN 0
ELSEIF FLAG:LOCALS > -1 && FLAG:LOCALS == MASTER
		PRINTFORMW %조사처리(CALLNAME:(FLAG:LOCALS), "를")% 파티에서 뺄 수는 없습니다
		CLEARLINE 1
		GOTO INPUT_LOOP
ELSEIF RESULT < 1 || RESULT > 6 || FLAG:LOCALS == 0 || FLAG:LOCALS == -1
	GOTO INPUT_LOOP
ELSE
	IF FLAG:SHOP커맨드 == [[SHOP:탐색]] && (ABL:(FLAG:LOCALS):종족 > 45 || ABL:(FLAG:LOCALS):종족 == 0) && ABL:(FLAG:LOCALS):종족 != 73
		PRINTW 던전내에서는 인간을 파티에서 제외할 수 없습니다
		CLEARLINE 1
		GOTO INPUT_LOOP
	ELSEIF FLAG:SHOP커맨드 == [[SHOP:탐색]] && TALENT:(FLAG:LOCALS):인수라
		PRINTW 던전내에서는 인수라를 파티에서 제외시킬 수 없습니다
		CLEARLINE 1
		GOTO INPUT_LOOP
	ELSEIF FLAG:SHOP커맨드 == [[SHOP:탐색]] && (CFLAG:(FLAG:LOCALS):소속ＣＯＭＰ == -1)
		PRINTW 던전내에서는 자택 서버에 등록된 악마를 파티에서 제외할 수 없습니다
		CLEARLINE 1
		GOTO INPUT_LOOP
	ENDIF
	CALL REMOVE_POSITION,RESULT
ENDIF
RESTART

;==================================
;メンバーを外す実行処理
;==================================
@REMOVE_POSITION,ARG
LOCALS = 포지션{ARG}
IF FLAG:(LOCALS) > -1
	CFLAG:(FLAG:LOCALS):포지션 = 0
	CFLAG:(FLAG:LOCALS):입력행동 = -1
	SIF CFLAG:(FLAG:LOCALS):PT플래그 > 0
		CFLAG:(FLAG:LOCALS):PT플래그 = 1
	SIF AUTO_PU_SKILL_ラグナロク（ＡＮ）(FLAG:LOCALS,"Hゲージリセット") > 0
		CALL SKILLGAGE_H_SET,FLAG:LOCALS,RESULT,0
ENDIF
FLAG:LOCALS = -1


;==================================
;아군パーティの描画
;==================================
;ARG:2 相性等표시してもよい状況か
;1:色リスト표시 2:상성等표시枠 4:강화・弱体化표시（전투중）　してもよい
;ARG:2がOK　かつ　FLAG:상성등표시ONがOK　の時표시する
;ARG:3 通常は0か생략
;셋업のメイン화면 1を指定
;탐색中のメイン화면 2を指定
;戦闘時ショートカットキーON 3を指定
@SHOW_NOW_FORMATION_P,ARG,ARG:1, ARG:2 = 0, ARG:3 = 0
#DIM LCOUNT, 4
#DIM LEN_NAME, 6
#DIM ERROR_CORRECTION, 6
#DIM CHARA_POSITION
#DIMS GAZOU_REIGAI
#DIM IMG_TYPE, 1 ;EDIT 017 ADD 
#DIMS SNAME, 1 ; EDIT 024 ADD
#LOCALSIZE 2
;---- EDIT 024 DEL START -------------------------
;表示する文字数がオーバーしないようにするため不要に
;;---- EDIT 019 MOD START -------------------------
;;CALLNAMEの長さ取得
;FOR LCOUNT, 0, 6
;	LOCALS = 포지션{LCOUNT+1}
;	LOCAL = FLAG:LOCALS
;	IF LOCAL >= 0
;		STRLENS CALLNAME:LOCAL
;		LEN_NAME:LCOUNT = RESULT
;	ELSE
;		LEN_NAME:LCOUNT = 0
;	ENDIF
;	;CALLNAMEが17バイト以上なら表示がズレるので修正するバイト数を記録
;	IF LEN_NAME:LCOUNT > 17
;		LEN_NAME:LCOUNT -= 17
;	ELSE
;		LEN_NAME:LCOUNT = 0
;	ENDIF
;NEXT
;;上下の段がズレていたら位置を合わせるため誤差を記録
;FOR LCOUNT, 0, 6
;	IF LCOUNT < 3
;		LOCAL = LCOUNT + 3
;	ELSE
;		LOCAL = LCOUNT - 3
;	ENDIF
;	
;	IF LEN_NAME:LCOUNT < LEN_NAME:LOCAL
;		ERROR_CORRECTION:LCOUNT = LEN_NAME:LOCAL - LEN_NAME:LCOUNT
;	ELSE
;		ERROR_CORRECTION:LCOUNT = 0
;	ENDIF
;NEXT
;---- EDIT 024 DEL END -------------------------

CUSTOMDRAWLINE =
PRINTL ＰＡＲＴＹ
FOR LCOUNT:1,ARG,ARG:1
	;色リスト표시１行目
	IF FLAG:상성등표시ON == 1 && GETBIT(ARG:2, 0) == 1 && LCOUNT:1 == 0
		CALL SHOW_AISYOU_COLOR_LIST, 0
		PRINTFORM %" " * 8%
	;色リスト표시　相性非표시の時の６行目
	ELSEIF FLAG:상성등표시ON == 1 && GETBIT(ARG:2, 0) == 1 && GETBIT(ARG:2, 1) == 0 && LCOUNT:1 == 1
		CALL SHOW_AISYOU_COLOR_LIST, 5
		PRINTFORM %" " * 8%
	;色リスト표시しないOR７行目以降
	ELSE
		PRINTFORM %" " * 17%
	ENDIF
	;---- EDIT 024 MOD START -------------------------
	SIF FLAG:커스텀게임화면 && !FLAG:화상표시설정
		PRINTFORM %" ",12%
	PRINT  
	FOR LCOUNT, 0, 3
		LOCALS = 포지션{LCOUNT+LCOUNT:1*3+1}
		LOCAL = FLAG:LOCALS
		GAZOU_REIGAI = ""
		;KR판 임의 미수정, 17-2 우선은 방치. 일판은 현재 16-2
		SNAME = %S_NAME(LOCAL, 17-2*!FLAG:커스텀게임화면, 2, "EMPTY"), 17-2*!FLAG:커스텀게임화면, LEFT%
		SIF LOCAL < 0
			SETCOLOR 0x404040
		IF ARG:3==2
			IF FLAG:커스텀게임화면
			PRINTBUTTON @"[0{LCOUNT+1+LCOUNT:1*3}] %SNAME%", AUTO_SPLIT("U/V/W/X/Y/Z", "/", LCOUNT+1+LCOUNT:1*3-1)
			ELSE
			PRINTBUTTON @"[0{LCOUNT+1+LCOUNT:1*3}] %SNAME%", AUTO_SPLIT("U/V/W/X/Y/Z", "/", LCOUNT+1+LCOUNT:1*3-1)
			ENDIF
		ELSEIF ARG:3==1
			IF FLAG:커스텀게임화면
			PRINTBUTTON @"[{20+LCOUNT+1+LCOUNT:1*3,2}] %SNAME%", 20 + LCOUNT+1+LCOUNT:1*3
			ELSE
			PRINTBUTTON @"[{20+LCOUNT+1+LCOUNT:1*3,2}] %SNAME%", 20 + LCOUNT+1+LCOUNT:1*3
			ENDIF
		ELSE
			IF FLAG:커스텀게임화면
			PRINTBUTTON @"[{LCOUNT+1+LCOUNT:1*3,2}] %SNAME%", LCOUNT+1+LCOUNT:1*3
			ELSE
			PRINTBUTTON @"[{LCOUNT+1+LCOUNT:1*3,2}] %SNAME%", LCOUNT+1+LCOUNT:1*3
			ENDIF
		ENDIF
		PRINTFORM %"  "%
		;---- EDIT 025 ADD START -------------------------
		RESETCOLOR
		;---- EDIT 025 ADD END -------------------------
		;---- EDIT 024 MOD END -------------------------
		IF FLAG:화상표시설정 > 0 && FLAG:상성등표시ON >= 1 && GETBIT(ARG:2, 1) == 1
		;---- EDIT 020 ADD START -------------------------
			IF LOCAL >= 0 && (TALENT:LOCAL:식노 || TALENT:LOCAL:악마빙의자)
				IF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 2)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
				ENDIF
			ELSEIF LOCAL >= 0 && TALENT:LOCAL:데빌시프터
				IF CFLAG:LOCAL:악마변신 && (FINDCHARA_ID(CFLAG:LOCAL:링크악마) == FINDCHARA_ID(CFLAG:LOCAL:초기링크악마))
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 2)
				ELSEIF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 3)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
				ENDIF
			ELSE
				;---- EDIT 017 ADD START -------------------------
				SIF LOCAL >= 0
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
				;---- EDIT 017 ADD END -------------------------
			ENDIF
			;---- EDIT 020 ADD END -------------------------

			IF モブ画像_設定確認(LOCAL, "セットアップ")
				CALL モブ画像_表示(LOCAL, "セットアップ", 1, 1)
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 3
				CALL ONI_MARK,LOCAL,1,1
			;---- EDIT 017 MOD START -------------------------			
			; ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL)
				; ;대상が石嶺카야で、かつ카야が인간をやめている
				; IF NO:LOCAL == 4629 && ABL:LOCAL:종족 != 0
				; 	IF CSTR:LOCAL:종족명 == "기계의처녀"
				; 		GAZOU_REIGAI = _ゴーレム_2
				; 	ELSEIF CSTR:LOCAL:종족명 == "흉조"
				; 		GAZOU_REIGAI = _ショボー
				; 	ELSEIF CSTR:LOCAL:종족명 == "지령"
				; 		GAZOU_REIGAI = _노커
				; 	ELSEIF CSTR:LOCAL:종족명 == "야마"
				; 		GAZOU_REIGAI = _서큐버스
				; 	ENDIF
				; 	PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_1_1"
				; 	PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_1_2"
				; 	PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_1_3"
				; 	PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_1_4"
				; 	PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_1_5"
				; 	PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_1_6"
				; ;それ以外
				; ELSE
				; 	PRINT_IMG @"%TOSTR(NO:LOCAL)%b_1_1"
				; 	PRINT_IMG @"%TOSTR(NO:LOCAL)%b_1_2"
				; 	PRINT_IMG @"%TOSTR(NO:LOCAL)%b_1_3"
				; 	PRINT_IMG @"%TOSTR(NO:LOCAL)%b_1_4"
				; 	PRINT_IMG @"%TOSTR(NO:LOCAL)%b_1_5"
				; 	PRINT_IMG @"%TOSTR(NO:LOCAL)%b_1_6"
				; ENDIF
			;---- EDIT 023 ADD START -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE((CFLAG:LOCAL:외견번호), IMG_TYPE) && CFLAG:LOCAL:외견번호 > 0
				CALL WRITE_IMG, (CFLAG:LOCAL:외견번호), IMG_TYPE, 1
			;---- EDIT 023 ADD END -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL, IMG_TYPE)
				CALL WRITE_IMG, NO:LOCAL, IMG_TYPE, 1
			;---- EDIT 017 MOD END -------------------------
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 1
				CALL RACE_ICON,NO:LOCAL,1,LOCAL,1
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 2
				CALL ONI_MARK,LOCAL,1,1
			ELSE
				PRINT 　　　　　　
			ENDIF
		ELSEIF FLAG:화상표시설정 > 0
			;---- EDIT 020 ADD START -------------------------
			IF LOCAL >= 0 && (TALENT:LOCAL:식노 || TALENT:LOCAL:악마빙의자)
				IF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0, 2)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0)
				ENDIF
			ELSEIF LOCAL >= 0 && TALENT:LOCAL:데빌시프터
				IF CFLAG:LOCAL:악마변신 && (FINDCHARA_ID(CFLAG:LOCAL:링크악마) == FINDCHARA_ID(CFLAG:LOCAL:초기링크악마))
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0, 2)
				ELSEIF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0, 3)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0)
				ENDIF
			ELSE
				;---- EDIT 017 ADD START -------------------------
				SIF LOCAL >= 0
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0)
				;---- EDIT 017 ADD END -------------------------
			ENDIF
			;---- EDIT 020 ADD END -------------------------
			IF モブ画像_設定確認(LOCAL, "セットアップ")
				CALL モブ画像_表示(LOCAL, "セットアップ", 1, 0)
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 3
				CALL ONI_MARK,LOCAL,1,0
			;---- EDIT 017 MOD START -------------------------	
			; ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL)
			; 	;대상が石嶺카야で、かつ카야が인간をやめている
			; 	IF NO:LOCAL == 4629 && ABL:LOCAL:종족 != 0
			; 		IF CSTR:LOCAL:종족명 == "기계의처녀"
			; 			GAZOU_REIGAI = _ゴーレム_2
			; 		ELSEIF CSTR:LOCAL:종족명 == "흉조"
			; 			GAZOU_REIGAI = _ショボー
			; 		ELSEIF CSTR:LOCAL:종족명 == "지령"
			; 			GAZOU_REIGAI = _노커
			; 		ELSEIF CSTR:LOCAL:종족명 == "야마"
			; 			GAZOU_REIGAI = _서큐버스
			; 		ENDIF
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_1_1"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_1_2"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_1_3"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_1_4"
			; 	;それ以外
			; 	ELSE
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_1_1"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_1_2"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_1_3"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_1_4"
			; 	ENDIF
			;---- EDIT 023 ADD START -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE((CFLAG:LOCAL:외견번호), IMG_TYPE) && CFLAG:LOCAL:외견번호 > 0
				CALL WRITE_IMG, (CFLAG:LOCAL:외견번호), IMG_TYPE, 1
			;---- EDIT 023 ADD END -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL, IMG_TYPE)
				CALL WRITE_IMG, NO:LOCAL, IMG_TYPE, 1
			;---- EDIT 017 MOD END -------------------------
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 1
				CALL RACE_ICON,NO:LOCAL,1,LOCAL,0
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 2
				CALL ONI_MARK,LOCAL,1,0
			ELSE
				PRINT 　　　　
			ENDIF
		ENDIF
		;上下の段がズレていたら位置を合わせる
		CHARA_POSITION = LCOUNT + LCOUNT:1*3
		SIF ERROR_CORRECTION:CHARA_POSITION > 0
			PRINTFORM %" " * ERROR_CORRECTION:CHARA_POSITION%
		PRINT 　
	NEXT
	PRINTL
	;色リスト표시２行目
	IF FLAG:상성등표시ON == 1 && GETBIT(ARG:2, 0) == 1 && LCOUNT:1 == 0
		CALL SHOW_AISYOU_COLOR_LIST, 1
		PRINTFORM %" " * 9%
	ELSE
		PRINTFORM %" " * 18%
	ENDIF
	;---- EDIT 024 MOD START -------------------------
	SIF FLAG:커스텀게임화면 && !FLAG:화상표시설정
		PRINTFORM %" ",7%
	;---- EDIT 024 MOD END -------------------------
	FOR LCOUNT, 0, 3
		LOCALS = 포지션{LCOUNT+LCOUNT:1*3+1}
		LOCAL = FLAG:LOCALS
		;---- EDIT 003 ADD START -------------------------
		;表示:RPGパラメータ(色付き)
		SIF FLAG:커스텀게임화면
			PRINTFORM %" ",2%
		CALL RPG_PRINT_PARAM_COLOR, 1, LOCAL
		;---- EDIT 003 ADD END ---------------------------
		RESETCOLOR
		;名前が16バイト以上だとズレるので修正
		CHARA_POSITION = LCOUNT + LCOUNT:1*3
		SIF LEN_NAME:CHARA_POSITION > 0
			PRINTFORM %" " * LEN_NAME:CHARA_POSITION%
		IF FLAG:화상표시설정 > 0 && FLAG:상성등표시ON >= 1 && GETBIT(ARG:2, 1) == 1
			;---- EDIT 020 ADD START -------------------------
			IF LOCAL >= 0 && (TALENT:LOCAL:식노 || TALENT:LOCAL:악마빙의자)
				IF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 2)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
				ENDIF
			ELSEIF LOCAL >= 0 && TALENT:LOCAL:데빌시프터
				IF CFLAG:LOCAL:악마변신 && (FINDCHARA_ID(CFLAG:LOCAL:링크악마) == FINDCHARA_ID(CFLAG:LOCAL:초기링크악마))
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 2)
				ELSEIF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 3)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
				ENDIF
			ELSE
			;---- EDIT 017 ADD START -------------------------
				SIF LOCAL >= 0
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
			;---- EDIT 017 ADD END -------------------------
			ENDIF
			;---- EDIT 020 ADD END -------------------------
			
			IF モブ画像_設定確認(LOCAL, "セットアップ")
				CALL モブ画像_表示(LOCAL, "セットアップ", 2, 1)
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 3
				CALL ONI_MARK,LOCAL,2,1
			;---- EDIT 017 MOD START -------------------------	
			; ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL)
			; 	;대상が石嶺카야で、かつ카야が인간をやめている
			; 	IF NO:LOCAL == 4629 && ABL:LOCAL:종족 != 0
			; 		IF CSTR:LOCAL:종족명 == "기계의처녀"
			; 			GAZOU_REIGAI = _ゴーレム_2
			; 		ELSEIF CSTR:LOCAL:종족명 == "흉조"
			; 			GAZOU_REIGAI = _ショボー
			; 		ELSEIF CSTR:LOCAL:종족명 == "지령"
			; 			GAZOU_REIGAI = _노커
			; 		ELSEIF CSTR:LOCAL:종족명 == "야마"
			; 			GAZOU_REIGAI = _서큐버스
			; 		ENDIF
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_2_1"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_2_2"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_2_3"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_2_4"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_2_5"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_2_6"
			; 	;それ以外
			; 	ELSE
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_2_1"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_2_2"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_2_3"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_2_4"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_2_5"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_2_6"
			; 	ENDIF
			;---- EDIT 023 ADD START -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE((CFLAG:LOCAL:외견번호), IMG_TYPE) && CFLAG:LOCAL:외견번호 > 0
				CALL WRITE_IMG, (CFLAG:LOCAL:외견번호), IMG_TYPE, 2
			;---- EDIT 023 ADD END -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL, IMG_TYPE)
				CALL WRITE_IMG, NO:LOCAL, IMG_TYPE, 2
			;---- EDIT 017 MOD END -------------------------
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 1
				CALL RACE_ICON,NO:LOCAL,2,LOCAL,1
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 2
				CALL ONI_MARK,LOCAL,2,1
			ELSE
				PRINT 　　　　　　
			ENDIF
		ELSEIF FLAG:화상표시설정 > 0
			;---- EDIT 020 ADD START -------------------------
			IF LOCAL >= 0 && (TALENT:LOCAL:식노 || TALENT:LOCAL:악마빙의자)
				IF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0, 2)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0)
				ENDIF
			ELSEIF LOCAL >= 0 && TALENT:LOCAL:데빌시프터
				IF CFLAG:LOCAL:악마변신 && (FINDCHARA_ID(CFLAG:LOCAL:링크악마) == FINDCHARA_ID(CFLAG:LOCAL:초기링크악마))
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0, 2)
				ELSEIF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0, 3)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0)
				ENDIF
			ELSE
				;---- EDIT 017 ADD START -------------------------
				SIF LOCAL >= 0
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0)
				;---- EDIT 017 ADD END -------------------------
			ENDIF
			;---- EDIT 020 ADD END -------------------------
			IF モブ画像_設定確認(LOCAL, "セットアップ")
				CALL モブ画像_表示(LOCAL, "セットアップ", 2, 0)
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 3
				CALL ONI_MARK,LOCAL,2,0
			;---- EDIT 017 MOD START -------------------------	
			; ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL)
			; 	;대상が石嶺카야で、かつ카야が인간をやめている
			; 	IF NO:LOCAL == 4629 && ABL:LOCAL:종족 != 0
			; 		IF CSTR:LOCAL:종족명 == "기계의처녀"
			; 			GAZOU_REIGAI = _ゴーレム_2
			; 		ELSEIF CSTR:LOCAL:종족명 == "흉조"
			; 			GAZOU_REIGAI = _ショボー
			; 		ELSEIF CSTR:LOCAL:종족명 == "지령"
			; 			GAZOU_REIGAI = _노커
			; 		ELSEIF CSTR:LOCAL:종족명 == "야마"
			; 			GAZOU_REIGAI = _서큐버스
			; 		ENDIF
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_2_1"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_2_2"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_2_3"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_2_4"
			; 	;それ以外
			; 	ELSE
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_2_1"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_2_2"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_2_3"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_2_4"
			; 	ENDIF
			;---- EDIT 023 ADD START -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE((CFLAG:LOCAL:외견번호), IMG_TYPE) && CFLAG:LOCAL:외견번호 > 0
				CALL WRITE_IMG, (CFLAG:LOCAL:외견번호), IMG_TYPE, 2
			;---- EDIT 023 ADD END -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL, IMG_TYPE)
				CALL WRITE_IMG, NO:LOCAL, IMG_TYPE, 2
			;---- EDIT 017 MOD END -------------------------
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 1
				CALL RACE_ICON,NO:LOCAL,2,LOCAL,0
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 2
				CALL ONI_MARK,LOCAL,2,0
			ELSE
				PRINT 　　　　
			ENDIF
		ENDIF
		;上下の段がズレていたら位置を合わせる
		SIF ERROR_CORRECTION:CHARA_POSITION > 0
			PRINTFORM %" " * ERROR_CORRECTION:CHARA_POSITION%
		PRINT 　
	NEXT
	PRINTL
	;色リスト표시３行目
	IF FLAG:상성등표시ON == 1 && GETBIT(ARG:2, 0) == 1 && LCOUNT:1 == 0
		CALL SHOW_AISYOU_COLOR_LIST, 2
		PRINTFORM %" " * 9%
	ELSE
		PRINTFORM %" " * 18%
	ENDIF
	;---- EDIT 024 MOD START -------------------------
	SIF FLAG:커스텀게임화면 && !FLAG:화상표시설정
		PRINTFORM %" ",7%
	;---- EDIT 024 MOD END -------------------------
	FOR LCOUNT, 0, 3
		LOCALS = 포지션{LCOUNT+LCOUNT:1*3+1}
		LOCAL = FLAG:LOCALS
		;---- EDIT 003 ADD START -------------------------
		;표시:RPGパラメータ(色付き)
		SIF FLAG:커스텀게임화면
			PRINTFORM %" ",2%
		CALL RPG_PRINT_PARAM_COLOR, 2, LOCAL
		;---- EDIT 003 ADD END ---------------------------
		RESETCOLOR
		;名前が16バイト以上だとズレるので修正
		CHARA_POSITION = LCOUNT + LCOUNT:1*3
		SIF LEN_NAME:CHARA_POSITION > 0
			PRINTFORM %" " * LEN_NAME:CHARA_POSITION%
		IF FLAG:화상표시설정 > 0 && FLAG:상성등표시ON >= 1 && GETBIT(ARG:2, 1) == 1
			;---- EDIT 020 ADD START -------------------------
			IF LOCAL >= 0 && (TALENT:LOCAL:식노 || TALENT:LOCAL:악마빙의자)
				IF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 2)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
				ENDIF
			ELSEIF LOCAL >= 0 && TALENT:LOCAL:데빌시프터
				IF CFLAG:LOCAL:악마변신 && (FINDCHARA_ID(CFLAG:LOCAL:링크악마) == FINDCHARA_ID(CFLAG:LOCAL:초기링크악마))
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 2)
				ELSEIF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 3)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
				ENDIF
			ELSE
				;---- EDIT 017 ADD START -------------------------
				SIF LOCAL >= 0
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
				;---- EDIT 017 ADD END -------------------------
			ENDIF
			;---- EDIT 020 ADD END -------------------------
			IF モブ画像_設定確認(LOCAL, "セットアップ")
				CALL モブ画像_表示(LOCAL, "セットアップ", 3, 1)
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 3
				CALL ONI_MARK,LOCAL,3,1
			;---- EDIT 017 MOD START -------------------------	
			; ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL)
			; 	;대상が石嶺카야で、かつ카야が인간をやめている
			; 	IF NO:LOCAL == 4629 && ABL:LOCAL:종족 != 0
			; 		IF CSTR:LOCAL:종족명 == "기계의처녀"
			; 			GAZOU_REIGAI = _ゴーレム_2
			; 		ELSEIF CSTR:LOCAL:종족명 == "흉조"
			; 			GAZOU_REIGAI = _ショボー
			; 		ELSEIF CSTR:LOCAL:종족명 == "지령"
			; 			GAZOU_REIGAI = _노커
			; 		ELSEIF CSTR:LOCAL:종족명 == "야마"
			; 			GAZOU_REIGAI = _서큐버스
			; 		ENDIF
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_3_1"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_3_2"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_3_3"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_3_4"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_3_5"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_3_6"
			; 	;それ以外
			; 	ELSE
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_3_1"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_3_2"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_3_3"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_3_4"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_3_5"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_3_6"
			; 	ENDIF
			;---- EDIT 023 ADD START -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE((CFLAG:LOCAL:외견번호), IMG_TYPE) && CFLAG:LOCAL:외견번호 > 0
				CALL WRITE_IMG, (CFLAG:LOCAL:외견번호), IMG_TYPE, 3
			;---- EDIT 023 ADD END -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL, IMG_TYPE)
				CALL WRITE_IMG, NO:LOCAL, IMG_TYPE, 3
			;---- EDIT 017 MOD END -------------------------
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 1
				CALL RACE_ICON,NO:LOCAL,3,LOCAL,1
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 2
				CALL ONI_MARK,LOCAL,3,1
			ELSE
				PRINT 　　　　　　
			ENDIF
		ELSEIF FLAG:화상표시설정 > 0
			;---- EDIT 020 ADD START -------------------------
			IF LOCAL >= 0 && (TALENT:LOCAL:식노 || TALENT:LOCAL:악마빙의자)
				IF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0, 2)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0)
				ENDIF
			ELSEIF LOCAL >= 0 && TALENT:LOCAL:데빌시프터
				IF CFLAG:LOCAL:악마변신 && (FINDCHARA_ID(CFLAG:LOCAL:링크악마) == FINDCHARA_ID(CFLAG:LOCAL:초기링크악마))
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0, 2)
				ELSEIF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0, 3)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0)
				ENDIF
			ELSE
				;---- EDIT 017 ADD START -------------------------
				SIF LOCAL >= 0
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0)
				;---- EDIT 017 ADD END -------------------------
			ENDIF
			;---- EDIT 020 ADD END -------------------------
			IF モブ画像_設定確認(LOCAL, "セットアップ")
				CALL モブ画像_表示(LOCAL, "セットアップ", 3, 0)
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 3
				CALL ONI_MARK,LOCAL,3,0
;---- EDIT 017 MOD START -------------------------	
			; ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL)
			; 	;대상が石嶺카야で、かつ카야が인간をやめている
			; 	IF NO:LOCAL == 4629 && ABL:LOCAL:종족 != 0
			; 		IF CSTR:LOCAL:종족명 == "기계의처녀"
			; 			GAZOU_REIGAI = _ゴーレム_2
			; 		ELSEIF CSTR:LOCAL:종족명 == "흉조"
			; 			GAZOU_REIGAI = _ショボー
			; 		ELSEIF CSTR:LOCAL:종족명 == "지령"
			; 			GAZOU_REIGAI = _노커
			; 		ELSEIF CSTR:LOCAL:종족명 == "야마"
			; 			GAZOU_REIGAI = _서큐버스
			; 		ENDIF
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_3_1"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_3_2"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_3_3"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_3_4"
			; 	;それ以外
			; 	ELSE
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_3_1"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_3_2"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_3_3"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_3_4"
			; 	ENDIF
			;---- EDIT 023 ADD START -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE((CFLAG:LOCAL:외견번호), IMG_TYPE) && CFLAG:LOCAL:외견번호 > 0
				CALL WRITE_IMG, (CFLAG:LOCAL:외견번호), IMG_TYPE, 3
			;---- EDIT 023 ADD END -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL, IMG_TYPE)
				CALL WRITE_IMG, NO:LOCAL, IMG_TYPE, 3
			;---- EDIT 017 MOD END -------------------------
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 1
				CALL RACE_ICON,NO:LOCAL,3,LOCAL,0
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 2
				CALL ONI_MARK,LOCAL,3,0
			ELSE
				PRINT 　　　　
			ENDIF
		ENDIF
		;上下の段がズレていたら位置を合わせる
		SIF ERROR_CORRECTION:CHARA_POSITION > 0
			PRINTFORM %" " * ERROR_CORRECTION:CHARA_POSITION%
		PRINT 　
	NEXT
	PRINTL
	;色リスト표시４行目
	IF FLAG:상성등표시ON == 1 && GETBIT(ARG:2, 0) == 1 && LCOUNT:1 == 0
		CALL SHOW_AISYOU_COLOR_LIST, 3
		PRINTFORM %" " * 9%
	ELSE
		PRINTFORM %" " * 18%
	ENDIF
	;---- EDIT 024 MOD START -------------------------
	SIF FLAG:커스텀게임화면 && !FLAG:화상표시설정
		PRINTFORM %" ",7%
	FOR LCOUNT, 0, 3
		LOCALS = 포지션{LCOUNT+LCOUNT:1*3+1}
		LOCAL = FLAG:LOCALS
		SIF FLAG:커스텀게임화면
			PRINTFORM %" ", 2%
		IF LOCAL < 0
			SETCOLOR 0x404040
			PRINTFORM %" ",22%
		ELSE
			;LVってどこまで上がるんだろう？
			IF BASE:LOCAL:LV > 999999
				PRINTFORM 　 LV%TOSTR(BASE:LOCAL:LV/1000000) + \@ LOG10(BASE:LOCAL:LV) == 6? .{(BASE:LOCAL:LV % 1000000)/100000}# \@,3%M 
			ELSEIF BASE:LOCAL:LV > 9999
				PRINTFORM 　 LV{BASE:LOCAL:LV/1000,3}K 
			ELSE
				PRINTFORM 　　LV{BASE:LOCAL:LV,3} 
			ENDIF
			CALL PRINT_ALIGNMENT,LOCAL,1
			PRINTFORM %" ",(INRANGE(BASE:LOCAL:LV,1000,9999) ? 1#2)%
		;---- EDIT 024 MOD END   -------------------------
		;---- EDIT 003 ADD START -------------------------
			;표시:RPG STATUS(色付き)
			CALL RPG_PRINT_STATUS_COLOR, LOCAL
		;---- EDIT 003 ADD END ---------------------------
		ENDIF
		RESETCOLOR
		;名前が16バイト以上だとズレるので修正
		CHARA_POSITION = LCOUNT + LCOUNT:1*3
		SIF LEN_NAME:CHARA_POSITION > 0
			PRINTFORM %" " * LEN_NAME:CHARA_POSITION%
		IF FLAG:화상표시설정 > 0 && FLAG:상성등표시ON >= 1 && GETBIT(ARG:2, 1) == 1
			;---- EDIT 020 ADD START -------------------------
			IF LOCAL >= 0 && (TALENT:LOCAL:식노 || TALENT:LOCAL:악마빙의자)
				IF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 2)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
				ENDIF
			ELSEIF LOCAL >= 0 && TALENT:LOCAL:데빌시프터
				IF CFLAG:LOCAL:악마변신 && (FINDCHARA_ID(CFLAG:LOCAL:링크악마) == FINDCHARA_ID(CFLAG:LOCAL:초기링크악마))
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 2)
				ELSEIF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 3)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
				ENDIF
			ELSE
				;---- EDIT 017 ADD START -------------------------
				SIF LOCAL >= 0
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
				;---- EDIT 017 ADD END -------------------------
			ENDIF
			;---- EDIT 020 ADD END -------------------------
			IF モブ画像_設定確認(LOCAL, "セットアップ")
				CALL モブ画像_表示(LOCAL, "セットアップ", 4, 1)
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 3
				CALL ONI_MARK,LOCAL,4,1
			;---- EDIT 017 MOD START -------------------------	
			; ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL)
			; 	;대상が石嶺카야で、かつ카야が인간をやめている
			; 	IF NO:LOCAL == 4629 && ABL:LOCAL:종족 != 0
			; 		IF CSTR:LOCAL:종족명 == "기계의처녀"
			; 			GAZOU_REIGAI = _ゴーレム_2
			; 		ELSEIF CSTR:LOCAL:종족명 == "흉조"
			; 			GAZOU_REIGAI = _ショボー
			; 		ELSEIF CSTR:LOCAL:종족명 == "지령"
			; 			GAZOU_REIGAI = _노커
			; 		ELSEIF CSTR:LOCAL:종족명 == "야마"
			; 			GAZOU_REIGAI = _서큐버스
			; 		ENDIF
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_4_1"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_4_2"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_4_3"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_4_4"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_4_5"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_4_6"
			; 	;それ以外
			; 	ELSE
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_4_1"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_4_2"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_4_3"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_4_4"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_4_5"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_4_6"
			; 	ENDIF
			;---- EDIT 023 ADD START -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE((CFLAG:LOCAL:외견번호), IMG_TYPE) && CFLAG:LOCAL:외견번호 > 0
				CALL WRITE_IMG, (CFLAG:LOCAL:외견번호), IMG_TYPE, 4
			;---- EDIT 023 ADD END -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL, IMG_TYPE)
				CALL WRITE_IMG, NO:LOCAL, IMG_TYPE, 4
			;---- EDIT 017 MOD END -------------------------
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 1
				CALL RACE_ICON,NO:LOCAL,4,LOCAL,1
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 2
				CALL ONI_MARK,LOCAL,4,1
			ELSE
				PRINT 　　　　　　
			ENDIF
		ELSEIF FLAG:화상표시설정 > 0
			;---- EDIT 020 ADD START -------------------------
			IF LOCAL >= 0 && (TALENT:LOCAL:식노 || TALENT:LOCAL:악마빙의자)
				IF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0, 2)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0)
				ENDIF
			ELSEIF LOCAL >= 0 && TALENT:LOCAL:데빌시프터
				IF CFLAG:LOCAL:악마변신 && (FINDCHARA_ID(CFLAG:LOCAL:링크악마) == FINDCHARA_ID(CFLAG:LOCAL:초기링크악마))
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0, 2)
				ELSEIF CFLAG:LOCAL:악마변신
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0, 3)
				ELSE
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0)
				ENDIF
			ELSE
				;---- EDIT 017 ADD START -------------------------
				SIF LOCAL >= 0
					IMG_TYPE = GET_IMG_TYPE(LOCAL, 0)
				;---- EDIT 017 ADD END -------------------------
			ENDIF
			;---- EDIT 020 ADD END -------------------------
			IF モブ画像_設定確認(LOCAL, "セットアップ")
				CALL モブ画像_表示(LOCAL, "セットアップ", 4, 0)
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 3
				CALL ONI_MARK,LOCAL,4,0
			;---- EDIT 017 MOD START -------------------------	
			; ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL)
			; 	;대상が石嶺카야で、かつ카야が인간をやめている
			; 	IF NO:LOCAL == 4629 && ABL:LOCAL:종족 != 0
			; 		IF CSTR:LOCAL:종족명 == "기계의처녀"
			; 			GAZOU_REIGAI = _ゴーレム_2
			; 		ELSEIF CSTR:LOCAL:종족명 == "흉조"
			; 			GAZOU_REIGAI = _ショボー
			; 		ELSEIF CSTR:LOCAL:종족명 == "지령"
			; 			GAZOU_REIGAI = _노커
			; 		ELSEIF CSTR:LOCAL:종족명 == "야마"
			; 			GAZOU_REIGAI = _서큐버스
			; 		ENDIF
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_4_1"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_4_2"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_4_3"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%_4_4"
			; 	;それ以外
			; 	ELSE
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_4_1"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_4_2"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_4_3"
			; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%_4_4"
			; 	ENDIF
			;---- EDIT 023 ADD START -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE((CFLAG:LOCAL:외견번호), IMG_TYPE) && CFLAG:LOCAL:외견번호 > 0
				CALL WRITE_IMG, (CFLAG:LOCAL:외견번호), IMG_TYPE, 4
			;---- EDIT 023 ADD END -------------------------
			ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL, IMG_TYPE)
				CALL WRITE_IMG, NO:LOCAL, IMG_TYPE, 4
			;---- EDIT 017 MOD END -------------------------
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 1
				CALL RACE_ICON,NO:LOCAL,4,LOCAL,0
			ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 2
				CALL ONI_MARK,LOCAL,4,0
			ELSE
				PRINT 　　　　
			ENDIF
		ENDIF
		;上下の段がズレていたら位置を合わせる
		SIF ERROR_CORRECTION:CHARA_POSITION > 0
			PRINTFORM %" " * ERROR_CORRECTION:CHARA_POSITION%
		PRINT 　
	NEXT
	PRINTL
	;相性等표시枠
	IF GETBIT(ARG:2, 1) == 1
		;相性等표시
		IF FLAG:상성등표시ON >= 1
			FOR LCOUNT:3, 0, 2
				;色リスト표시５〜６行目
				IF FLAG:상성등표시ON == 1 && GETBIT(ARG:2, 0) == 1 && LCOUNT:1 == 0
					CALL SHOW_AISYOU_COLOR_LIST, 4 + LCOUNT:3
					PRINTFORM %" " * 7%
				ELSE
					PRINTFORM %" " * 16%
				ENDIF
				;---- EDIT 024 MOD START -------------------------
				SIF FLAG:커스텀게임화면 && !FLAG:화상표시설정
					PRINTFORM %" ",7%
				FOR LCOUNT, 0, 3
					LOCALS = 포지션{LCOUNT+LCOUNT:1*3+1}
					LOCAL = FLAG:LOCALS
							SIF FLAG:커스텀게임화면
								PRINTFORM %" " , 2%
				;---- EDIT 024 MOD END -------------------------
					IF LOCAL < 0
						;EMPTY
						PRINT 　　　　　　　　　　　　
					ELSE
						IF FLAG:상성등표시ON == 1 || (FLAG:상성등표시ON > 1 && GETBIT(ARG:2, 2) == 0)
							;全ての相性を표시
							PRINT 　　　
							FOR LCOUNT:2, 0, 9
								CALL SET_AISYOU_COLOR, MAXBASE:LOCAL:(GET_TYPE(LCOUNT:2 + LCOUNT:3 * 9))
								;속성名の先머리１文字で表す
								PRINTFORM %SUBSTRING(GET_TYPE(LCOUNT:2 + LCOUNT:3 * 9), 0, 2)%
							NEXT
						ELSEIF FLAG:상성등표시ON == 2
							IF GETBIT(ARG:2, 2) == 1
								PRINT 　　　
								LOCAL:1 = GETCOLOR()
								IF LCOUNT:3 == 0
									CALL BUFFCOLORSET, CFLAG:LOCAL:공격강화
									PRINTFORM 공\@CFLAG:LOCAL:공격강화 < 0 ?  # + \@{CFLAG:LOCAL:공격강화 / 4}
									CALL BUFFCOLORSET, CFLAG:LOCAL:명중강화
									PRINTFORM 명\@CFLAG:LOCAL:명중강화 < 0 ?  # + \@{CFLAG:LOCAL:명중강화 / 4}
									CALL BUFFCOLORSET, CFLAG:LOCAL:마법위력강화
									PRINTFORM 위\@CFLAG:LOCAL:마법위력강화 < 0 ?  # + \@{CFLAG:LOCAL:마법위력강화 / 4}
									CALL BUFFCOLORSET, CFLAG:LOCAL:크리티컬강화
									PRINTFORM 크리\@CFLAG:LOCAL:크리티컬강화 < 0 ?  # + \@{CFLAG:LOCAL:크리티컬강화}
								ELSE
									CALL BUFFCOLORSET, CFLAG:LOCAL:방어강화
									PRINTFORM 방\@CFLAG:LOCAL:방어강화 < 0 ?  # + \@{CFLAG:LOCAL:방어강화 / 4}
									CALL BUFFCOLORSET, CFLAG:LOCAL:회피강화
									PRINTFORM 회\@CFLAG:LOCAL:회피강화 < 0 ?  # + \@{CFLAG:LOCAL:회피강화 / 4}
									CALL BUFFCOLORSET, CFLAG:LOCAL:마법효과강화
									PRINTFORM 효\@CFLAG:LOCAL:마법효과강화 < 0 ?  # + \@{CFLAG:LOCAL:마법효과강화 / 4}
									CALL BUFFCOLORSET, CFLAG:LOCAL:BS부착률강화 * (-1)
									PRINTFORM BS부\@CFLAG:LOCAL:BS부착률강화 < 0 ?  # + \@{CFLAG:LOCAL:BS부착률강화}
								ENDIF
								SETCOLOR LOCAL:1
							ENDIF
						ELSEIF FLAG:상성등표시ON == 3
							PRINT 　
							;SIF LCOUNT:3 == 1
							;	PRINT 　
							;PRINT 　　
							LOCAL:1 = GETCOLOR()
							;1130~1147
							FOR LCOUNT:2 , 1130 , 1148
								SIF LCOUNT:3 == 0 && LCOUNT:2 > 1139
									CONTINUE
								SIF LCOUNT:3 == 1 && LCOUNT:2 <= 1139
									CONTINUE
								;文字色설정
								IF CFLAG:(LOCAL):(LCOUNT:2) > 0
									SETCOLOR COLOR("aqua")
								ELSE
									SETCOLOR COLOR("light-gray")
								ENDIF
								PRINTFORM %SUBSTRING(CFLAGNAME:(LCOUNT:2), 0, 2)%
								;PRINTFORM {CFLAG:(LOCAL):(LCOUNT:2)}
							NEXT
					;		SIF CFLAG:(FLAG:LOCALS):SHOCK무효화횟수 < 1
					;			CFLAG:(FLAG:LOCALS):SHOCK무효화횟수 = 1
					;		SIF CFLAG:(FLAG:LOCALS):FREEZE무효화횟수 < 1
					;			CFLAG:(FLAG:LOCALS):FREEZE무효화횟수 = 1
					;		SIF CFLAG:(FLAG:LOCALS):SLIP무효화횟수 < 1
					;			CFLAG:(FLAG:LOCALS):SLIP무효화횟수 = 1
					;		SIF CFLAG:(FLAG:LOCALS):FLAME무효화횟수 < 1
					;			CFLAG:(FLAG:LOCALS):FLAME무효화횟수 = 1
							IF LCOUNT:3 == 1
								IF CFLAG:(LOCAL):BS무효화횟수 > 0
									SETCOLOR COLOR("aqua")
								ELSE
									SETCOLOR COLOR("light-gray")
								ENDIF
								PRINTFORM バ
								IF CFLAG:(LOCAL):DYING무효화횟수 > 0
									SETCOLOR COLOR("aqua")
								ELSE
									SETCOLOR COLOR("light-gray")
								ENDIF
								PRINTFORM 死
							ENDIF
							PRINT 　
							SETCOLOR LOCAL:1
						ENDIF
					ENDIF
					RESETCOLOR
					;名前が16バイト以上だとズレるので修正
					CHARA_POSITION = LCOUNT + LCOUNT:1*3
					SIF LEN_NAME:CHARA_POSITION > 0
						PRINTFORM %" " * LEN_NAME:CHARA_POSITION%
					IF FLAG:화상표시설정 > 0
			;---- EDIT 020 ADD START -------------------------
					IF LOCAL >= 0 && (TALENT:LOCAL:식노 || TALENT:LOCAL:악마빙의자)
						IF CFLAG:LOCAL:악마변신
							IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 2)
						ELSE
							IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
						ENDIF
					ELSEIF LOCAL >= 0 && TALENT:LOCAL:데빌시프터
						IF CFLAG:LOCAL:악마변신 && (FINDCHARA_ID(CFLAG:LOCAL:링크악마) == FINDCHARA_ID(CFLAG:LOCAL:초기링크악마))
							IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 2)
						ELSEIF CFLAG:LOCAL:악마변신
							IMG_TYPE = GET_IMG_TYPE(LOCAL, 1, 3)
						ELSE
							IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
						ENDIF
					ELSE
						;---- EDIT 017 ADD START -------------------------
						SIF LOCAL >= 0
							IMG_TYPE = GET_IMG_TYPE(LOCAL, 1)
						;---- EDIT 017 ADD END -------------------------
			ENDIF
			;---- EDIT 020 ADD END -------------------------
						IF モブ画像_設定確認(LOCAL, "セットアップ")
							CALL モブ画像_表示(LOCAL, "セットアップ", LCOUNT:3 + 5, 1)
						ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 3
							CALL ONI_MARK,LOCAL,LCOUNT:3 + 5,1
						;---- EDIT 017 MOD START -------------------------	
						; ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL)
						; 	;대상が石嶺카야で、かつ카야が인간をやめている
						; 	IF NO:LOCAL == 4629 && ABL:LOCAL:종족 != 0
						; 		IF CSTR:LOCAL:종족명 == "기계의처녀"
						; 			GAZOU_REIGAI = _ゴーレム_2
						; 		ELSEIF CSTR:LOCAL:종족명 == "흉조"
						; 			GAZOU_REIGAI = _ショボー
						; 		ELSEIF CSTR:LOCAL:종족명 == "지령"
						; 			GAZOU_REIGAI = _노커
						; 		ELSEIF CSTR:LOCAL:종족명 == "야마"
						; 			GAZOU_REIGAI = _서큐버스
						; 		ENDIF
						; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_%TOSTR(LCOUNT:3 + 5)%_1"
						; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_%TOSTR(LCOUNT:3 + 5)%_2"
						; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_%TOSTR(LCOUNT:3 + 5)%_3"
						; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_%TOSTR(LCOUNT:3 + 5)%_4"
						; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_%TOSTR(LCOUNT:3 + 5)%_5"
						; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%%GAZOU_REIGAI%b_%TOSTR(LCOUNT:3 + 5)%_6"
						; 	;それ以外
						; 	ELSE
						; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_%TOSTR(LCOUNT:3 + 5)%_1"
						; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_%TOSTR(LCOUNT:3 + 5)%_2"
						; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_%TOSTR(LCOUNT:3 + 5)%_3"
						; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_%TOSTR(LCOUNT:3 + 5)%_4"
						; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_%TOSTR(LCOUNT:3 + 5)%_5"
						; 		PRINT_IMG @"%TOSTR(NO:LOCAL)%b_%TOSTR(LCOUNT:3 + 5)%_6"
						; 	ENDIF
						;---- EDIT 023 ADD START -------------------------
						ELSEIF LOCAL >= 0 && EXIST_PICTURE((CFLAG:LOCAL:외견번호), IMG_TYPE) && CFLAG:LOCAL:외견번호 > 0
							CALL WRITE_IMG, (CFLAG:LOCAL:외견번호), IMG_TYPE, LCOUNT:3 + 5
						;---- EDIT 023 ADD END -------------------------
						ELSEIF LOCAL >= 0 && EXIST_PICTURE(NO:LOCAL, IMG_TYPE)
							CALL WRITE_IMG, NO:LOCAL, IMG_TYPE, LCOUNT:3 + 5
						;---- EDIT 017 MOD END -------------------------
						ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 1
							CALL RACE_ICON,NO:LOCAL,LCOUNT:3 + 5,LOCAL,1
						ELSEIF LOCAL >= 0 && FLAG:화상표시설정 == 2
							CALL ONI_MARK,LOCAL,LCOUNT:3 + 5,1
						ELSE
							PRINT 　　　　　　
						ENDIF
					ENDIF
					;上下の段がズレていたら位置を合わせる
					SIF ERROR_CORRECTION:CHARA_POSITION > 0
						PRINTFORM %" " * ERROR_CORRECTION:CHARA_POSITION%
				NEXT
				PRINTL
			NEXT
		ENDIF
	ELSEIF FLAG:상성등표시ON == 1 && GETBIT(ARG:2, 0) == 1 && LCOUNT:1 == 0
		;色リスト표시、相性等非표시の時の５行目
		CALL SHOW_AISYOU_COLOR_LIST, 4
		PRINTFORM %" " * 7%
	ENDIF
	PRINTL
NEXT
CUSTOMDRAWLINE =
;---- EDIT 019 MOD END ---------------------------

@BUFFCOLORSET, ARG
IF ARG > 0
	SETCOLOR 0x66FFFF
ELSEIF ARG < 0
	SETCOLOR 0x990000
ELSE
	SETCOLOR 0x404040
ENDIF

;==================================
;적パーティの描画
;==================================
;ARG:2 選択中の스킬の속성　＆　표시してもよい状況か
;０〜상성수：その속성に対する相性표시　例：검격　75％
;−１：色分けで全部표시　例：검飛打戦火氷電衝神
;それ以外：표시しない
;ARG:2がOK　かつ　FLAG:상성등표시ONがOK　の時표시する
@SHOW_NOW_FORMATION_E,ARG,ARG:1,ARG:2
#DIM LCOUNT, 4
CUSTOMDRAWLINE =
PRINT ＥＮＥＭＹ
PRINTFORM %@"현재의월령：",90,RIGHT%
IF FLAG:월령 != 0 && FLAG:월령 != 8
	PRINTFORML {FLAG:월령}/8 \@ FLAG:월령벡터 == 0 ? ＹＯＵＮＧ # ＯＬＤ \@ ＭＯＯＮ
ELSE
	PRINTFORML \@ FLAG:월령 == 8 ? ＦＵＬＬ ＭＯＯＮ # ＮＥＷ ＭＯＯＮ\@
ENDIF
FOR LCOUNT:1,ARG:1-1,ARG-1,-1

	FOR LCOUNT, 0, 5
		LOCALS = 포지션{LCOUNT+LCOUNT:1*5+7}
		LOCAL = FLAG:LOCALS
		;---- EDIT 005 MOD START -------------------------
		IF LOCAL < 0
			SETCOLOR 0x404040
		;---- EDIT 006 MOD START -------------------------
		;解析度최대のキャラは色を変えて표시する様に
		ELSEIF FLAG:(20000 + NO:LOCAL) >= 1000
			SETCOLOR FINDCHARA_B(NO:LOCAL) > 0 ? 0xee88ff # 0x8888ff

		ELSEIF FINDCHARA_B(NO:LOCAL) > 0
			SETCOLOR 0xffbbbb

		;---- EDIT 006 MOD END -------------------------
		ENDIF
		;---- EDIT 005 DEL END ---------------------------
		SIF FLAG:커스텀게임화면
			PRINTFORM %" " * 5%
		;---- EDIT 019 MOD START -------------------------
		PRINTFORM [{LCOUNT+LCOUNT:1*5+7,2}] \@(LOCAL > -1) ? %CALLNAME:LOCAL,17,LEFT% # %"EMPTY",17,LEFT%\@
		;---- EDIT 019 MOD END -------------------------
		RESETCOLOR
	NEXT
	PRINTL
	FOR LCOUNT, 0, 5
		LOCALS = 포지션{LCOUNT+LCOUNT:1*5+7}
		LOCAL = FLAG:LOCALS
		;---- EDIT 003 ADD START -------------------------
			;표시:RPGパラメータ(色付き)
			SIF FLAG:커스텀게임화면
				PRINTFORM %" ",3%
			CALL RPG_PRINT_PARAM_COLOR, 3, LOCAL
		;---- EDIT 003 ADD END ---------------------------
		RESETCOLOR
	NEXT
	PRINTL
	FOR LCOUNT, 0, 5
		LOCALS = 포지션{LCOUNT+LCOUNT:1*5+7}
		LOCAL = FLAG:LOCALS
		;---- EDIT 003 ADD START -------------------------
			;표시:RPGパラメータ(色付き)
			SIF FLAG:커스텀게임화면
				PRINTFORM %" ",3%
			CALL RPG_PRINT_PARAM_COLOR, 4, LOCAL
		;---- EDIT 003 ADD END ---------------------------
		RESETCOLOR
	NEXT
	PRINTL
	FOR LCOUNT, 0, 5
		LOCALS = 포지션{LCOUNT+LCOUNT:1*5+7}
		SIF FLAG:커스텀게임화면
			PRINTFORM %" " * 5%
		LOCAL = FLAG:LOCALS
		IF LOCAL < 0
			SETCOLOR 0x404040
			PRINTFORM %" ",20%
		ELSE
			IF CFLAG:LOCAL:언노운플래그 == 0
				PRINTFORM 　　LV{BASE:LOCAL:LV,3}
				SIF FINDCHARA_B(NO:LOCAL) == 0
					SETCOLOR COLOR("gray")
				PRINTFORM \@ CFLAG:(FINDCHARA(NO, NO:LOCAL)):PT플래그 > 0 ? 동 # 　 \@
				RESETCOLOR
				PRINTFORM \@ TALENT:LOCAL:남자 == 0 ? ♀ # ♂ \@
			ELSE
				PRINTFORM 　　?????????
			ENDIF
		;---- EDIT 003 ADD START -------------------------
			;표시:RPG STATUS(色付き)
			CALL RPG_PRINT_STATUS_COLOR, LOCAL
		;---- EDIT 003 ADD END ---------------------------
		ENDIF
		;---- EDIT 019 ADD START -------------------------
		PRINTFORM %" " * 2%
		;---- EDIT 019 ADD END ---------------------------
		RESETCOLOR
	NEXT
	PRINTL
	;相性표시
	;---- EDIT 004 ADD START -------------------------
	IF (ARG:2 >= -1 && ARG:2 < FLAG:상성수 && FLAG:상성등표시ON != 0) || (ARG:2 >= 0 && ARG:2 < FLAG:상성수 && EQUIP:MASTER:호프・아이즈 == 1 && (NUM_SUMMONER() || NUM_HAVESKILL([[스킬:하이・애널라이즈]])))
	;---- EDIT 004 ADD END ---------------------------
	;何か표시するときに実行。具体的には↓
	;全部or特定の표시してよいタイミング　もしくは　特定の표시してよいタイミング＆호프・아이즈ONなら実行
;	IF GETBIT(FLAG:상성등표시ON, 0) == 1 || ((ARG:2 >= 0 && ARG:2 < FLAG:상성수) && EQUIP:MASTER:호프・아이즈 == 1 && NUM_SUMMONER())
;	コンフィグON　もしくは　ギボアイズ持ちで特定の相性표시　なら実行
		FOR LCOUNT:3, 0, 2
			FOR LCOUNT, 0, 5
				SIF FLAG:커스텀게임화면
					PRINTFORM %" " * 5%
				LOCALS = 포지션{LCOUNT+LCOUNT:1*5+7}
				LOCAL = FLAG:LOCALS
				IF LOCAL < 0
					;EMPTY
					PRINT 　　　　　　　　　　
				ELSEIF ARG:2 == -1
					;全部표시タイミング
					SELECTCASE FLAG:상성등표시ON
						;CASE 0はありえない
						CASE 1
							;コンフィグONで
							;---- EDIT 004 ADD START -------------------------
							;---- EDIT 016 MOD START -------------------------
							;---- EDIT 018 DEL START -------------------------
							;IF (FLAG:(20000+NO:LOCAL) >= 100 && (NUM_SUMMONER() != 0) || NUM_HAVESKILL([[스킬:하이・애널라이즈]])) && !EQUIP:MASTER:마인드시커
								;解析度十分でCOMP持ちかつ、もしくは하이・애널라이즈持ち健在で마인드시커장비中でない
							;---- EDIT 018 DEL END ---------------------------
							;---- EDIT 016 MOD END ---------------------------
							;---- EDIT 004 ADD END ---------------------------
							;---- EDIT 018 ADD START -------------------------                                                                                                           EDIT 021 ADD  !CFLAG:LOCAL:애널라이즈불가
							IF (FLAG:(20000+NO:LOCAL) >= 100 && (NUM_SUMMONER(1) != 0) || NUM_HAVESKILL([[스킬:하이・애널라이즈]])) && !EQUIP:MASTER:마인드시커 && !CFLAG:LOCAL:1291
								;解析度十分でCOMP持ち、もしくは하이・애널라이즈持ち健在で마인드시커장비中でない
							;---- EDIT 018 ADD END ---------------------------
								;全ての相性を표시
								PRINT 　
								FOR LCOUNT:2, 0, 9
									CALL SET_AISYOU_COLOR, MAXBASE:LOCAL:(GET_TYPE(LCOUNT:2 + LCOUNT:3 * 9))
									;속성名の先머리１文字で表す
									PRINTFORM %SUBSTRING(GET_TYPE(LCOUNT:2 + LCOUNT:3 * 9), 0, 2)%
								NEXT
							ELSE
								SETCOLOR 0x808080
								PRINT 　？？？？？？？？？
							ENDIF
						CASE 2
							;강화弱体化표시
							PRINT 　
							IF LCOUNT:3 == 0
								CALL BUFFCOLORSET, CFLAG:LOCAL:공격강화
								PRINTFORM 공\@CFLAG:LOCAL:공격강화 < 0 ?  # + \@{CFLAG:LOCAL:공격강화 / 4}
								CALL BUFFCOLORSET, CFLAG:LOCAL:명중강화
								PRINTFORM 명\@CFLAG:LOCAL:명중강화 < 0 ?  # + \@{CFLAG:LOCAL:명중강화 / 4}
								CALL BUFFCOLORSET, CFLAG:LOCAL:마법위력강화
								PRINTFORM 위\@CFLAG:LOCAL:마법위력강화 < 0 ?  # + \@{CFLAG:LOCAL:마법위력강화 / 4}
								CALL BUFFCOLORSET, CFLAG:LOCAL:크리티컬강화
								PRINTFORM 크리\@CFLAG:LOCAL:크리티컬강화 < 0 ?  # + \@{CFLAG:LOCAL:크리티컬강화}
							ELSE
								CALL BUFFCOLORSET, CFLAG:LOCAL:방어강화
								PRINTFORM 방\@CFLAG:LOCAL:방어강화 < 0 ?  # + \@{CFLAG:LOCAL:방어강화 / 4}
								CALL BUFFCOLORSET, CFLAG:LOCAL:회피강화
								PRINTFORM 회\@CFLAG:LOCAL:회피강화 < 0 ?  # + \@{CFLAG:LOCAL:회피강화 / 4}
								CALL BUFFCOLORSET, CFLAG:LOCAL:마법효과강화
								PRINTFORM 효\@CFLAG:LOCAL:마법효과강화 < 0 ?  # + \@{CFLAG:LOCAL:마법효과강화 / 4}
								CALL BUFFCOLORSET, CFLAG:LOCAL:BS부착률강화 * (-1)
								PRINTFORM BS부\@CFLAG:LOCAL:BS부착률강화 < 0 ?  # + \@{CFLAG:LOCAL:BS부착률강화}
							ENDIF
						CASE 3
							IF (FLAG:(20000+NO:LOCAL) >= 100 && (NUM_SUMMONER(1) != 0) || NUM_HAVESKILL([[스킬:하이・애널라이즈]])) && !EQUIP:MASTER:마인드시커 && !CFLAG:LOCAL:1291
								;PRINT 　
								;SIF LCOUNT:3 == 1
								;	PRINT 　
								;PRINT 　　
								LOCAL:1 = GETCOLOR()
								;1130~1147
								FOR LCOUNT:2 , 1130 , 1148
									SIF LCOUNT:3 == 0 && LCOUNT:2 > 1138
										CONTINUE
									SIF LCOUNT:3 == 1 && LCOUNT:2 <= 1138
										CONTINUE
									;文字色설정
									IF CFLAG:(LOCAL):(LCOUNT:2) > 0
										SETCOLOR COLOR("aqua")
									ELSE
										SETCOLOR COLOR("light-gray")
									ENDIF
									PRINTFORM %SUBSTRING(CFLAGNAME:(LCOUNT:2), 0, 2)%
						;			PRINTFORM {CFLAG:(LOCAL):(LCOUNT:2)}
								NEXT
						;		SIF CFLAG:(FLAG:LOCALS):SHOCK무효화횟수 < 1
						;			CFLAG:(FLAG:LOCALS):SHOCK무효화횟수 = 1
						;		SIF CFLAG:(FLAG:LOCALS):FREEZE무효화횟수 < 1
						;			CFLAG:(FLAG:LOCALS):FREEZE무효화횟수 = 1
						;		SIF CFLAG:(FLAG:LOCALS):SLIP무효화횟수 < 1
						;			CFLAG:(FLAG:LOCALS):SLIP무효화횟수 = 1
						;		SIF CFLAG:(FLAG:LOCALS):FLAME무효화횟수 < 1
						;			CFLAG:(FLAG:LOCALS):FLAME무효화횟수 = 1
						;		CFLAG:(LOCAL):BS무효화횟수
						;		CFLAG:(LOCAL):DYING무효화횟수
								PRINT 　
								SETCOLOR LOCAL:1
							ELSE
								SETCOLOR 0x808080
								PRINT 　？？？？？？？？？
							ENDIF
					ENDSELECT
				ELSEIF ARG:2 >= 0 && ARG:2 < FLAG:상성수
					;特定の相性を표시タイミング
					;---- EDIT 004 ADD START -------------------------
					;---- EDIT 018 DEL START -------------------------
					;IF FLAG:(20000+NO:LOCAL) >= 100 && (NUM_SUMMONER() != 0 || NUM_HAVESKILL([[스킬:하이・애널라이즈]])) && FLAG:상성등표시ON != 0
						;解析度十分でCOMP持ち、もしくは하이・애널라이즈持ち健在でコンフィグOFFではない
					;---- EDIT 018 DEL END ---------------------------
					;---- EDIT 004 ADD END ---------------------------
					;---- EDIT 018 ADD START -------------------------                                                                                         EDIT 021 ADD  !CFLAG:LOCAL:애널라이즈불가
					IF FLAG:(20000+NO:LOCAL) >= 100 && (NUM_SUMMONER(1) != 0 || NUM_HAVESKILL([[스킬:하이・애널라이즈]])) && FLAG:상성등표시ON != 0 && !CFLAG:LOCAL:1291
						;解析度十分でCOMP持ち、もしくは하이・애널라이즈持ち健在でコンフィグOFFではない
						;---- EDIT 018 ADD END ---------------------------
						LOCAL:1 = MAXBASE:LOCAL:(GET_TYPE(ARG:2))
						CALL SET_AISYOU_COLOR, LOCAL:1
						PRINTFORM 　　　　%GET_TYPE(ARG:2)%
						PRINTFORM \@ LOCAL:1 < 0 ? 흡 # 　\@
						PRINTFORM \@ LOCAL:1 != 999 ? {ABS(LOCAL:1), 4}％ # 　반사\@
					;---- EDIT 004 ADD START -------------------------
					ELSEIF EQUIP:MASTER:호프・아이즈 == 1 && (NUM_SUMMONER() || NUM_HAVESKILL([[스킬:서드아이]]))
						;解析度が低い or 誰もＣＯＭＰを使えない（ANALYZEで스테이터스표시できない）상태で호프・아이즈持っている
					;---- EDIT 004 ADD END ---------------------------
						;호프・아이즈効果표시
						IF MAXBASE:LOCAL:(GET_TYPE(ARG:2)) == 999 || MAXBASE:LOCAL:(GET_TYPE(ARG:2)) <= 0
							SETCOLOR 0xFF0000
							PRINT 　 --- ALART !! --- 
						ELSEIF MAXBASE:LOCAL:(GET_TYPE(ARG:2)) > 199
							SETCOLOR 0x00FFFF
							PRINT 　 -- WEAKPOINT!! --
						ELSE
							PRINT 　　　　　　　　　　
						ENDIF
					ELSE
						PRINT 　　　　　　　　　　
					ENDIF
				ELSE
					;ここには来ないはず？
					PRINT ERROR!
				ENDIF
				;---- EDIT 019 ADD START -------------------------
				PRINTFORM %" " * 2%
				;---- EDIT 019 ADD END ---------------------------
				RESETCOLOR
			NEXT
			PRINTL
			SIF ARG:2 >= 0 && ARG:2 < FLAG:상성수
				BREAK
			;特定の相性を표시の場合、표시は１行だけ
		NEXT
;	ENDIF
	ENDIF
	PRINTL
NEXT
RETURN 0
CUSTOMDRAWLINE =



;==================================
;前詰め체크
;==================================
@REFRESH_FORMATION
;전위가 비어있는데 후위에 있는 포지션이 있는지 조사한다
FOR LOCAL,1,4
	LOCALS = 포지션{LOCAL}
	LOCALS:1 = 포지션{LOCAL+3}
	IF FLAG:LOCALS == -1
		SIF FLAG:(LOCALS:1) > -1
			CALL INSERT_POSITION,LOCAL,FLAG:(LOCALS:1)
	ELSEIF GET_STATE(CFLAG:(FLAG:LOCALS):상태이상) == "DYING"
		SIF FLAG:(LOCALS:1) > -1 && GET_STATE(CFLAG:(FLAG:(LOCALS:1)):상태이상) != "DYING"
			CALL CHANGE_POSITION,FLAG:LOCALS,FLAG:(LOCALS:1)
	ENDIF
NEXT
FOR LOCAL,7,12
	LOCALS = 포지션{LOCAL}
	LOCALS:1 = 포지션{LOCAL+5}
	IF FLAG:LOCALS == -1
		SIF FLAG:(LOCALS:1) > -1
			CALL INSERT_POSITION,LOCAL,FLAG:(LOCALS:1)
	ELSEIF GET_STATE(CFLAG:(FLAG:LOCALS):상태이상) == "DYING"
		SIF FLAG:(LOCALS:1) > -1 && GET_STATE(CFLAG:(FLAG:(LOCALS:1)):상태이상) != "DYING"
			CALL CHANGE_POSITION,FLAG:LOCALS,FLAG:(LOCALS:1)
	ENDIF
NEXT

;==============================================
;포지션入れ替え
;==============================================
@CHANGE_POSITION,ARG,ARG:1
	LOCALS = 포지션{CFLAG:(ARG:0):포지션}
	LOCALS:1 = 포지션{CFLAG:(ARG:1):포지션}
	SWAP FLAG:LOCALS,FLAG:(LOCALS:1)
	SWAP CFLAG:(ARG:0):포지션,CFLAG:(ARG:1):포지션

;==============================================
;포지션入れ替え2式
;==============================================
@CHANGE_POS,ARG,ARG:1
	LOCALS = 포지션{ARG}
	LOCALS:1 = 포지션{ARG:1}
	SIF FLAG:LOCALS > -1
		CFLAG:(FLAG:LOCALS):포지션 = ARG:1
	SIF FLAG:(LOCALS:1) > -1
		CFLAG:(FLAG:(LOCALS:1)):포지션 = ARG
	CALL REFRESH_POS
;		SWAP FLAG:LOCALS,FLAG:(LOCALS:1)

;==================================
;포지션に挿入
;==================================
@INSERT_POSITION,ARG,ARG:1
LOCALS = 포지션{ARG}
IF CFLAG:(ARG:1):PT플래그 > 0
	SIF ARG < 4
		LOCALS:1 = 포지션{ARG+3}
ELSE
	SIF ARG < 12
		LOCALS:1 = 포지션{ARG+5}
ENDIF
IF FLAG:LOCALS > -1
	;後ろが空いてるならずれてもらう
	IF ((CFLAG:(ARG:1):PT플래그 && ARG < 4) || (CFLAG:(ARG:1):PT플래그 == 0 && ARG < 12)) && FLAG:(LOCALS:1) == -1
		CFLAG:(FLAG:LOCALS):포지션 = ARG+3+!CFLAG:(FLAG:LOCALS):PT플래그*2
		FLAG:(LOCALS:1) = FLAG:LOCALS
		;PRINTFORML {ARG}に%CALLNAME:(ARG:1)%を配置します
		FLAG:LOCALS = ARG:1
		;PRINTFORML %CALLNAME:(ARG:1)%の포지션を{ARG}に書き換えます。
		CFLAG:(ARG:1):포지션 = ARG
		SIF CFLAG:(ARG:1):PT플래그
			CFLAG:(ARG:1):PT플래그 = 2
	;空いておらず、そこに居るのが主人なら交代不可
	ELSEIF (FLAG:LOCALS) == MASTER
		PRINTW 교대할 수 없습니다
		RETURN -1
	;空いておらず、そこに居るのが악마なら交代;悪마인もここ
	ELSEIF (ABL:(FLAG:LOCALS):종족 >0 && ABL:(FLAG:LOCALS):종족 <46 )|| ABL:(FLAG:LOCALS):종족 == 73
		CALL REMOVE_POSITION,ARG
		;PRINTFORML {ARG}に%CALLNAME:(ARG:1)%を配置します
		FLAG:LOCALS = ARG:1
		;PRINTFORML %CALLNAME:(ARG:1)%の포지션を{ARG}に書き換えます。
		CFLAG:(ARG:1):포지션 = ARG
		SIF CFLAG:(ARG:1):PT플래그
			CFLAG:(ARG:1):PT플래그 = 2
	;そこに居るのが主人以外かつ탐색or전투중でなければ交代
	ELSEIF (FLAG:LOCALS) != MASTER && FLAG:SHOP커맨드 == [[SHOP:셋업]]
		CALL REMOVE_POSITION,ARG
		;PRINTFORML {ARG}に%CALLNAME:(ARG:1)%を配置します
		FLAG:LOCALS = ARG:1
		;PRINTFORML %CALLNAME:(ARG:1)%の포지션を{ARG}に書き換えます。
		CFLAG:(ARG:1):포지션 = ARG
		SIF CFLAG:(ARG:1):PT플래그
			CFLAG:(ARG:1):PT플래그 = 2
	ELSE
	;どれかに引っかからなかったら交代できない
		PRINTW 교대할 수 없습니다
		RETURN -1
	ENDIF
	
ELSE
	IF CFLAG:(ARG:1):포지션
		LOCALS:2 = 포지션{CFLAG:(ARG:1):포지션}
		FLAG:(LOCALS:2) = -1
	ENDIF
	;PRINTFORML {ARG}に%CALLNAME:(ARG:1)%を配置します
	FLAG:LOCALS = ARG:1
	;PRINTFORML %CALLNAME:(ARG:1)%の포지션を{ARG}に書き換えます。
	CFLAG:(ARG:1):포지션 = ARG
	SIF CFLAG:(ARG:1):PT플래그
		CFLAG:(ARG:1):PT플래그 = 2
ENDIF



;==================================
;仲間を표시
;==================================
@CHOOSE_COMPANION,ARG
N = ARG
IF FLAG:SHOP커맨드 == [[SHOP:셋업]]
	CALL INPUT_CHARA_LIST("누구를 배치합니까？", "CASTING_CHOOSE_COMPANION", "", "", "", "그만둔다")
ELSE
	CALL INPUT_CHARA_LIST("누구를 부릅니까？", "CASTING_CHOOSE_COMPANION", "", "", "", "그만둔다")
ENDIF
IF RESULT == 1000
	RETURN 1000
;ELSEIF RESULT == 1002 && ARG == 2 ;この1002がよく分からないからコメントアウト
;	RETURN 1002
ELSE
	SELECTCASE FLAG:SHOP커맨드
		CASE [[SHOP:탐색]],[[SHOP:콜로세움참가]],[[SHOP:이벤트]],[[SHOP:의뢰청부]]
			IF ABL:RESULT:종족 != 0 && BASE:MASTER:ＭＡＧ < MAXBASE:RESULT:￥
				PRINTW MAG가 부족합니다
				CLEARLINE 2
				RESTART
			ENDIF
	ENDSELECT
	RETURN RESULT
ENDIF

@CASTING_CHOOSE_COMPANION(ARG:0)
SIF CFLAG:(ARG:0):PT플래그 != 1
	RETURN 0
SIF CFLAG:(ARG:0):전투참가불가능 > 0
	RETURN 0
SIF CFLAG:(ARG:0):노역플래그 == 3
	RETURN 0
SIF N == 1 && GET_STATE(CFLAG:(ARG:0):상태이상) == "DYING"
	RETURN 0
SIF TALENT:(ARG:0):비전투원
	RETURN 0
SIF CFLAG:(ARG:0):이자리에없는플래그 == 1
	RETURN 0
SIF N == 1 && ABL:(ARG:0):종족 == 0
	RETURN 0
SIF N == 1 && CFLAG:(ARG:0):피변신플래그
	RETURN 0
SIF N == 1 && CFLAG:(ARG:0):소속ＣＯＭＰ == -1
	RETURN 0
;필터링されてるキャラは除外
SIF CFLAG:(ARG:0):필터링플래그
	RETURN 0
RETURN 1

;========================================================================
;포지션キャラ側から読み込み
;合体、매각等でキャラが消滅する際に포지션を読み込みし直す処理
;========================================================================
@REFRESH_POS
	FOR LOCAL,1,17
		LOCALS = 포지션{LOCAL}
		FLAG:LOCALS = -1
	NEXT
	FOR LOCAL,0,CHARANUM
		SIF CFLAG:LOCAL:PT플래그 == 2
			CFLAG:LOCAL:PT플래그 = 1
		IF CFLAG:LOCAL:포지션 > 0
			CALL INSERT_POSITION,CFLAG:LOCAL:포지션,LOCAL
		ENDIF
	NEXT



;---- EDIT 003 ADD START -------------------------
;=================================================
;   sub RPG_PRINT_PARAM_COLOR
;=================================================
;   표시:RPGパラメータ(色付き)
;-------------------------------------------------
;  引数を元に着色したパラメータ情報をPRINTする
;-------------------------------------------------
; Input:
;  ARG:0				処理타입(1:ＨＰ(아군) 2:ＭＰ(아군) 3:ＨＰ(적) 4:ＭＰ(적))
;  ARG:1				포지션
;  ARG:2				着色拒否フラグ(0:着色 1:着色拒否 2:ボスのみ着色拒否)
;-------------------------------------------------
@RPG_PRINT_PARAM_COLOR, ARG:0, ARG:1, ARG:2 = 0
;--초기化
;LOCAL:0  ;포지션
;LOCAL:1  ;出力無しフラグ(0:出力 1:出力無し(着色) 2:出力無し(通常色))
;LOCAL:2  ;보스플래그(0:通常 1:ボス)
LOCAL:0  = ARG:1
LOCAL:1 = 0
LOCAL:2 = 0

;--定数설정
IF ARG:0 == 1 || ARG:0 == 3
	LOCALS:10 = ＨＰ
ELSE
	LOCALS:10 = ＭＰ
ENDIF

;CHK:대상有無
IF ARG:1 < 0
;대상無し
	LOCAL:1 = 1
ELSE
;대상有り

	;--定数설정
	LOCAL:10  = BASE:(ARG:1):(LOCALS:10)
	LOCAL:11  = MAXBASE:(ARG:1):(LOCALS:10)

	;CHK:処理타입
	SELECTCASE ARG:0
		;적の場合
		CASE 3,4
			;CHK:ボス
			IF (CFLAG:(LOCAL:0):보스플래그 || FLAG:(20000+NO:(LOCAL:0)) < 100)
			;ボスの場合
				LOCAL:2 = 1

				;処理타입:4(ＭＰ(적))で최대値が0以下の場合
				IF ARG:0 == 4 && !( LOCAL:11 > 0 )
					;魔法사용不可のキャラは非표시
					LOCAL:1 = 2
				ENDIF

			ELSE
			;雑魚の場合
				;処理타입:4(ＭＰ(적))で종족が0以下の場合
				IF ARG:0 == 4 && !( ABL:(ARG:1):종족 > 0 )
					;魔法사용不可のキャラは非표시
					LOCAL:1 = 2
				ENDIF

			ENDIF

		;아군の場合
		CASEELSE

			;処理타입:2(ＭＰ(아군))で최대値が0以下の場合
			IF ARG:0 == 2 && !( LOCAL:11 > 0 )
				;魔法사용不可のキャラは非표시
				LOCAL:1 = 2
			ENDIF

	ENDSELECT

ENDIF


;--出力開始

;出力無し
IF LOCAL:1 != 0
	IF LOCAL:1 == 2
		;通常色で표시
	ELSE
		;暗色で표시
		SETCOLOR 0x404040
	ENDIF
	IF FLAG:커스텀게임화면
	PRINTFORM 　　%LOCALS:10% [-----/-----]
	ELSE
	PRINTFORM 　　%LOCALS:10% [-----/-----]
	ENDIF
ELSE
;出力有り

	PRINTFORM 　　%LOCALS:10% [

	;CHK:着色拒否フラグ
	IF ARG:2 == 1
	ELSEIF ARG:2 == 2 && (LOCAL:2)
	ELSE
		;CHK:数値
		SELECTCASE LOCAL:10
			;死亡
			CASE IS == 0
				;赤(暗い赤)
				SETCOLOR 0x990000
			;危険
			CASE IS <  (LOCAL:11 * 25 / 100)
				;赤(朱色?)
				SETCOLOR 0xcc6666
			;弱っている
			CASE IS <  (LOCAL:11 * 50 / 100)
				;黄色(오렌지)
				SETCOLOR 0xffcc66
		ENDSELECT
	ENDIF

	;CHK:보스플래그
	IF LOCAL:2
		LOCALS:1 = 
		LOCALS:2 = 
		IF FLAG:커스텀게임화면
			FOR LOCAL:20, 0, 11
				IF LOCAL:10 >= ( (LOCAL:11/12) * (LOCAL:20 + 1))
					LOCALS:1 += "*"
				ELSE
					LOCALS:2 += "."
				ENDIF
			NEXT
		ELSE
			FOR LOCAL:20, 0, 11
				;---- EDIT 019 MOD START -------------------------
				IF LOCAL:10 >= ( (LOCAL:11/12) * (LOCAL:20 + 1))
				;---- EDIT 019 MOD END -------------------------
					LOCALS:1 += "*"
				ELSE
					LOCALS:2 += "."
				ENDIF
			NEXT
		ENDIF
		PRINTFORM %LOCALS:1%
		PRINTFORM %LOCALS:2%
		RESETCOLOR
	ELSE
		;---- EDIT 024 MOD START -------------------------
		IF FLAG:커스텀게임화면
		PRINTFORM %ADD_KMGT(LOCAL:10)%
		RESETCOLOR
		PRINTFORM /%ADD_KMGT(LOCAL:11)%
		ELSE
		PRINTFORM %ADD_KMGT(LOCAL:10)%
		RESETCOLOR
		PRINTFORM /%ADD_KMGT(LOCAL:11)%
		;---- EDIT 024 MOD END   -------------------------
		ENDIF
	ENDIF

	PRINT ]
ENDIF

;=================================================
;   sub RPG_PRINT_STATUS_COLOR
;=================================================
;   표시:RPG STATUS(色付き)
;-------------------------------------------------
;  引数を元に着色した상태情報をPRINTする
;-------------------------------------------------
; Input:
;  ARG:0				포지션
;-------------------------------------------------
@RPG_PRINT_STATUS_COLOR, ARG:0
#LOCALSIZE 1
IF CFLAG:(ARG:0):상태이상 == 0
	;GOOD
	IF FLAG:무후후전개
		IF CFLAG:(ARG:0):던전내발정
			SETCOLOR 0xff00ff
			PRINTFORM %ハート(3)% 
			RESETCOLOR
		ELSE
			LOCAL = MIN(15000 , CFLAG:(ARG:0):던전내발정용욕정치)
			;SETCOLOR 0x404040 + (0xff00ff - 0x404040) * MIN(15000 , PALAM:(ARG:0):욕정) / 15000
			SETCOLOR 0x40 + (0xff - 0x40) * LOCAL / 15000 , 0x40 - (0x40 * LOCAL / 15000) , 0x40 + (0xff - 0x40) * LOCAL / 15000
			PRINT  GOOD
			SETCOLOR 0xff * LOCAL / 15000 , 0 , 0xff * LOCAL / 15000
			PRINTFORM %ハート()%
			RESETCOLOR
		ENDIF
		RETURN 0
	ELSE
		SETCOLOR 0x404040
	ENDIF
ELSE
	RESETCOLOR
	;CHK:상태이상
	SELECTCASE GET_STATE(CFLAG:(ARG:0):상태이상)
		CASE "HAPPY"
			;ピンク(薄い桃)
			SETCOLOR 0xffcccc
		CASE "SHOCK"
			;黄(薄い黄)
			SETCOLOR 0xffff99
		CASE "PANIC"
			;青(薄い蒼)
			SETCOLOR 0x99ccff
		CASE "SLEEP"
			;青(暗い青)
			SETCOLOR 0x009999
		CASE "FREEZE"
			;青(薄い蒼)
			SETCOLOR 0x0099cc
		CASE "BIND"
			;黄(暗い黄)
			SETCOLOR 0xcccc00
		CASE "CLOSE"
			;紫(薄い紫)
			SETCOLOR 0xcc99ff
		CASE "POISON"
			;紫
			SETCOLOR 0xcc00cc
		CASE "CHARM"
			;ピンク
			SETCOLOR 0xff00ff
		CASE "PALYZE"
			;緑
			SETCOLOR 0x66cc99
		CASE "CURSE"
			;濃い紫
			SETCOLOR 0x6600ff
		CASE "FLY"
			;濃い黄
			SETCOLOR 0xffff00
		CASE "STONE"
			;灰色
			SETCOLOR 0x999999
		CASE "DYING"
			;赤(暗い赤)
			SETCOLOR 0x990000
		CASE "ORGY"
			;오렌지
			SETCOLOR 0xffaa11
		CASE "HEAT"
			;やや暗い赤
			SETCOLOR 0xaa0000
		CASE "FLAME"
			;鮮やかな紫みの赤
			SETCOLOR 0xff1e86
		CASE "SLIP"
			;明るい黄みの橙
			SETCOLOR 0xffde86
		CASE "BRAND"
			;濃い橙
			SETCOLOR 0xff6400
	ENDSELECT
ENDIF
PRINTFORM %GET_STATE(CFLAG:(ARG:0):상태이상),7,RIGHT%
RESETCOLOR
;---- EDIT 003 ADD END ---------------------------
;---- EDIT 009 ADD START ---------------------------
@CHOOSE_DEAD_COMPANION,ARG
N = ARG
$INPUT_LOOP_2
IF FLAG:SHOP커맨드 == [[SHOP:셋업]]
	CALL INPUT_CHARA_LIST("누구를 배치합니까？", "CASTING_DEAD_COMPANION", "", "", "", "그만둔다")
ELSE
	CALL INPUT_CHARA_LIST("누구를 부릅니까？", "CASTING_DEAD_COMPANION", "", "", "", "그만둔다")
ENDIF
IF RESULT == 1000
	RETURN 1000
;ELSEIF RESULT == 1002 && ARG == 2 ;この1002がよく分からないからコメントアウト
;	RETURN 1002
ELSE
	SELECTCASE FLAG:SHOP커맨드
		CASE [[SHOP:탐색]],[[SHOP:콜로세움참가]],[[SHOP:이벤트]],[[SHOP:의뢰청부]]
			IF ABL:RESULT:종족 != 0 && BASE:MASTER:ＭＡＧ < MAXBASE:RESULT:￥
				PRINTW MAG가 부족합니다
				CLEARLINE 2
				GOTO INPUT_LOOP_2
			ENDIF
	ENDSELECT
	RETURN RESULT
ENDIF

@CASTING_DEAD_COMPANION(ARG:0)
SIF CFLAG:(ARG:0):PT플래그 != 1
	RETURN 0
SIF CFLAG:(ARG:0):전투참가불가능 > 0
	RETURN 0
SIF CFLAG:(ARG:0):노역플래그 == 3
	RETURN 0
SIF N == 1 && GET_STATE(CFLAG:(ARG:0):상태이상) != "DYING"
	RETURN 0
SIF TALENT:(ARG:0):비전투원
	RETURN 0
SIF CFLAG:(ARG:0):이자리에없는플래그 == 1
	RETURN 0
SIF N == 1 && ABL:(ARG:0):종족 == 0
	RETURN 0
SIF N == 1 && CFLAG:(ARG:0):피변신플래그
	RETURN 0
SIF N == 1 && CFLAG:(ARG:0):소속ＣＯＭＰ == -1
	RETURN 0
;필터링されてるキャラは除外
SIF CFLAG:(ARG:0):필터링플래그
	RETURN 0
RETURN 1
;---- EDIT 009 ADD END ---------------------------
