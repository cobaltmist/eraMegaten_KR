;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;
;	Modification Data:
;
;	Edit	Date			Author					Reason
;	001		20xx/xx/xx		----					新規作成
;	002		2011/ 1/13		P						エラー対策
;	003		2011/ 4/25		P						仕様を大幅変更
;	004		2013/ 3/05		銃Ｐ					リストの最初のページと最後のページを行き来できるように加筆
;	005		2013/11/24		ひみつ					リスト表示数設定
;	006		2017/06/23		kuni					キャラ表示でINPUT_CHARA_LISTを使用するように変更
;	007		2022/06/27		JK好き					@CASTING_SUB_TARGET_SELECT 盟友をサブターゲットにして調教出来た問題を修正
;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;予備キャラボタンを選択可能か＆名前表示
;@SHOPCOMABLE_180
;CALL SUB_TARGET_ABLE, 1
;RETURN RESULT

;@SHOPCOMABLE_181
;CALL SUB_TARGET_ABLE, 2
;RETURN RESULT

;@SHOPCOMABLE_182
;CALL SUB_TARGET_ABLE, 3
;RETURN RESULT

@SUB_TARGET_ABLE, ARG
CALL SHOPCOMABLE_108
LOCAL = FINDCHARA_ID(TARGET:ARG)
IF LOCAL >= 0
	;노역中キャラは除外
	SIF CFLAG:LOCAL:노역플래그 == 3
		TARGET:ARG = -1
	;임신육아중のキャラは除外
	SIF CHECK_CHILD_CARE(LOCAL) && FLAG:출산기능ONOFF == 1
		TARGET:ARG = -1
	;失踪中などこの場にいないなら除外
	SIF CFLAG:LOCAL:이자리에없는플래그
		TARGET:ARG = -1
	SIF CFLAG:LOCAL:필터링플래그
		TARGET:ARG = -1
	LOCAL = TARGET:ARG ? LOCAL # -1
ENDIF
IF LOCAL == -1
	;---- EDIT 002 ADD START -------------------------
	;キャラがいなかった場合も、-1を代入
		TARGET:ARG = -1
	;---- EDIT 002 ADD END ---------------------------
	RESULTS = T{ARG}:EMPTY
ENDIF
RETURN RESULT

;予備キャラボタン選択時の動作
@SHOP_COM_511
CALL SUB_TARGET, 1
@SHOP_COM_512
CALL SUB_TARGET, 2
@SHOP_COM_513
CALL SUB_TARGET, 3
@SHOP_COM_514
CALL SUB_TARGET, 4
@SHOP_COM_515
CALL SUB_TARGET, 5
@SHOP_COM_516
CALL SUB_TARGET, 6
@SHOP_COM_517
CALL SUB_TARGET, 7
@SHOP_COM_518
CALL SUB_TARGET, 8
@SHOP_COM_519
CALL SUB_TARGET, 9

;EMPTYなら予備キャラ설정、설정済みならTARGETをそのキャラに변경
;現在のTARGETと同じキャラだったら해제
@SUB_TARGET, ARG
LOCAL = FINDCHARA_ID(TARGET:ARG)
IF LOCAL == -1
	CALL SUB_TARGET_SELECT, ARG
ELSE
	IF TARGET == LOCAL
		TARGET = -1
	ELSE
		TARGET = LOCAL
		SIF TARGET == ASSI
			ASSI = -1
		SIF FLAG:대기이용설정 == 1
			CALL SHOP_COM_201
	ENDIF
ENDIF

;@SUB_ASSI_ABLE, ARG
;CALL SHOPCOMABLE_109
;LOCAL = FINDCHARA_ID(ASSI:ARG)
;IF LOCAL >= 0
;	;노역中キャラは除外
;;	SIF CFLAG:LOCAL:노역플래그 == 3
		ASSI:ARG = -1
;;	;임신육아중のキャラは除外
;	SIF ((TALENT:LOCAL:임신 && CFLAG:LOCAL:출산예정일 - 2 <= DAY) || TALENT:LOCAL:육아중) && FLAG:출산기능ONOFF == 1
;		ASSI:ARG = -1
;	;失踪中などこの場にいないなら除外
;	SIF CFLAG:LOCAL:이자리에없는플래그
;		ASSI:ARG = -1
;	SIF CFLAG:LOCAL:필터링플래그
;		ASSI:ARG = -1
;	SIF MARK:LOCAL:반발각인 > 0
;		ASSI:ARG = -1
;	;조수가능でないものは除外
;	SIF CFLAG:LOCAL:매각가능 < 2
;		ASSI:ARG = -1
;	LOCAL = ASSI:ARG ? LOCAL # -1
;ENDIF
;IF LOCAL == -1
	;---- EDIT 002 ADD START -------------------------
;;	;キャラがいなかった場合も、-1を代入
;	ASSI:ARG = -1
;	;---- EDIT 002 ADD END ---------------------------
;	RESULTS = A{ARG}:EMPTY
;ELSE
;	SUBSTRING CALLNAME:LOCAL, 0, 16
;	RESULTS = A{ARG}:%RESULTS%
;ENDIF
;RETURN RESULT

;予備조수ボタン選択時の動作
@SHOP_COM_521
CALL SUB_ASSI, 1
@SHOP_COM_522
CALL SUB_ASSI, 2
@SHOP_COM_523
CALL SUB_ASSI, 3
@SHOP_COM_524
CALL SUB_ASSI, 4
@SHOP_COM_525
CALL SUB_ASSI, 5
@SHOP_COM_526
CALL SUB_ASSI, 6
@SHOP_COM_527
CALL SUB_ASSI, 7
@SHOP_COM_528
CALL SUB_ASSI, 8
@SHOP_COM_529
CALL SUB_ASSI, 9

;EMPTYなら予備조수설정、설정済みならASSIをその조수に변경
;現在のASSIと同じキャラだったら해제
@SUB_ASSI, ARG
LOCAL = FINDCHARA_ID(TARGET:ARG)
;---- EDIT 002 ADD START -------------------------
;조건を、ASSI:ARGからLOCALに
IF LOCAL == -1
;---- EDIT 002 ADD END ---------------------------
	CALL SUB_TARGET_SELECT, ARG
ELSE
	IF ASSI == LOCAL
		ASSI = -1
	ELSE
		IF !ISASSI:LOCAL
			PRINTFORML %조사처리(CALLNAME:LOCAL,"는")% 조수경험이 없습니다
			PRINTFORML 정말 조수로 삼으시겠습니까？
			CALL INPUT_YN
			SIF RESULT
				RETURN 0
		ENDIF
		ASSI = LOCAL
		CALL ASSI_CHANGE
		;ISASSI:ASSI = 1
		IF ASSI == TARGET
			TARGET = -1
			FLAG:996 = -1
		ENDIF
	ENDIF
ENDIF

;ARG番눈の予備조수を변경
;@SUB_ASSI_SELECT, ARG
;P = 0
;표시させるキャラを抽出（Q:*に표시するキャラの등록번호、LOCAL:2に人数）
;VARSET Q, 0
;A = 0
;FOR LOCAL, 0, CHARANUM
;	SIF MARK:LOCAL:반발각인 > 0
;		CONTINUE
;	;主人は除外
;	SIF LOCAL == MASTER
;		CONTINUE
;	;노역中キャラは除外
;	SIF CFLAG:LOCAL:노역플래그 == 3
;		CONTINUE
;	;失踪中などこの場にいないなら除外
;	SIF CFLAG:LOCAL:이자리에없는플래그
;		CONTINUE
;	;임신육아중のキャラは除外
;	SIF ((TALENT:LOCAL:임신 && CFLAG:LOCAL:출산예정일 - 2 <= DAY) || TALENT:LOCAL:육아중) && FLAG:출산기능ONOFF == 1
;		CONTINUE
;	;조수가능でないものは除外
;	SIF CFLAG:LOCAL:매각가능 < 2
;		CONTINUE
;	SIF CFLAG:LOCAL:필터링플래그
;		CONTINUE
;
;	Q:A = LOCAL
;	LOCAL:2 = A
;	A += 1
;NEXT

;$PRINT_LIST
;CALL ASSI_LIST
;DRAWLINE
;PRINTFORMLC \@(P <= 0) ? %" " * 16% # [1001]이전페이지\@
;PRINTLC [1000]돌아간다
;PRINTFORMLC \@(P >= (LOCAL:2 - 1) / 20) ? %" " * 16% # [1009]다음페이지\@

;$INPUT_LOOP
;INPUT
;IF RESULT == 1000
;	RETURN 0
;ELSEIF RESULT == 1001
;	IF P > 0
;		P -= 1
;		GOTO PRINT_LIST
;	ELSE
;		GOTO INPUT_LOOP
;	ENDIF
;ELSEIF RESULT == 1009
;	LOCAL = (LOCAL:2 - 1) / 20
;	IF P < LOCAL
;		P += 1
;		GOTO PRINT_LIST
;	ELSE
;		GOTO INPUT_LOOP
;	ENDIF
;ELSEIF RESULT == 0
;	ASSI:ARG = -1
;	RETURN 0
;ELSEIF RESULT < 0 || RESULT >= CHARANUM || MATCH(Q,RESULT,0) == 0
;	GOTO INPUT_LOOP
;ENDIF
;ASSI:ARG = CFLAG:RESULT:캐릭터고유번호

@SHOP_COM_531
CALL SUB_TARGET_SELECT, 1
@SHOP_COM_532
CALL SUB_TARGET_SELECT, 2
@SHOP_COM_533
CALL SUB_TARGET_SELECT, 3
@SHOP_COM_534
CALL SUB_TARGET_SELECT, 4
@SHOP_COM_535
CALL SUB_TARGET_SELECT, 5
@SHOP_COM_536
CALL SUB_TARGET_SELECT, 6
@SHOP_COM_537
CALL SUB_TARGET_SELECT, 7
@SHOP_COM_538
CALL SUB_TARGET_SELECT, 8
@SHOP_COM_539
CALL SUB_TARGET_SELECT, 9
;ARG番눈の予備キャラを변경
@SUB_TARGET_SELECT, ARG
CALL INPUT_CHARA_LIST("예비 조교 대상을 지정하세요", "CASTING_SUB_TARGET_SELECT", "", "", "MODECHANGE_SUB_TARGET_SELECT")
IF RESULT == 1000
	RETURN 0
ELSEIF RESULT == 999
	TARGET:ARG = -1
ELSE
	TARGET:ARG = CFLAG:RESULT:캐릭터고유번호
ENDIF

@CASTING_SUB_TARGET_SELECT(ARG)
;主人は除外
SIF ARG == MASTER
	RETURN 0
;盟友は除外
SIF TALENT:ARG:맹우
	RETURN 0
;노역中キャラは除外
SIF CFLAG:ARG:노역플래그 == 3
	RETURN 0
;임신육아중のキャラは除外
;SIF ((TALENT:ARG:임신 && CFLAG:ARG:출산예정일 - 2 <= DAY) || TALENT:ARG:육아중) && FLAG:출산기능ONOFF == 1
;	RETURN 0
;失踪中などこの場にいないなら除外
SIF CFLAG:ARG:이자리에없는플래그
	RETURN 0
SIF CFLAG:ARG:필터링플래그
	RETURN 0
RETURN 1

@MODECHANGE_SUB_TARGET_SELECT, ARG
SELECTCASE ARG
	CASE -1
		PRINTL 　[999]해제한다
	CASE 999
		RETURN ARG , 0
ENDSELECT
RETURN ARG , 1

;予備조수ボタンを選択가능か＆이름표시
;@SHOPCOMABLE_183
;CALL SUB_ASSI_ABLE, 1
;RETURN RESULT

;@SHOPCOMABLE_184
;CALL SUB_ASSI_ABLE, 2
;RETURN RESULT
;@SHOPCOMABLE_185
;CALL SHOPCOMABLE_108
;RESULTS = 予備변경
;RETURN RESULT


;@SHOP_COM_185
;SIF FINDCHARA_ID(TARGET:1) == -1
;	TARGET:1 = -1
;SIF FINDCHARA_ID(TARGET:2) == -1
;	TARGET:2 = -1
;SIF FINDCHARA_ID(TARGET:3) == -1
;	TARGET:3 = -1
;SIF FINDCHARA_ID(ASSI:1) == -1
;	ASSI:1 = -1
;SIF FINDCHARA_ID(ASSI:2) == -1
;	ASSI:2 = -1
;PRINTFORML [0] 예비조교대상1　\@TARGET:1 > 0 ? %CALLNAME:FINDCHARA_ID(TARGET:1)%# EMPTY\@
;PRINTFORML [1] 예비조교대상2　\@TARGET:2 > 0 ? %CALLNAME:FINDCHARA_ID(TARGET:2)%# EMPTY\@
;PRINTFORML [2] 예비조교대상3　\@TARGET:3 > 0 ? %CALLNAME:FINDCHARA_ID(TARGET:3)%# EMPTY\@
;CALL SHOPCOMABLE_109
;LOCAL = RESULT
;IF LOCAL
;	PRINTFORML [3] 예비조수1　\@ASSI:1 > 0 ? %CALLNAME:FINDCHARA_ID(ASSI:1)%# EMPTY\@
;	PRINTFORML [4] 예비조수2　\@ASSI:2 > 0 ? %CALLNAME:FINDCHARA_ID(ASSI:2)%# EMPTY\@
;ENDIF
;PRINTL [100] 돌아간다
;CALL INPUTINT(0, 1, 2 , LOCAL * 3, LOCAL * 4, 100)
;IF RESULT == 100
;	RETURN 0
;ELSEIF RESULT >= 3
;	CALL SUB_ASSI_SELECT, RESULT - 2
;ELSE
;	CALL SUB_TARGET_SELECT, RESULT + 1
;ENDIF
;RESTART
